Ø³ÙÙØ±Ø© Ø§Ù„Ø¨ÙŠØª (Sofra Al-Bayt) â€” Source Codes Bundle
Generated for IP submission.
NOTE: This bundle excludes standalone HTML/CSS files.


==========================================================================================
FILE: firestore.rules
==========================================================================================
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function signedIn() {
      return request.auth != null;
    }

    function myRole() {
      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role;
    }

    function isOwner() {
      return signedIn() && myRole() == 'owner';
    }

    function isCourier() {
      return signedIn() && myRole() == 'courier';
    }

    function isCustomer() {
      return signedIn() && myRole() == 'customer';
    }

    function isAdmin() {
      return signedIn() && myRole() == 'admin';
    }

    function isDeveloper() {
      return signedIn() && myRole() == 'developer';
    }

    /* ===== users ===== */
    match /users/{uid} {
      allow read: if isOwner() || isAdmin() || isDeveloper() || (signedIn() && request.auth.uid == uid);
      allow create: if signedIn() && request.auth.uid == uid;
      allow update: if signedIn() && request.auth.uid == uid || isDeveloper();
      allow delete: if isDeveloper();
    }

    /* ===== restaurants ===== */
    match /restaurants/{ownerId} {
      allow read: if true;
      allow create: if isOwner() && request.auth.uid == ownerId || isAdmin() || isDeveloper();
      allow update: if isOwner() && request.auth.uid == ownerId || isAdmin() || isDeveloper();
      allow delete: if isDeveloper();
    }

    /* ===== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø­Ø³Ø§Ø³Ø© Ù„Ù„Ù…Ø·Ø§Ø¹Ù… ===== */
    match /restaurants/{ownerId}/private/bankInfo {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… ÙÙ‚Ø· Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ùˆ Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹)
      allow read: if isDeveloper() 
                  || (isOwner() && request.auth.uid == ownerId)
                  || isCustomer();
      // Ø§Ù„ÙƒØªØ§Ø¨Ø©: ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… ÙÙ‚Ø· Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow create, update: if isDeveloper() || (isOwner() && request.auth.uid == ownerId);
      allow delete: if isDeveloper();
    }

    /* ===== menu ===== */
    match /menuItems/{itemId} {
      allow read: if true;
      allow create: if isOwner() && request.resource.data.ownerId == request.auth.uid || isAdmin() || isDeveloper();
      allow update: if isOwner() 
                    && resource.data.ownerId == request.auth.uid
                    && request.resource.data.ownerId == request.auth.uid
                    || isAdmin()
                    || isDeveloper();
      allow delete: if isDeveloper();
    }

    /* ===== orders ===== */
    match /orders/{orderId} {
      allow read: if isOwner()
                  || (isCourier() && (resource.data.courierId == request.auth.uid || resource.data.status in ['ready', 'out_for_delivery']))
                  || (isCustomer() && resource.data.customerId == request.auth.uid)
                  || isAdmin()
                  || isDeveloper();

      allow create: if (isCustomer() && request.resource.data.customerId == request.auth.uid)
                    || (isAdmin() && request.resource.data.customerId == request.auth.uid);

      allow update: if isOwner()
                    || (isCourier() && resource.data.courierId == request.auth.uid)
                    || isAdmin()
                    || isDeveloper();
      allow delete: if isDeveloper();
    }

    /* ===== wallets (for admins and app) ===== */
    match /wallets/{walletId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ùˆ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø­ÙØ¸Ø© (Ø§Ù„Ù…Ø´Ø±Ù)
      allow read: if isDeveloper() || (isAdmin() && request.auth.uid == walletId);
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ù…Ø´Ø±Ù Ù„Ù…Ø­ÙØ¸ØªÙ‡ + Ø§Ù„Ù…Ø·ÙˆØ± + Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø´Ø±Ù Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨)
      allow create: if isDeveloper() 
                    || (isAdmin() && request.auth.uid == walletId)
                    || (isCustomer() && walletId != request.auth.uid); // Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠÙ…ÙƒÙ†Ù‡ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø´Ø±Ù
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ùˆ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø´Ø±Ù Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨)
      allow update: if isDeveloper() 
                    || (isCustomer() && walletId != request.auth.uid); // Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ø¯ÙŠØ« Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø´Ø±Ù
      
      allow delete: if isDeveloper();
    }

    /* ===== settings (single doc like settings/general) ===== */
    match /settings/{doc} {
      allow read: if true;
      allow create, update, delete: if isOwner() || isDeveloper();
    }

    /* ===== packageRequests (Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª) ===== */
    match /packageRequests/{requestId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ùˆ ØµØ§Ø­Ø¨ Ø§Ù„Ø·Ù„Ø¨
      allow read: if isDeveloper() || (isOwner() && resource.data.restaurantId == request.auth.uid);
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… ÙÙ‚Ø·
      allow create: if isOwner() && request.resource.data.restaurantId == request.auth.uid;
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù…Ø·ÙˆØ± (Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù†Ùƒ/Ø§Ù„Ù‚Ø¨ÙˆÙ„/Ø§Ù„Ø±ÙØ¶) Ø£Ùˆ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… (Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„)
      allow update: if isDeveloper() 
                    || (isOwner() && resource.data.restaurantId == request.auth.uid);
      
      // Ø§Ù„Ø­Ø°Ù: Ø§Ù„Ù…Ø·ÙˆØ± ÙÙ‚Ø·
      allow delete: if isDeveloper();
    }

    /* ===== tasks (Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†) ===== */
    match /tasks/{taskId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ùˆ Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø³Ù†Ø¯Ø© Ø¥Ù„ÙŠÙ‡ Ø§Ù„Ù…Ù‡Ù…Ø©
      allow read: if isDeveloper() || (isAdmin() && resource.data.assignedTo == request.auth.uid);
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ù…Ø·ÙˆØ± ÙÙ‚Ø·
      allow create: if isDeveloper();
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ùˆ Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø³Ù†Ø¯Ø© Ø¥Ù„ÙŠÙ‡ Ø§Ù„Ù…Ù‡Ù…Ø© (Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©)
      allow update: if isDeveloper() || (isAdmin() && resource.data.assignedTo == request.auth.uid);
      
      // Ø§Ù„Ø­Ø°Ù: Ø§Ù„Ù…Ø·ÙˆØ± ÙÙ‚Ø·
      allow delete: if isDeveloper();
    }

    /* ===== messages (Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…Ù†Ø¯ÙˆØ¨/Ø§Ù„Ù…Ø·Ø¹Ù…) ===== */
    match /orders/{orderId}/messages/{messageId} {
      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨
      function getOrder() {
        return get(/databases/$(database)/documents/orders/$(orderId)).data;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ø·Ù„Ø¨
      function isOrderParticipant() {
        let order = getOrder();
        return request.auth.uid == order.customerId 
            || request.auth.uid == order.courierId 
            || request.auth.uid == order.restaurantId;
      }
      
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£Ùˆ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… Ø§Ù„Ù…Ø±ØªØ¨Ø·ÙŠÙ† Ø¨Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow read: if isDeveloper() || (signedIn() && isOrderParticipant());
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£Ùˆ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… Ø§Ù„Ù…Ø±ØªØ¨Ø·ÙŠÙ† Ø¨Ø§Ù„Ø·Ù„Ø¨
      allow create: if signedIn() && isOrderParticipant();
      
      // Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø­Ø°Ù
      allow update, delete: if isDeveloper();
    }

    /* ===== hiringRequests (Ø·Ù„Ø¨Ø§Øª ØªÙˆØ¸ÙŠÙ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†) ===== */
    match /hiringRequests/{requestId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ØµØ§Ø­Ø¨ Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow read: if isDeveloper() 
                  || (isCourier() && resource.data.courierId == request.auth.uid)
                  || (isOwner() && resource.data.restaurantId == request.auth.uid);
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ÙÙ‚Ø· (Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªÙˆØ¸ÙŠÙ)
      allow create: if isCourier() && request.resource.data.courierId == request.auth.uid;
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… (Ù„Ù„Ù‚Ø¨ÙˆÙ„/Ø§Ù„Ø±ÙØ¶) Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow update: if isDeveloper() 
                    || (isOwner() && resource.data.restaurantId == request.auth.uid);
      
      // Ø§Ù„Ø­Ø°Ù: Ø§Ù„Ù…Ø·ÙˆØ± ÙÙ‚Ø·
      allow delete: if isDeveloper();
    }

    /* ===== notifications (Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…) ===== */
    match /notifications/{notificationId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ù…Ø³ØªÙ„Ù… Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow read: if isDeveloper() || (signedIn() && resource.data.recipientId == request.auth.uid);
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ùˆ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ (Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø·ÙˆØ±/Ø§Ù„Ù…Ø´Ø±Ù)
      allow create: if signedIn();
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ù„ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©) Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow update: if isDeveloper() || (signedIn() && resource.data.recipientId == request.auth.uid);
      
      // Ø§Ù„Ø­Ø°Ù: Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ùˆ Ø§Ù„Ù…Ø³ØªÙ„Ù…
      allow delete: if isDeveloper() || (signedIn() && resource.data.recipientId == request.auth.uid);
    }

    /* ===== promotions (Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„Ø© Ù„Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø©) ===== */
    match /promotions/{promotionId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø§Ù„Ø¬Ù…ÙŠØ¹ (Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡)
      allow read: if true;
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø³Ø±Ø© ÙÙ‚Ø· (Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø¹Ù„Ø§Ù†)
      allow create: if isOwner() && request.resource.data.ownerId == request.auth.uid;
      
      // Ø§Ù„ØªØ­Ø¯ÙŠØ«: ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø³Ø±Ø© (Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ù„Ø§Ù†Ù‡) Ø£Ùˆ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… (Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª) Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow update: if isDeveloper() 
                    || (isOwner() && resource.data.ownerId == request.auth.uid)
                    || (signedIn() && request.resource.data.diff(resource.data).affectedKeys().hasOnly(['viewsCount']));
      
      // Ø§Ù„Ø­Ø°Ù: ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø³Ø±Ø© (Ù„Ø­Ø°Ù Ø¥Ø¹Ù„Ø§Ù†Ù‡) Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow delete: if isDeveloper() || (isOwner() && resource.data.ownerId == request.auth.uid);
    }

    /* ===== restaurantStats (Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø·Ø§Ø¹Ù…/Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø©) ===== */
    match /restaurantStats/{restaurantId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow read: if isDeveloper() || (isOwner() && request.auth.uid == restaurantId);
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ùˆ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… (Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø©)
      allow create: if signedIn() || isDeveloper();
      allow update: if signedIn() || isDeveloper();
      
      // Ø§Ù„Ø­Ø°Ù: Ø§Ù„Ù…Ø·ÙˆØ± ÙÙ‚Ø·
      allow delete: if isDeveloper();
    }

    /* ===== visitLogs (Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª) ===== */
    match /visitLogs/{logId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… (Ø²ÙŠØ§Ø±Ø§ØªÙ‡ ÙÙ‚Ø·) Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow read: if isDeveloper() || (isOwner() && resource.data.restaurantId == request.auth.uid);
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø£ÙŠ Ø´Ø®Øµ (Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©)
      allow create: if true;
      
      // Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø­Ø°Ù Ø¥Ù„Ø§ Ù„Ù„Ù…Ø·ÙˆØ±
      allow update, delete: if isDeveloper();
    }

    /* ===== customerRegistrations (ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ø¨Ø± Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø³Ø±) ===== */
    match /customerRegistrations/{regId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… (ØªØ³Ø¬ÙŠÙ„Ø§ØªÙ‡ ÙÙ‚Ø·) Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow read: if isDeveloper() || (isOwner() && resource.data.restaurantId == request.auth.uid);
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow create: if signedIn() || isDeveloper();
      
      // Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø­Ø°Ù Ø¥Ù„Ø§ Ù„Ù„Ù…Ø·ÙˆØ±
      allow update, delete: if isDeveloper();
    }

    /* ===== storeFollowers (Ù…ØªØ§Ø¨Ø¹Ùˆ Ø§Ù„Ù…ØªØ§Ø¬Ø±) ===== */
    match /storeFollowers/{followId} {
      // Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… (Ù…ØªØ§Ø¨Ø¹ÙŠÙ‡ ÙÙ‚Ø·) Ø£Ùˆ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ Ù†ÙØ³Ù‡ Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
      allow read: if isDeveloper() 
                  || (isOwner() && resource.data.restaurantId == request.auth.uid)
                  || (signedIn() && resource.data.followerId == request.auth.uid);
      
      // Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„
      allow create: if signedIn() && request.resource.data.followerId == request.auth.uid;
      
      // Ø§Ù„Ø­Ø°Ù: Ø§Ù„Ù…ØªØ§Ø¨Ø¹ Ù†ÙØ³Ù‡ Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ± (Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©)
      allow delete: if isDeveloper() || (signedIn() && resource.data.followerId == request.auth.uid);
      
      // Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¥Ù„Ø§ Ù„Ù„Ù…Ø·ÙˆØ±
      allow update: if isDeveloper();
    }
  }
}



==========================================================================================
FILE: src/App.tsx
==========================================================================================
import React from 'react'
import { Routes, Route, Navigate } from 'react-router-dom'
import { Header } from './components/Header'
import { Footer } from './components/Footer'
import { TopBar } from './components/TopBar'
import { BetaBanner } from './components/BetaBanner'
import { LocationRequired } from './components/LocationRequired'
import { useAuth } from './auth'

// ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
import { Landing } from './pages/Landing'
import { RestaurantsPage } from './pages/RestaurantsPage'
import { MenuPage } from './pages/MenuPage'
import { CartPage } from './pages/CartPage'
import { Login } from './pages/Login'
import { Register } from './pages/Register'
import { CustomerLogin } from './pages/CustomerLogin'
import PrivacyPolicy from './pages/PrivacyPolicy'
import AccountDeleted from './pages/AccountDeleted'

// ØµÙØ­Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
import { CheckoutPage } from './pages/CheckoutPage'
import { TrackOrders } from './pages/TrackOrders'
import { ProfileEdit } from './pages/ProfileEdit'

// ØµÙØ­Ø§Øª ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù…
import { OwnerDashboard } from './pages/OwnerDashboard'
import { ManageMenu } from './pages/ManageMenu'
import { OrdersAdmin } from './pages/OrdersAdmin'
import { EditRestaurant } from './pages/EditRestaurant'
import { CourierRequests } from './pages/CourierRequests'
import { PackagesPage } from './pages/PackagesPage'
import { PromotionPage } from './pages/PromotionPage'

// ØµÙØ­Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
import { CourierApp } from './pages/CourierApp'
import { CourierHiring } from './pages/CourierHiring'
import { ChatPage } from './pages/ChatPage'

// ØµÙØ­Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
import { NotificationsPage } from './pages/NotificationsPage'

// ØµÙØ­Ø§Øª Ø§Ù„Ø¥Ø¯Ù…Ù† ÙˆØ§Ù„Ù…Ø·ÙˆØ±
import { AdminDashboard } from './pages/AdminDashboard'
import { AdminRestaurants } from './pages/AdminRestaurants'
import { AdminOrders } from './pages/AdminOrders'
import { Developer } from './pages/Developer'
import { SetupDeveloper } from './pages/SetupDeveloper'

// Ù…Ø³Ø§Ø±Ø§Øª Ù…Ø­Ù…ÙŠØ©
import { ProtectedRoute } from './routes/ProtectedRoute'
import { RoleGate } from './routes/RoleGate'

// ØµÙØ­Ø© ØªØµØ­ÙŠØ­ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
import { DebugOrders } from './pages/DebugOrders'

export default function App() {
  const { locationRequired, refreshUserData, loading } = useAuth()

  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø·Ù„ÙˆØ¨ØŒ Ù†Ø¹Ø±Ø¶ ØµÙØ­Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
  if (!loading && locationRequired) {
    return <LocationRequired onLocationSaved={refreshUserData} />
  }

  return (
    <div className="min-h-screen flex flex-col bg-gradient-to-b from-sky-50 via-white to-sky-50 text-sky-900">
      {/* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ + Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© - Ø«Ø§Ø¨ØªÙŠÙ† ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© ØªÙ…Ø§Ù…Ø§Ù‹ */}
      <div className="fixed top-0 left-0 right-0 z-50">
        <BetaBanner />
        <TopBar />
        <Header />
      </div>

      {/* Ù…Ø³Ø§ÙØ© ÙØ§Ø±ØºØ© Ø¨Ø­Ø¬Ù… Ø§Ù„Ù‡ÙŠØ¯Ø± */}
      <div className="h-[130px] sm:h-[150px]" />

      {/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */}
      <main className="flex-1 max-w-6xl mx-auto w-full px-4 py-8">
        <Routes>
          {/* Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */}
          <Route path="/" element={<Landing />} />

          {/* ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø·Ø§Ø¹Ù… */}
          <Route path="/restaurants" element={<RestaurantsPage />} />
          <Route path="/menu" element={<MenuPage />} />
          <Route path="/cart" element={<CartPage />} />
          <Route path="/login" element={<Login />} />
          <Route path="/customer-login" element={<CustomerLogin />} />
          <Route path="/register" element={<Register />} />
          <Route path="/privacy-policy" element={<PrivacyPolicy />} />
          <Route path="/account-deleted" element={<AccountDeleted />} />
          <Route path="/setup-dev" element={<SetupDeveloper />} />

          {/* ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */}
          <Route
            path="/chat"
            element={
              <ProtectedRoute>
                <RoleGate allow={['customer', 'courier', 'owner', 'admin']}>
                  <ChatPage />
                </RoleGate>
              </ProtectedRoute>
            }
          />

          {/* ØµÙØ­Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */}
          <Route
            path="/notifications"
            element={
              <ProtectedRoute>
                <RoleGate allow={['customer', 'courier', 'owner', 'admin', 'developer']}>
                  <NotificationsPage />
                </RoleGate>
              </ProtectedRoute>
            }
          />

          {/* ØµÙØ­Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ */}
          <Route
            path="/checkout"
            element={
              <ProtectedRoute>
                <RoleGate allow={['customer', 'admin']}>
                  <CheckoutPage />
                </RoleGate>
              </ProtectedRoute>
            }
          />
          <Route
            path="/orders"
            element={
              <ProtectedRoute>
                <RoleGate allow={['customer', 'admin']}>
                  <TrackOrders />
                </RoleGate>
              </ProtectedRoute>
            }
          />
          <Route
            path="/profile"
            element={
              <ProtectedRoute>
                <RoleGate allow={['customer', 'courier', 'owner', 'admin', 'developer']}>
                  <ProfileEdit />
                </RoleGate>
              </ProtectedRoute>
            }
          />

          {/* ØµÙØ­Ø§Øª ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… */}
          <Route
            path="/owner"
            element={
              <ProtectedRoute>
                <RoleGate allow={['owner']}>
                  <OwnerDashboard />
                </RoleGate>
              </ProtectedRoute>
            }
          />
          <Route
            path="/owner/menu"
            element={
              <ProtectedRoute>
                <RoleGate allow={['owner']}>
                  <ManageMenu />
                </RoleGate>
              </ProtectedRoute>
            }
          />
          <Route
            path="/owner/orders"
            element={
              <ProtectedRoute>
                <RoleGate allow={['owner']}>
                  <OrdersAdmin />
                </RoleGate>
              </ProtectedRoute>
            }
          />
          <Route
            path="/owner/edit"
            element={
              <ProtectedRoute>
                <RoleGate allow={['owner']}>
                  <EditRestaurant />
                </RoleGate>
              </ProtectedRoute>
            }
          />
          <Route
            path="/owner/courier-requests"
            element={
              <ProtectedRoute>
                <RoleGate allow={['owner', 'developer']}>
                  <CourierRequests />
                </RoleGate>
              </ProtectedRoute>
            }
          />
          <Route
            path="/owner/packages"
            element={
              <ProtectedRoute>
                <RoleGate allow={['owner']}>
                  <PackagesPage />
                </RoleGate>
              </ProtectedRoute>
            }
          />
          <Route
            path="/owner/promotion"
            element={
              <ProtectedRoute>
                <RoleGate allow={['owner']}>
                  <PromotionPage />
                </RoleGate>
              </ProtectedRoute>
            }
          />

          {/* ØµÙØ­Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ */}
          <Route
            path="/courier"
            element={
              <ProtectedRoute>
                <RoleGate allow={['courier', 'developer']}>
                  <CourierApp />
                </RoleGate>
              </ProtectedRoute>
            }
          />
          <Route
            path="/courier/hiring"
            element={
              <ProtectedRoute>
                <RoleGate allow={['courier', 'developer']}>
                  <CourierHiring />
                </RoleGate>
              </ProtectedRoute>
            }
          />

          {/* ØµÙØ­Ø§Øª Ø§Ù„Ø¥Ø¯Ù…Ù† (Ø§Ù„Ù…Ø´Ø±Ù) */}
          <Route
            path="/admin"
            element={
              <ProtectedRoute>
                <RoleGate allow={['admin', 'developer']}>
                  <AdminDashboard />
                </RoleGate>
              </ProtectedRoute>
            }
          />
          <Route
            path="/admin/restaurants"
            element={
              <ProtectedRoute>
                <RoleGate allow={['admin', 'developer']}>
                  <AdminRestaurants />
                </RoleGate>
              </ProtectedRoute>
            }
          />
          <Route
            path="/admin/orders"
            element={
              <ProtectedRoute>
                <RoleGate allow={['admin', 'developer']}>
                  <AdminOrders />
                </RoleGate>
              </ProtectedRoute>
            }
          />

          {/* ØµÙØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ± */}
          <Route
            path="/developer"
            element={
              <ProtectedRoute>
                <RoleGate allow={['developer', 'admin']}>
                  <Developer />
                </RoleGate>
              </ProtectedRoute>
            }
          />

          {/* ØµÙØ­Ø© ØªØµØ­ÙŠØ­ Ø§Ù„Ø·Ù„Ø¨Ø§Øª */}
          <Route path="/__debug_orders" element={<DebugOrders />} />

          {/* ØµÙØ­Ø© 404 */}
          <Route path="*" element={<Navigate to="/" replace />} />
        </Routes>
      </main>

      {/* Ø§Ù„ÙÙˆØªØ± */}
      <Footer />
    </div>
  )
}

==========================================================================================
FILE: src/auth.tsx
==========================================================================================
import React, { createContext, useContext, useEffect, useState } from 'react'
import { onAuthStateChanged, signOut, User } from 'firebase/auth'
import { auth, db } from './firebase'
import { doc, getDoc, setDoc, updateDoc } from 'firebase/firestore'

type Role = 'owner' | 'courier' | 'customer' | 'admin' | 'developer'
type GeoLocation = { lat: number; lng: number }

// Ù…ÙØªØ§Ø­ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©
const SESSION_LOCATION_KEY = 'broast_session_location'

type AuthContextType = {
  user: User | null,
  role: Role | null,
  loading: boolean,
  logout: () => Promise<void>,
  userLocation: GeoLocation | null,
  locationRequired: boolean,
  refreshUserData: () => Promise<void>,
}

const AuthContext = createContext<AuthContextType>({
  user: null,
  role: null,
  loading: true,
  logout: async () => {},
  userLocation: null,
  locationRequired: false,
  refreshUserData: async () => {},
})

export const AuthProvider: React.FC<{children: React.ReactNode}> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null)
  const [role, setRole] = useState<Role | null>(null)
  const [loading, setLoading] = useState(true)
  const [userLocation, setUserLocation] = useState<GeoLocation | null>(null)
  const [locationRequired, setLocationRequired] = useState(false)

  // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ØªÙØ³ØªØ¯Ø¹Ù‰ Ø¨Ø¹Ø¯ Ø­ÙØ¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹)
  const refreshUserData = async () => {
    if (!user) return
    const snap = await getDoc(doc(db, 'users', user.uid))
    if (snap.exists()) {
      const data = snap.data()
      const r = data?.role as Role | undefined
      const loc = data?.location as GeoLocation | undefined
      const customerSavedLoc = data?.savedLocation as { lat: number; lng: number; address: string } | undefined
      
      // Ù„Ù„Ø¹Ù…ÙŠÙ„: Ø§Ø³ØªØ®Ø¯Ø§Ù… savedLocationØŒ Ù„ØºÙŠØ±Ù‡Ù…: location
      if (r === 'customer' || r === 'admin') {
        const customerLoc = customerSavedLoc 
          ? { lat: customerSavedLoc.lat, lng: customerSavedLoc.lng }
          : loc || null
        setUserLocation(customerLoc)
        if (customerLoc) {
          sessionStorage.setItem(SESSION_LOCATION_KEY, JSON.stringify(customerLoc))
        }
      } else {
        setUserLocation(loc || null)
        if (loc) {
          sessionStorage.setItem(SESSION_LOCATION_KEY, JSON.stringify(loc))
        }
      }
      setLocationRequired(false)
    }
  }

  useEffect(() => {
    const unsub = onAuthStateChanged(auth, async (u) => {
      setUser(u)
      if (u) {
        const snap = await getDoc(doc(db, 'users', u.uid))
        const data = snap.data()
        const r = snap.exists() ? (data?.role as Role) : null
        setRole(r)
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ - Ù„Ù„Ø¹Ù…ÙŠÙ„ Ù†Ø³ØªØ®Ø¯Ù… savedLocationØŒ Ù„ØºÙŠØ±Ù‡Ù… location
        const savedLoc = data?.location as GeoLocation | undefined
        const customerSavedLoc = data?.savedLocation as { lat: number; lng: number; address: string } | undefined
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const sessionLocStr = sessionStorage.getItem(SESSION_LOCATION_KEY)
        const sessionLoc = sessionLocStr ? JSON.parse(sessionLocStr) as GeoLocation : null
        
        // Ù„Ù„Ø¹Ù…ÙŠÙ„: Ø§Ø³ØªØ®Ø¯Ø§Ù… savedLocation Ø§Ù„Ù…Ø­ÙÙˆØ¸ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
        // Ù„ØºÙŠØ±Ù‡Ù…: Ø§Ø³ØªØ®Ø¯Ø§Ù… location Ø§Ù„Ø¹Ø§Ø¯ÙŠ
        let currentLoc: GeoLocation | null = null
        if (r === 'customer' || r === 'admin') {
          // Ø§Ù„Ø¹Ù…ÙŠÙ„/Ø§Ù„Ù…Ø´Ø±Ù: Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨
          currentLoc = customerSavedLoc 
            ? { lat: customerSavedLoc.lat, lng: customerSavedLoc.lng }
            : sessionLoc || savedLoc || null
        } else {
          currentLoc = sessionLoc || savedLoc || null
        }
        setUserLocation(currentLoc)
        
        // ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø·Ù„ÙˆØ¨Ø§Ù‹
        if (r === 'customer' || r === 'admin') {
          // Ø§Ù„Ø¹Ù…ÙŠÙ„/Ø§Ù„Ù…Ø´Ø±Ù: Ù„Ø§ ÙŠÙØ·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø­ÙÙˆØ¸Ø§Ù‹ ÙÙŠ Ø­Ø³Ø§Ø¨Ù‡ Ø£Ùˆ ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø©
          const hasLocation = !!customerSavedLoc || !!sessionLoc
          
          // ğŸ“ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…ÙˆÙ‚Ø¹ØŒ Ù†Ø­Ø§ÙˆÙ„ ØªØ­Ø¯ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
          if (!hasLocation && navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
              async (pos) => {
                const autoLocation = {
                  lat: pos.coords.latitude,
                  lng: pos.coords.longitude,
                  address: 'Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (ØªÙ„Ù‚Ø§Ø¦ÙŠ)'
                }
                // Ø­ÙØ¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨
                try {
                  await updateDoc(doc(db, 'users', u.uid), {
                    savedLocation: autoLocation,
                    location: { lat: autoLocation.lat, lng: autoLocation.lng }
                  })
                  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                  setUserLocation({ lat: autoLocation.lat, lng: autoLocation.lng })
                  sessionStorage.setItem(SESSION_LOCATION_KEY, JSON.stringify({ lat: autoLocation.lat, lng: autoLocation.lng }))
                  setLocationRequired(false)
                } catch (err) {
                  console.warn('ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', err)
                }
              },
              (err) => {
                console.warn('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:', err)
                // Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ù†Ø·Ù„Ø¨Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹
                setLocationRequired(true)
              },
              { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            )
          } else {
            setLocationRequired(!hasLocation)
          }
          
          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ù†Ø¯Ù‡ Ù…ÙˆÙ‚Ø¹ Ù…Ø­ÙÙˆØ¸ØŒ Ù†Ø­ÙØ¸Ù‡ ÙÙŠ sessionStorage Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ø±ÙŠØ¹
          if (customerSavedLoc && !sessionLoc) {
            sessionStorage.setItem(SESSION_LOCATION_KEY, JSON.stringify({ lat: customerSavedLoc.lat, lng: customerSavedLoc.lng }))
          }
        } else if (r === 'owner' || r === 'courier') {
          // Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ÙˆØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù…: ÙŠØ·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… ÙŠØ­ÙØ¸ Ù…Ù† Ù‚Ø¨Ù„
          setLocationRequired(!savedLoc)
        } else {
          setLocationRequired(false)
        }

        // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø·Ø¹Ù… Ù„Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
        if (r === 'owner') {
          try {
            const restRef = doc(db, 'restaurants', u.uid)
            const restSnap = await getDoc(restRef)
            if (!restSnap.exists()) {
              await setDoc(restRef, {
                name: data?.restaurantName || data?.name || 'Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯',
                ownerId: u.uid,
                email: data?.email || u.email || '',
                phone: '',
                city: '',
                location: '',
                logoUrl: '',
              }, { merge: true })
            }
          } catch (err) {
            console.warn('ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø·Ø¹Ù… Ù„Ù„Ù…Ø§Ù„Ùƒ', err)
          }
        }
      } else {
        setRole(null)
        setUserLocation(null)
        setLocationRequired(false)
      }
      setLoading(false)
    })
    return () => unsub()
  }, [])

  const logout = async () => { await signOut(auth) }

  return (
    <AuthContext.Provider value={{ user, role, loading, logout, userLocation, locationRequired, refreshUserData }}>
      {children}
    </AuthContext.Provider>
  )
}

export const useAuth = () => useContext(AuthContext)

==========================================================================================
FILE: src/components/BetaBanner.tsx
==========================================================================================
// src/components/BetaBanner.tsx
import React from 'react'
import { FlaskConical } from 'lucide-react'

export const BetaBanner: React.FC = () => {
  return (
    <div className="w-full bg-gradient-to-r from-amber-500 via-orange-500 to-amber-500 text-white py-1.5 overflow-hidden">
      <div className="flex items-center justify-center gap-2">
        <FlaskConical className="w-4 h-4 text-white animate-pulse flex-shrink-0" />
        <div className="beta-marquee whitespace-nowrap font-bold text-xs tracking-wide">
          ğŸ§ª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© (Beta) â€” Ù†Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ­Ø³ÙŠÙ†Ù‡ Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø±! ğŸš€
        </div>
        <FlaskConical className="w-4 h-4 text-white animate-pulse flex-shrink-0" />
      </div>
    </div>
  )
}

==========================================================================================
FILE: src/components/Button.tsx
==========================================================================================
// src/components/Button.tsx
import React from "react"

type ButtonProps = {
  children: React.ReactNode
  onClick?: () => void
  type?: "button" | "submit" | "reset"
  disabled?: boolean
  className?: string
}

export const Button: React.FC<ButtonProps> = ({
  children,
  onClick,
  type = "button",
  disabled = false,
  className = "",
}) => {
  return (
    <button
      type={type}
      onClick={onClick}
      disabled={disabled}
      className={`
        bg-yellow-500 hover:bg-yellow-600 text-black font-bold px-4 py-2 
        rounded-xl shadow-md transition transform hover:scale-105
        disabled:opacity-50 disabled:cursor-not-allowed
        ${className}
      `}
    >
      {children}
    </button>
  )
}

==========================================================================================
FILE: src/components/Footer.tsx
==========================================================================================
import React from "react";
import { Link, useNavigate } from "react-router-dom";
import { auth, db } from "@/firebase";
import { deleteUser } from "firebase/auth";
import { doc, deleteDoc } from "firebase/firestore";
import { useAuth } from "@/auth";
import { Heart, Shield, Trash2, Code2 } from "lucide-react";
import { useDialog } from "@/components/ui/ConfirmDialog";

export const Footer: React.FC = () => {
  const { user } = useAuth();
  const navigate = useNavigate();
  const dialog = useDialog();

  const handleDeleteAccount = async () => {
    if (!user) return;

    const confirmDelete = await dialog.confirm(
      'Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡. Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§.',
      { title: 'Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ', dangerous: true, confirmText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù Ø­Ø³Ø§Ø¨ÙŠ', cancelText: 'Ø¥Ù„ØºØ§Ø¡' }
    );
    if (!confirmDelete) return;

    try {
      await deleteDoc(doc(db, "users", user.uid));
      await deleteUser(auth.currentUser!);

      dialog.success('ØªÙ… Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­');
      navigate("/account-deleted");
    } catch (error: any) {
      console.error("Error deleting account:", error);
      dialog.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§.');
    }
  };

  return (
    <footer className="bg-gradient-to-b from-sky-600 to-sky-700 text-white text-center py-8 sm:py-10 mt-12 sm:mt-16 shadow-[0_-10px_40px_rgba(14,165,233,0.2)]">
      <div className="max-w-4xl mx-auto flex flex-col items-center gap-4 sm:gap-6 px-4">
        
        {/* Ø§Ù„Ø´Ø¹Ø§Ø± */}
        <div className="flex items-center gap-2 sm:gap-3">
          <div className="w-10 h-10 sm:w-12 sm:h-12 bg-white rounded-xl sm:rounded-2xl flex items-center justify-center shadow-lg">
            <span className="text-2xl sm:text-3xl">ğŸ—</span>
          </div>
          <span className="text-xl sm:text-2xl font-black">Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª</span>
        </div>

        {/* Ø§Ù„Ù†Øµ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */}
        <p className="text-xs sm:text-sm md:text-base font-medium text-sky-100 flex items-center gap-2">
          ØµÙ†Ø¹ Ø¨Ù€ <Heart className="w-3 h-3 sm:w-4 sm:h-4 text-red-400 fill-red-400" /> ÙÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Â© {new Date().getFullYear()}
        </p>

        {/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */}
        <div className="flex flex-wrap justify-center items-center gap-2 sm:gap-3">
          {/* Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© */}
          <Link
            to="/privacy-policy"
            className="flex items-center gap-1.5 sm:gap-2 bg-white/20 backdrop-blur-sm text-white font-semibold px-3 sm:px-5 py-2 sm:py-2.5 rounded-xl sm:rounded-2xl hover:bg-white/30 hover:scale-105 transition-all duration-300 text-xs sm:text-sm"
          >
            <Shield className="w-3 h-3 sm:w-4 sm:h-4" />
            Ø§Ù„Ø®ØµÙˆØµÙŠØ©
          </Link>

          {/* Ø§Ù„Ù…Ø·ÙˆØ± */}
          <Link
            to="/developer"
            className="flex items-center gap-1.5 sm:gap-2 bg-white/20 backdrop-blur-sm text-white font-semibold px-3 sm:px-5 py-2 sm:py-2.5 rounded-xl sm:rounded-2xl hover:bg-white/30 hover:scale-105 transition-all duration-300 text-xs sm:text-sm"
          >
            <Code2 className="w-3 h-3 sm:w-4 sm:h-4" />
            Ø§Ù„Ù…Ø·ÙˆØ±
          </Link>

          {/* Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ */}
          {user && (
            <button
              onClick={handleDeleteAccount}
              className="flex items-center gap-1.5 sm:gap-2 bg-red-500/80 backdrop-blur-sm text-white font-semibold px-3 sm:px-5 py-2 sm:py-2.5 rounded-xl sm:rounded-2xl hover:bg-red-500 hover:scale-105 transition-all duration-300 text-xs sm:text-sm"
            >
              <Trash2 className="w-3 h-3 sm:w-4 sm:h-4" />
              Ø­Ø°Ù Ø­Ø³Ø§Ø¨ÙŠ
            </button>
          )}
        </div>

        {/* Ø®Ø· ÙØ§ØµÙ„ */}
        <div className="w-24 sm:w-32 h-1 bg-white/20 rounded-full"></div>

        {/* Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± */}
        <p className="text-[10px] sm:text-xs text-sky-200">
          Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù€ Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª
        </p>
      </div>
    </footer>
  );
};

==========================================================================================
FILE: src/components/Header.tsx
==========================================================================================
// src/components/Header.tsx
import React, { useState, useEffect } from "react";
import { Link, useLocation, useNavigate } from "react-router-dom";
import { useAuth } from "@/auth";
import { Menu, X, Home, ShoppingCart, Package, Store, Truck, Shield, Code2, ArrowRight, User, Bell } from "lucide-react";
import { db } from "@/firebase";
import { collection, query, where, onSnapshot } from "firebase/firestore";

const NavLink: React.FC<{ to: string; label: string; icon?: React.ReactNode; onClick?: () => void }> = ({
  to,
  label,
  icon,
  onClick,
}) => {
  const { pathname } = useLocation();
  const active = pathname === to;
  return (
    <Link
      to={to}
      onClick={onClick}
      className={
        "flex items-center gap-2 px-4 py-3 sm:py-2.5 rounded-2xl text-sm font-bold transition-all duration-300 " +
        (active
          ? "bg-white text-sky-600 shadow-lg shadow-sky-200/50 scale-105"
          : "text-white/90 hover:text-white hover:bg-white/20 backdrop-blur-sm")
      }
    >
      {icon}
      <span>{label}</span>
    </Link>
  );
};

export const Header: React.FC = () => {
  const { user, role, logout } = useAuth();
  const [open, setOpen] = useState(false);
  const [unreadCount, setUnreadCount] = useState(0);
  const location = useLocation();
  const navigate = useNavigate();

  // Ù‡Ù„ Ù†Ø­Ù† ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŸ
  const isHome = location.pathname === '/';

  // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØµÙØ­Ø©
  useEffect(() => {
    setOpen(false);
  }, [location.pathname]);

  // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
  useEffect(() => {
    if (open) {
      document.body.style.overflow = 'hidden';
    } else {
      document.body.style.overflow = '';
    }
    return () => { document.body.style.overflow = ''; };
  }, [open]);

  // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©
  useEffect(() => {
    if (!user?.uid) {
      setUnreadCount(0);
      return;
    }

    const q = query(
      collection(db, 'notifications'),
      where('recipientId', '==', user.uid),
      where('read', '==', false)
    );

    const unsub = onSnapshot(q, (snap) => {
      setUnreadCount(snap.size);
    }, (error) => {
      console.warn('Notifications listener error:', error);
      setUnreadCount(0);
    });

    return () => unsub();
  }, [user?.uid]); // âœ… Ø§Ø³ØªØ®Ø¯Ù… user.uid Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† user object

  return (
    <header className="bg-gradient-to-r from-sky-600/95 via-sky-500/95 to-sky-600/95 backdrop-blur-lg shadow-xl shadow-sky-200/30">
      <div className="max-w-6xl mx-auto px-3 sm:px-4 py-3 sm:py-4 flex items-center justify-between">
        {/* Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ + Ø´Ø¹Ø§Ø± */}
        <div className="flex items-center gap-2">
          {/* Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ - ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… Ù†ÙƒÙ† ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */}
          {!isHome && (
            <button
              onClick={() => navigate(-1)}
              className="w-9 h-9 sm:w-10 sm:h-10 bg-white/20 hover:bg-white/30 rounded-xl flex items-center justify-center text-white transition-all"
              aria-label="Ø±Ø¬ÙˆØ¹"
            >
              <ArrowRight className="w-5 h-5" />
            </button>
          )}
          
          <button
            onClick={() => window.location.href = '/'}
            className="text-xl sm:text-2xl font-black text-white flex items-center gap-2 sm:gap-3 hover:scale-105 transition-transform drop-shadow-lg"
          >
            <div className="w-9 h-9 sm:w-10 sm:h-10 bg-white rounded-xl sm:rounded-2xl flex items-center justify-center shadow-lg">
              <span className="text-xl sm:text-2xl">ğŸ—</span>
            </div>
            <span className="text-lg sm:text-2xl">Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª</span>
          </button>
        </div>

        {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯ÙŠØ³ÙƒØªÙˆØ¨ */}
        <nav className="hidden md:flex items-center gap-1 lg:gap-2">
          <NavLink to="/restaurants" label="Ø§Ù„Ù…Ø·Ø§Ø¹Ù…" icon={<Store className="w-4 h-4" />} />

          {/* ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙ‚Ø· */}
          {role === "customer" && (
            <>
              <NavLink to="/cart" label="ğŸ›’ Ø§Ù„Ø³Ù„Ø©" />
              <NavLink to="/orders" label="Ø·Ù„Ø¨Ø§ØªÙŠ" />
              <NavLink to="/profile" label="Ø¨ÙŠØ§Ù†Ø§ØªÙŠ" icon={<User className="w-4 h-4" />} />
            </>
          )}

          {/* ğŸ‘¨â€ğŸ³ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… */}
          {role === "owner" && (
            <>
              <NavLink to="/owner" label="Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·Ø¹Ù…" />
              <NavLink to="/owner/orders" label="Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù…" />
              <NavLink to="/owner/courier-requests" label="Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†" />
            </>
          )}

          {/* ğŸšš Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ */}
          {role === "courier" && (
            <>
              <NavLink to="/courier" label="ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨" />
              <NavLink to="/courier/hiring" label="Ø§Ù„ØªÙˆØ¸ÙŠÙ" />
            </>
          )}

          {/* ğŸ” Ø§Ù„Ø¥Ø¯Ù…Ù† */}
          {role === "admin" && (
            <NavLink to="/admin" label="Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©" />
          )}

          {/* ğŸ‘¨â€ğŸ’» Ø§Ù„Ù…Ø·ÙˆØ± */}
          {role === "developer" && (
            <NavLink to="/developer" label="Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ±" />
          )}

          {/* ğŸ”” Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */}
          {user && (
            <Link
              to="/notifications"
              className="relative p-2.5 rounded-xl bg-white/20 hover:bg-white/30 transition text-white"
              title="Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª"
            >
              <Bell className="w-5 h-5" />
              {unreadCount > 0 && (
                <span className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-bold animate-pulse">
                  {unreadCount > 9 ? '9+' : unreadCount}
                </span>
              )}
            </Link>
          )}

          {/* Ø¯Ø®ÙˆÙ„/Ø®Ø±ÙˆØ¬ */}
          {user ? (
            <button
              onClick={logout}
              className="px-5 py-2.5 rounded-2xl text-sm font-bold text-sky-600 bg-white shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300"
            >
              Ø®Ø±ÙˆØ¬
            </button>
          ) : (
            <NavLink to="/login" label="Ø¯Ø®ÙˆÙ„" />
          )}
        </nav>

        {/* Ø²Ø± Ø§Ù„Ù…ÙŠÙ†ÙŠÙˆ Ù„Ù„Ø¬ÙˆØ§Ù„ */}
        <button
          className="md:hidden p-2.5 rounded-2xl bg-white/20 hover:bg-white/30 transition backdrop-blur-sm"
          onClick={() => setOpen(!open)}
        >
          {open ? (
            <X className="w-6 h-6 text-white" />
          ) : (
            <Menu className="w-6 h-6 text-white" />
          )}
        </button>
      </div>

      {/* overlay Ø®Ù„ÙÙŠØ© */}
      {open && (
        <div 
          className="fixed inset-0 bg-black/50 z-40 md:hidden backdrop-blur-sm"
          onClick={() => setOpen(false)}
        />
      )}

      {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ù†Ø²Ù„Ù‚Ø© */}
      <div className={`
        fixed top-0 right-0 h-full w-72 max-w-[80vw] bg-gradient-to-b from-sky-500 to-sky-700 
        z-50 md:hidden transform transition-transform duration-300 ease-out shadow-2xl
        ${open ? 'translate-x-0' : 'translate-x-full'}
      `}>
        {/* Ø±Ø£Ø³ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */}
        <div className="flex items-center justify-between p-4 border-b border-white/20">
          <span className="text-white font-bold text-lg">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
          <button 
            onClick={() => setOpen(false)}
            className="p-2 rounded-xl bg-white/20 hover:bg-white/30 transition"
          >
            <X className="w-5 h-5 text-white" />
          </button>
        </div>

        {/* Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */}
        <div className="p-4 flex flex-col gap-2 overflow-y-auto max-h-[calc(100vh-80px)]">
          <NavLink
            to="/restaurants"
            label="Ø§Ù„Ù…Ø·Ø§Ø¹Ù…"
            icon={<Store className="w-5 h-5" />}
            onClick={() => setOpen(false)}
          />

          {/* ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙ‚Ø· */}
          {role === "customer" && (
            <>
              <NavLink
                to="/cart"
                label="Ø§Ù„Ø³Ù„Ø©"
                icon={<ShoppingCart className="w-5 h-5" />}
                onClick={() => setOpen(false)}
              />
              <NavLink
                to="/orders"
                label="Ø·Ù„Ø¨Ø§ØªÙŠ"
                icon={<Package className="w-5 h-5" />}
                onClick={() => setOpen(false)}
              />
              <NavLink
                to="/profile"
                label="Ø¨ÙŠØ§Ù†Ø§ØªÙŠ"
                icon={<User className="w-5 h-5" />}
                onClick={() => setOpen(false)}
              />
            </>
          )}

          {/* ğŸ‘¨â€ğŸ³ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… */}
          {role === "owner" && (
            <>
              <NavLink
                to="/owner"
                label="Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·Ø¹Ù…"
                icon={<Home className="w-5 h-5" />}
                onClick={() => setOpen(false)}
              />
              <NavLink
                to="/owner/orders"
                label="Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù…"
                icon={<Package className="w-5 h-5" />}
                onClick={() => setOpen(false)}
              />
              <NavLink
                to="/owner/courier-requests"
                label="Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†"
                icon={<Truck className="w-5 h-5" />}
                onClick={() => setOpen(false)}
              />
            </>
          )}

          {/* ğŸšš Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ */}
          {role === "courier" && (
            <>
              <NavLink
                to="/courier"
                label="ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨"
                icon={<Truck className="w-5 h-5" />}
                onClick={() => setOpen(false)}
              />
              <NavLink
                to="/courier/hiring"
                label="Ø§Ù„ØªÙˆØ¸ÙŠÙ"
                icon={<Package className="w-5 h-5" />}
                onClick={() => setOpen(false)}
              />
            </>
          )}

          {/* ğŸ” Ø§Ù„Ø¥Ø¯Ù…Ù† */}
          {role === "admin" && (
            <NavLink 
              to="/admin" 
              label="Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©" 
              icon={<Shield className="w-5 h-5" />}
              onClick={() => setOpen(false)} 
            />
          )}

          {/* ğŸ‘¨â€ğŸ’» Ø§Ù„Ù…Ø·ÙˆØ± */}
          {role === "developer" && (
            <NavLink 
              to="/developer" 
              label="Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ±" 
              icon={<Code2 className="w-5 h-5" />}
              onClick={() => setOpen(false)} 
            />
          )}

          {/* ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */}
          {user && (
            <NavLink 
              to="/notifications" 
              label={`Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ${unreadCount > 0 ? `(${unreadCount})` : ''}`}
              icon={<Bell className="w-5 h-5" />}
              onClick={() => setOpen(false)} 
            />
          )}

          {/* ÙØ§ØµÙ„ */}
          <div className="h-px bg-white/20 my-2"></div>

          {user ? (
            <button
              onClick={() => {
                logout();
                setOpen(false);
              }}
              className="w-full mt-2 px-5 py-3 rounded-2xl text-sm font-bold text-sky-600 bg-white shadow-lg hover:scale-105 transition-all duration-300 text-center"
            >
              ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </button>
          ) : (
            <NavLink
              to="/login"
              label="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"
              icon={<Home className="w-5 h-5" />}
              onClick={() => setOpen(false)}
            />
          )}
        </div>
      </div>
    </header>
  );
};

==========================================================================================
FILE: src/components/LocationPicker.tsx
==========================================================================================
// src/components/LocationPicker.tsx
import React, { useState, useEffect, useCallback } from 'react'
import { MapPin, Navigation, Check, X, Loader2, Target, Smartphone, Search, PenLine, Map } from 'lucide-react'

type Location = { lat: number; lng: number }

type SearchResult = {
  display_name: string
  lat: string
  lon: string
}

type Props = {
  isOpen: boolean
  onClose: () => void
  onConfirm: (location: Location, address: string) => void
  initialLocation?: Location | null
}

export const LocationPicker: React.FC<Props> = ({ isOpen, onClose, onConfirm, initialLocation }) => {
  const [location, setLocation] = useState<Location | null>(initialLocation || null)
  const [address, setAddress] = useState('')
  const [loading, setLoading] = useState(false)
  const [gpsLoading, setGpsLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [mapReady, setMapReady] = useState(false)
  const [searchQuery, setSearchQuery] = useState('')
  const [searchResults, setSearchResults] = useState<SearchResult[]>([])
  const [searchLoading, setSearchLoading] = useState(false)
  const [showResults, setShowResults] = useState(false)
  // ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„: Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø£Ùˆ ÙŠØ¯ÙˆÙŠ
  const [inputMode, setInputMode] = useState<'map' | 'manual'>('map')

  // ğŸ¯ Ù…ÙˆÙ‚Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø§Ù„Ø±ÙŠØ§Ø¶)
  const defaultLocation: Location = { lat: 24.7136, lng: 46.6753 }

  // ï¿½ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†Ø§Ø·Ù‚
  const searchPlaces = useCallback(async (query: string) => {
    if (!query.trim() || query.length < 2) {
      setSearchResults([])
      setShowResults(false)
      return
    }

    setSearchLoading(true)
    try {
      // Ø¥Ø¶Ø§ÙØ© "Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©" Ù„Ù„Ø¨Ø­Ø« Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      const searchTerm = query.includes('Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©') ? query : `${query}, Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©`
      const response = await fetch(
        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchTerm)}&limit=5&accept-language=ar`,
        {
          headers: {
            'Accept': 'application/json',
          }
        }
      )
      const data = await response.json()
      setSearchResults(data)
      setShowResults(data.length > 0)
    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«:', err)
      setSearchResults([])
    } finally {
      setSearchLoading(false)
    }
  }, [])

  // ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ù†ØªÙŠØ¬Ø© Ø¨Ø­Ø«
  const selectSearchResult = useCallback((result: SearchResult) => {
    const newLoc = { lat: parseFloat(result.lat), lng: parseFloat(result.lon) }
    setLocation(newLoc)
    setSearchQuery('')
    setSearchResults([])
    setShowResults(false)
    
    // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø®ØªØ§Ø±
    if ((window as any).leafletMap) {
      (window as any).leafletMap.setView([newLoc.lat, newLoc.lng], 16, {
        animate: true,
        duration: 0.5
      })
      if ((window as any).leafletMarker) {
        (window as any).leafletMarker.setLatLng([newLoc.lat, newLoc.lng])
      }
    }
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† ÙƒØ¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    const shortName = result.display_name.split(',').slice(0, 3).join('ØŒ')
    setAddress(shortName)
  }, [])

  // ï¿½ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ø¨Ø± GPS
  const getGPSLocation = useCallback(() => {
    if (!navigator.geolocation) {
      setError('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹')
      return
    }

    setGpsLoading(true)
    setError(null)

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const newLoc = { lat: pos.coords.latitude, lng: pos.coords.longitude }
        setLocation(newLoc)
        setGpsLoading(false)
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        if ((window as any).leafletMap) {
          (window as any).leafletMap.setView([newLoc.lat, newLoc.lng], 17)
          if ((window as any).leafletMarker) {
            (window as any).leafletMarker.setLatLng([newLoc.lat, newLoc.lng])
          }
        }
      },
      (err) => {
        setGpsLoading(false)
        if (err.code === 1) {
          setError('ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹. ÙØ¹Ù‘Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­')
        } else if (err.code === 2) {
          setError('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ GPS')
        } else {
          setError('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰')
        }
      },
      { 
        enableHighAccuracy: true, 
        timeout: 15000,
        maximumAge: 0 
      }
    )
  }, [])

  // ğŸ—ºï¸ ØªØ­Ù…ÙŠÙ„ Leaflet
  useEffect(() => {
    if (!isOpen) return

    // ØªØ­Ù…ÙŠÙ„ CSS
    if (!document.getElementById('leaflet-css')) {
      const link = document.createElement('link')
      link.id = 'leaflet-css'
      link.rel = 'stylesheet'
      link.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css'
      document.head.appendChild(link)
    }

    // ØªØ­Ù…ÙŠÙ„ JS
    if (!(window as any).L) {
      const script = document.createElement('script')
      script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js'
      script.onload = () => setMapReady(true)
      document.body.appendChild(script)
    } else {
      setMapReady(true)
    }
  }, [isOpen])

  // ğŸ—ºï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  useEffect(() => {
    if (!isOpen || !mapReady || !(window as any).L) return

    const L = (window as any).L
    const container = document.getElementById('location-map')
    if (!container) return

    // Ø¥Ø²Ø§Ù„Ø© Ø®Ø±ÙŠØ·Ø© Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
    if ((window as any).leafletMap) {
      (window as any).leafletMap.remove()
    }

    const startLoc = location || defaultLocation

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    const map = L.map('location-map', {
      zoomControl: false,
      attributionControl: false,
    }).setView([startLoc.lat, startLoc.lng], location ? 17 : 12)

    // Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© (OpenStreetMap Ø®ÙÙŠÙ ÙˆØ³Ø±ÙŠØ¹)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(map)

    // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø§Ø±ÙƒØ±
    const customIcon = L.divIcon({
      className: 'custom-marker',
      html: `
        <div style="
          width: 50px; 
          height: 50px; 
          background: linear-gradient(135deg, #0EA5E9, #0284C7);
          border-radius: 50% 50% 50% 0;
          transform: rotate(-45deg);
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 4px 20px rgba(14, 165, 233, 0.5);
          border: 3px solid white;
        ">
          <div style="transform: rotate(45deg); color: white; font-size: 20px;">ğŸ“</div>
        </div>
      `,
      iconSize: [50, 50],
      iconAnchor: [25, 50],
    })

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø±ÙƒØ±
    const marker = L.marker([startLoc.lat, startLoc.lng], { 
      icon: customIcon,
      draggable: true 
    }).addTo(map)

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ Ø³Ø­Ø¨ Ø§Ù„Ù…Ø§Ø±ÙƒØ±
    marker.on('dragend', () => {
      const pos = marker.getLatLng()
      setLocation({ lat: pos.lat, lng: pos.lng })
    })

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    map.on('click', (e: any) => {
      const { lat, lng } = e.latlng
      marker.setLatLng([lat, lng])
      setLocation({ lat, lng })
    })

    // Ø­ÙØ¸ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹
    ;(window as any).leafletMap = map
    ;(window as any).leafletMarker = marker

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯
    if (location) {
      setLocation(location)
    }

    return () => {
      if ((window as any).leafletMap) {
        (window as any).leafletMap.remove()
        ;(window as any).leafletMap = null
        ;(window as any).leafletMarker = null
      }
    }
  }, [isOpen, mapReady])

  // ğŸ“ ØªÙ…Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
  const centerOnLocation = () => {
    if (location && (window as any).leafletMap) {
      (window as any).leafletMap.setView([location.lat, location.lng], 17, {
        animate: true,
        duration: 0.5
      })
    }
  }

  // âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
  const handleConfirm = () => {
    // ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙŠØ¯ÙˆÙŠØŒ Ù„Ø§ Ù†Ø­ØªØ§Ø¬ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
    if (inputMode === 'manual') {
      if (!address.trim()) {
        setError('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ')
        return
      }
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ø§Ù„Ø±ÙŠØ§Ø¶) Ù„Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙŠØ¯ÙˆÙŠ
      onConfirm({ lat: 24.7136, lng: 46.6753 }, address)
      return
    }
    
    // ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    if (!location) {
      setError('Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø£ÙˆÙ„Ø§Ù‹')
      return
    }
    if (!address.trim()) {
      setError('Ø£Ø¯Ø®Ù„ ÙˆØµÙ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†')
      return
    }
    onConfirm(location, address)
  }

  if (!isOpen) return null

  return (
    <div className="fixed inset-0 z-[9999] flex items-center justify-center">
      {/* Ø®Ù„ÙÙŠØ© Ù…Ø¹ØªÙ…Ø© */}
      <div 
        className="absolute inset-0 bg-black/60 backdrop-blur-sm"
        onClick={onClose}
      />

      {/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */}
      <div className="relative w-full h-full sm:w-[95%] sm:h-[90%] sm:max-w-2xl sm:rounded-3xl overflow-hidden bg-white shadow-2xl flex flex-col">
        
        {/* Ø§Ù„Ù‡ÙŠØ¯Ø± */}
        <div className="bg-gradient-to-r from-sky-500 to-sky-600 text-white p-4">
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                <MapPin className="w-5 h-5" />
              </div>
              <div>
                <h2 className="font-bold text-lg">ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„</h2>
                <p className="text-sm text-white/80">
                  {inputMode === 'map' ? 'Ø§Ø¨Ø­Ø« Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„Ø¯Ø¨ÙˆØ³' : 'Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù†Ùƒ ÙŠØ¯ÙˆÙŠØ§Ù‹'}
                </p>
              </div>
            </div>
            <button 
              onClick={onClose}
              className="w-10 h-10 bg-white/20 hover:bg-white/30 rounded-xl flex items-center justify-center transition"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
          
          {/* ğŸ”„ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹: Ø®Ø±ÙŠØ·Ø© / ÙŠØ¯ÙˆÙŠ */}
          <div className="flex gap-2 mb-3">
            <button
              onClick={() => setInputMode('map')}
              className={`flex-1 py-2.5 rounded-xl font-semibold text-sm flex items-center justify-center gap-2 transition ${
                inputMode === 'map' 
                  ? 'bg-white text-sky-600' 
                  : 'bg-white/20 text-white hover:bg-white/30'
              }`}
            >
              <Map className="w-4 h-4" />
              Ø§Ù„Ø®Ø±ÙŠØ·Ø©
            </button>
            <button
              onClick={() => setInputMode('manual')}
              className={`flex-1 py-2.5 rounded-xl font-semibold text-sm flex items-center justify-center gap-2 transition ${
                inputMode === 'manual' 
                  ? 'bg-white text-sky-600' 
                  : 'bg-white/20 text-white hover:bg-white/30'
              }`}
            >
              <PenLine className="w-4 h-4" />
              Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ
            </button>
          </div>
          
          {/* ğŸ” Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« - ÙÙ‚Ø· ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø®Ø±ÙŠØ·Ø© */}
          {inputMode === 'map' && (
            <div className="relative">
              <Search className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
              <input
                type="text"
                value={searchQuery}
                onChange={(e) => {
                  setSearchQuery(e.target.value)
                  searchPlaces(e.target.value)
                }}
                onFocus={() => searchResults.length > 0 && setShowResults(true)}
                placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø­ÙŠØŒ Ø´Ø§Ø±Ø¹ØŒ Ø£Ùˆ Ù…ÙƒØ§Ù†..."
                className="w-full bg-white/95 text-gray-800 rounded-xl p-3 pr-10 pl-10 focus:outline-none focus:ring-2 focus:ring-white/50 transition placeholder:text-gray-400"
              />
              {searchLoading && (
                <Loader2 className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-sky-500 animate-spin" />
              )}
              
              {/* Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« */}
              {showResults && searchResults.length > 0 && (
                <div className="absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-2xl overflow-hidden z-[1001] max-h-60 overflow-y-auto">
                  {searchResults.map((result, index) => (
                    <button
                      key={index}
                      onClick={() => selectSearchResult(result)}
                      className="w-full p-3 text-right hover:bg-sky-50 border-b border-gray-100 last:border-0 transition flex items-start gap-3"
                    >
                      <MapPin className="w-5 h-5 text-sky-500 flex-shrink-0 mt-0.5" />
                      <span className="text-gray-700 text-sm leading-relaxed">
                        {result.display_name}
                      </span>
                    </button>
                  ))}
                </div>
              )}
            </div>
          )}
        </div>

        {/* Ø§Ù„Ø®Ø±ÙŠØ·Ø© - ÙÙ‚Ø· ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø®Ø±ÙŠØ·Ø© */}
        {inputMode === 'map' && (
          <div className="flex-1 relative">
            {!mapReady && (
              <div className="absolute inset-0 flex items-center justify-center bg-sky-50">
                <div className="text-center">
                  <Loader2 className="w-12 h-12 text-sky-500 animate-spin mx-auto mb-3" />
                  <p className="text-sky-600 font-medium">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø©...</p>
                </div>
              </div>
            )}
            <div id="location-map" className="w-full h-full" />

            {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */}
            <div className="absolute left-4 top-4 flex flex-col gap-2 z-[1000]">
              {/* Ø²Ø± GPS */}
              <button
                onClick={getGPSLocation}
                disabled={gpsLoading}
                className="w-12 h-12 bg-white rounded-xl shadow-lg flex items-center justify-center hover:bg-sky-50 transition disabled:opacity-50"
                title="Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ"
              >
                {gpsLoading ? (
                  <Loader2 className="w-5 h-5 text-sky-500 animate-spin" />
                ) : (
                  <Navigation className="w-5 h-5 text-sky-500" />
                )}
              </button>

              {/* Ø²Ø± Ø§Ù„ØªÙ…Ø±ÙƒØ² */}
              {location && (
                <button
                  onClick={centerOnLocation}
                  className="w-12 h-12 bg-white rounded-xl shadow-lg flex items-center justify-center hover:bg-sky-50 transition"
                  title="ØªÙ…Ø±ÙƒØ²"
                >
                  <Target className="w-5 h-5 text-gray-600" />
                </button>
              )}
            </div>

            {/* Ù…Ø¤Ø´Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ */}
            {location && (
              <div className="absolute right-4 top-4 bg-white/95 backdrop-blur-sm rounded-xl shadow-lg p-3 z-[1000] max-w-[200px]">
                <div className="flex items-center gap-2 text-green-600 mb-1">
                  <Check className="w-4 h-4" />
                  <span className="text-sm font-medium">ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</span>
                </div>
                <p className="text-xs text-gray-500 font-mono">
                  {location.lat.toFixed(6)}, {location.lng.toFixed(6)}
                </p>
              </div>
            )}
          </div>
        )}

        {/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙŠØ¯ÙˆÙŠ */}
        {inputMode === 'manual' && (
          <div className="flex-1 p-6 overflow-y-auto bg-gray-50">
            <div className="max-w-md mx-auto space-y-4">
              {/* Ø£ÙŠÙ‚ÙˆÙ†Ø© */}
              <div className="text-center py-4">
                <div className="w-20 h-20 bg-sky-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                  <PenLine className="w-10 h-10 text-sky-500" />
                </div>
                <h3 className="text-lg font-bold text-gray-800">Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù†Ùƒ ÙŠØ¯ÙˆÙŠØ§Ù‹</h3>
                <p className="text-sm text-gray-500 mt-1">Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø¯Ù‚Ø© Ù„ÙŠØµÙ„Ùƒ Ø§Ù„Ø·Ù„Ø¨</p>
              </div>

              {/* Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                <select
                  className="w-full border-2 border-gray-200 rounded-xl p-3 bg-white focus:border-sky-400 focus:outline-none"
                  onChange={(e) => setAddress(prev => {
                    const parts = prev.split('ØŒ').slice(1)
                    return e.target.value + (parts.length ? 'ØŒ' + parts.join('ØŒ') : '')
                  })}
                >
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                  <option value="Ø§Ù„Ø±ÙŠØ§Ø¶">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                  <option value="Ø¬Ø¯Ø©">Ø¬Ø¯Ø©</option>
                  <option value="Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©">Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©</option>
                  <option value="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©</option>
                  <option value="Ø§Ù„Ø¯Ù…Ø§Ù…">Ø§Ù„Ø¯Ù…Ø§Ù…</option>
                  <option value="Ø§Ù„Ø®Ø¨Ø±">Ø§Ù„Ø®Ø¨Ø±</option>
                  <option value="Ø§Ù„Ø£Ø­Ø³Ø§Ø¡">Ø§Ù„Ø£Ø­Ø³Ø§Ø¡</option>
                  <option value="Ø§Ù„Ø·Ø§Ø¦Ù">Ø§Ù„Ø·Ø§Ø¦Ù</option>
                  <option value="ØªØ¨ÙˆÙƒ">ØªØ¨ÙˆÙƒ</option>
                  <option value="Ø¨Ø±ÙŠØ¯Ø©">Ø¨Ø±ÙŠØ¯Ø©</option>
                  <option value="Ø®Ù…ÙŠØ³ Ù…Ø´ÙŠØ·">Ø®Ù…ÙŠØ³ Ù…Ø´ÙŠØ·</option>
                  <option value="Ø£Ø¨Ù‡Ø§">Ø£Ø¨Ù‡Ø§</option>
                  <option value="Ø§Ù„Ù‚Ø·ÙŠÙ">Ø§Ù„Ù‚Ø·ÙŠÙ</option>
                  <option value="Ù†Ø¬Ø±Ø§Ù†">Ù†Ø¬Ø±Ø§Ù†</option>
                  <option value="Ø¬Ø§Ø²Ø§Ù†">Ø¬Ø§Ø²Ø§Ù†</option>
                  <option value="ÙŠÙ†Ø¨Ø¹">ÙŠÙ†Ø¨Ø¹</option>
                  <option value="Ø­Ø§Ø¦Ù„">Ø­Ø§Ø¦Ù„</option>
                </select>
              </div>

              {/* Ø§Ù„Ø­ÙŠ */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ø­ÙŠ</label>
                <input
                  type="text"
                  placeholder="Ù…Ø«Ø§Ù„: Ø­ÙŠ Ø§Ù„Ù†Ø±Ø¬Ø³"
                  className="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-sky-400 focus:outline-none"
                  onChange={(e) => setAddress(prev => {
                    const city = prev.split('ØŒ')[0] || ''
                    return city + (e.target.value ? 'ØŒ ' + e.target.value : '')
                  })}
                />
              </div>

              {/* Ø§Ù„Ø´Ø§Ø±Ø¹ */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ø´Ø§Ø±Ø¹</label>
                <input
                  type="text"
                  placeholder="Ù…Ø«Ø§Ù„: Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²"
                  className="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-sky-400 focus:outline-none"
                  onChange={(e) => setAddress(prev => {
                    const parts = prev.split('ØŒ').slice(0, 2)
                    return parts.join('ØŒ') + (e.target.value ? 'ØŒ ' + e.target.value : '')
                  })}
                />
              </div>

              {/* ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©</label>
                <textarea
                  placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ØŒ Ø§Ù„Ø¯ÙˆØ±ØŒ Ø¹Ù„Ø§Ù…Ø© Ù…Ù…ÙŠØ²Ø©..."
                  rows={3}
                  className="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-sky-400 focus:outline-none resize-none"
                  onChange={(e) => setAddress(prev => {
                    const parts = prev.split('ØŒ').slice(0, 3)
                    return parts.join('ØŒ') + (e.target.value ? 'ØŒ ' + e.target.value : '')
                  })}
                />
              </div>

              {/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ */}
              {address && (
                <div className="bg-green-50 border-2 border-green-200 rounded-xl p-4">
                  <div className="flex items-center gap-2 text-green-600 mb-2">
                    <Check className="w-5 h-5" />
                    <span className="font-semibold">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span>
                  </div>
                  <p className="text-gray-700">{address}</p>
                </div>
              )}
            </div>
          </div>
        )}

        {/* Ù‚Ø³Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯ */}
        <div className="bg-white border-t p-4 space-y-3">
          {/* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ */}
          {error && (
            <div className="bg-red-50 border border-red-200 text-red-600 rounded-xl p-3 text-sm flex items-center gap-2">
              <X className="w-4 h-4 flex-shrink-0" />
              {error}
            </div>
          )}

          {/* Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† - ÙÙ‚Ø· ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø®Ø±ÙŠØ·Ø© */}
          {inputMode === 'map' && (
            <>
              <div className="relative">
                <Smartphone className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                <input
                  type="text"
                  value={address}
                  onChange={(e) => setAddress(e.target.value)}
                  placeholder="ÙˆØµÙ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ù…Ø«Ø§Ù„: Ø­ÙŠ Ø§Ù„Ù†Ø±Ø¬Ø³ØŒ Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²ØŒ Ø¨Ø¬Ø§Ù†Ø¨ Ù…Ø³Ø¬Ø¯...)"
                  className="w-full border-2 border-gray-200 rounded-xl p-3 pr-10 focus:border-sky-400 focus:outline-none transition text-gray-800"
                />
              </div>

              {/* Ù†ØµÙŠØ­Ø© */}
              <p className="text-xs text-gray-500 text-center">
                ğŸ’¡ Ø£Ø¶Ù ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ø¶Ø­Ø© Ù„ÙŠØµÙ„Ùƒ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø³Ø±Ø¹Ø©
              </p>
            </>
          )}

          {/* Ø£Ø²Ø±Ø§Ø± */}
          <div className="flex gap-3">
            <button
              onClick={onClose}
              className="flex-1 py-3 px-4 rounded-xl border-2 border-gray-200 text-gray-600 font-semibold hover:bg-gray-50 transition"
            >
              Ø¥Ù„ØºØ§Ø¡
            </button>
            <button
              onClick={handleConfirm}
              disabled={inputMode === 'map' && !location}
              className="flex-1 py-3 px-4 rounded-xl bg-gradient-to-r from-green-500 to-green-600 text-white font-bold shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center gap-2"
            >
              <Check className="w-5 h-5" />
              ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
            </button>
          </div>
        </div>
      </div>

      {/* Ø£Ù†Ù…Ø§Ø· CSS Ù„Ù„Ù…Ø§Ø±ÙƒØ± */}
      <style>{`
        .custom-marker {
          background: transparent !important;
          border: none !important;
        }
        .leaflet-container {
          font-family: inherit;
        }
        .leaflet-control-zoom {
          display: none;
        }
        #location-map {
          background: #f0f9ff;
        }
      `}</style>
    </div>
  )
}

==========================================================================================
FILE: src/components/LocationRequired.tsx
==========================================================================================
// src/components/LocationRequired.tsx
// Ù…ÙƒÙˆÙ† ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¥Ù„Ø²Ø§Ù…ÙŠØ§Ù‹

import React, { useState, useEffect, useCallback } from 'react'
import { MapPin, Navigation, Loader2, AlertTriangle, CheckCircle } from 'lucide-react'
import { doc, updateDoc } from 'firebase/firestore'
import { db } from '@/firebase'
import { useAuth } from '@/auth'

type Location = { lat: number; lng: number }

type Props = {
  onLocationSaved: () => void
}

export const LocationRequired: React.FC<Props> = ({ onLocationSaved }) => {
  const { user, role } = useAuth()
  const [location, setLocation] = useState<Location | null>(null)
  const [loading, setLoading] = useState(false)
  const [gpsLoading, setGpsLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [mapReady, setMapReady] = useState(false)
  const [saving, setSaving] = useState(false)

  // Ù…ÙˆÙ‚Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø§Ù„Ø±ÙŠØ§Ø¶)
  const defaultLocation: Location = { lat: 24.7136, lng: 46.6753 }

  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ø¨Ø± GPS
  const getGPSLocation = useCallback(() => {
    if (!navigator.geolocation) {
      setError('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹')
      return
    }

    setGpsLoading(true)
    setError(null)

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const newLoc = { lat: pos.coords.latitude, lng: pos.coords.longitude }
        setLocation(newLoc)
        setGpsLoading(false)
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        if ((window as any).locationRequiredMap) {
          (window as any).locationRequiredMap.setView([newLoc.lat, newLoc.lng], 17)
          if ((window as any).locationRequiredMarker) {
            (window as any).locationRequiredMarker.setLatLng([newLoc.lat, newLoc.lng])
          }
        }
      },
      (err) => {
        setGpsLoading(false)
        if (err.code === 1) {
          setError('ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹. ÙØ¹Ù‘Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­')
        } else if (err.code === 2) {
          setError('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ GPS')
        } else {
          setError('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰')
        }
      },
      { 
        enableHighAccuracy: true, 
        timeout: 15000,
        maximumAge: 0 
      }
    )
  }, [])

  // ØªØ­Ù…ÙŠÙ„ Leaflet
  useEffect(() => {
    // ØªØ­Ù…ÙŠÙ„ CSS
    if (!document.getElementById('leaflet-css')) {
      const link = document.createElement('link')
      link.id = 'leaflet-css'
      link.rel = 'stylesheet'
      link.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css'
      document.head.appendChild(link)
    }

    // ØªØ­Ù…ÙŠÙ„ JS
    if (!(window as any).L) {
      const script = document.createElement('script')
      script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js'
      script.onload = () => setMapReady(true)
      document.body.appendChild(script)
    } else {
      setMapReady(true)
    }
  }, [])

  // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  useEffect(() => {
    if (!mapReady || !(window as any).L) return

    const L = (window as any).L
    const container = document.getElementById('location-required-map')
    if (!container) return

    // Ø¥Ø²Ø§Ù„Ø© Ø®Ø±ÙŠØ·Ø© Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
    if ((window as any).locationRequiredMap) {
      (window as any).locationRequiredMap.remove()
    }

    const startLoc = location || defaultLocation

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    const map = L.map('location-required-map', {
      zoomControl: true,
      attributionControl: false,
    }).setView([startLoc.lat, startLoc.lng], 12)

    // Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(map)

    // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø§Ø±ÙƒØ±
    const customIcon = L.divIcon({
      className: 'custom-marker',
      html: `
        <div style="
          width: 50px; 
          height: 50px; 
          background: linear-gradient(135deg, #0EA5E9, #0284C7);
          border-radius: 50% 50% 50% 0;
          transform: rotate(-45deg);
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 4px 20px rgba(14, 165, 233, 0.5);
          border: 3px solid white;
        ">
          <div style="transform: rotate(45deg); color: white; font-size: 20px;">ğŸ“</div>
        </div>
      `,
      iconSize: [50, 50],
      iconAnchor: [25, 50],
    })

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø§Ø±ÙƒØ±
    const marker = L.marker([startLoc.lat, startLoc.lng], { 
      icon: customIcon,
      draggable: true 
    }).addTo(map)

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ Ø³Ø­Ø¨ Ø§Ù„Ù…Ø§Ø±ÙƒØ±
    marker.on('dragend', () => {
      const pos = marker.getLatLng()
      setLocation({ lat: pos.lat, lng: pos.lng })
    })

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    map.on('click', (e: any) => {
      const { lat, lng } = e.latlng
      setLocation({ lat, lng })
      marker.setLatLng([lat, lng])
    })

    // Ø­ÙØ¸ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹
    ;(window as any).locationRequiredMap = map
    ;(window as any).locationRequiredMarker = marker

    return () => {
      if ((window as any).locationRequiredMap) {
        (window as any).locationRequiredMap.remove()
        ;(window as any).locationRequiredMap = null
        ;(window as any).locationRequiredMarker = null
      }
    }
  }, [mapReady])

  // Ø­ÙØ¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹
  const saveLocation = async () => {
    if (!location || !user) return

    setSaving(true)
    try {
      // Ø­ÙØ¸ ÙÙŠ Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      await updateDoc(doc(db, 'users', user.uid), {
        location: location,
        locationUpdatedAt: new Date()
      })

      // Ø¥Ø°Ø§ ÙƒØ§Ù† ØµØ§Ø­Ø¨ Ù…Ø·Ø¹Ù…ØŒ Ø­ÙØ¸ ÙÙŠ Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø·Ø¹Ù… Ø£ÙŠØ¶Ø§Ù‹
      if (role === 'owner') {
        try {
          await updateDoc(doc(db, 'restaurants', user.uid), {
            geoLocation: location,
            locationUpdatedAt: new Date()
          })
        } catch (err) {
          console.warn('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø·Ø¹Ù…:', err)
        }
      }

      onLocationSaved()
    } catch (err) {
      setError('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰')
    } finally {
      setSaving(false)
    }
  }

  const getRoleText = () => {
    switch (role) {
      case 'owner': return 'Ù…Ø·Ø¹Ù…Ùƒ'
      case 'courier': return 'Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ'
      default: return 'Ù…ÙˆÙ‚Ø¹Ùƒ'
    }
  }

  return (
    <div className="fixed inset-0 z-50 bg-gradient-to-br from-sky-50 via-white to-sky-100 flex items-center justify-center p-4">
      <div className="bg-white rounded-3xl shadow-2xl max-w-lg w-full overflow-hidden">
        {/* Ø§Ù„Ù‡ÙŠØ¯Ø± */}
        <div className="bg-gradient-to-r from-sky-500 to-sky-600 p-6 text-white text-center">
          <div className="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
            <MapPin className="w-10 h-10" />
          </div>
          <h1 className="text-2xl font-bold mb-2">Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ {getRoleText()}</h1>
          <p className="text-sky-100 text-sm">
            {role === 'owner' 
              ? 'Ù„Ø¹Ø±Ø¶ Ù…Ø·Ø¹Ù…Ùƒ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù‚Ø±ÙŠØ¨ÙŠÙ† Ù…Ù†Ùƒ'
              : 'Ù„Ù†Ø¹Ø±Ø¶ Ù„Ùƒ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© Ù…Ù†Ùƒ (15 ÙƒÙ…)'}
          </p>
        </div>

        {/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */}
        <div className="p-6 space-y-4">
          {/* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ */}
          {error && (
            <div className="bg-red-50 border border-red-200 rounded-xl p-3 flex items-center gap-3 text-red-700">
              <AlertTriangle className="w-5 h-5 flex-shrink-0" />
              <p className="text-sm">{error}</p>
            </div>
          )}

          {/* Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ GPS */}
          <button
            onClick={getGPSLocation}
            disabled={gpsLoading}
            className="w-full flex items-center justify-center gap-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold p-4 rounded-xl shadow-lg transition disabled:opacity-50"
          >
            {gpsLoading ? (
              <>
                <Loader2 className="w-5 h-5 animate-spin" />
                Ø¬Ø§Ø±Ù ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...
              </>
            ) : (
              <>
                <Navigation className="w-5 h-5" />
                ğŸ“ Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
              </>
            )}
          </button>

          {/* Ø§Ù„Ø®Ø±ÙŠØ·Ø© */}
          <div className="relative">
            <p className="text-sm text-gray-500 mb-2 text-center">
              Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹
            </p>
            <div 
              id="location-required-map" 
              className="h-64 rounded-xl overflow-hidden border-2 border-gray-200"
              style={{ background: '#f0f9ff' }}
            />
            {!mapReady && (
              <div className="absolute inset-0 flex items-center justify-center bg-sky-50">
                <Loader2 className="w-8 h-8 animate-spin text-sky-500" />
              </div>
            )}
          </div>

          {/* Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ */}
          {location && (
            <div className="bg-green-50 border border-green-200 rounded-xl p-3 flex items-center gap-3 text-green-700">
              <CheckCircle className="w-5 h-5 flex-shrink-0" />
              <div className="text-sm">
                <p className="font-semibold">ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ âœ“</p>
                <p className="text-xs text-green-600">
                  {location.lat.toFixed(6)}, {location.lng.toFixed(6)}
                </p>
              </div>
            </div>
          )}

          {/* Ø²Ø± Ø§Ù„Ø­ÙØ¸ */}
          <button
            onClick={saveLocation}
            disabled={!location || saving}
            className="w-full flex items-center justify-center gap-3 bg-gradient-to-r from-sky-500 to-sky-600 hover:from-sky-600 hover:to-sky-700 text-white font-bold p-4 rounded-xl shadow-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {saving ? (
              <>
                <Loader2 className="w-5 h-5 animate-spin" />
                Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸...
              </>
            ) : (
              <>
                <CheckCircle className="w-5 h-5" />
                ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
              </>
            )}
          </button>

          <p className="text-xs text-gray-400 text-center">
            ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ù…ÙˆÙ‚Ø¹Ùƒ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
          </p>
        </div>
      </div>
    </div>
  )
}

==========================================================================================
FILE: src/components/TopBar.tsx
==========================================================================================
// src/components/TopBar.tsx
import React from 'react'
import { Sparkles } from 'lucide-react'

export const TopBar: React.FC = () => {
  return (
    <div 
      className="w-full bg-gradient-to-r from-sky-500 via-sky-400 to-sky-500 text-white py-2 sm:py-3 overflow-hidden shadow-lg"
    >
      <div className="flex items-center justify-center gap-1 sm:gap-2 px-2">
        <Sparkles className="w-4 h-4 sm:w-5 sm:h-5 text-white animate-pulse flex-shrink-0" />
        <div className="marquee whitespace-nowrap font-bold text-xs sm:text-sm tracking-wide">
          âœ¨ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª â€” Ø£Ø´Ù‡Ù‰ Ø§Ù„Ø£ÙƒÙ„Ø§Øª ØªÙˆØµÙ„Ùƒ Ù„ÙŠÙ† Ø¨Ø§Ø¨ Ø¨ÙŠØªÙƒ! ğŸš—ğŸ’¨
        </div>
        <Sparkles className="w-4 h-4 sm:w-5 sm:h-5 text-white animate-pulse flex-shrink-0" />
      </div>
    </div>
  )
}

==========================================================================================
FILE: src/components/ui/ConfirmDialog.tsx
==========================================================================================
import React, { createContext, useContext, useState, useCallback, useMemo } from 'react'
import { AlertTriangle, CheckCircle, Info, XCircle, X } from 'lucide-react'

// Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø­ÙˆØ§Ø±Ø§Øª
type DialogType = 'confirm' | 'alert' | 'info' | 'success' | 'error' | 'warning'

type DialogOptions = {
  title?: string
  message: string
  type?: DialogType
  confirmText?: string
  cancelText?: string
  onConfirm?: () => void | Promise<void>
  onCancel?: () => void
  dangerous?: boolean // Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© Ù…Ø«Ù„ Ø§Ù„Ø­Ø°Ù
}

type DialogState = DialogOptions & {
  isOpen: boolean
  resolve?: (value: boolean) => void
}

type DialogContextType = {
  confirm: (message: string, options?: Partial<DialogOptions>) => Promise<boolean>
  alert: (message: string, options?: Partial<DialogOptions>) => Promise<void>
  success: (message: string, options?: Partial<DialogOptions>) => Promise<void>
  error: (message: string, options?: Partial<DialogOptions>) => Promise<void>
  warning: (message: string, options?: Partial<DialogOptions>) => Promise<void>
  info: (message: string, options?: Partial<DialogOptions>) => Promise<void>
}

const DialogContext = createContext<DialogContextType | null>(null)

export const useDialog = () => {
  const ctx = useContext(DialogContext)
  if (!ctx) throw new Error('useDialog must be used within DialogProvider')
  return ctx
}

export const DialogProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [dialog, setDialog] = useState<DialogState>({
    isOpen: false,
    message: '',
    type: 'confirm',
  })

  const openDialog = useCallback((options: DialogOptions): Promise<boolean> => {
    return new Promise((resolve) => {
      setDialog({
        ...options,
        isOpen: true,
        resolve,
      })
    })
  }, [])

  const closeDialog = useCallback((result: boolean) => {
    if (dialog.resolve) {
      dialog.resolve(result)
    }
    setDialog(prev => ({ ...prev, isOpen: false }))
  }, [dialog.resolve])

  const handleConfirm = useCallback(async () => {
    if (dialog.onConfirm) {
      await dialog.onConfirm()
    }
    closeDialog(true)
  }, [dialog.onConfirm, closeDialog])

  const handleCancel = useCallback(() => {
    if (dialog.onCancel) {
      dialog.onCancel()
    }
    closeDialog(false)
  }, [dialog.onCancel, closeDialog])

  const api: DialogContextType = useMemo(() => ({
    confirm: (message, options = {}) => openDialog({
      message,
      type: 'confirm',
      title: options.title || 'ØªØ£ÙƒÙŠØ¯',
      confirmText: options.confirmText || 'ØªØ£ÙƒÙŠØ¯',
      cancelText: options.cancelText || 'Ø¥Ù„ØºØ§Ø¡',
      ...options,
    }),
    alert: (message, options = {}) => openDialog({
      message,
      type: 'alert',
      title: options.title || 'ØªÙ†Ø¨ÙŠÙ‡',
      confirmText: options.confirmText || 'Ø­Ø³Ù†Ø§Ù‹',
      ...options,
    }).then(() => {}),
    success: (message, options = {}) => openDialog({
      message,
      type: 'success',
      title: options.title || 'ØªÙ… Ø¨Ù†Ø¬Ø§Ø­',
      confirmText: options.confirmText || 'Ø­Ø³Ù†Ø§Ù‹',
      ...options,
    }).then(() => {}),
    error: (message, options = {}) => openDialog({
      message,
      type: 'error',
      title: options.title || 'Ø®Ø·Ø£',
      confirmText: options.confirmText || 'Ø­Ø³Ù†Ø§Ù‹',
      ...options,
    }).then(() => {}),
    warning: (message, options = {}) => openDialog({
      message,
      type: 'warning',
      title: options.title || 'ØªØ­Ø°ÙŠØ±',
      confirmText: options.confirmText || 'Ø­Ø³Ù†Ø§Ù‹',
      ...options,
    }).then(() => {}),
    info: (message, options = {}) => openDialog({
      message,
      type: 'info',
      title: options.title || 'Ù…Ø¹Ù„ÙˆÙ…Ø©',
      confirmText: options.confirmText || 'Ø­Ø³Ù†Ø§Ù‹',
      ...options,
    }).then(() => {}),
  }), [openDialog])

  return (
    <DialogContext.Provider value={api}>
      {children}
      <DialogModal 
        {...dialog} 
        onConfirm={handleConfirm} 
        onCancel={handleCancel}
      />
    </DialogContext.Provider>
  )
}

// ===== Ù…ÙƒÙˆÙ† Ø§Ù„Ø­ÙˆØ§Ø± =====
type DialogModalProps = DialogState & {
  onConfirm: () => void
  onCancel: () => void
}

const DialogModal: React.FC<DialogModalProps> = ({
  isOpen,
  title,
  message,
  type = 'confirm',
  confirmText = 'ØªØ£ÙƒÙŠØ¯',
  cancelText = 'Ø¥Ù„ØºØ§Ø¡',
  dangerous,
  onConfirm,
  onCancel,
}) => {
  if (!isOpen) return null

  // Ø£Ù„ÙˆØ§Ù† ÙˆØ£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
  const config = {
    confirm: {
      icon: <Info className="w-8 h-8" />,
      iconBg: 'bg-sky-100',
      iconColor: 'text-sky-600',
      buttonColor: dangerous ? 'bg-red-600 hover:bg-red-700' : 'bg-sky-600 hover:bg-sky-700',
    },
    alert: {
      icon: <AlertTriangle className="w-8 h-8" />,
      iconBg: 'bg-amber-100',
      iconColor: 'text-amber-600',
      buttonColor: 'bg-amber-600 hover:bg-amber-700',
    },
    success: {
      icon: <CheckCircle className="w-8 h-8" />,
      iconBg: 'bg-green-100',
      iconColor: 'text-green-600',
      buttonColor: 'bg-green-600 hover:bg-green-700',
    },
    error: {
      icon: <XCircle className="w-8 h-8" />,
      iconBg: 'bg-red-100',
      iconColor: 'text-red-600',
      buttonColor: 'bg-red-600 hover:bg-red-700',
    },
    warning: {
      icon: <AlertTriangle className="w-8 h-8" />,
      iconBg: 'bg-orange-100',
      iconColor: 'text-orange-600',
      buttonColor: 'bg-orange-600 hover:bg-orange-700',
    },
    info: {
      icon: <Info className="w-8 h-8" />,
      iconBg: 'bg-blue-100',
      iconColor: 'text-blue-600',
      buttonColor: 'bg-blue-600 hover:bg-blue-700',
    },
  }

  const c = config[type]
  const showCancel = type === 'confirm'

  return (
    <>
      {/* Backdrop */}
      <div 
        className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[9998] animate-fadeIn"
        onClick={onCancel}
      />
      
      {/* Dialog */}
      <div className="fixed inset-0 z-[9999] flex items-center justify-center p-4 pointer-events-none">
        <div 
          className="bg-white rounded-2xl shadow-2xl w-full max-w-sm pointer-events-auto animate-scaleIn overflow-hidden"
          onClick={(e) => e.stopPropagation()}
        >
          {/* Header */}
          <div className="relative p-6 pb-0">
            {/* Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ */}
            <button
              onClick={onCancel}
              className="absolute top-4 left-4 p-1.5 rounded-lg hover:bg-gray-100 transition text-gray-400 hover:text-gray-600"
            >
              <X className="w-5 h-5" />
            </button>
            
            {/* Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */}
            <div className="flex justify-center mb-4">
              <div className={`w-16 h-16 rounded-full ${c.iconBg} ${c.iconColor} flex items-center justify-center`}>
                {c.icon}
              </div>
            </div>
            
            {/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */}
            <h3 className="text-xl font-bold text-center text-gray-900">
              {title}
            </h3>
          </div>
          
          {/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */}
          <div className="p-6 pt-3">
            <p className="text-center text-gray-600 leading-relaxed">
              {message}
            </p>
          </div>
          
          {/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */}
          <div className={`p-4 pt-0 flex gap-3 ${showCancel ? 'flex-row-reverse' : 'justify-center'}`}>
            <button
              onClick={onConfirm}
              className={`flex-1 py-3 px-6 rounded-xl font-bold text-white transition-all duration-200 hover:scale-[1.02] active:scale-[0.98] ${c.buttonColor}`}
            >
              {confirmText}
            </button>
            
            {showCancel && (
              <button
                onClick={onCancel}
                className="flex-1 py-3 px-6 rounded-xl font-bold text-gray-700 bg-gray-100 hover:bg-gray-200 transition-all duration-200 hover:scale-[1.02] active:scale-[0.98]"
              >
                {cancelText}
              </button>
            )}
          </div>
        </div>
      </div>
      
      {/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† */}
      <style>{`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes scaleIn {
          from { opacity: 0; transform: scale(0.9); }
          to { opacity: 1; transform: scale(1); }
        }
        .animate-fadeIn {
          animation: fadeIn 0.2s ease-out;
        }
        .animate-scaleIn {
          animation: scaleIn 0.2s ease-out;
        }
      `}</style>
    </>
  )
}

export default DialogProvider

==========================================================================================
FILE: src/components/ui/Toast.tsx
==========================================================================================
import React, { createContext, useCallback, useContext, useEffect, useMemo, useState } from "react"

type ToastType = "success" | "error" | "info" | "warning"

export type ToastItem = {
  id: string
  type: ToastType
  title?: string
  message: string
  duration?: number // ms
}

type ToastCtx = {
  show: (msg: string, opts?: Partial<Omit<ToastItem, "id" | "message">>) => void
  success: (msg: string, opts?: Partial<Omit<ToastItem, "id" | "message">>) => void
  error: (msg: string, opts?: Partial<Omit<ToastItem, "id" | "message">>) => void
  info: (msg: string, opts?: Partial<Omit<ToastItem, "id" | "message">>) => void
  warning: (msg: string, opts?: Partial<Omit<ToastItem, "id" | "message">>) => void
}

const ToastContext = createContext<ToastCtx | null>(null)

export const useToast = () => {
  const ctx = useContext(ToastContext)
  if (!ctx) throw new Error("useToast must be used within ToastProvider")
  return ctx
}

export const ToastProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [items, setItems] = useState<ToastItem[]>([])

  const remove = useCallback((id: string) => {
    setItems(prev => prev.filter(t => t.id !== id))
  }, [])

  const push = useCallback((message: string, type: ToastType, opts?: Partial<Omit<ToastItem, "id" | "message">>) => {
    const id = Math.random().toString(36).slice(2)
    const item: ToastItem = {
      id,
      message,
      type,
      title: opts?.title,
      duration: opts?.duration ?? 3000,
    }
    setItems(prev => [...prev, item])
    if (item.duration && item.duration > 0) {
      setTimeout(() => remove(id), item.duration)
    }
  }, [remove])

  const api: ToastCtx = useMemo(() => ({
    show: (m, o) => push(m, o?.type ?? "info", o),
    success: (m, o) => push(m, "success", o),
    error: (m, o) => push(m, "error", o),
    info: (m, o) => push(m, "info", o),
    warning: (m, o) => push(m, "warning", o),
  }), [push])

  return (
    <ToastContext.Provider value={api}>
      {children}
      <ToastContainer items={items} onClose={remove} />
    </ToastContext.Provider>
  )
}

const typeStyles: Record<ToastType, string> = {
  success: "bg-green-600 text-white",
  error: "bg-red-600 text-white",
  info: "bg-slate-800 text-white",
  warning: "bg-yellow-500 text-black",
}

const typeIcon: Record<ToastType, string> = {
  success: "âœ”",
  error: "âœ–",
  info: "â„¹",
  warning: "âš ",
}

const ToastContainer: React.FC<{ items: ToastItem[]; onClose: (id: string) => void }> = ({ items, onClose }) => {
  // ÙŠÙ…Ù†Ø¹ ØªØ¯Ø§Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¬ÙˆØ§Ù„ Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©
  useEffect(() => {
    // Ø§Ø®ØªÙŠØ§Ø±ÙŠ
  }, [])
  return (
    <div className="fixed z-[9999] inset-0 pointer-events-none flex flex-col items-center sm:items-end gap-2 p-4 sm:p-6">
      <div className="mt-auto w-full sm:w-auto flex flex-col gap-2">
        {items.map(t => (
          <div
            key={t.id}
            className={`pointer-events-auto ${typeStyles[t.type]} rounded-2xl shadow-lg px-4 py-3 sm:min-w-[320px] animate-[toastIn_.2s_ease]`}
          >
            <div className="flex items-start gap-3">
              <div className="text-xl leading-none">{typeIcon[t.type]}</div>
              <div className="flex-1">
                {t.title && <div className="font-bold">{t.title}</div>}
                <div className="text-sm">{t.message}</div>
              </div>
              <button
                onClick={() => onClose(t.id)}
                className="opacity-80 hover:opacity-100 transition"
                aria-label="Close"
              >Ã—</button>
            </div>
          </div>
        ))}
      </div>

      {/* Ø­Ø±ÙƒØ§Øª Ø¨Ø³ÙŠØ·Ø© */}
      <style>
        {`@keyframes toastIn{from{transform:translateY(8px);opacity:0}to{transform:translateY(0);opacity:1}}`}
      </style>
    </div>
  )
}

==========================================================================================
FILE: src/context/CartContext.tsx
==========================================================================================
/**
 * âš ï¸ DEPRECATED: This file is kept only for backwards compatibility during migration.
 * Please use hooks/useCart.ts instead.
 * 
 * This context was replaced with useCart hook that uses localStorage,
 * providing better persistence and simpler state management.
 */

import React, { createContext } from "react";

const CartContext = createContext<any>(undefined);

// This provider is now a no-op since CartProvider is not needed
export const CartProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  return <>{children}</>;
};

==========================================================================================
FILE: src/firebase.ts
==========================================================================================
// src/firebase.ts
import { initializeApp, getApps, getApp } from "firebase/app"
import { getAuth, indexedDBLocalPersistence, browserLocalPersistence, initializeAuth } from "firebase/auth"
import { getFirestore } from "firebase/firestore"
import { getStorage } from "firebase/storage"

const firebaseConfig = {
  apiKey: "AIzaSyC1iM3g3gGfu23GKLpDRQplBuHidPniFIk",
  authDomain: "albayt-sofra.firebaseapp.com",
  projectId: "albayt-sofra",
  storageBucket: "albayt-sofra.firebasestorage.app",
  messagingSenderId: "895117143740",
  appId: "1:895117143740:web:239cfccc93d101c1f36ab9",
  measurementId: "G-FK3746ERH8",
}

export const app = getApps().length ? getApp() : initializeApp(firebaseConfig)

// âœ… ØªÙ‡ÙŠØ¦Ø© Auth Ù…Ø¹ persistence Ù…Ø­Ù„ÙŠ (IndexedDB Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… localStorage)
// Ù‡Ø°Ø§ ÙŠØ¶Ù…Ù† Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© Ø­ØªÙ‰ Ø¨Ø¹Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„
export const auth = getApps().length > 0 
  ? getAuth(app)
  : initializeAuth(app, {
      persistence: [indexedDBLocalPersistence, browserLocalPersistence]
    })

export const db = getFirestore(app)
export const storage = getStorage(app)

==========================================================================================
FILE: src/hooks/useCart.ts
==========================================================================================
import { useCallback, useEffect, useMemo, useState } from 'react'

export type CartItem = {
  id: string
  name: string
  price: number
  qty: number
  ownerId?: string   // âœ… Ø£Ø¶ÙÙ†Ø§ Ø®Ø§ØµÙŠØ© Ø§Ù„Ù…Ø·Ø¹Ù…
}

const KEY = 'broast_cart'

export function useCart() {
  const [items, setItems] = useState<CartItem[]>(() => {
    try {
      const raw = localStorage.getItem(KEY)
      return raw ? JSON.parse(raw) : []
    } catch { 
      return [] 
    }
  })

  useEffect(() => {
    localStorage.setItem(KEY, JSON.stringify(items))
  }, [items])

  // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… useCallback Ù„Ù…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯ÙˆØ§Ù„ ÙÙŠ ÙƒÙ„ render
  const add = useCallback((it: Omit<CartItem, 'qty'>, qty = 1) => {
    setItems(prev => {
      const idx = prev.findIndex(p => p.id === it.id)
      if (idx >= 0) {
        const copy = [...prev]
        copy[idx] = { 
          ...copy[idx], 
          qty: copy[idx].qty + qty,
          ownerId: it.ownerId ?? copy[idx].ownerId  // âœ… Ù†Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ ownerId
        }
        return copy
      }
      return [...prev, { ...it, qty }]
    })
  }, [])

  const remove = useCallback((id: string) => 
    setItems(prev => prev.filter(p => p.id !== id)), [])

  const changeQty = useCallback((id: string, qty: number) => 
    setItems(prev => prev.map(p => p.id === id ? { ...p, qty } : p)), [])

  const clear = useCallback(() => setItems([]), [])

  // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… useMemo Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ ÙÙ‚Ø· Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± items
  const subtotal = useMemo(() => 
    items.reduce((s, it) => s + it.price * it.qty, 0), [items])

  return { items, add, remove, changeQty, clear, subtotal }
}

==========================================================================================
FILE: src/main.tsx
==========================================================================================
// src/main.tsx Ø£Ùˆ src/index.tsx
import React from 'react'
import ReactDOM from 'react-dom/client'
import { BrowserRouter } from 'react-router-dom'
import App from './App'
import './index.css'
import { AuthProvider } from './auth'
import { CartProvider } from './context/CartContext'   // âœ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ø²ÙˆØ¯ Ø§Ù„Ø³Ù„Ø©
import { ToastProvider } from './components/ui/Toast'
import { DialogProvider } from './components/ui/ConfirmDialog' // âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙˆØ§Ø±Ø§Øª

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <BrowserRouter>
      <ToastProvider>
        <DialogProvider>
          <AuthProvider>
            <CartProvider>   {/* âœ… Ù„Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø§Ù„Ø³Ù„Ø© */}
              <App />
            </CartProvider>
          </AuthProvider>
        </DialogProvider>
      </ToastProvider>
    </BrowserRouter>
  </React.StrictMode>,
)

==========================================================================================
FILE: src/pages/AccountDeleted.tsx
==========================================================================================
// src/pages/AccountDeleted.tsx
import React from "react";
import { Link } from "react-router-dom";

export default function AccountDeleted() {
  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-gray-100 text-center">
      <h1 className="text-2xl font-bold text-red-600 mb-4">
        ØªÙ… Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­
      </h1>
      <p className="text-gray-600 mb-6">
        Ù†Ø£Ø³Ù Ù„Ù…ØºØ§Ø¯Ø±ØªÙƒ ğŸ— ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¹ÙˆØ¯Ø© ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯.
      </p>
      <Link
        to="/"
        className="text-white bg-red-500 px-6 py-2 rounded-lg hover:bg-red-600"
      >
        Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      </Link>
    </div>
  );
}

==========================================================================================
FILE: src/pages/AdminDashboard.tsx
==========================================================================================
import React, { useEffect, useState } from 'react'
import { Link } from 'react-router-dom'
import { Building2, ShoppingCart, Wallet, BarChart3, User as UserIcon, ClipboardList, CheckCircle } from 'lucide-react'
import { useAuth } from '@/auth'
import { RoleGate } from '@/routes/RoleGate'
import { collection, getDocs, doc, getDoc, query, where, updateDoc, serverTimestamp, limit, getCountFromServer } from 'firebase/firestore'
import { db } from '@/firebase'
import { Order, Restaurant, User } from '@/types'
import { useToast } from '@/components/ui/Toast'

type Task = {
  id: string
  title: string
  description?: string
  assignedTo: string
  assignedToName?: string
  status: 'pending' | 'in_progress' | 'completed' | 'cancelled'
  priority: 'low' | 'medium' | 'high'
  dueDate?: string
  createdBy: string
  createdAt: any
  updatedAt: any
  completedAt?: any
  notes?: string
}

type AdminStats = {
  totalRestaurants: number
  totalOrders: number
  totalEarnings: number
  pendingOrders: number
}

type TabType = 'dashboard' | 'profile' | 'tasks'

export const AdminDashboard: React.FC = () => {
  const { user, role } = useAuth()
  const toast = useToast()
  const [activeTab, setActiveTab] = useState<TabType>('dashboard')
  const [stats, setStats] = useState<AdminStats>({
    totalRestaurants: 0,
    totalOrders: 0,
    totalEarnings: 0,
    pendingOrders: 0,
  })
  const [walletBalance, setWalletBalance] = useState(0)
  const [loading, setLoading] = useState(true)
  const [adminData, setAdminData] = useState<User | null>(null)
  const [myTasks, setMyTasks] = useState<Task[]>([])
  const [taskFilter, setTaskFilter] = useState<'all' | 'pending' | 'in_progress' | 'completed'>('all')

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
  useEffect(() => {
    if (!user) return

    (async () => {
      try {
        // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… getCountFromServer Ù„Ù„Ø¹Ø¯ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
        const restaurantsCount = await getCountFromServer(collection(db, 'restaurants'))
        const totalRestaurants = restaurantsCount.data().count

        // âœ… Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ÙÙ‚Ø· Ù…Ø¹ limit
        const pendingQuery = query(
          collection(db, 'orders'), 
          where('status', '==', 'pending'),
          limit(100)
        )
        const pendingSnap = await getDocs(pendingQuery)
        const pendingOrders = pendingSnap.size
        
        // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙƒÙ„ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… count
        const ordersCount = await getCountFromServer(collection(db, 'orders'))
        const totalOrders = ordersCount.data().count
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù…Ù† Ø¢Ø®Ø± 100 Ø·Ù„Ø¨ ÙÙ‚Ø· (Ù„Ù„Ø³Ø±Ø¹Ø©)
        const recentOrdersQuery = query(collection(db, 'orders'), limit(100))
        const recentSnap = await getDocs(recentOrdersQuery)
        const totalEarnings = recentSnap.docs.reduce((sum, d) => sum + (d.data().deliveryFee || 0), 0)

        // Ø¬Ù„Ø¨ Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø¥Ø¯Ù…Ù†
        try {
          const walletSnap = await getDoc(doc(db, 'wallets', user.uid))
          const walletData = walletSnap.data()
          setWalletBalance(walletData?.balance || 0)
        } catch {
          setWalletBalance(0)
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø³Ù†Ø¯Ø© Ù„Ù„Ù…Ø´Ø±Ù
        try {
          const tasksQuery = query(collection(db, 'tasks'), where('assignedTo', '==', user.uid))
          const tasksSnap = await getDocs(tasksQuery)
          const tasksData = tasksSnap.docs.map(d => ({ id: d.id, ...d.data() } as Task))
          setMyTasks(tasksData.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0)))
        } catch (err) {
          console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…:', err)
        }

        setStats({
          totalRestaurants,
          totalOrders,
          totalEarnings,
          pendingOrders,
        })
      } catch (err) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', err)
      } finally {
        setLoading(false)
      }
    })()
  }, [user])

  // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø©
  const updateTaskStatus = async (taskId: string, newStatus: Task['status']) => {
    try {
      const updateData: any = {
        status: newStatus,
        updatedAt: serverTimestamp()
      }
      if (newStatus === 'completed') {
        updateData.completedAt = serverTimestamp()
      }
      await updateDoc(doc(db, 'tasks', taskId), updateData)
      setMyTasks(prev => prev.map(t => 
        t.id === taskId ? { ...t, status: newStatus } : t
      ))
      toast.success(
        newStatus === 'in_progress' ? 'ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©' :
        newStatus === 'completed' ? 'ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰' :
        'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø©'
      )
    } catch (err) {
      toast.error('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø©')
    }
  }

  // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø­Ø§Ù„ÙŠ
  useEffect(() => {
    if (!user) return

    (async () => {
      try {
        const userSnap = await getDoc(doc(db, 'users', user.uid))
        if (userSnap.exists()) {
          setAdminData({ uid: userSnap.id, ...userSnap.data() } as User)
        }
      } catch (err) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù:', err)
      }
    })()
  }, [user])

  if (loading) {
    return (
      <RoleGate allow={['admin']}>
        <div className="flex items-center justify-center h-96 text-lg">
          Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...
        </div>
      </RoleGate>
    )
  }

  return (
    <RoleGate allow={['admin']}>
      <div className="space-y-8">
        {/* Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© */}
        <div className="text-center mb-8">
          <h1 className="text-4xl font-extrabold text-primary">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
          <p className="text-gray-600 mt-2">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø´Ø±Ù! ğŸ‘‹</p>
        </div>

        {/* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */}
        <div className="flex justify-center gap-4 mb-6">
          <button
            onClick={() => setActiveTab('dashboard')}
            className={`px-6 py-3 rounded-xl font-bold transition flex items-center gap-2 ${
              activeTab === 'dashboard'
                ? 'bg-primary text-white shadow-lg'
                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
            }`}
          >
            <BarChart3 className="w-5 h-5" />
            Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
          </button>
          <button
            onClick={() => setActiveTab('profile')}
            className={`px-6 py-3 rounded-xl font-bold transition flex items-center gap-2 ${
              activeTab === 'profile'
                ? 'bg-primary text-white shadow-lg'
                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
            }`}
          >
            <UserIcon className="w-5 h-5" />
            Ø¨ÙŠØ§Ù†Ø§ØªÙŠ
          </button>
          <button
            onClick={() => setActiveTab('tasks')}
            className={`px-6 py-3 rounded-xl font-bold transition flex items-center gap-2 relative ${
              activeTab === 'tasks'
                ? 'bg-primary text-white shadow-lg'
                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
            }`}
          >
            <ClipboardList className="w-5 h-5" />
            Ù…Ù‡Ø§Ù…ÙŠ
            {myTasks.filter(t => t.status === 'pending' || t.status === 'in_progress').length > 0 && (
              <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">
                {myTasks.filter(t => t.status === 'pending' || t.status === 'in_progress').length}
              </span>
            )}
          </button>
        </div>

        {/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨: Ø¨ÙŠØ§Ù†Ø§ØªÙŠ */}
        {activeTab === 'profile' && (
          <div className="bg-white rounded-2xl shadow-lg p-6">
            <h2 className="text-2xl font-bold text-primary mb-6 flex items-center gap-2">
              <UserIcon className="w-6 h-6" />
              Ø¨ÙŠØ§Ù†Ø§ØªÙŠ
            </h2>
            
            {!adminData ? (
              <div className="text-center py-8 text-gray-600">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            ) : (
              <div className="space-y-6">
                {/* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */}
                <div className="bg-gradient-to-r from-sky-50 to-blue-50 rounded-2xl p-6">
                  <div className="flex items-center gap-4 mb-6">
                    <div className="w-20 h-20 bg-primary rounded-full flex items-center justify-center text-white text-3xl font-bold">
                      {adminData.name?.charAt(0) || adminData.email?.charAt(0) || 'ØŸ'}
                    </div>
                    <div>
                      <h3 className="text-2xl font-bold text-gray-900">
                        {adminData.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}
                      </h3>
                      <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-bold bg-sky-100 text-sky-800 mt-2">
                        ğŸ‘” Ù…Ø´Ø±Ù
                      </span>
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="bg-white rounded-xl p-4 shadow-sm">
                      <p className="text-sm text-gray-500 mb-1">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
                      <p className="font-semibold text-gray-900 font-mono">{adminData.email}</p>
                    </div>
                    <div className="bg-white rounded-xl p-4 shadow-sm">
                      <p className="text-sm text-gray-500 mb-1">Ø§Ù„Ø¯ÙˆØ±</p>
                      <p className="font-semibold text-gray-900">{role === 'admin' ? 'Ù…Ø´Ø±Ù' : role}</p>
                    </div>
                    <div className="bg-white rounded-xl p-4 shadow-sm">
                      <p className="text-sm text-gray-500 mb-1">Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>
                      <p className="font-semibold text-gray-600 text-xs font-mono break-all">{adminData.uid}</p>
                    </div>
                    <div className="bg-white rounded-xl p-4 shadow-sm">
                      <p className="text-sm text-gray-500 mb-1">Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©</p>
                      <p className="font-bold text-green-600 text-xl">{walletBalance.toFixed(2)} Ø±.Ø³</p>
                    </div>
                  </div>
                </div>

                {/* Ø±Ø§Ø¨Ø· ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ */}
                <Link
                  to="/profile"
                  className="block w-full bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-xl p-4 text-center font-semibold transition"
                >
                  âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                </Link>
              </div>
            )}
          </div>
        )}

        {/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨: Ù…Ù‡Ø§Ù…ÙŠ */}
        {activeTab === 'tasks' && (
          <div className="space-y-6">
            <div className="bg-white rounded-2xl shadow-lg p-6">
              <h2 className="text-2xl font-bold text-primary mb-6 flex items-center gap-2">
                <ClipboardList className="w-6 h-6" />
                Ù…Ù‡Ø§Ù…ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
              </h2>

              {/* ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */}
              <div className="flex flex-wrap gap-2 mb-6">
                {(['all', 'pending', 'in_progress', 'completed'] as const).map(filter => (
                  <button
                    key={filter}
                    onClick={() => setTaskFilter(filter)}
                    className={`px-4 py-2 rounded-xl font-semibold transition ${
                      taskFilter === filter
                        ? 'bg-primary text-white'
                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`}
                  >
                    {filter === 'all' && 'ğŸ“‹ Ø§Ù„ÙƒÙ„'}
                    {filter === 'pending' && 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}
                    {filter === 'in_progress' && 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°'}
                    {filter === 'completed' && 'âœ… Ù…ÙƒØªÙ…Ù„Ø©'}
                  </button>
                ))}
              </div>

              {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© */}
              <div className="grid grid-cols-3 gap-4 mb-6">
                <div className="bg-yellow-50 rounded-xl p-4 text-center">
                  <p className="text-2xl font-bold text-yellow-600">
                    {myTasks.filter(t => t.status === 'pending').length}
                  </p>
                  <p className="text-sm text-yellow-700">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>
                </div>
                <div className="bg-blue-50 rounded-xl p-4 text-center">
                  <p className="text-2xl font-bold text-blue-600">
                    {myTasks.filter(t => t.status === 'in_progress').length}
                  </p>
                  <p className="text-sm text-blue-700">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
                </div>
                <div className="bg-green-50 rounded-xl p-4 text-center">
                  <p className="text-2xl font-bold text-green-600">
                    {myTasks.filter(t => t.status === 'completed').length}
                  </p>
                  <p className="text-sm text-green-700">Ù…ÙƒØªÙ…Ù„Ø©</p>
                </div>
              </div>

              {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */}
              {myTasks
                .filter(t => taskFilter === 'all' || t.status === taskFilter)
                .length === 0 ? (
                <div className="text-center py-12 text-gray-500">
                  <p className="text-5xl mb-4">ğŸ“‹</p>
                  <p className="text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… {taskFilter !== 'all' && 'ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©'}</p>
                  <p className="text-sm mt-2">Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙŠ ÙŠØ³Ù†Ø¯Ù‡Ø§ Ù„Ùƒ Ø§Ù„Ù…Ø·ÙˆØ±</p>
                </div>
              ) : (
                <div className="space-y-4">
                  {myTasks
                    .filter(t => taskFilter === 'all' || t.status === taskFilter)
                    .map(task => (
                      <div
                        key={task.id}
                        className={`border-2 rounded-2xl p-4 transition ${
                          task.status === 'completed' ? 'bg-green-50 border-green-200' :
                          task.status === 'in_progress' ? 'bg-blue-50 border-blue-200' :
                          task.priority === 'high' ? 'bg-red-50 border-red-200' :
                          'bg-white border-gray-200'
                        }`}
                      >
                        <div className="flex items-start justify-between gap-4">
                          <div className="flex-1">
                            <div className="flex items-center gap-2 mb-2">
                              <span className={`px-2 py-0.5 rounded text-xs font-semibold ${
                                task.priority === 'high' ? 'bg-red-100 text-red-700' :
                                task.priority === 'medium' ? 'bg-yellow-100 text-yellow-700' :
                                'bg-gray-100 text-gray-700'
                              }`}>
                                {task.priority === 'high' ? 'ğŸ”´ Ø¹Ø§Ù„ÙŠØ©' : task.priority === 'medium' ? 'ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø©' : 'âšª Ù…Ù†Ø®ÙØ¶Ø©'}
                              </span>
                              <span className={`px-2 py-0.5 rounded text-xs font-semibold ${
                                task.status === 'pending' ? 'bg-yellow-100 text-yellow-700' :
                                task.status === 'in_progress' ? 'bg-blue-100 text-blue-700' :
                                task.status === 'completed' ? 'bg-green-100 text-green-700' :
                                'bg-red-100 text-red-700'
                              }`}>
                                {task.status === 'pending' && 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}
                                {task.status === 'in_progress' && 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°'}
                                {task.status === 'completed' && 'âœ… Ù…ÙƒØªÙ…Ù„Ø©'}
                                {task.status === 'cancelled' && 'âŒ Ù…Ù„ØºØ§Ø©'}
                              </span>
                            </div>
                            <h3 className="font-bold text-lg text-gray-800">{task.title}</h3>
                            {task.description && (
                              <p className="text-gray-600 mt-1">{task.description}</p>
                            )}
                            <div className="flex flex-wrap gap-3 mt-3 text-sm text-gray-500">
                              {task.dueDate && (
                                <span className={new Date(task.dueDate) < new Date() && task.status !== 'completed' ? 'text-red-600 font-semibold' : ''}>
                                  ğŸ“… {new Date(task.dueDate).toLocaleDateString('ar-SA')}
                                  {new Date(task.dueDate) < new Date() && task.status !== 'completed' && ' (Ù…ØªØ£Ø®Ø±Ø©!)'}
                                </span>
                              )}
                              <span>ğŸ• {task.createdAt?.toDate?.()?.toLocaleDateString('ar-SA') || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                            </div>
                            {task.notes && (
                              <p className="text-sm text-gray-500 mt-2 bg-gray-100 p-2 rounded">ğŸ’¬ {task.notes}</p>
                            )}
                          </div>
                          
                          {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */}
                          <div className="flex flex-col gap-2">
                            {task.status === 'pending' && (
                              <button
                                onClick={() => updateTaskStatus(task.id, 'in_progress')}
                                className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl font-semibold transition"
                              >
                                â–¶ï¸ Ø¨Ø¯Ø¡
                              </button>
                            )}
                            {task.status === 'in_progress' && (
                              <button
                                onClick={() => updateTaskStatus(task.id, 'completed')}
                                className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-xl font-semibold transition"
                              >
                                <CheckCircle className="w-4 h-4" />
                                Ø¥ÙƒÙ…Ø§Ù„
                              </button>
                            )}
                            {task.status === 'completed' && (
                              <span className="text-green-600 font-semibold text-center">
                                âœ… ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²
                              </span>
                            )}
                          </div>
                        </div>
                      </div>
                    ))}
                </div>
              )}
            </div>
          </div>
        )}

        {/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨: Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */}
        {activeTab === 'dashboard' && (
          <>
        {/* Ø§Ù„Ù…Ø­ÙØ¸Ø© */}
        <div className="bg-gradient-to-r from-primary to-sky-700 rounded-2xl shadow-lg p-6 text-white">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm opacity-90">Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­ÙØ¸Ø©</p>
              <h2 className="text-3xl font-bold">{walletBalance.toFixed(2)} Ø±.Ø³</h2>
              <p className="text-sm opacity-75 mt-2">ğŸ’° ØªØ­ØµÙ„ Ø¹Ù„Ù‰ 50 Ù‡Ù„Ù„Ø© Ù…Ù† ÙƒÙ„ Ø·Ù„Ø¨ Ù„Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„ØªÙŠ Ø£Ø¶ÙØªÙ‡Ø§</p>
            </div>
            <Wallet className="w-16 h-16 opacity-80" />
          </div>
        </div>

        {/* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          {/* Ø§Ù„Ù…Ø·Ø§Ø¹Ù… */}
          <div className="bg-white rounded-2xl shadow p-6 hover:shadow-lg transition">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-600 text-sm">Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ù…Ø¶Ø§ÙØ©</p>
                <h3 className="text-3xl font-bold text-primary mt-2">{stats.totalRestaurants}</h3>
              </div>
              <Building2 className="w-12 h-12 text-primary opacity-30" />
            </div>
          </div>

          {/* Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙƒÙ„ÙŠØ© */}
          <div className="bg-white rounded-2xl shadow p-6 hover:shadow-lg transition">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-600 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                <h3 className="text-3xl font-bold text-blue-600 mt-2">{stats.totalOrders}</h3>
              </div>
              <ShoppingCart className="w-12 h-12 text-blue-600 opacity-30" />
            </div>
          </div>

          {/* Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© */}
          <div className="bg-white rounded-2xl shadow p-6 hover:shadow-lg transition">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-600 text-sm">Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>
                <h3 className="text-3xl font-bold text-yellow-600 mt-2">{stats.pendingOrders}</h3>
              </div>
              <BarChart3 className="w-12 h-12 text-yellow-600 opacity-30" />
            </div>
          </div>

          {/* Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ */}
          <div className="bg-white rounded-2xl shadow p-6 hover:shadow-lg transition">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-gray-600 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</p>
                <h3 className="text-3xl font-bold text-green-600 mt-2">{stats.totalEarnings.toFixed(2)}</h3>
              </div>
              <BarChart3 className="w-12 h-12 text-green-600 opacity-30" />
            </div>
          </div>
        </div>

        {/* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {/* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù… */}
          <div className="bg-white rounded-2xl shadow p-6 hover:shadow-lg transition">
            <h3 className="text-xl font-bold text-primary mb-4">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</h3>
            <p className="text-gray-600 text-sm mb-4">
              Ø£Ø¶Ù Ù…Ø·Ø§Ø¹Ù… Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ£Ø¯Ø± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ù…Ø³Ø¬Ù„Ø©
            </p>
            <div className="space-y-2">
              <Link
                to="/admin/add-restaurant"
                className="block w-full bg-primary hover:bg-red-900 text-white rounded-xl p-3 text-center font-semibold transition"
              >
                â• Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯
              </Link>
              <Link
                to="/admin/restaurants"
                className="block w-full bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-xl p-3 text-center font-semibold transition"
              >
                ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
              </Link>
            </div>
          </div>

          {/* Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª */}
          <div className="bg-white rounded-2xl shadow p-6 hover:shadow-lg transition">
            <h3 className="text-xl font-bold text-primary mb-4">Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
            <p className="text-gray-600 text-sm mb-4">
              Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ù…Ø¶Ø§ÙØ© ÙˆØªØ§Ø¨Ø¹ Ø­Ø§Ù„ØªÙ‡Ø§
            </p>
            <div className="space-y-2">
              <Link
                to="/admin/orders"
                className="block w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl p-3 text-center font-semibold transition"
              >
                ğŸ“Š Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
              </Link>
              <Link
                to="/admin/orders?status=pending"
                className="block w-full bg-yellow-500 hover:bg-yellow-600 text-white rounded-xl p-3 text-center font-semibold transition"
              >
                â³ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
              </Link>
            </div>
          </div>

          {/* Ø§Ù„Ø¹Ù…ÙŠÙ„ */}
          <div className="bg-white rounded-2xl shadow p-6 hover:shadow-lg transition">
            <h3 className="text-xl font-bold text-primary mb-4">ÙƒØ¹Ù…ÙŠÙ„</h3>
            <p className="text-gray-600 text-sm mb-4">
              Ø§Ø³ØªØ¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ£Ù†Ø´Ø¦ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø«Ù„ Ø£ÙŠ Ø¹Ù…ÙŠÙ„
            </p>
            <div className="space-y-2">
              <Link
                to="/menu"
                className="block w-full bg-green-600 hover:bg-green-700 text-white rounded-xl p-3 text-center font-semibold transition"
              >
                ğŸ— Ø§Ø³ØªØ¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
              </Link>
              <Link
                to="/orders"
                className="block w-full bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-xl p-3 text-center font-semibold transition"
              >
                ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ
              </Link>
            </div>
          </div>

          {/* Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙˆØ§Ù„Ù…ÙƒØ§ÙØ¢Øª */}
          <div className="bg-white rounded-2xl shadow p-6 hover:shadow-lg transition">
            <h3 className="text-xl font-bold text-primary mb-4">Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙˆØ§Ù„Ù…ÙƒØ§ÙØ¢Øª</h3>
            <p className="text-gray-600 text-sm mb-4">
              Ø§Ø¹Ø±Ø¶ Ø±ØµÙŠØ¯Ùƒ ÙˆØ§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ­ØµÙ„Ø© Ù…Ù† Ø·Ù„Ø¨Ø§Øª Ù…Ø·Ø§Ø¹Ù…Ùƒ
            </p>
            <div className="space-y-2">
              <div className="block w-full bg-gradient-to-r from-primary to-sky-700 text-white rounded-xl p-3 text-center font-semibold">
                ğŸ’° Ø±ØµÙŠØ¯Ùƒ: {walletBalance.toFixed(2)} Ø±.Ø³
              </div>
              <Link
                to="/admin/wallet"
                className="block w-full bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-xl p-3 text-center font-semibold transition"
              >
                ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­ÙØ¸Ø©
              </Link>
            </div>
          </div>
        </div>

        {/* ØªØ°ÙƒÙŠØ± Ù…Ù‡Ù… */}
        <div className="bg-sky-50 border-l-4 border-sky-500 p-6 rounded-lg">
          <h4 className="font-bold text-sky-900 mb-2">ğŸ’° Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª:</h4>
          <ul className="text-sky-800 text-sm space-y-1">
            <li>âœ“ <strong>50 Ù‡Ù„Ù„Ø©</strong> Ù„Ùƒ Ø¹Ù† ÙƒÙ„ Ø·Ù„Ø¨ ÙŠØªÙ… Ù…Ù† Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„ØªÙŠ Ø£Ø¶ÙØªÙ‡Ø§</li>
            <li>âœ“ <strong>1 Ø±ÙŠØ§Ù„</strong> Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† ÙƒÙ„ Ø·Ù„Ø¨ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø·Ø¹Ù… Ù…Ø¶Ø§Ù Ø¹Ù† Ø·Ø±ÙŠÙ‚Ùƒ)</li>
            <li>âœ“ <strong>1.5 Ø±ÙŠØ§Ù„</strong> Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø°Ø§ Ø§Ù„Ù…Ø·Ø¹Ù… Ù…Ø³Ø¬Ù„ Ù…Ù† Ø§Ù„Ù…Ø·ÙˆØ± Ù…Ø¨Ø§Ø´Ø±Ø©</li>
            <li>âœ“ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª ØªÙØ¶Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù…Ø­ÙØ¸ØªÙƒ Ø¹Ù†Ø¯ ÙƒÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</li>
          </ul>
        </div>
          </>
        )}
      </div>
    </RoleGate>
  )
}

==========================================================================================
FILE: src/pages/AdminOrders.tsx
==========================================================================================
import React, { useEffect, useState } from 'react'
import { collection, getDocs, query, where, orderBy } from 'firebase/firestore'
import { db } from '@/firebase'
import { RoleGate } from '@/routes/RoleGate'
import { useToast } from '@/components/ui/Toast'
import { Order, OrderStatus } from '@/types'

const statusLabels: Record<OrderStatus, string> = {
  pending: 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
  accepted: 'âœ… Ù…Ù‚Ø¨ÙˆÙ„',
  preparing: 'ğŸ‘¨â€ğŸ³ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±',
  ready: 'ğŸ“¦ Ø¬Ø§Ù‡Ø²',
  out_for_delivery: 'ğŸš— ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚',
  delivered: 'âœ”ï¸ ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…',
  cancelled: 'âŒ Ù…Ù„ØºÙŠ',
}

export const AdminOrders: React.FC = () => {
  const toast = useToast()
  const [orders, setOrders] = useState<Order[]>([])
  const [loading, setLoading] = useState(true)
  const [statusFilter, setStatusFilter] = useState<OrderStatus | 'all'>('all')

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  useEffect(() => {
    loadOrders()
  }, [statusFilter])

  const loadOrders = async () => {
    try {
      let q
      if (statusFilter === 'all') {
        q = query(collection(db, 'orders'), orderBy('createdAt', 'desc'))
      } else {
        q = query(
          collection(db, 'orders'),
          where('status', '==', statusFilter),
          orderBy('createdAt', 'desc')
        )
      }

      const snap = await getDocs(q)
      const data = snap.docs.map(d => ({ id: d.id, ...d.data() } as Order))
      setOrders(data)
    } catch (err) {
      toast.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª')
      console.error(err)
    } finally {
      setLoading(false)
    }
  }

  if (loading) {
    return (
      <RoleGate allow={['admin', 'developer']}>
        <div className="flex items-center justify-center h-96">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
      </RoleGate>
    )
  }

  return (
    <RoleGate allow={['admin', 'developer']}>
      <div className="space-y-6">
        <h1 className="text-3xl font-bold text-primary">Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>

        {/* ØªØµÙÙŠØ© Ø§Ù„Ø­Ø§Ù„Ø© */}
        <div className="flex gap-2 overflow-x-auto pb-2">
          <button
            onClick={() => setStatusFilter('all')}
            className={`px-4 py-2 rounded-xl font-semibold transition whitespace-nowrap ${
              statusFilter === 'all'
                ? 'bg-primary text-white'
                : 'bg-gray-200 text-gray-800 hover:bg-gray-300'
            }`}
          >
            Ø§Ù„ÙƒÙ„ ({orders.length})
          </button>
          {(
            ['pending', 'accepted', 'preparing', 'ready', 'out_for_delivery', 'delivered'] as OrderStatus[]
          ).map(status => {
            const count = orders.filter(o => o.status === status).length
            return (
              <button
                key={status}
                onClick={() => setStatusFilter(status)}
                className={`px-4 py-2 rounded-xl font-semibold transition whitespace-nowrap ${
                  statusFilter === status
                    ? 'bg-primary text-white'
                    : 'bg-gray-200 text-gray-800 hover:bg-gray-300'
                }`}
              >
                {statusLabels[status]} ({count})
              </button>
            )
          })}
        </div>

        {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª */}
        <div className="space-y-4">
          {orders.length === 0 ? (
            <div className="text-center text-gray-500 py-12">
              Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª {statusFilter !== 'all' && `Ø¨Ø­Ø§Ù„Ø© "${statusLabels[statusFilter as OrderStatus]}"`}
            </div>
          ) : (
            orders.map(order => (
              <div
                key={order.id}
                className="bg-white rounded-2xl shadow p-6 hover:shadow-lg transition"
              >
                <div className="flex items-start justify-between mb-4">
                  <div>
                    <h3 className="text-lg font-bold">Ø·Ù„Ø¨ #{order.id.slice(-8)}</h3>
                    <p className="text-gray-600 text-sm">
                      {order.createdAt ? new Date(order.createdAt as any).toLocaleDateString('ar-SA') : 'â€”'}
                    </p>
                  </div>
                  <span
                    className={`px-4 py-2 rounded-xl font-semibold text-white whitespace-nowrap ${
                      order.status === 'pending'
                        ? 'bg-yellow-500'
                        : order.status === 'delivered'
                        ? 'bg-green-600'
                        : order.status === 'cancelled'
                        ? 'bg-red-600'
                        : 'bg-blue-600'
                    }`}
                  >
                    {statusLabels[order.status]}
                  </span>
                </div>

                {/* Ø§Ù„ØªÙØ§ØµÙŠÙ„ */}
                <div className="grid md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <p className="text-gray-600 text-sm">Ø§Ù„Ø¹Ù…ÙŠÙ„ ID</p>
                    <p className="font-mono text-sm text-gray-800">{order.customerId.slice(0, 12)}...</p>
                  </div>
                  <div>
                    <p className="text-gray-600 text-sm">Ø§Ù„Ù…Ø·Ø¹Ù…</p>
                    <p className="font-semibold text-gray-800">{order.restaurantName || 'â€”'}</p>
                  </div>
                  <div>
                    <p className="text-gray-600 text-sm">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</p>
                    <p className="text-sm text-gray-800">{order.address}</p>
                  </div>
                  <div>
                    <p className="text-gray-600 text-sm">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</p>
                    <p className="text-lg font-bold text-primary">{order.total?.toFixed(2) || 0} Ø±.Ø³</p>
                  </div>
                </div>

                {/* Ø§Ù„Ø£ØµÙ†Ø§Ù */}
                <div className="bg-gray-50 rounded-xl p-3 text-sm">
                  <p className="font-semibold mb-2">Ø§Ù„Ø£ØµÙ†Ø§Ù:</p>
                  <div className="space-y-1">
                    {order.items?.map((item, idx) => (
                      <div key={idx} className="flex justify-between text-gray-700">
                        <span>{item.name} Ã— {item.qty}</span>
                        <span>{(item.price * item.qty).toFixed(2)} Ø±.Ø³</span>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            ))
          )}
        </div>
      </div>
    </RoleGate>
  )
}

export default AdminOrders

==========================================================================================
FILE: src/pages/AdminRestaurants.tsx
==========================================================================================
import React, { useEffect, useState, useRef } from 'react'
import { collection, getDocs, addDoc, deleteDoc, doc, updateDoc, serverTimestamp } from 'firebase/firestore'
import { ref, uploadBytesResumable, getDownloadURL, getStorage } from 'firebase/storage'
import { db, app } from '@/firebase'
import { useAuth } from '@/auth'
import { RoleGate } from '@/routes/RoleGate'
import { useToast } from '@/components/ui/Toast'
import { useDialog } from '@/components/ui/ConfirmDialog'
import { Restaurant } from '@/types'
import { Trash2, Plus, UserCheck, Upload, Image, Shield, Award, Medal, Crown, CheckCircle, XCircle, ChevronDown } from 'lucide-react'

export const AdminRestaurants: React.FC = () => {
  const { user, role } = useAuth()
  const toast = useToast()
  const dialog = useDialog()
  const [restaurants, setRestaurants] = useState<Restaurant[]>([])
  const [loading, setLoading] = useState(true)
  const [showForm, setShowForm] = useState(false)
  const [uploading, setUploading] = useState(false)
  const [uploadProgress, setUploadProgress] = useState(0)
  const fileRef = useRef<HTMLInputElement>(null)
  const storage = getStorage(app)
  
  const [formData, setFormData] = useState({
    name: '',
    phone: '',
    city: '',
    location: '',
    logoFile: null as File | null,
    logoPreview: '',
  })

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
  useEffect(() => {
    loadRestaurants()
  }, [])

  const loadRestaurants = async () => {
    try {
      const snap = await getDocs(collection(db, 'restaurants'))
      const data = snap.docs.map(d => ({
        id: d.id,
        ...d.data(),
      } as Restaurant))
      setRestaurants(data)
    } catch (err) {
      toast.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…')
      console.error(err)
    } finally {
      setLoading(false)
    }
  }

  const handleAddRestaurant = async (e: React.FormEvent) => {
    e.preventDefault()

    if (!formData.name.trim()) {
      toast.warning('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…')
      return
    }

    try {
      setUploading(true)
      
      // Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø± Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯
      let logoUrl = ''
      if (formData.logoFile) {
        const safeName = formData.logoFile.name.replace(/\s+/g, '_').slice(-60)
        const path = `uploads/restaurant_${Date.now()}_${safeName}`
        const storageRef = ref(storage, path)
        
        const task = uploadBytesResumable(storageRef, formData.logoFile, {
          contentType: formData.logoFile.type || 'image/jpeg',
        })
        
        await new Promise<void>((resolve, reject) => {
          task.on(
            'state_changed',
            (snap) => {
              const progress = Math.round((snap.bytesTransferred / snap.totalBytes) * 100)
              setUploadProgress(progress)
            },
            reject,
            async () => {
              logoUrl = await getDownloadURL(task.snapshot.ref)
              resolve()
            }
          )
        })
      }
      
      // ğŸ’° ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…ÙØ¶ÙŠÙ ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
      const isAdmin = role === 'admin'
      const isDev = role === 'developer'
      
      await addDoc(collection(db, 'restaurants'), {
        name: formData.name,
        phone: formData.phone,
        city: formData.city,
        location: formData.location,
        ownerId: 'admin_' + Date.now(),
        email: user?.email || '',
        logoUrl: logoUrl,
        createdAt: new Date(),
        // ğŸ’° Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª - Ø­ÙØ¸ Ù…Ù† Ø£Ø¶Ø§Ù Ø§Ù„Ù…Ø·Ø¹Ù…
        referredBy: isAdmin ? user?.uid : null,
        referrerType: isAdmin ? 'admin' : (isDev ? 'developer' : null),
      })

      toast.success('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø·Ø¹Ù… Ø¨Ù†Ø¬Ø§Ø­ âœ…')
      if (isAdmin) {
        toast.info('ğŸ’° Ø³ØªØ­ØµÙ„ Ø¹Ù„Ù‰ 75 Ù‡Ù„Ù„Ø© Ù…Ù† ÙƒÙ„ Ù…Ù†ØªØ¬ ÙŠÙØ·Ù„Ø¨ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø·Ø¹Ù…')
      }
      setFormData({ name: '', phone: '', city: '', location: '', logoFile: null, logoPreview: '' })
      setShowForm(false)
      setUploadProgress(0)
      loadRestaurants()
    } catch (err) {
      toast.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø·Ø¹Ù…')
      console.error(err)
    } finally {
      setUploading(false)
    }
  }

  const handleDelete = async (id: string) => {
    const confirmed = await dialog.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø·Ø¹Ù…ØŸ', { dangerous: true, title: 'Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù…' })
    if (!confirmed) return

    try {
      await deleteDoc(doc(db, 'restaurants', id))
      toast.success('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù… Ø¨Ù†Ø¬Ø§Ø­')
      loadRestaurants()
    } catch (err) {
      toast.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù…')
      console.error(err)
    }
  }

  // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚
  const handleToggleVerified = async (restaurant: Restaurant) => {
    const newStatus = !restaurant.isVerified
    const confirmed = await dialog.confirm(
      newStatus 
        ? `Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙˆØ«ÙŠÙ‚ Ø£Ø³Ø±Ø© "${restaurant.name}"ØŸ` 
        : `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ ØªÙˆØ«ÙŠÙ‚ Ø£Ø³Ø±Ø© "${restaurant.name}"ØŸ`,
      { 
        title: newStatus ? 'âœ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø±Ø©' : 'âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚',
        confirmText: newStatus ? 'Ù†Ø¹Ù…ØŒ ÙˆØ«Ù‘Ù‚' : 'Ù†Ø¹Ù…ØŒ Ø£Ù„ØºÙ Ø§Ù„ØªÙˆØ«ÙŠÙ‚',
      }
    )
    if (!confirmed) return

    try {
      await updateDoc(doc(db, 'restaurants', restaurant.id), {
        isVerified: newStatus,
        verifiedAt: newStatus ? serverTimestamp() : null,
        updatedAt: serverTimestamp(),
      })
      toast.success(newStatus ? 'ØªÙ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø±Ø© âœ…' : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚')
      loadRestaurants()
    } catch (err) {
      toast.error('Ø­Ø¯Ø« Ø®Ø·Ø£')
      console.error(err)
    }
  }

  // ØªØ­Ø¯ÙŠØ« ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨Ø§Ø¦Ø¹
  const handleUpdateTier = async (restaurant: Restaurant, tier: 'bronze' | 'silver' | 'gold') => {
    try {
      await updateDoc(doc(db, 'restaurants', restaurant.id), {
        sellerTier: tier,
        tierUpdatedAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
      })
      const tierNames = { bronze: 'Ø¨Ø±ÙˆÙ†Ø²ÙŠ', silver: 'ÙØ¶ÙŠ', gold: 'Ø°Ù‡Ø¨ÙŠ' }
      toast.success(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØµÙ†ÙŠÙ Ø¥Ù„Ù‰ ${tierNames[tier]} ğŸ†`)
      loadRestaurants()
    } catch (err) {
      toast.error('Ø­Ø¯Ø« Ø®Ø·Ø£')
      console.error(err)
    }
  }

  // Ù…ÙƒÙˆÙ† Ø´Ø§Ø±Ø© Ø§Ù„ØªØµÙ†ÙŠÙ
  const TierBadge: React.FC<{ tier?: string }> = ({ tier }) => {
    switch (tier) {
      case 'gold':
        return (
          <span className="inline-flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-amber-400 to-yellow-400 text-white text-xs font-bold rounded-full shadow">
            <Crown className="w-3 h-3" /> Gold
          </span>
        )
      case 'silver':
        return (
          <span className="inline-flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-gray-300 to-gray-400 text-gray-800 text-xs font-bold rounded-full shadow">
            <Medal className="w-3 h-3" /> Silver
          </span>
        )
      default:
        return (
          <span className="inline-flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-amber-600 to-orange-600 text-white text-xs font-bold rounded-full shadow">
            <Award className="w-3 h-3" /> Bronze
          </span>
        )
    }
  }

  if (loading) {
    return (
      <RoleGate allow={['admin', 'developer']}>
        <div className="flex items-center justify-center h-96">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
      </RoleGate>
    )
  }

  return (
    <RoleGate allow={['admin', 'developer']}>
      <div className="space-y-6">
        <div className="flex items-center justify-between">
          <h1 className="text-3xl font-bold text-primary">Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ù…Ø¶Ø§ÙØ©</h1>
          <button
            onClick={() => setShowForm(!showForm)}
            className="flex items-center gap-2 bg-primary hover:bg-red-900 text-white px-6 py-3 rounded-xl font-semibold transition"
          >
            <Plus className="w-5 h-5" /> Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯
          </button>
        </div>

        {/* Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ© */}
        {showForm && (
          <div className="bg-white rounded-2xl shadow p-6">
            <h2 className="text-xl font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯</h2>
            <form onSubmit={handleAddRestaurant} className="space-y-4">
              {/* Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø·Ø¹Ù… */}
              <div className="space-y-2">
                <label className="block font-semibold text-gray-700">Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø·Ø¹Ù…</label>
                <div className="flex items-center gap-4">
                  {formData.logoPreview ? (
                    <img 
                      src={formData.logoPreview} 
                      alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ø¹Ø§Ø±" 
                      className="w-20 h-20 rounded-xl object-cover border-2 border-sky-200"
                    />
                  ) : (
                    <div className="w-20 h-20 rounded-xl bg-gray-100 flex items-center justify-center border-2 border-dashed border-gray-300">
                      <Image className="w-8 h-8 text-gray-400" />
                    </div>
                  )}
                  <div className="flex-1">
                    <input
                      ref={fileRef}
                      type="file"
                      accept="image/*"
                      className="hidden"
                      onChange={(e) => {
                        const file = e.target.files?.[0]
                        if (file) {
                          setFormData({
                            ...formData,
                            logoFile: file,
                            logoPreview: URL.createObjectURL(file)
                          })
                        }
                      }}
                    />
                    <button
                      type="button"
                      onClick={() => fileRef.current?.click()}
                      className="flex items-center gap-2 px-4 py-2 bg-sky-100 hover:bg-sky-200 text-sky-700 rounded-xl font-semibold transition"
                    >
                      <Upload className="w-4 h-4" />
                      {formData.logoFile ? 'ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©' : 'Ø±ÙØ¹ Ø´Ø¹Ø§Ø±'}
                    </button>
                    {formData.logoFile && (
                      <p className="text-xs text-gray-500 mt-1">{formData.logoFile.name}</p>
                    )}
                  </div>
                </div>
                {uploading && uploadProgress > 0 && (
                  <div className="w-full bg-gray-200 rounded-full h-2">
                    <div 
                      className="bg-sky-500 h-2 rounded-full transition-all" 
                      style={{ width: `${uploadProgress}%` }}
                    />
                  </div>
                )}
              </div>
              
              <input
                type="text"
                placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…"
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full border rounded-xl p-3 text-gray-900"
              />
              <input
                type="text"
                placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"
                value={formData.phone}
                onChange={e => setFormData({ ...formData, phone: e.target.value })}
                className="w-full border rounded-xl p-3 text-gray-900"
              />
              <input
                type="text"
                placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©"
                value={formData.city}
                onChange={e => setFormData({ ...formData, city: e.target.value })}
                className="w-full border rounded-xl p-3 text-gray-900"
              />
              <textarea
                placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹ / Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"
                value={formData.location}
                onChange={e => setFormData({ ...formData, location: e.target.value })}
                className="w-full border rounded-xl p-3 text-gray-900"
              />
              <div className="flex gap-3">
                <button
                  type="submit"
                  disabled={uploading}
                  className="flex-1 bg-primary hover:bg-red-900 text-white rounded-xl p-3 font-semibold transition disabled:opacity-50"
                >
                  {uploading ? `Ø¬Ø§Ø±Ù Ø§Ù„Ø±ÙØ¹... ${uploadProgress}%` : 'âœ… Ø­ÙØ¸'}
                </button>
                <button
                  type="button"
                  onClick={() => setShowForm(false)}
                  className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-xl p-3 font-semibold transition"
                >
                  âŒ Ø¥Ù„ØºØ§Ø¡
                </button>
              </div>
            </form>
          </div>
        )}

        {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù… */}
        <div className="grid gap-4">
          {restaurants.length === 0 ? (
            <div className="text-center text-gray-500 py-12">
              Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø·Ø§Ø¹Ù… Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
            </div>
          ) : (
            restaurants.map(restaurant => (
              <div
                key={restaurant.id}
                className="bg-white rounded-2xl shadow p-6 hover:shadow-lg transition"
              >
                <div className="flex items-start justify-between">
                  <div className="flex gap-4">
                    {/* Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø·Ø¹Ù… */}
                    {restaurant.logoUrl ? (
                      <img 
                        src={restaurant.logoUrl} 
                        alt={restaurant.name}
                        className="w-16 h-16 rounded-xl object-cover border-2 border-sky-100"
                      />
                    ) : (
                      <div className="w-16 h-16 rounded-xl bg-sky-100 flex items-center justify-center">
                        <span className="text-2xl">ğŸ½ï¸</span>
                      </div>
                    )}
                    
                    <div className="flex-1">
                      <div className="flex items-center gap-2 flex-wrap">
                        <h3 className="text-xl font-bold text-primary">{restaurant.name}</h3>
                        {/* Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ */}
                        {restaurant.isVerified && (
                          <span className="inline-flex items-center gap-1 px-2 py-0.5 bg-green-100 text-green-700 text-xs font-bold rounded-full">
                            <CheckCircle className="w-3 h-3" /> Ù…ÙˆØ«Ù‚Ø©
                          </span>
                        )}
                        {/* Ø´Ø§Ø±Ø© Ø§Ù„ØªØµÙ†ÙŠÙ */}
                        <TierBadge tier={restaurant.sellerTier} />
                      </div>
                      {restaurant.city && (
                        <p className="text-gray-600 text-sm">ğŸ“ {restaurant.city}</p>
                      )}
                      {restaurant.phone && (
                        <p className="text-gray-600 text-sm">ğŸ“ {restaurant.phone}</p>
                      )}
                      {restaurant.location && (
                        <p className="text-gray-600 text-sm">ğŸ¢ {restaurant.location}</p>
                      )}
                    </div>
                  </div>
                  
                  {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */}
                  <div className="flex items-center gap-2">
                    {/* Ø²Ø± Ø§Ù„ØªÙˆØ«ÙŠÙ‚ */}
                    <button
                      onClick={() => handleToggleVerified(restaurant)}
                      className={`p-2.5 rounded-xl transition flex items-center gap-1 text-sm font-semibold ${
                        restaurant.isVerified 
                          ? 'bg-green-100 hover:bg-green-200 text-green-700' 
                          : 'bg-gray-100 hover:bg-gray-200 text-gray-600'
                      }`}
                      title={restaurant.isVerified ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚' : 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø±Ø©'}
                    >
                      <Shield className="w-4 h-4" />
                      {restaurant.isVerified ? 'Ù…ÙˆØ«Ù‚Ø©' : 'ØªÙˆØ«ÙŠÙ‚'}
                    </button>
                    
                    {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµÙ†ÙŠÙ */}
                    <div className="relative group">
                      <button
                        className="p-2.5 rounded-xl bg-amber-100 hover:bg-amber-200 text-amber-700 transition flex items-center gap-1 text-sm font-semibold"
                      >
                        <Award className="w-4 h-4" />
                        Ø§Ù„ØªØµÙ†ÙŠÙ
                        <ChevronDown className="w-3 h-3" />
                      </button>
                      <div className="absolute left-0 top-full mt-1 bg-white rounded-xl shadow-xl border opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-20 min-w-[140px]">
                        <button
                          onClick={() => handleUpdateTier(restaurant, 'bronze')}
                          className={`w-full px-4 py-2.5 text-right hover:bg-amber-50 transition flex items-center gap-2 first:rounded-t-xl ${restaurant.sellerTier === 'bronze' || !restaurant.sellerTier ? 'bg-amber-50' : ''}`}
                        >
                          <Award className="w-4 h-4 text-amber-600" />
                          <span className="font-semibold">Bronze</span>
                        </button>
                        <button
                          onClick={() => handleUpdateTier(restaurant, 'silver')}
                          className={`w-full px-4 py-2.5 text-right hover:bg-gray-50 transition flex items-center gap-2 ${restaurant.sellerTier === 'silver' ? 'bg-gray-100' : ''}`}
                        >
                          <Medal className="w-4 h-4 text-gray-500" />
                          <span className="font-semibold">Silver</span>
                        </button>
                        <button
                          onClick={() => handleUpdateTier(restaurant, 'gold')}
                          className={`w-full px-4 py-2.5 text-right hover:bg-yellow-50 transition flex items-center gap-2 last:rounded-b-xl ${restaurant.sellerTier === 'gold' ? 'bg-yellow-50' : ''}`}
                        >
                          <Crown className="w-4 h-4 text-amber-500" />
                          <span className="font-semibold">Gold</span>
                        </button>
                      </div>
                    </div>
                    
                    {/* Ø²Ø± Ø§Ù„Ø­Ø°Ù */}
                    <button
                      onClick={() => handleDelete(restaurant.id)}
                      className="p-2.5 bg-red-100 hover:bg-red-200 text-red-600 rounded-xl transition"
                      title="Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù…"
                    >
                      <Trash2 className="w-4 h-4" />
                    </button>
                  </div>
                </div>
              </div>
            ))
          )}
        </div>
      </div>
    </RoleGate>
  )
}

export default AdminRestaurants

==========================================================================================
FILE: src/pages/CartPage.tsx
==========================================================================================
// src/pages/CartPage.tsx
import React from "react"
import { useCart } from "@/hooks/useCart"
import { Link } from "react-router-dom"
import { Trash2, ShoppingBag, ArrowLeft, Minus, Plus } from "lucide-react"

export const CartPage: React.FC = () => {
  const { items, subtotal, remove, clear, changeQty } = useCart()

  if (items.length === 0) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-sky-50 via-white to-sky-100 flex flex-col items-center justify-center py-20 px-4">
        <div className="w-24 h-24 bg-white/80 backdrop-blur rounded-full flex items-center justify-center mb-6 shadow-lg">
          <ShoppingBag className="w-12 h-12 text-sky-400" />
        </div>
        <h2 className="text-xl font-bold text-sky-800 mb-2">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</h2>
        <p className="text-sky-600/70 mb-6">Ø£Ø¶Ù Ø¨Ø¹Ø¶ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù„Ø°ÙŠØ°Ø©!</p>
        <Link 
          to="/restaurants" 
          className="flex items-center gap-2 bg-gradient-to-r from-sky-500 to-sky-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-sky-200/50 hover:shadow-xl transition"
        >
          <ArrowLeft className="w-5 h-5" />
          ØªØµÙØ­ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
        </Link>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-sky-50 via-white to-sky-100 py-6">
      <div className="max-w-3xl mx-auto space-y-4 px-2 sm:px-4">
      <div className="flex items-center justify-between">
        <h1 className="text-xl sm:text-2xl font-bold flex items-center gap-2">
          <ShoppingBag className="w-6 h-6 text-primary" />
          Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
          <span className="text-sm bg-primary text-white px-2 py-0.5 rounded-full">{items.length}</span>
        </h1>
      </div>

      {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù */}
      <div className="space-y-3">
        {items.map((i) => (
          <div
            key={i.id}
            className="flex items-center gap-3 glass-card p-3 sm:p-4 rounded-xl"
          >
            {/* ØµÙˆØ±Ø© Ø§Ù„ØµÙ†Ù (Ø§ÙØªØ±Ø§Ø¶ÙŠØ©) */}
            <div className="w-16 h-16 sm:w-20 sm:h-20 bg-gray-100 rounded-xl flex items-center justify-center flex-shrink-0">
              <span className="text-3xl">ğŸŸ</span>
            </div>
            
            {/* ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙ†Ù */}
            <div className="flex-1 min-w-0">
              <h3 className="font-bold text-sm sm:text-base truncate">{i.name}</h3>
              <p className="text-primary font-bold text-sm">{i.price.toFixed(2)} Ø±.Ø³</p>
              
              {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙƒÙ…ÙŠØ© */}
              <div className="flex items-center gap-2 mt-2">
                <button
                  onClick={() => i.qty > 1 ? changeQty(i.id, i.qty - 1) : remove(i.id)}
                  className="w-7 h-7 sm:w-8 sm:h-8 rounded-lg bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition"
                >
                  <Minus className="w-4 h-4" />
                </button>
                <span className="font-bold text-lg w-8 text-center">{i.qty}</span>
                <button
                  onClick={() => changeQty(i.id, i.qty + 1)}
                  className="w-7 h-7 sm:w-8 sm:h-8 rounded-lg bg-primary text-white hover:bg-sky-600 flex items-center justify-center transition"
                >
                  <Plus className="w-4 h-4" />
                </button>
              </div>
            </div>
            
            {/* Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ + Ø­Ø°Ù */}
            <div className="flex flex-col items-end gap-2">
              <span className="font-bold text-lg text-gray-900">{(i.price * i.qty).toFixed(2)} Ø±.Ø³</span>
              <button
                onClick={() => remove(i.id)}
                className="p-2 rounded-lg bg-red-50 hover:bg-red-100 text-red-500 transition"
              >
                <Trash2 className="w-4 h-4" />
              </button>
            </div>
          </div>
        ))}
      </div>

      {/* Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ù„Ø© */}
      <div className="glass-card rounded-xl p-4 space-y-3">
        <div className="flex justify-between text-sky-700">
          <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</span>
          <span className="font-bold">{subtotal.toFixed(2)} Ø±.Ø³</span>
        </div>
        <div className="flex justify-between text-amber-600">
          <span>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
          <span className="font-semibold text-sm">ØªÙØ­Ø¯Ø¯ Ø¹Ù†Ø¯ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨</span>
        </div>
        <div className="h-px bg-sky-200/50"></div>
        <div className="flex justify-between">
          <span className="font-bold text-lg text-sky-900">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
          <span className="font-bold text-xl text-sky-600">{subtotal.toFixed(2)} Ø±.Ø³</span>
        </div>
        <p className="text-xs text-gray-500 text-center">
          ğŸ’¡ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ ÙŠØ­Ø¯Ø¯Ù‡Ø§ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£Ùˆ Ø§Ù„Ø£Ø³Ø±Ø© Ø­Ø³Ø¨ Ù…ÙˆÙ‚Ø¹Ùƒ
        </p>
      </div>

      {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */}
      <div className="flex flex-col sm:flex-row gap-3 pb-6">
        <button
          onClick={clear}
          className="flex-1 flex items-center justify-center gap-2 px-5 py-3 rounded-xl glass-light text-sky-700 font-semibold hover:bg-white/70 transition"
        >
          <Trash2 className="w-5 h-5" />
          ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©
        </button>
        <Link
          to="/checkout"
          className="flex-1 flex items-center justify-center gap-2 px-5 py-3 rounded-xl bg-gradient-to-r from-green-500 to-green-600 text-white font-bold shadow-lg shadow-green-200/50 hover:shadow-xl hover:scale-[1.02] transition"
        >
          âœ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
        </Link>
      </div>
      </div>
    </div>
  )
}

==========================================================================================
FILE: src/pages/ChatPage.tsx
==========================================================================================
// src/pages/ChatPage.tsx
import React, { useEffect, useState, useRef } from 'react'
import { useSearchParams, useNavigate } from 'react-router-dom'
import { 
  collection, doc, getDoc, addDoc, onSnapshot, 
  query, orderBy, serverTimestamp, Timestamp 
} from 'firebase/firestore'
import { db } from '@/firebase'
import { useAuth } from '@/auth'
import { useToast } from '@/components/ui/Toast'
import { 
  MessageCircle, Send, ArrowRight, Package, 
  MapPin, Clock, CheckCheck, Sparkles, Heart,
  Smile, ThumbsUp, Star, Zap, Coffee, Pizza, Store
} from 'lucide-react'

// Ø±Ø³Ø§Ø¦Ù„ Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„
const QUICK_MESSAGES_CUSTOMER = [
  { text: 'Ø£ÙŠÙ† ÙˆØµÙ„ØªØŸ ğŸ“', emoji: 'ğŸ“' },
  { text: 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! ğŸ’™', emoji: 'ğŸ’™' },
  { text: 'Ø®Ø° Ø±Ø§Ø­ØªÙƒ ğŸ˜Š', emoji: 'ğŸ˜Š' },
  { text: 'Ø£Ù†Ø§ Ø¨Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± â³', emoji: 'â³' },
  { text: 'ØªÙ…Ø§Ù… ğŸ‘', emoji: 'ğŸ‘' },
  { text: 'Ù…Ù…ØªØ§Ø²! â­', emoji: 'â­' },
]

// Ø±Ø³Ø§Ø¦Ù„ Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø·Ø¹Ù…
const QUICK_MESSAGES_CUSTOMER_TO_RESTAURANT = [
  { text: 'ÙƒÙ… Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©ØŸ â±ï¸', emoji: 'â±ï¸' },
  { text: 'Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ…! ğŸ’™', emoji: 'ğŸ’™' },
  { text: 'Ù‡Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¬Ø§Ù‡Ø²ØŸ ğŸ“¦', emoji: 'ğŸ“¦' },
  { text: 'Ø£Ø­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ ğŸ“', emoji: 'ğŸ“' },
  { text: 'Ù…Ù…ØªØ§Ø²! â­', emoji: 'â­' },
  { text: 'ØªÙ…Ø§Ù… ğŸ‘', emoji: 'ğŸ‘' },
]

// Ø±Ø³Ø§Ø¦Ù„ Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨
const QUICK_MESSAGES_COURIER = [
  { text: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø¥Ù„ÙŠÙƒ! ğŸš—', emoji: 'ğŸš—' },
  { text: 'ÙˆØµÙ„Øª! ğŸ“', emoji: 'ğŸ“' },
  { text: 'Ø¯Ù‚Ø§Ø¦Ù‚ ÙˆØ£ÙˆØµÙ„ â±ï¸', emoji: 'â±ï¸' },
  { text: 'Ø£Ø­ØªØ§Ø¬ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ğŸ“Œ', emoji: 'ğŸ“Œ' },
  { text: 'Ø§ØªØµÙ„ Ø¨ÙŠ ğŸ“', emoji: 'ğŸ“' },
  { text: 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ! ğŸ™', emoji: 'ğŸ™' },
]

// Ø±Ø³Ø§Ø¦Ù„ Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ù…Ø·Ø¹Ù…
const QUICK_MESSAGES_RESTAURANT = [
  { text: 'Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ± ğŸ‘¨â€ğŸ³', emoji: 'ğŸ‘¨â€ğŸ³' },
  { text: 'Ø§Ù„Ø·Ù„Ø¨ Ø¬Ø§Ù‡Ø²! ğŸ“¦', emoji: 'ğŸ“¦' },
  { text: 'Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ ğŸš—', emoji: 'ğŸš—' },
  { text: 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ! ğŸ™', emoji: 'ğŸ™' },
  { text: 'Ù†Ø¹ØªØ°Ø± Ø¹Ù† Ø§Ù„ØªØ£Ø®ÙŠØ± â³', emoji: 'â³' },
  { text: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ âœ…', emoji: 'âœ…' },
]

// Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹
const EMOJI_PICKER = ['ğŸ˜Š', 'ğŸ‘', 'â¤ï¸', 'ğŸ”¥', 'â­', 'ğŸ™', 'ğŸ’ª', 'ğŸ‰', 'â˜•', 'ğŸ•', 'ğŸš—', 'ğŸ“']

type Message = {
  id: string
  text: string
  senderId: string
  senderRole: 'customer' | 'courier' | 'owner'
  createdAt: Timestamp | null
}

type OrderInfo = {
  id: string
  status: string
  address: string
  total: number
  customerId: string
  courierId?: string
  restaurantId?: string
  restaurantName?: string
}

export const ChatPage: React.FC = () => {
  const [params] = useSearchParams()
  const orderId = params.get('orderId')
  const nav = useNavigate()
  const { user, role } = useAuth()
  const toast = useToast()
  
  const [order, setOrder] = useState<OrderInfo | null>(null)
  const [messages, setMessages] = useState<Message[]>([])
  const [newMsg, setNewMsg] = useState('')
  const [sending, setSending] = useState(false)
  const [showEmoji, setShowEmoji] = useState(false)
  const [partnerName, setPartnerName] = useState('')
  const messagesEndRef = useRef<HTMLDivElement>(null)

  const isCourier = role === 'courier'
  const isOwner = role === 'owner'
  const isCustomer = role === 'customer' || role === 'admin'
  
  // ØªØ­Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ù…Ø·Ø¹Ù… (Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø¯ÙˆØ¨)
  const isChatWithRestaurant = order && !order.courierId && order.restaurantId
  
  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ± ÙˆÙ†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  const getQuickMessages = () => {
    if (isCourier) return QUICK_MESSAGES_COURIER
    if (isOwner) return QUICK_MESSAGES_RESTAURANT
    if (isCustomer && isChatWithRestaurant) return QUICK_MESSAGES_CUSTOMER_TO_RESTAURANT
    return QUICK_MESSAGES_CUSTOMER
  }
  
  const quickMessages = getQuickMessages()

  // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨
  useEffect(() => {
    if (!orderId) return
    
    const unsub = onSnapshot(doc(db, 'orders', orderId), (snap) => {
      if (snap.exists()) {
        const data = snap.data()
        setOrder({
          id: snap.id,
          status: data.status,
          address: data.address,
          total: data.total,
          customerId: data.customerId,
          courierId: data.courierId,
          restaurantId: data.restaurantId,
          restaurantName: data.restaurantName,
        })
      }
    })
    
    return () => unsub()
  }, [orderId])

  // ØªØ­Ù…ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±
  useEffect(() => {
    if (!order) return
    
    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø´Ø±ÙŠÙƒ ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
    let partnerId: string | undefined
    let partnerType: 'courier' | 'restaurant' | 'customer' = 'customer'
    
    if (isCourier) {
      // Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ÙŠØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„
      partnerId = order.customerId
      partnerType = 'customer'
    } else if (isOwner) {
      // Ø§Ù„Ù…Ø·Ø¹Ù… ÙŠØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„
      partnerId = order.customerId
      partnerType = 'customer'
    } else if (isCustomer) {
      // Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£Ùˆ Ø§Ù„Ù…Ø·Ø¹Ù…
      if (order.courierId) {
        partnerId = order.courierId
        partnerType = 'courier'
      } else if (order.restaurantId) {
        partnerId = order.restaurantId
        partnerType = 'restaurant'
      }
    }
    
    if (!partnerId) {
      setPartnerName(isChatWithRestaurant ? (order.restaurantName || 'Ø§Ù„Ù…Ø·Ø¹Ù…') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯')
      return
    }
    
    if (partnerType === 'restaurant') {
      // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…
      getDoc(doc(db, 'restaurants', partnerId)).then(snap => {
        if (snap.exists()) {
          setPartnerName(snap.data()?.name || 'Ø§Ù„Ù…Ø·Ø¹Ù…')
        } else {
          setPartnerName(order.restaurantName || 'Ø§Ù„Ù…Ø·Ø¹Ù…')
        }
      })
    } else {
      // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      getDoc(doc(db, 'users', partnerId)).then(snap => {
        if (snap.exists()) {
          const defaultName = partnerType === 'courier' ? 'Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨' : 'Ø§Ù„Ø¹Ù…ÙŠÙ„'
          setPartnerName(snap.data()?.name || defaultName)
        }
      })
    }
  }, [order, isCourier, isOwner, isCustomer, isChatWithRestaurant])

  // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„
  useEffect(() => {
    if (!orderId) return
    
    const q = query(
      collection(db, 'orders', orderId, 'messages'),
      orderBy('createdAt', 'asc')
    )
    
    const unsub = onSnapshot(q, (snap) => {
      setMessages(snap.docs.map(d => ({
        id: d.id,
        ...d.data()
      } as Message)))
    })
    
    return () => unsub()
  }, [orderId])

  // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø³ÙÙ„ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø¯ÙŠØ¯Ø©
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })
  }, [messages])

  // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
  const sendMessage = async (text: string) => {
    if (!text.trim() || !user || !orderId) return
    
    setSending(true)
    try {
      // ØªØ­Ø¯ÙŠØ¯ Ø¯ÙˆØ± Ø§Ù„Ù…Ø±Ø³Ù„
      let senderRole: 'customer' | 'courier' | 'owner' = 'customer'
      if (isCourier) senderRole = 'courier'
      else if (isOwner) senderRole = 'owner'
      
      await addDoc(collection(db, 'orders', orderId, 'messages'), {
        text: text.trim(),
        senderId: user.uid,
        senderRole,
        createdAt: serverTimestamp(),
      })
      setNewMsg('')
      setShowEmoji(false)
    } catch (err) {
      toast.error('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©')
    }
    setSending(false)
  }

  // Ø¥Ø¶Ø§ÙØ© Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù„Ù„Ø±Ø³Ø§Ù„Ø©
  const addEmoji = (emoji: string) => {
    setNewMsg(prev => prev + emoji)
  }

  // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
  const formatTime = (ts: Timestamp | null) => {
    if (!ts) return ''
    const date = ts.toDate()
    return date.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' })
  }

  // Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
  const getStatusInfo = (status: string) => {
    const map: Record<string, { text: string; color: string; emoji: string }> = {
      'pending': { text: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', color: 'bg-yellow-500', emoji: 'â³' },
      'accepted': { text: 'ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„', color: 'bg-blue-500', emoji: 'âœ…' },
      'preparing': { text: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±', color: 'bg-orange-500', emoji: 'ğŸ‘¨â€ğŸ³' },
      'ready': { text: 'Ø¬Ø§Ù‡Ø²', color: 'bg-purple-500', emoji: 'ğŸ“¦' },
      'out_for_delivery': { text: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚', color: 'bg-sky-500', emoji: 'ğŸš—' },
      'delivered': { text: 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…', color: 'bg-green-500', emoji: 'âœ…' },
    }
    return map[status] || { text: status, color: 'bg-gray-500', emoji: 'ğŸ“¦' }
  }
  
  // ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø´Ø±ÙŠÙƒ
  const getPartnerIcon = () => {
    if (isCourier || isOwner) return 'ğŸ‘¤' // Ø§Ù„Ø¹Ù…ÙŠÙ„
    if (isChatWithRestaurant) return 'ğŸ½ï¸' // Ø§Ù„Ù…Ø·Ø¹Ù…
    return 'ğŸš—' // Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
  }

  if (!orderId) {
    return (
      <div className="flex items-center justify-center min-h-[60vh]">
        <div className="text-center">
          <MessageCircle className="w-16 h-16 mx-auto text-gray-300 mb-4" />
          <p className="text-gray-500">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</p>
        </div>
      </div>
    )
  }

  if (!order) {
    return (
      <div className="flex items-center justify-center min-h-[60vh]">
        <div className="text-center">
          <div className="w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4" />
          <p className="text-gray-500">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
      </div>
    )
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© (Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£Ùˆ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù…)
  const hasAccess = user?.uid === order.customerId || 
                    user?.uid === order.courierId || 
                    user?.uid === order.restaurantId
  
  if (!hasAccess) {
    return (
      <div className="flex items-center justify-center min-h-[60vh]">
        <div className="text-center">
          <div className="text-6xl mb-4">ğŸ”’</div>
          <p className="text-gray-500">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</p>
        </div>
      </div>
    )
  }

  const statusInfo = getStatusInfo(order.status)

  return (
    <div className="flex flex-col h-[calc(100vh-200px)] max-w-2xl mx-auto">
      {/* Ø±Ø£Ø³ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ÙØ®Ù… */}
      <div className={`bg-gradient-to-r ${isChatWithRestaurant ? 'from-orange-500 via-amber-500 to-yellow-500' : 'from-primary via-sky-500 to-accent'} rounded-t-3xl p-4 shadow-luxury`}>
        <div className="flex items-center gap-3">
          <button 
            onClick={() => nav(-1)}
            className="w-10 h-10 rounded-full bg-white/20 backdrop-blur flex items-center justify-center hover:bg-white/30 transition-all"
          >
            <ArrowRight className="w-5 h-5 text-white" />
          </button>
          
          <div className="flex-1">
            <div className="flex items-center gap-2">
              <div className="w-12 h-12 rounded-full bg-white/20 backdrop-blur flex items-center justify-center">
                <span className="text-2xl">{getPartnerIcon()}</span>
              </div>
              <div>
                <h2 className="font-bold text-white text-lg">
                  {partnerName || (isChatWithRestaurant ? 'Ø§Ù„Ù…Ø·Ø¹Ù…' : (isCourier || isOwner ? 'Ø§Ù„Ø¹Ù…ÙŠÙ„' : 'Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨'))}
                </h2>
                <div className="flex items-center gap-1 text-white/80 text-sm">
                  <span className={`w-2 h-2 rounded-full ${order.status === 'delivered' ? 'bg-green-400' : 'bg-yellow-400 animate-pulse'}`} />
                  <span>{statusInfo.emoji} {statusInfo.text}</span>
                </div>
              </div>
            </div>
          </div>
          
          {isChatWithRestaurant ? (
            <Store className="w-6 h-6 text-white animate-pulse" />
          ) : (
            <Sparkles className="w-6 h-6 text-yellow-300 animate-pulse" />
          )}
        </div>
        
        {/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø®ØªØµØ±Ø© */}
        <div className="mt-3 flex items-center gap-4 text-white/90 text-sm">
          <div className="flex items-center gap-1">
            <Package className="w-4 h-4" />
            <span>#{order.id.slice(-6)}</span>
          </div>
          {order.restaurantName && (
            <div className="flex items-center gap-1">
              <Store className="w-4 h-4" />
              <span>{order.restaurantName}</span>
            </div>
          )}
          <div className="flex items-center gap-1">
            <MapPin className="w-4 h-4" />
            <span className="truncate max-w-[150px]">{order.address}</span>
          </div>
        </div>
      </div>

      {/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */}
      <div className="flex-1 overflow-y-auto bg-gradient-to-b from-sky-50 to-white p-4 space-y-3">
        {messages.length === 0 && (
          <div className="text-center py-10">
            <div className="text-6xl mb-4">ğŸ’¬</div>
            <p className="text-gray-500">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¢Ù†!</p>
            <p className="text-gray-400 text-sm mt-1">Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„ØªÙˆØ§ØµÙ„</p>
          </div>
        )}
        
        {messages.map((msg, idx) => {
          const isMe = msg.senderId === user?.uid
          return (
            <div
              key={msg.id}
              className={`flex ${isMe ? 'justify-start' : 'justify-end'}`}
            >
              <div
                className={`
                  max-w-[80%] rounded-2xl px-4 py-3 shadow-md
                  ${isMe 
                    ? 'bg-gradient-to-br from-primary to-sky-600 text-white rounded-br-sm' 
                    : 'bg-white text-gray-800 rounded-bl-sm border border-gray-100'
                  }
                  transform transition-all duration-300 hover:scale-[1.02]
                `}
              >
                <p className="text-base leading-relaxed">{msg.text}</p>
                <div className={`flex items-center gap-1 mt-1 text-xs ${isMe ? 'text-white/70' : 'text-gray-400'}`}>
                  <Clock className="w-3 h-3" />
                  <span>{formatTime(msg.createdAt)}</span>
                  {isMe && <CheckCheck className="w-3 h-3 mr-1" />}
                </div>
              </div>
            </div>
          )
        })}
        <div ref={messagesEndRef} />
      </div>

      {/* Ø±Ø³Ø§Ø¦Ù„ Ø³Ø±ÙŠØ¹Ø© */}
      <div className="bg-white border-t border-gray-100 px-3 py-2">
        <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
          {quickMessages.map((qm, idx) => (
            <button
              key={idx}
              onClick={() => sendMessage(qm.text)}
              className="flex-shrink-0 px-4 py-2 bg-gradient-to-r from-sky-50 to-blue-50 
                         rounded-full text-sm text-primary font-medium border border-sky-100
                         hover:from-sky-100 hover:to-blue-100 hover:shadow-md 
                         transition-all duration-200 active:scale-95"
            >
              {qm.text}
            </button>
          ))}
        </div>
      </div>

      {/* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */}
      {showEmoji && (
        <div className="bg-white border-t border-gray-100 px-4 py-3">
          <div className="flex flex-wrap gap-2 justify-center">
            {EMOJI_PICKER.map((emoji, idx) => (
              <button
                key={idx}
                onClick={() => addEmoji(emoji)}
                className="w-10 h-10 text-2xl hover:bg-gray-100 rounded-full 
                           transition-all duration-200 hover:scale-125 active:scale-95"
              >
                {emoji}
              </button>
            ))}
          </div>
        </div>
      )}

      {/* Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙØ®Ù… */}
      <div className="bg-white border-t border-gray-200 p-3">
        <div className="flex items-center gap-2">
          <button
            onClick={() => setShowEmoji(!showEmoji)}
            className={`w-10 h-10 rounded-full flex items-center justify-center transition-all
                       ${showEmoji ? 'bg-primary text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}
          >
            <Smile className="w-5 h-5" />
          </button>
          
          <div className="flex-1 relative">
            <input
              type="text"
              value={newMsg}
              onChange={(e) => setNewMsg(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && sendMessage(newMsg)}
              placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..."
              className="w-full px-5 py-3 bg-gray-100 rounded-full text-gray-800 
                         placeholder-gray-400 focus:outline-none focus:ring-2 
                         focus:ring-primary/50 focus:bg-white transition-all"
            />
          </div>
          
          <button
            onClick={() => sendMessage(newMsg)}
            disabled={!newMsg.trim() || sending}
            className={`w-12 h-12 rounded-full flex items-center justify-center transition-all
                       ${newMsg.trim() 
                         ? 'bg-gradient-to-r from-primary to-accent text-white shadow-lg hover:shadow-xl hover:scale-105' 
                         : 'bg-gray-200 text-gray-400'
                       }
                       disabled:opacity-50 active:scale-95`}
          >
            <Send className="w-5 h-5" />
          </button>
        </div>
      </div>

      {/* ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… */}
      {order.status === 'delivered' && (
        <div className="bg-gradient-to-r from-green-500 to-emerald-500 p-4 text-center">
          <div className="flex items-center justify-center gap-2 text-white">
            <CheckCheck className="w-6 h-6" />
            <span className="font-bold">ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰</span>
            <Heart className="w-5 h-5 text-red-300 animate-pulse" />
          </div>
          <p className="text-white/80 text-sm mt-1">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ ØªØ·Ø¨ÙŠÙ‚Ù†Ø§ â­</p>
        </div>
      )}
    </div>
  )
}

==========================================================================================
FILE: src/pages/CheckoutPage.tsx
==========================================================================================
import React, { useState, useEffect } from 'react'
import { addDoc, collection, doc, getDoc, updateDoc, increment, serverTimestamp } from 'firebase/firestore'
import { db } from '@/firebase'
import { useCart } from '@/hooks/useCart'
import { useAuth } from '@/auth'
import { useNavigate } from 'react-router-dom'
import { RoleGate } from '@/routes/RoleGate'
import { useDialog } from '@/components/ui/ConfirmDialog'
import { useToast } from '@/components/ui/Toast'
import { LocationPicker } from '@/components/LocationPicker'
import { MapPin, Check, ShoppingBag, Truck, CreditCard, ChevronLeft, Store, XCircle, Info } from 'lucide-react'

const PLATFORM_FEE_PER_ITEM = 1.0
const ADMIN_COMMISSION_PER_ITEM = 0.75

// Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ© Ø¹Ù„Ù‰ ÙƒÙ„ Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„ (ØªÙØ®ØµÙ… Ù…Ù† Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨)
const COURIER_PLATFORM_FEE = 3.75

// âœ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…ØªÙˆÙØ± - Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ ÙŠØ­Ø¯Ø¯Ù‡Ø§ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨/Ø§Ù„Ø£Ø³Ø±Ø©
const DELIVERY_AVAILABLE = true

export const CheckoutPage: React.FC = () => {
  const { items, subtotal, clear } = useCart()
  const { user } = useAuth()
  const nav = useNavigate()
  const dialog = useDialog()
  const toast = useToast()
  const [address, setAddress] = useState('')
  const [saving, setSaving] = useState(false)
  const [restaurant, setRestaurant] = useState<{ id: string; name: string; referredBy?: string; referrerType?: string } | null>(null)
  const [location, setLocation] = useState<{ lat: number; lng: number } | null>(null)
  const [showLocationPicker, setShowLocationPicker] = useState(false)
  const [deliveryType, setDeliveryType] = useState<'pickup' | 'delivery'>('pickup') // Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ

  // Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ ØªØ¨Ø¯Ø£ Ø¨Ù€ 0 - ÙŠØ­Ø¯Ø¯Ù‡Ø§ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£Ùˆ Ø§Ù„Ø£Ø³Ø±Ø© Ø¹Ù†Ø¯ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨
  const deliveryFee = 0 // Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
  const totalItemsCount = items.reduce((sum, item) => sum + item.qty, 0)
  const total = subtotal // Ø¨Ø¯ÙˆÙ† Ø±Ø³ÙˆÙ… ØªÙˆØµÙŠÙ„ Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹

  // âœ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù…
  useEffect(() => {
    const loadRestaurant = async () => {
      if (items.length === 0) return
      let ownerId = items[0]?.ownerId

      if (!ownerId && items[0]?.id) {
        try {
          const menuSnap = await getDoc(doc(db, 'menuItems', items[0].id))
          const menuData = menuSnap.exists() ? (menuSnap.data() as any) : null
          ownerId = menuData?.ownerId || null
        } catch (err) {
          console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ†Ù:', err)
        }
      }

      if (!ownerId) {
        setRestaurant(null)
        return
      }

      const rSnap = await getDoc(doc(db, 'restaurants', ownerId))
      const rData = rSnap.exists() ? (rSnap.data() as any) : null
      setRestaurant({ 
        id: ownerId, 
        name: rData?.name || 'Ù…Ø·Ø¹Ù…',
        referredBy: rData?.referredBy,
        referrerType: rData?.referrerType
      })
    }
    loadRestaurant()
  }, [items])

  // âœ… Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† LocationPicker
  const handleLocationConfirm = (loc: { lat: number; lng: number }, addr: string) => {
    setLocation(loc)
    setAddress(addr)
    setShowLocationPicker(false)
    toast.success('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ“')
  }

  // âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
  const placeOrder = async () => {
    if (!user) return
    if (items.length === 0) { dialog.warning('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©'); return }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…ÙØ¹Ù„ ÙˆÙ…Ø®ØªØ§Ø±
    if (deliveryType === 'delivery' && DELIVERY_AVAILABLE) {
      if (!address) { dialog.warning('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†'); return }
      if (!location) { dialog.warning('Ø­Ø¯Ù‘Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©'); return }
    }

    let restId = restaurant?.id
    if (!restId && items[0]?.id) {
      const menuSnap = await getDoc(doc(db, 'menuItems', items[0].id))
      const menuData = menuSnap.exists() ? (menuSnap.data() as any) : null
      restId = menuData?.ownerId || null
    }

    if (!restId) {
      dialog.error('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø·Ø¹Ù… Ù„Ù„Ø·Ù„Ø¨. Ø£Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.')
      return
    }

    setSaving(true)
    
    // ğŸ’° Ø­Ø³Ø§Ø¨ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¯Ø®Ù„
    const referredByAdmin = restaurant?.referrerType === 'admin' && restaurant?.referredBy
    const totalItemsCount = items.reduce((sum, item) => sum + item.qty, 0)
    
    // Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠ (Ø¨Ø¯ÙˆÙ† Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚)
    const SERVICE_FEE_PER_ITEM = PLATFORM_FEE_PER_ITEM + ADMIN_COMMISSION_PER_ITEM // 1.75
    const originalSubtotal = subtotal - (SERVICE_FEE_PER_ITEM * totalItemsCount) // Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„Ù…Ø·Ø¹Ù…
    
    // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¯Ø®Ù„:
    const restaurantEarnings = originalSubtotal // Ø§Ù„Ù…Ø·Ø¹Ù… ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ
    const platformFee = PLATFORM_FEE_PER_ITEM * totalItemsCount // Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (1 Ø±.Ø³ Ã— Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª)
    const adminCommission = referredByAdmin ? (ADMIN_COMMISSION_PER_ITEM * totalItemsCount) : 0 // Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø´Ø±Ù
    const appEarnings = platformFee + (referredByAdmin ? 0 : (ADMIN_COMMISSION_PER_ITEM * totalItemsCount)) // Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ£Ø®Ø° Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø´Ø±Ù Ø¥Ø°Ø§ Ù…Ø§ ÙÙŠÙ‡ Ù…Ø´Ø±Ù

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©
    const orderRef = await addDoc(collection(db, 'orders'), {
      customerId: user.uid,
      restaurantId: restId,
      restaurantName: restaurant?.name || 'Ù…Ø·Ø¹Ù…',
      items: items.map(i => ({
        id: i.id,
        name: i.name,
        price: i.price,
        qty: i.qty,
        ownerId: i.ownerId ?? restId,
      })),
      subtotal,
      deliveryFee: 0, // ÙŠØ­Ø¯Ø¯Ù‡Ø§ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£Ùˆ Ø§Ù„Ø£Ø³Ø±Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹
      deliveryFeeSetBy: null, // Ù…Ù† Ø­Ø¯Ø¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„
      deliveryFeeSetAt: null, // Ù…ØªÙ‰ ØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§
      total: subtotal, // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¯ÙˆÙ† Ø±Ø³ÙˆÙ… ØªÙˆØµÙŠÙ„ Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹
      status: 'pending',
      deliveryType, // Ù†ÙˆØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ…: pickup Ø£Ùˆ delivery
      address: deliveryType === 'pickup' ? 'Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…' : address,
      location: deliveryType === 'pickup' ? null : location,
      createdAt: serverTimestamp(),
      updatedAt: serverTimestamp(),
      paymentMethod: 'cod',
      // ğŸ’° Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¯Ø®Ù„
      restaurantEarnings: restaurantEarnings,
      platformFee: platformFee,
      platformFeePerItem: PLATFORM_FEE_PER_ITEM,
      adminCommission: adminCommission,
      adminCommissionPerItem: ADMIN_COMMISSION_PER_ITEM,
      appEarnings: appEarnings,
      totalItemsCount: totalItemsCount,
      referredBy: restaurant?.referredBy || null,
      // ğŸ’° Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ (3.75 Ø±ÙŠØ§Ù„)
      courierPlatformFee: deliveryType === 'delivery' ? COURIER_PLATFORM_FEE : 0,
    })

    // ğŸ’° ØªØ­Ø¯ÙŠØ« Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø·Ø¹Ù…
    try {
      const restaurantWalletRef = doc(db, 'wallets', restId)
      const restaurantWalletSnap = await getDoc(restaurantWalletRef)
      
      if (restaurantWalletSnap.exists()) {
        await updateDoc(restaurantWalletRef, {
          balance: increment(restaurantEarnings),
          totalEarnings: increment(restaurantEarnings),
          updatedAt: serverTimestamp(),
        })
      } else {
        const { setDoc } = await import('firebase/firestore')
        await setDoc(restaurantWalletRef, {
          balance: restaurantEarnings,
          totalEarnings: restaurantEarnings,
          totalWithdrawn: 0,
          transactions: [],
          updatedAt: serverTimestamp(),
        })
      }
    } catch (err) {
      // Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø·Ø¹Ù…
    }

    // ğŸ’° ØªØ­Ø¯ÙŠØ« Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø´Ø±Ù Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø·Ø¹Ù… Ù…Ø³Ø¬Ù„ Ø¹Ù† Ø·Ø±ÙŠÙ‚Ù‡
    if (referredByAdmin && restaurant?.referredBy && adminCommission > 0) {
      try {
        const walletRef = doc(db, 'wallets', restaurant.referredBy)
        const walletSnap = await getDoc(walletRef)
        
        if (walletSnap.exists()) {
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
          await updateDoc(walletRef, {
            balance: increment(adminCommission),
            totalEarnings: increment(adminCommission),
            updatedAt: serverTimestamp(),
          })
        } else {
          // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ÙØ¸Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ø´Ø±Ù
          const { setDoc } = await import('firebase/firestore')
          await setDoc(walletRef, {
            balance: adminCommission,
            totalEarnings: adminCommission,
            totalWithdrawn: 0,
            transactions: [],
            updatedAt: serverTimestamp(),
          })
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù„Ù„Ø³Ø¬Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹)
      } catch (err) {
        // Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø´Ø±Ù
      }
    }

    // ğŸ’° ØªØ­Ø¯ÙŠØ« Ù…Ø­ÙØ¸Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ)
    try {
      const appWalletRef = doc(db, 'wallets', 'app_earnings')
      const appWalletSnap = await getDoc(appWalletRef)
      
      if (appWalletSnap.exists()) {
        await updateDoc(appWalletRef, {
          balance: increment(appEarnings),
          totalEarnings: increment(appEarnings),
          updatedAt: serverTimestamp(),
        })
      } else {
        const { setDoc } = await import('firebase/firestore')
        await setDoc(appWalletRef, {
          balance: appEarnings,
          totalEarnings: appEarnings,
          totalWithdrawn: 0,
          transactions: [],
          updatedAt: serverTimestamp(),
        })
      }
    } catch (err) {
      // Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù…Ø­ÙØ¸Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    }

    clear()
    setSaving(false)
    nav('/orders')
  }

  return (
    <RoleGate allow={['customer', 'admin']}>
      <div className="max-w-xl mx-auto space-y-4">
        
        {/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */}
        <div className="bg-gradient-to-r from-sky-500 to-sky-600 rounded-2xl p-5 text-white shadow-lg">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
              <ShoppingBag className="w-6 h-6" />
            </div>
            <div>
              <h1 className="text-xl font-bold">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</h1>
              <p className="text-sm text-white/80">{restaurant?.name || 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...'}</p>
            </div>
          </div>
        </div>

        {/* ğŸ§¾ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ */}
        <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
          <div className="bg-gray-50 px-4 py-3 border-b flex items-center gap-2">
            <ShoppingBag className="w-5 h-5 text-sky-500" />
            <span className="font-bold text-gray-800">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</span>
            <span className="text-xs bg-sky-100 text-sky-600 px-2 py-0.5 rounded-full mr-auto">
              {items.length} ØµÙ†Ù
            </span>
          </div>
          <div className="p-4 space-y-2">
            {items.map(i => (
              <div key={i.id} className="flex items-center justify-between py-2 border-b border-gray-100 last:border-0">
                <div className="flex items-center gap-3">
                  <span className="w-8 h-8 bg-sky-100 rounded-lg flex items-center justify-center text-sm">
                    {i.qty}Ã—
                  </span>
                  <span className="text-gray-800 font-medium">{i.name}</span>
                </div>
                <span className="font-bold text-sky-600">{(i.price * i.qty).toFixed(2)} Ø±.Ø³</span>
              </div>
            ))}
          </div>
        </div>

        {/* ï¿½ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… */}
        <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
          <div className="bg-gray-50 px-4 py-3 border-b flex items-center gap-2">
            <Truck className="w-5 h-5 text-sky-500" />
            <span className="font-bold text-gray-800">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</span>
          </div>
          <div className="p-4 space-y-3">
            {/* Ø®ÙŠØ§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù… */}
            <button
              onClick={() => setDeliveryType('pickup')}
              className={`w-full p-4 rounded-xl border-2 transition flex items-center gap-4 ${
                deliveryType === 'pickup'
                  ? 'border-green-500 bg-green-50'
                  : 'border-gray-200 hover:border-gray-300'
              }`}
            >
              <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${
                deliveryType === 'pickup' ? 'bg-green-500' : 'bg-gray-100'
              }`}>
                <Store className={`w-6 h-6 ${deliveryType === 'pickup' ? 'text-white' : 'text-gray-500'}`} />
              </div>
              <div className="flex-1 text-right">
                <p className={`font-bold ${deliveryType === 'pickup' ? 'text-green-700' : 'text-gray-800'}`}>
                  Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…
                </p>
                <p className="text-sm text-gray-500">Ù…Ø¬Ø§Ù†Ø§Ù‹ - Ø¨Ø¯ÙˆÙ† Ø±Ø³ÙˆÙ… ØªÙˆØµÙŠÙ„</p>
              </div>
              {deliveryType === 'pickup' && (
                <Check className="w-6 h-6 text-green-500" />
              )}
            </button>

            {/* Ø®ÙŠØ§Ø± Ø§Ù„ØªÙˆØµÙŠÙ„ */}
            <button
              onClick={() => setDeliveryType('delivery')}
              className={`w-full p-4 rounded-xl border-2 transition flex items-center gap-4 ${
                deliveryType === 'delivery'
                  ? 'border-sky-500 bg-sky-50'
                  : 'border-gray-200 hover:border-gray-300'
              }`}
            >
              <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${
                deliveryType === 'delivery' ? 'bg-sky-500' : 'bg-gray-100'
              }`}>
                <Truck className={`w-6 h-6 ${deliveryType === 'delivery' ? 'text-white' : 'text-gray-500'}`} />
              </div>
              <div className="flex-1 text-right">
                <p className={`font-bold ${deliveryType === 'delivery' ? 'text-sky-700' : 'text-gray-800'}`}>
                  ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„
                </p>
                <p className="text-sm text-amber-600">Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ ÙŠØ­Ø¯Ø¯Ù‡Ø§ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨/Ø§Ù„Ø£Ø³Ø±Ø©</p>
              </div>
              {deliveryType === 'delivery' && (
                <Check className="w-6 h-6 text-sky-500" />
              )}
            </button>
          </div>
        </div>

        {/* ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ - ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…ØªÙˆÙØ± ÙˆÙ…Ø®ØªØ§Ø± */}
        {DELIVERY_AVAILABLE && deliveryType === 'delivery' && (
        <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
          <div className="bg-gray-50 px-4 py-3 border-b flex items-center gap-2">
            <MapPin className="w-5 h-5 text-green-500" />
            <span className="font-bold text-gray-800">Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„</span>
          </div>
          <div className="p-4">
            {location ? (
              <div className="space-y-3">
                {/* Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯ */}
                <div className="bg-green-50 border-2 border-green-200 rounded-xl p-4">
                  <div className="flex items-start gap-3">
                    <div className="w-10 h-10 bg-green-500 rounded-xl flex items-center justify-center flex-shrink-0">
                      <Check className="w-5 h-5 text-white" />
                    </div>
                    <div className="flex-1 min-w-0">
                      <p className="font-bold text-green-700 mb-1">ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ âœ“</p>
                      <p className="text-sm text-gray-600 break-words">{address}</p>
                      <p className="text-xs text-gray-400 mt-1 font-mono">
                        {location.lat.toFixed(5)}, {location.lng.toFixed(5)}
                      </p>
                    </div>
                  </div>
                </div>
                
                {/* Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹ */}
                <button
                  onClick={() => setShowLocationPicker(true)}
                  className="w-full py-3 px-4 rounded-xl border-2 border-sky-200 text-sky-600 font-semibold hover:bg-sky-50 transition flex items-center justify-center gap-2"
                >
                  <MapPin className="w-5 h-5" />
                  ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹
                </button>
              </div>
            ) : (
              <button
                onClick={() => setShowLocationPicker(true)}
                className="w-full py-4 rounded-xl bg-gradient-to-r from-sky-500 to-sky-600 text-white font-bold shadow-lg hover:shadow-xl transition flex items-center justify-center gap-3"
              >
                <MapPin className="w-6 h-6" />
                <span>ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„</span>
                <ChevronLeft className="w-5 h-5" />
              </button>
            )}
          </div>
        </div>
        )}

        {/* ğŸ’° Ø§Ù„Ù…Ù„Ø®Øµ */}
        <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
          <div className="bg-gray-50 px-4 py-3 border-b flex items-center gap-2">
            <CreditCard className="w-5 h-5 text-amber-500" />
            <span className="font-bold text-gray-800">Ù…Ù„Ø®Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span>
          </div>
          <div className="p-4 space-y-2">
            <div className="flex items-center justify-between text-gray-600">
              <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</span>
              <span className="font-semibold">{subtotal.toFixed(2)} Ø±.Ø³</span>
            </div>
            {deliveryType === 'delivery' && (
            <div className="flex items-center justify-between text-amber-600">
              <div className="flex items-center gap-2">
                <Truck className="w-4 h-4" />
                <span>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
              </div>
              <span className="font-semibold text-sm">ØªÙØ­Ø¯Ø¯ Ù„Ø§Ø­Ù‚Ø§Ù‹</span>
            </div>
            )}
            {deliveryType === 'pickup' && (
            <div className="flex items-center justify-between text-green-600">
              <div className="flex items-center gap-2">
                <Store className="w-4 h-4" />
                <span>Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…</span>
              </div>
              <span className="font-semibold">Ù…Ø¬Ø§Ù†Ø§Ù‹</span>
            </div>
            )}
            <div className="h-px bg-gray-200 my-2" />
            <div className="flex items-center justify-between">
              <span className="font-bold text-lg text-gray-800">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
              <span className="font-black text-xl text-sky-600">{total.toFixed(2)} Ø±.Ø³</span>
            </div>
          </div>
        </div>

        {/* âœ… Ø²Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ */}
        <button
          disabled={saving || (deliveryType === 'delivery' && DELIVERY_AVAILABLE && !location)}
          onClick={placeOrder}
          className="w-full py-4 rounded-2xl bg-gradient-to-r from-green-500 to-green-600 text-white font-bold text-lg shadow-xl hover:shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center gap-3"
        >
          {saving ? (
            <>
              <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
              Ø¬Ø§Ø±Ù Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...
            </>
          ) : (
            <>
              <Check className="w-6 h-6" />
              {deliveryType === 'pickup' ? 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ (Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…)' : 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ (Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…)'}
            </>
          )}
        </button>

        {/* ØªØ­Ø°ÙŠØ± Ù„Ù„ØªÙˆØµÙŠÙ„ */}
        {deliveryType === 'delivery' && DELIVERY_AVAILABLE && !location && (
          <p className="text-center text-sm text-amber-600 bg-amber-50 rounded-xl p-3">
            âš ï¸ ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„ Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
          </p>
        )}

        {/* LocationPicker Modal */}
        <LocationPicker
          isOpen={showLocationPicker}
          onClose={() => setShowLocationPicker(false)}
          onConfirm={handleLocationConfirm}
          initialLocation={location}
        />
      </div>
    </RoleGate>
  )
}

==========================================================================================
FILE: src/pages/CourierApp.tsx
==========================================================================================
import React, { useEffect, useState } from 'react'
import { collection, doc, onSnapshot, orderBy, query, updateDoc, where, serverTimestamp, limit } from 'firebase/firestore'
import { db } from '@/firebase'
import { useAuth } from '@/auth'
import { Order } from '@/types'
import { useNavigate } from 'react-router-dom'
import { useToast } from '@/components/ui/Toast'
import { 
  MessageCircle, Package, MapPin, Truck, CheckCircle, 
  Clock, Navigation, Phone, DollarSign, Sparkles, AlertCircle 
} from 'lucide-react'

// Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ© Ø¹Ù„Ù‰ ÙƒÙ„ Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„ (ØªÙØ®ØµÙ… Ù…Ù† Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨)
const COURIER_PLATFORM_FEE = 3.75

export const CourierApp: React.FC = () => {
  const { user } = useAuth()
  const nav = useNavigate()
  const toast = useToast()
  const [ready, setReady] = useState<Order[]>([])
  const [mine, setMine] = useState<Order[]>([])
  const [deliveryFees, setDeliveryFees] = useState<Record<string, string>>({})
  const [savingFee, setSavingFee] = useState<string | null>(null)

  useEffect(() => {
    if (!user?.uid) return
    
    // âœ… Ø¥Ø¶Ø§ÙØ© limit Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
    const q1 = query(
      collection(db, 'orders'), 
      where('status', 'in', ['ready']), 
      orderBy('createdAt', 'desc'),
      limit(20) // Ø£Ø­Ø¯Ø« 20 Ø·Ù„Ø¨ Ø¬Ø§Ù‡Ø²
    )
    const u1 = onSnapshot(q1, (snap) => setReady(snap.docs.map(d => ({ id: d.id, ...d.data() } as Order))))
    
    const q2 = query(
      collection(db, 'orders'), 
      where('courierId', '==', user.uid), 
      orderBy('createdAt', 'desc'),
      limit(20) // Ø£Ø­Ø¯Ø« 20 Ø·Ù„Ø¨ Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨
    )
    const u2 = onSnapshot(q2, (snap) => setMine(snap.docs.map(d => ({ id: d.id, ...d.data() } as Order))))
    
    return () => { u1(); u2() }
  }, [user?.uid])

  const take = async (id: string, order: Order) => {
    if (!user) return
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ø¯ÙŠØ¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„
    if (!order.deliveryFeeSetBy) {
      const feeStr = deliveryFees[id]
      const fee = parseFloat(feeStr)
      
      if (isNaN(fee) || fee < 0) {
        toast.error('Ø­Ø¯Ø¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹')
        return
      }

      setSavingFee(id)
      const newTotal = order.subtotal + fee

      // ØªØ­Ø¯ÙŠØ¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¹Ø§Ù‹
      await updateDoc(doc(db, 'orders', id), { 
        courierId: user.uid, 
        status: 'out_for_delivery',
        deliveryFee: fee,
        deliveryFeeSetBy: 'courier',
        deliveryFeeSetAt: serverTimestamp(),
        total: newTotal,
        courierPlatformFee: COURIER_PLATFORM_FEE, // Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
        updatedAt: serverTimestamp() 
      })
      
      setSavingFee(null)
      toast.success(`ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨! Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„: ${fee} Ø±.Ø³ (- ${COURIER_PLATFORM_FEE} Ø±Ø³ÙˆÙ… Ù…Ù†ØµØ©)`)
    } else {
      // Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø­Ø¯Ø¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø³Ø±Ø©
      await updateDoc(doc(db, 'orders', id), { 
        courierId: user.uid, 
        status: 'out_for_delivery',
        courierPlatformFee: COURIER_PLATFORM_FEE,
        updatedAt: serverTimestamp() 
      })
      toast.success('ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨!')
    }
  }

  const delivered = async (id: string) => {
    await updateDoc(doc(db, 'orders', id), { status: 'delivered', updatedAt: serverTimestamp() })
  }

  return (
    <div className="space-y-6">
      {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© */}
      <div className="grid grid-cols-2 gap-4">
        <div className="bg-gradient-to-br from-sky-500 to-blue-600 rounded-2xl p-4 text-white shadow-lg">
          <div className="flex items-center gap-2 mb-1">
            <Package className="w-5 h-5" />
            <span className="text-sm opacity-90">Ø·Ù„Ø¨Ø§Øª Ø¬Ø§Ù‡Ø²Ø©</span>
          </div>
          <div className="text-3xl font-bold">{ready.length}</div>
        </div>
        <div className="bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl p-4 text-white shadow-lg">
          <div className="flex items-center gap-2 mb-1">
            <Truck className="w-5 h-5" />
            <span className="text-sm opacity-90">Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</span>
          </div>
          <div className="text-3xl font-bold">{mine.filter(o => o.status !== 'delivered').length}</div>
        </div>
      </div>

      <div className="grid lg:grid-cols-2 gap-6">
        {/* Ø·Ù„Ø¨Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… */}
        <div>
          <div className="flex items-center gap-2 mb-4">
            <div className="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center">
              <Package className="w-5 h-5 text-purple-600" />
            </div>
            <h2 className="font-bold text-lg">Ø·Ù„Ø¨Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªØ³Ù„ÙŠÙ… ğŸ“¦</h2>
          </div>
          <div className="space-y-3">
            {ready.map(o => (
              <div key={o.id} className="bg-white rounded-2xl shadow-card overflow-hidden hover:shadow-lg transition-all">
                <div className="bg-gradient-to-r from-purple-500 to-pink-500 px-4 py-2 flex items-center justify-between">
                  <span className="text-white font-bold">#{o.id.slice(-6)}</span>
                  <span className="text-white/90 text-sm">{o.restaurantName || 'Ù…Ø·Ø¹Ù…'}</span>
                </div>
                <div className="p-4">
                  <div className="flex items-center gap-2 text-gray-600 text-sm mb-2">
                    <MapPin className="w-4 h-4" />
                    <span className="truncate">{o.address}</span>
                  </div>
                  
                  {/* Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± */}
                  <div className="bg-gray-50 rounded-xl p-3 mb-3 space-y-1">
                    <div className="flex justify-between text-sm">
                      <span className="text-gray-600">Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                      <span className="font-semibold">{o.subtotal?.toFixed(2)} Ø±.Ø³</span>
                    </div>
                    {o.deliveryFeeSetBy ? (
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-600">Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
                        <span className="font-semibold text-green-600">{o.deliveryFee?.toFixed(2)} Ø±.Ø³</span>
                      </div>
                    ) : (
                      <div className="flex justify-between text-sm">
                        <span className="text-gray-600">Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
                        <span className="text-amber-600 text-xs">ØªØ­Ø¯Ø¯Ù‡Ø§ Ø£Ù†Øª</span>
                      </div>
                    )}
                    <div className="h-px bg-gray-200 my-1"></div>
                    <div className="flex justify-between">
                      <span className="font-bold text-gray-800">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                      <span className="font-bold text-green-600">{o.total?.toFixed(2)} Ø±.Ø³</span>
                    </div>
                  </div>

                  {/* ØªØ­Ø¯ÙŠØ¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¥Ø°Ø§ Ù„Ù… ØªÙØ­Ø¯Ø¯ */}
                  {!o.deliveryFeeSetBy && (
                    <div className="bg-amber-50 border border-amber-200 rounded-xl p-3 mb-3">
                      <div className="flex items-center gap-2 mb-2">
                        <AlertCircle className="w-4 h-4 text-amber-600" />
                        <span className="font-semibold text-amber-800 text-sm">Ø­Ø¯Ø¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
                      </div>
                      <div className="flex gap-2">
                        <input
                          type="number"
                          min="0"
                          step="0.5"
                          placeholder="Ù…Ø«Ø§Ù„: 10"
                          value={deliveryFees[o.id] || ''}
                          onChange={(e) => setDeliveryFees(prev => ({ ...prev, [o.id]: e.target.value }))}
                          className="flex-1 px-3 py-2 rounded-lg border border-amber-200 focus:border-amber-400 focus:outline-none text-gray-800 text-sm"
                        />
                        <span className="flex items-center text-gray-500 text-sm">Ø±.Ø³</span>
                      </div>
                      <p className="text-xs text-amber-700 mt-2">
                        âš ï¸ Ø³ÙŠÙØ®ØµÙ… {COURIER_PLATFORM_FEE} Ø±.Ø³ Ø±Ø³ÙˆÙ… Ù…Ù†ØµØ© Ù…Ù† Ø£Ø±Ø¨Ø§Ø­Ùƒ
                      </p>
                    </div>
                  )}

                  <button 
                    onClick={() => take(o.id, o)}
                    disabled={savingFee === o.id}
                    className="w-full py-3 rounded-xl bg-gradient-to-r from-gray-800 to-gray-900 
                               text-white font-bold flex items-center justify-center gap-2
                               hover:from-gray-900 hover:to-black transition-all shadow-lg hover:shadow-xl disabled:opacity-50"
                  >
                    {savingFee === o.id ? (
                      <span>Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸...</span>
                    ) : (
                      <>
                        <Truck className="w-5 h-5" />
                        <span>Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ ğŸš—</span>
                      </>
                    )}
                  </button>
                </div>
              </div>
            ))}
            {ready.length === 0 && (
              <div className="text-center py-10 bg-gray-50 rounded-2xl">
                <div className="text-5xl mb-3">ğŸ“¦</div>
                <p className="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ø§Ù„Ø¢Ù†</p>
                <p className="text-gray-400 text-sm mt-1">Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªÙˆØµÙŠÙ„</p>
              </div>
            )}
          </div>
        </div>

        {/* Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØ© */}
        <div>
          <div className="flex items-center gap-2 mb-4">
            <div className="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
              <Navigation className="w-5 h-5 text-green-600" />
            </div>
            <h2 className="font-bold text-lg">Ø·Ù„Ø¨Ø§ØªÙŠ ğŸ›µ</h2>
          </div>
          <div className="space-y-3">
            {mine.filter(o => o.status !== 'delivered').map(o => (
              <div key={o.id} className="bg-white rounded-2xl shadow-card overflow-hidden hover:shadow-lg transition-all">
                <div className="bg-gradient-to-r from-sky-500 to-blue-500 px-4 py-2 flex items-center justify-between">
                  <span className="text-white font-bold">#{o.id.slice(-6)}</span>
                  <div className="flex items-center gap-1 text-white/90 text-sm">
                    <Clock className="w-3 h-3" />
                    <span>ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚</span>
                  </div>
                </div>
                <div className="p-4">
                  <div className="flex items-center gap-2 text-gray-600 text-sm mb-2">
                    <MapPin className="w-4 h-4" />
                    <span className="truncate">{o.address}</span>
                  </div>
                  <div className="flex items-center gap-2 text-green-600 font-bold text-lg mb-3">
                    <DollarSign className="w-5 h-5" />
                    <span>{o.total?.toFixed?.(2)} Ø±.Ø³</span>
                  </div>
                  
                  {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */}
                  <div className="flex gap-2">
                    <button 
                      onClick={() => nav(`/chat?orderId=${o.id}`)}
                      className="flex-1 py-3 rounded-xl bg-gradient-to-r from-primary to-accent 
                                 text-white font-bold flex items-center justify-center gap-2
                                 hover:shadow-lg transition-all"
                    >
                      <MessageCircle className="w-5 h-5" />
                      <span>Ù…Ø­Ø§Ø¯Ø«Ø© ğŸ’¬</span>
                    </button>
                    <button 
                      onClick={() => delivered(o.id)} 
                      className="flex-1 py-3 rounded-xl bg-gradient-to-r from-green-500 to-emerald-500 
                                 text-white font-bold flex items-center justify-center gap-2
                                 hover:from-green-600 hover:to-emerald-600 transition-all shadow-lg hover:shadow-xl"
                    >
                      <CheckCircle className="w-5 h-5" />
                      <span>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… âœ…</span>
                    </button>
                  </div>
                </div>
              </div>
            ))}
            {mine.filter(o => o.status !== 'delivered').length === 0 && (
              <div className="text-center py-10 bg-gray-50 rounded-2xl">
                <div className="text-5xl mb-3">ğŸ›µ</div>
                <p className="text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                <p className="text-gray-400 text-sm mt-1">Ø§Ø³ØªÙ„Ù… Ø·Ù„Ø¨Ø§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©</p>
              </div>
            )}
          </div>
        </div>
      </div>

      {/* Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ù„Ù…Ø© Ø§Ù„ÙŠÙˆÙ… */}
      {mine.filter(o => o.status === 'delivered').length > 0 && (
        <div className="mt-6">
          <div className="flex items-center gap-2 mb-4">
            <Sparkles className="w-5 h-5 text-yellow-500" />
            <h3 className="font-bold text-gray-700">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… âœ…</h3>
          </div>
          <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-3">
            {mine.filter(o => o.status === 'delivered').slice(0, 6).map(o => (
              <div key={o.id} className="bg-green-50 border border-green-200 rounded-xl p-3">
                <div className="flex items-center justify-between">
                  <span className="font-bold text-green-700">#{o.id.slice(-6)}</span>
                  <span className="text-green-600 font-bold">{o.total?.toFixed?.(2)} Ø±.Ø³</span>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  )
}

==========================================================================================
FILE: src/pages/CourierHiring.tsx
==========================================================================================
// src/pages/CourierHiring.tsx
import React, { useEffect, useState } from 'react'
import { db } from '@/firebase'
import { collection, getDocs, addDoc, query, where, getDocs as getDocsQ, serverTimestamp } from 'firebase/firestore'
import { useAuth } from '@/auth'
import { Briefcase, CheckCircle2, XCircle, Clock } from 'lucide-react'
import { useDialog } from '@/components/ui/ConfirmDialog'

type Restaurant = {
  id: string
  name: string
  logoUrl?: string
}

type HiringRequest = {
  restaurantId: string
  status: string
}

export const CourierHiring: React.FC = () => {
  const { user } = useAuth()
  const dialog = useDialog()
  const [restaurants, setRestaurants] = useState<Restaurant[]>([])
  const [requests, setRequests] = useState<Record<string, HiringRequest>>({})
  const [loading, setLoading] = useState(true)
  const [sending, setSending] = useState<string | null>(null)

  useEffect(() => {
    if (!user) return

    const load = async () => {
      // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
      const snap = await getDocs(collection(db, 'restaurants'))
      const data = snap.docs.map(d => ({ id: d.id, ...(d.data() as any) }))
      setRestaurants(data)

      // âœ… ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØ¸ÙŠÙ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
      const qy = query(collection(db, 'hiringRequests'), where('courierId', '==', user.uid))
      const reqSnap = await getDocsQ(qy)
      const reqs: Record<string, HiringRequest> = {}
      reqSnap.docs.forEach(d => {
        const rd = d.data() as any
        reqs[rd.restaurantId] = { restaurantId: rd.restaurantId, status: rd.status }
      })
      setRequests(reqs)

      setLoading(false)
    }

    load()
  }, [user])

  const sendRequest = async (r: Restaurant) => {
    if (!user) { dialog.warning('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹'); return }
    setSending(r.id)

    await addDoc(collection(db, 'hiringRequests'), {
      courierId: user.uid,
      courierName: user.displayName || 'Ù…Ù†Ø¯ÙˆØ¨',
      restaurantId: r.id,
      restaurantName: r.name,
      status: 'pending',
      createdAt: serverTimestamp(),
    })

    setRequests(prev => ({
      ...prev,
      [r.id]: { restaurantId: r.id, status: 'pending' },
    }))

    setSending(null)
  }

  if (loading) return <div className="text-center py-10 text-sky-600">â³ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…...</div>

  return (
    <div className="min-h-screen bg-gradient-to-br from-sky-50 via-white to-sky-100 py-8 px-4">
      <h1 className="text-2xl sm:text-3xl font-extrabold text-sky-600 text-center mb-8 flex items-center justify-center gap-2">
        <Briefcase className="w-7 h-7 text-sky-500" />
        Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØ¸ÙŠÙ
      </h1>

      <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 max-w-5xl mx-auto">
        {restaurants.map(r => {
          const req = requests[r.id]
          return (
            <div
              key={r.id}
              className="glass-card rounded-2xl p-6 hover:shadow-xl transition transform hover:-translate-y-1 flex flex-col items-center"
            >
              {r.logoUrl ? (
                <img
                  src={r.logoUrl}
                  className="w-24 h-24 rounded-full mb-4 object-cover border-4 border-sky-300 shadow"
                />
              ) : (
                <div className="w-24 h-24 rounded-full bg-sky-100 flex items-center justify-center text-3xl mb-4">
                  ğŸ´
                </div>
              )}
              <h3 className="font-bold text-lg mb-2 text-sky-900">{r.name}</h3>

              {req ? (
                <span
                  className={`mt-3 px-4 py-2 rounded-xl text-sm font-semibold flex items-center gap-2 ${
                    req.status === 'pending'
                      ? 'bg-amber-100 text-amber-700 border border-amber-200'
                      : req.status === 'accepted'
                      ? 'bg-green-100 text-green-700 border border-green-200'
                      : 'bg-red-100 text-red-700 border border-red-200'
                  }`}
                >
                  {req.status === 'pending' && <Clock className="w-4 h-4" />}
                  {req.status === 'accepted' && <CheckCircle2 className="w-4 h-4" />}
                  {req.status === 'rejected' && <XCircle className="w-4 h-4" />}
                  {req.status === 'pending'
                    ? 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'
                    : req.status === 'accepted'
                    ? 'âœ… ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„'
                    : 'âŒ Ù…Ø±ÙÙˆØ¶'}
                </span>
              ) : (
                <button
                  disabled={sending === r.id}
                  onClick={() => sendRequest(r)}
                  className="mt-4 w-full px-4 py-2 rounded-xl bg-gradient-to-r from-sky-500 to-sky-600 text-white font-bold shadow-lg shadow-sky-200/50 hover:shadow-xl hover:scale-105 transition disabled:opacity-50"
                >
                  {sending === r.id ? 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...' : 'ğŸ“© Ø·Ù„Ø¨ ØªÙˆØ¸ÙŠÙ'}
                </button>
              )}
            </div>
          )
        })}
      </div>
    </div>
  )
}

==========================================================================================
FILE: src/pages/CourierRequests.tsx
==========================================================================================
// src/pages/CourierRequests.tsx
import React, { useEffect, useState } from 'react'
import { db } from '@/firebase'
import { collection, query, where, getDocs, updateDoc, doc, deleteDoc } from 'firebase/firestore'
import { useAuth } from '@/auth'
import { useDialog } from '@/components/ui/ConfirmDialog'
import { useToast } from '@/components/ui/Toast'
import { UserX, UserCheck, UserMinus, Clock, CheckCircle, XCircle, Trash2 } from 'lucide-react'

export const CourierRequests: React.FC = () => {
  const { user } = useAuth()
  const dialog = useDialog()
  const toast = useToast()
  const [requests, setRequests] = useState<any[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    if (!user) return
    (async () => {
      const q = query(collection(db, 'hiringRequests'), where('restaurantId', '==', user.uid))
      const snap = await getDocs(q)
      setRequests(snap.docs.map(d => ({ id: d.id, ...(d.data() as any) })))
      setLoading(false)
    })()
  }, [user])

  const handleAction = async (id: string, status: 'accepted' | 'rejected') => {
    await updateDoc(doc(db, 'hiringRequests', id), { status })
    setRequests(reqs => reqs.map(r => r.id === id ? { ...r, status } : r))
    toast.success(status === 'accepted' ? 'ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ âœ…' : 'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨')
  }

  // ÙØµÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ (ØªØºÙŠÙŠØ± Ø­Ø§Ù„ØªÙ‡ Ø¥Ù„Ù‰ terminated)
  const handleTerminate = async (request: any) => {
    const confirmed = await dialog.confirm(
      `Ù‡Ù„ ØªØ±ÙŠØ¯ ÙØµÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ "${request.courierName}"ØŸ`,
      {
        title: 'ÙØµÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨',
        confirmText: 'Ù†Ø¹Ù…ØŒ ÙØµÙ„',
        cancelText: 'Ø¥Ù„ØºØ§Ø¡',
        dangerous: true
      }
    )
    
    if (!confirmed) return
    
    await updateDoc(doc(db, 'hiringRequests', request.id), { status: 'terminated' })
    setRequests(reqs => reqs.map(r => r.id === request.id ? { ...r, status: 'terminated' } : r))
    toast.success('ØªÙ… ÙØµÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨')
  }

  // Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹
  const handleDelete = async (request: any) => {
    const confirmed = await dialog.confirm(
      `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø·Ù„Ø¨ "${request.courierName}" Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ`,
      {
        title: 'Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨',
        confirmText: 'Ù†Ø¹Ù…ØŒ Ø­Ø°Ù',
        cancelText: 'Ø¥Ù„ØºØ§Ø¡',
        dangerous: true
      }
    )
    
    if (!confirmed) return
    
    await deleteDoc(doc(db, 'hiringRequests', request.id))
    setRequests(reqs => reqs.filter(r => r.id !== request.id))
    toast.success('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨')
  }

  // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
  const handleReactivate = async (request: any) => {
    await updateDoc(doc(db, 'hiringRequests', request.id), { status: 'accepted' })
    setRequests(reqs => reqs.map(r => r.id === request.id ? { ...r, status: 'accepted' } : r))
    toast.success('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ âœ…')
  }

  const getStatusBadge = (status: string) => {
    switch (status) {
      case 'pending':
        return { text: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯', color: 'bg-yellow-100 text-yellow-700', icon: Clock }
      case 'accepted':
        return { text: 'Ù…Ù‚Ø¨ÙˆÙ„ âœ…', color: 'bg-green-100 text-green-700', icon: CheckCircle }
      case 'rejected':
        return { text: 'Ù…Ø±ÙÙˆØ¶', color: 'bg-red-100 text-red-700', icon: XCircle }
      case 'terminated':
        return { text: 'Ù…ÙØµÙˆÙ„', color: 'bg-gray-100 text-gray-700', icon: UserX }
      default:
        return { text: status, color: 'bg-gray-100 text-gray-700', icon: Clock }
    }
  }

  if (loading) return <div className="text-center py-10">â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

  // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
  const activeCouriers = requests.filter(r => r.status === 'accepted')
  const pendingRequests = requests.filter(r => r.status === 'pending')
  const terminatedCouriers = requests.filter(r => r.status === 'terminated')
  const rejectedRequests = requests.filter(r => r.status === 'rejected')

  return (
    <div className="py-6 space-y-8">
      <h1 className="text-2xl font-bold text-primary text-center mb-6">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</h1>
      
      {requests.length === 0 ? (
        <div className="text-center py-16">
          <div className="text-6xl mb-4">ğŸ‘¥</div>
          <p className="text-gray-500 text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØªÙˆØ¸ÙŠÙ</p>
          <p className="text-gray-400 text-sm mt-2">Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù…Ø·Ø¹Ù…Ùƒ</p>
        </div>
      ) : (
        <>
          {/* Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ Ø§Ù„Ù†Ø´Ø·ÙŠÙ† */}
          {activeCouriers.length > 0 && (
            <div>
              <h2 className="text-lg font-bold text-green-600 mb-3 flex items-center gap-2">
                <UserCheck className="w-5 h-5" />
                Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ Ø§Ù„Ù†Ø´Ø·ÙŠÙ† ({activeCouriers.length})
              </h2>
              <div className="space-y-3">
                {activeCouriers.map(r => {
                  const badge = getStatusBadge(r.status)
                  return (
                    <div key={r.id} className="bg-white rounded-2xl shadow-card p-4 border-r-4 border-green-500">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center text-2xl">
                            ğŸš—
                          </div>
                          <div>
                            <div className="font-bold text-gray-800">{r.courierName}</div>
                            <div className={`text-xs px-2 py-1 rounded-full inline-flex items-center gap-1 ${badge.color}`}>
                              <badge.icon className="w-3 h-3" />
                              {badge.text}
                            </div>
                          </div>
                        </div>
                        <button
                          onClick={() => handleTerminate(r)}
                          className="flex items-center gap-2 px-4 py-2 bg-red-50 text-red-600 rounded-xl 
                                     hover:bg-red-100 transition-all font-medium"
                        >
                          <UserMinus className="w-4 h-4" />
                          ÙØµÙ„
                        </button>
                      </div>
                    </div>
                  )
                })}
              </div>
            </div>
          )}

          {/* Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯ */}
          {pendingRequests.length > 0 && (
            <div>
              <h2 className="text-lg font-bold text-yellow-600 mb-3 flex items-center gap-2">
                <Clock className="w-5 h-5" />
                Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ({pendingRequests.length})
              </h2>
              <div className="space-y-3">
                {pendingRequests.map(r => (
                  <div key={r.id} className="bg-white rounded-2xl shadow-card p-4 border-r-4 border-yellow-500">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <div className="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center text-2xl">
                          ğŸ‘¤
                        </div>
                        <div>
                          <div className="font-bold text-gray-800">{r.courierName}</div>
                          <div className="text-xs text-yellow-600">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯ â³</div>
                        </div>
                      </div>
                      <div className="flex gap-2">
                        <button 
                          onClick={() => handleAction(r.id, 'accepted')} 
                          className="flex items-center gap-1 px-4 py-2 rounded-xl bg-green-500 text-white hover:bg-green-600 transition-all font-medium"
                        >
                          <UserCheck className="w-4 h-4" />
                          Ù‚Ø¨ÙˆÙ„
                        </button>
                        <button 
                          onClick={() => handleAction(r.id, 'rejected')} 
                          className="flex items-center gap-1 px-4 py-2 rounded-xl bg-red-500 text-white hover:bg-red-600 transition-all font-medium"
                        >
                          <XCircle className="w-4 h-4" />
                          Ø±ÙØ¶
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ Ø§Ù„Ù…ÙØµÙˆÙ„ÙŠÙ† */}
          {terminatedCouriers.length > 0 && (
            <div>
              <h2 className="text-lg font-bold text-gray-500 mb-3 flex items-center gap-2">
                <UserX className="w-5 h-5" />
                Ø§Ù„Ù…ÙØµÙˆÙ„ÙŠÙ† ({terminatedCouriers.length})
              </h2>
              <div className="space-y-3">
                {terminatedCouriers.map(r => (
                  <div key={r.id} className="bg-gray-50 rounded-2xl shadow p-4 border-r-4 border-gray-400 opacity-75">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <div className="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center text-2xl">
                          ğŸ‘¤
                        </div>
                        <div>
                          <div className="font-bold text-gray-600">{r.courierName}</div>
                          <div className="text-xs text-gray-500">Ù…ÙØµÙˆÙ„</div>
                        </div>
                      </div>
                      <div className="flex gap-2">
                        <button
                          onClick={() => handleReactivate(r)}
                          className="flex items-center gap-1 px-3 py-2 bg-green-100 text-green-600 rounded-xl 
                                     hover:bg-green-200 transition-all text-sm font-medium"
                        >
                          <UserCheck className="w-4 h-4" />
                          Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„
                        </button>
                        <button
                          onClick={() => handleDelete(r)}
                          className="flex items-center gap-1 px-3 py-2 bg-red-100 text-red-600 rounded-xl 
                                     hover:bg-red-200 transition-all text-sm font-medium"
                        >
                          <Trash2 className="w-4 h-4" />
                          Ø­Ø°Ù
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø© */}
          {rejectedRequests.length > 0 && (
            <div>
              <h2 className="text-lg font-bold text-red-500 mb-3 flex items-center gap-2">
                <XCircle className="w-5 h-5" />
                Ù…Ø±ÙÙˆØ¶ÙŠÙ† ({rejectedRequests.length})
              </h2>
              <div className="space-y-3">
                {rejectedRequests.map(r => (
                  <div key={r.id} className="bg-red-50 rounded-2xl shadow p-4 border-r-4 border-red-400 opacity-75">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <div className="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center text-2xl">
                          ğŸ‘¤
                        </div>
                        <div>
                          <div className="font-bold text-gray-600">{r.courierName}</div>
                          <div className="text-xs text-red-500">Ù…Ø±ÙÙˆØ¶</div>
                        </div>
                      </div>
                      <button
                        onClick={() => handleDelete(r)}
                        className="flex items-center gap-1 px-3 py-2 bg-red-100 text-red-600 rounded-xl 
                                   hover:bg-red-200 transition-all text-sm font-medium"
                      >
                        <Trash2 className="w-4 h-4" />
                        Ø­Ø°Ù
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
        </>
      )}
    </div>
  )
}

==========================================================================================
FILE: src/pages/CourierTermsPage.tsx
==========================================================================================
// src/pages/CourierTermsPage.tsx
import React from "react";
import { Link } from "react-router-dom";

export default function CourierTermsPage() {
  return (
    <div className="min-h-screen bg-gray-100 text-gray-800 px-4 py-10 leading-relaxed">
      <div className="max-w-3xl mx-auto bg-white shadow-lg rounded-2xl p-6 sm:p-8">
        <h1 className="text-2xl font-bold text-emerald-600 mb-6 text-center">
          Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ğŸš—
        </h1>
        <p className="text-center text-gray-600 mb-8">Ù…Ù†ØµØ© Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª</p>

        {/* 1. Ø§Ù„ØªØ¹Ø±ÙŠÙ */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-emerald-500 pr-3">
            1. Ø§Ù„ØªØ¹Ø±ÙŠÙ
          </h2>
          <p>
            Ù…Ù†ØµØ© Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª Ù‡ÙŠ Ù…Ù†ØµØ© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ØªØ¹Ù…Ù„ ÙƒÙˆØ³ÙŠØ· ØªÙ‚Ù†ÙŠ Ù„Ø±Ø¨Ø· Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø©
            ÙˆØ§Ù„Ù…Ø·Ø§Ø¹Ù… Ø¨Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† Ø¹Ø¨Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.
          </p>
        </section>

        {/* 2. Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-emerald-500 pr-3">
            2. Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>
              ÙŠÙ‚Ø± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø¨Ø£Ù† Ø¹Ù„Ø§Ù‚ØªÙ‡ Ù…Ø¹ Ù…Ù†ØµØ© Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª Ù‡ÙŠ{" "}
              <strong className="text-emerald-600">
                Ø¹Ù„Ø§Ù‚Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù†ØµØ© ØªÙ‚Ù†ÙŠØ© ÙÙ‚Ø·
              </strong>
              .
            </li>
            <li>
              Ù„Ø§ ØªÙØ¹Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©:
              <ul className="list-disc list-inside mr-6 mt-2 space-y-1">
                <li>Ø¹Ù„Ø§Ù‚Ø© Ø¹Ù…Ù„</li>
                <li>Ø£Ùˆ ØªÙˆØ¸ÙŠÙ</li>
                <li>Ø£Ùˆ ÙƒÙØ§Ù„Ø©</li>
              </ul>
            </li>
            <li>
              ÙŠØ¹Ù…Ù„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø¨ØµÙØªÙ‡{" "}
              <strong className="text-emerald-600">Ù…Ø³ØªÙ‚Ù„Ø§Ù‹</strong> ÙˆÙŠØªØ­Ù…Ù„ ÙƒØ§Ù…Ù„
              Ù…Ø³Ø¤ÙˆÙ„ÙŠØªÙ‡ Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ©.
            </li>
          </ul>
        </section>

        {/* 3. Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-emerald-500 pr-3">
            3. Ø§Ù„ØªØ³Ø¬ÙŠÙ„
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ù…Ù†ØµØ© Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª Ù…Ø¬Ø§Ù†ÙŠ.</li>
            <li>Ù„Ø§ ØªÙ„ØªØ²Ù… Ø§Ù„Ù…Ù†ØµØ© Ø¨ØªÙˆÙÙŠØ± Ø¹Ø¯Ø¯ Ù…Ø¹ÙŠÙ† Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨.</li>
          </ul>
        </section>

        {/* 4. Ø±Ø³ÙˆÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù†ØµØ© */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-emerald-500 pr-3">
            4. Ø±Ø³ÙˆÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù†ØµØ©
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>
              ÙŠÙˆØ§ÙÙ‚ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø¹Ù„Ù‰ Ø¯ÙØ¹ Ø±Ø³ÙˆÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù†ØµØ© Ù…Ù‚Ø§Ø¨Ù„ ÙƒÙ„ Ø·Ù„Ø¨ ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡
              Ø¹Ø¨Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.
            </li>
            <li>
              ÙŠØªÙ… Ø®ØµÙ…:{" "}
              <strong className="text-emerald-600">2 Ø¥Ù„Ù‰ 3 Ø±ÙŠØ§Ù„</strong> Ø¹Ù† ÙƒÙ„
              Ø·Ù„Ø¨
              <br />
              <span className="text-sm text-gray-500 mr-4">
                (ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ù†ØµØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© Ø£Ùˆ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©)
              </span>
            </li>
            <li>ÙŠØªÙ… Ø§Ù„Ø®ØµÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</li>
          </ul>
        </section>

        {/* 5. Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-emerald-500 pr-3">
            5. Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
          </h2>
          <p className="mb-3">ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø¹Ù†:</p>
          <ul className="list-disc list-inside space-y-2 text-gray-700 mr-4">
            <li>Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ ÙˆØªØ³Ù„ÙŠÙ…Ù‡ Ù„Ù„Ø¹Ù…ÙŠÙ„</li>
            <li>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯</li>
            <li>Ø­Ø³Ù† Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø³Ø±Ø© ÙˆØ§Ù„Ø¹Ù…ÙŠÙ„</li>
            <li>Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø·Ù„Ø¨ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙˆØµÙŠÙ„</li>
            <li>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ÙŠØ© ÙˆØ§Ù„Ù†Ø¸Ø§Ù…ÙŠØ© Ø§Ù„Ù…Ø¹Ù…ÙˆÙ„ Ø¨Ù‡Ø§</li>
          </ul>
        </section>

        {/* 6. Ø­Ø¯ÙˆØ¯ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ù…Ù†ØµØ© */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-emerald-500 pr-3">
            6. Ø­Ø¯ÙˆØ¯ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ù…Ù†ØµØ©
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>ØªØ¹Ù…Ù„ Ù…Ù†ØµØ© Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª ÙƒÙˆØ³ÙŠØ· ØªÙ‚Ù†ÙŠ ÙÙ‚Ø·.</li>
            <li>
              Ù„Ø§ ØªØªØ­Ù…Ù„ Ø§Ù„Ù…Ù†ØµØ© Ø£ÙŠ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø¹Ù†:
              <ul className="list-disc list-inside mr-6 mt-2 space-y-1">
                <li>ØªØµØ±ÙØ§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</li>
                <li>Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…Ø±ÙˆØ±ÙŠØ©</li>
                <li>Ø§Ù„ØªØ£Ø®ÙŠØ± ÙÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„</li>
                <li>ÙÙ‚Ø¯Ø§Ù† Ø£Ùˆ ØªÙ„Ù Ø§Ù„Ø·Ù„Ø¨ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙˆØµÙŠÙ„</li>
                <li>Ø£ÙŠ Ù…Ø®Ø§Ù„ÙØ§Øª Ù†Ø¸Ø§Ù…ÙŠØ© Ø£Ùˆ Ù…Ø±ÙˆØ±ÙŠØ©</li>
              </ul>
            </li>
            <li>
              ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ÙˆØ­Ø¯Ù‡ Ø£ÙŠ Ù…Ø·Ø§Ù„Ø¨Ø§Øª Ø£Ùˆ Ø£Ø¶Ø±Ø§Ø± Ù†Ø§ØªØ¬Ø© Ø¹Ù† ØªÙ†ÙÙŠØ° Ø§Ù„Ø·Ù„Ø¨.
            </li>
          </ul>
        </section>

        {/* 7. Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-emerald-500 pr-3">
            7. Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†ÙØ°Ø©.</li>
            <li>ÙŠØ­Ù‚ Ù„Ù„Ù…Ù†ØµØ© Ø®ØµÙ… Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚Ø¨Ù„ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª.</li>
            <li>
              ØªØ­ØªÙØ¸ Ø§Ù„Ù…Ù†ØµØ© Ø¨Ø­Ù‚ ØªØ¹Ø¯ÙŠÙ„ Ø¢Ù„ÙŠØ© Ø§Ù„Ø§Ø­ØªØ³Ø§Ø¨ Ø£Ùˆ Ø§Ù„Ø±Ø³ÙˆÙ… Ù…Ø³ØªÙ‚Ø¨Ù„Ù‹Ø§ Ù…Ø¹ Ø¥Ø´Ø¹Ø§Ø±
              Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø¨Ø°Ù„Ùƒ.
            </li>
          </ul>
        </section>

        {/* 8. Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø³Ø§Ø¨ */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-emerald-500 pr-3">
            8. Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø³Ø§Ø¨
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>
              ÙŠØ­Ù‚ Ù„Ù„Ù…Ù†ØµØ© Ø¥ÙŠÙ‚Ø§Ù Ø£Ùˆ ØªØ¹Ù„ÙŠÙ‚ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ÙÙŠ Ø­Ø§Ù„:
              <ul className="list-disc list-inside mr-6 mt-2 space-y-1">
                <li>ØªÙƒØ±Ø§Ø± Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</li>
                <li>Ø³ÙˆØ¡ Ø§Ù„ØªØ¹Ø§Ù…Ù„</li>
                <li>Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„Ø´Ø±ÙˆØ·</li>
                <li>Ø§Ù„Ø¥Ø¶Ø±Ø§Ø± Ø¨Ø³Ù…Ø¹Ø© Ø§Ù„Ù…Ù†ØµØ©</li>
              </ul>
            </li>
            <li>Ø¯ÙˆÙ† ØªØ­Ù…Ù„ Ø£ÙŠ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ù…Ø§Ù„ÙŠØ© Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©.</li>
          </ul>
        </section>

        {/* 9. Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-emerald-500 pr-3">
            9. Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>
              ÙŠØ­Ù‚ Ù„Ù„Ù…Ù†ØµØ© ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ· Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© Ø¨Ù…Ø§ ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©.
            </li>
            <li>ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø¨Ø£ÙŠ ØªØ­Ø¯ÙŠØ«Ø§Øª.</li>
          </ul>
        </section>

        {/* 10. Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-emerald-500 pr-3">
            10. Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
          </h2>
          <p className="bg-emerald-50 border border-emerald-200 rounded-lg p-4 text-gray-800">
            Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙƒÙ…Ù†Ø¯ÙˆØ¨ ÙÙŠ Ù…Ù†ØµØ© Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØªØŒ ÙØ¥Ù†Ùƒ ØªÙ‚Ø± Ø¨Ù‚Ø±Ø§Ø¡Ø© ÙˆÙÙ‡Ù… ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
            Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… Ø£Ø¹Ù„Ø§Ù‡.
          </p>
        </section>

        {/* Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© */}
        <div className="bg-emerald-50 border border-emerald-300 rounded-lg p-4 mt-8 text-center">
          <p className="text-emerald-800 font-medium">
            â˜‘ï¸ Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… ÙˆØ£ØªØ­Ù…Ù„ ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ÙƒÙ…Ù†Ø¯ÙˆØ¨ Ù…Ø³ØªÙ‚Ù„
          </p>
        </div>

        <p className="mt-6 text-sm text-gray-500 text-center">
          ØªÙ… Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ· Ø¨ØªØ§Ø±ÙŠØ®{" "}
          {new Date().toLocaleDateString("ar-SA")}
        </p>

        <div className="mt-8 flex flex-col sm:flex-row gap-3 justify-center">
          <Link
            to="/register"
            className="text-white bg-emerald-500 hover:bg-emerald-600 px-6 py-3 rounded-lg inline-block transition-colors text-center font-bold"
          >
            âœ… Ù…ÙˆØ§ÙÙ‚ - Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ³Ø¬ÙŠÙ„
          </Link>
          <Link
            to="/"
            className="text-emerald-600 bg-emerald-100 hover:bg-emerald-200 px-6 py-3 rounded-lg inline-block transition-colors text-center"
          >
            Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </Link>
        </div>
      </div>
    </div>
  );
}

==========================================================================================
FILE: src/pages/CustomerLogin.tsx
==========================================================================================
// src/pages/CustomerLogin.tsx
import React, { useState, useEffect, useRef } from 'react'
import { RecaptchaVerifier, signInWithPhoneNumber, ConfirmationResult } from 'firebase/auth'
import { auth, db } from '@/firebase'
import { doc, getDoc, setDoc, updateDoc, serverTimestamp } from 'firebase/firestore'
import { Link, useNavigate } from 'react-router-dom'
import { Phone, KeyRound, LogIn, ArrowRight, RefreshCw } from 'lucide-react'
import { useDialog } from '@/components/ui/ConfirmDialog'

// ØªÙ†Ø³ÙŠÙ‚ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ
const formatPhoneNumber = (phone: string): string => {
  // Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„ Ø´ÙŠØ¡ ØºÙŠØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
  let cleaned = phone.replace(/\D/g, '')
  
  // Ø¥Ø°Ø§ Ø¨Ø¯Ø£ Ø¨Ù€ 0 Ù†Ø²ÙŠÙ„Ù‡
  if (cleaned.startsWith('0')) {
    cleaned = cleaned.substring(1)
  }
  
  // Ø¥Ø°Ø§ Ø¨Ø¯Ø£ Ø¨Ù€ 966 Ù†ØªØ±ÙƒÙ‡ØŒ ÙˆØ¥Ù„Ø§ Ù†Ø¶ÙŠÙÙ‡
  if (!cleaned.startsWith('966')) {
    cleaned = '966' + cleaned
  }
  
  return '+' + cleaned
}

export const CustomerLogin: React.FC = () => {
  const [phone, setPhone] = useState('')
  const [otp, setOtp] = useState('')
  const [step, setStep] = useState<'phone' | 'otp'>('phone')
  const [loading, setLoading] = useState(false)
  const [confirmationResult, setConfirmationResult] = useState<ConfirmationResult | null>(null)
  const [countdown, setCountdown] = useState(0)
  const recaptchaRef = useRef<HTMLDivElement>(null)
  const recaptchaVerifierRef = useRef<RecaptchaVerifier | null>(null)
  const nav = useNavigate()
  const dialog = useDialog()

  // ØªÙ‡ÙŠØ¦Ø© reCAPTCHA
  useEffect(() => {
    if (recaptchaRef.current && !recaptchaVerifierRef.current) {
      recaptchaVerifierRef.current = new RecaptchaVerifier(auth, recaptchaRef.current, {
        size: 'invisible',
        callback: () => {
          // reCAPTCHA solved
        },
        'expired-callback': () => {
          // reCAPTCHA expired
          recaptchaVerifierRef.current = null
        }
      })
    }

    return () => {
      if (recaptchaVerifierRef.current) {
        recaptchaVerifierRef.current.clear()
        recaptchaVerifierRef.current = null
      }
    }
  }, [])

  // Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
  useEffect(() => {
    if (countdown > 0) {
      const timer = setTimeout(() => setCountdown(countdown - 1), 1000)
      return () => clearTimeout(timer)
    }
  }, [countdown])

  // Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚
  const sendOTP = async () => {
    if (!phone || phone.length < 9) {
      dialog.warning('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ ØµØ­ÙŠØ­')
      return
    }

    const formattedPhone = formatPhoneNumber(phone)

    setLoading(true)
    try {
      // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© reCAPTCHA Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
      if (!recaptchaVerifierRef.current && recaptchaRef.current) {
        recaptchaVerifierRef.current = new RecaptchaVerifier(auth, recaptchaRef.current, {
          size: 'invisible',
        })
      }

      const confirmation = await signInWithPhoneNumber(auth, formattedPhone, recaptchaVerifierRef.current!)
      setConfirmationResult(confirmation)
      setStep('otp')
      setCountdown(60) // 60 Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ø¥Ø¹Ø§Ø¯Ø©
      dialog.success('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ Ø¬ÙˆØ§Ù„Ùƒ')
    } catch (err: any) {
      console.error('OTP Error:', err)
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† reCAPTCHA
      if (recaptchaVerifierRef.current) {
        recaptchaVerifierRef.current.clear()
        recaptchaVerifierRef.current = null
      }
      
      if (err.code === 'auth/invalid-phone-number') {
        dialog.error('Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ØºÙŠØ± ØµØ­ÙŠØ­')
      } else if (err.code === 'auth/too-many-requests') {
        dialog.error('Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹')
      } else if (err.code === 'auth/quota-exceeded') {
        dialog.error('ØªÙ… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØŒ Ø­Ø§ÙˆÙ„ ØºØ¯Ø§Ù‹')
      } else {
        dialog.error(err.message || 'ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²')
      }
    } finally {
      setLoading(false)
    }
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø²
  const verifyOTP = async () => {
    if (!otp || otp.length !== 6) {
      dialog.warning('Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…')
      return
    }

    if (!confirmationResult) {
      dialog.error('Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø£Ø¹Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²')
      setStep('phone')
      return
    }

    setLoading(true)
    try {
      const userCred = await confirmationResult.confirm(otp)
      const uid = userCred.user.uid
      const userPhone = userCred.user.phoneNumber

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const userDoc = await getDoc(doc(db, 'users', uid))
      
      let isNewUser = false
      if (!userDoc.exists()) {
        isNewUser = true
        // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ù…ÙŠÙ„
        await setDoc(doc(db, 'users', uid), {
          phone: userPhone,
          role: 'customer',
          name: '',
          createdAt: serverTimestamp(),
        })
        dialog.success('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰')
      } else {
        dialog.success('Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ! ğŸ‘‹')
      }

      // ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ­ÙØ¸Ù‡
      const userData = userDoc.exists() ? userDoc.data() : { role: 'customer' }
      const hasLocation = userData?.savedLocation || userData?.location
      
      // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø¹Ù†Ø¯Ù‡ Ù…ÙˆÙ‚Ø¹ Ù…Ø­ÙÙˆØ¸ØŒ Ù†Ø­Ø§ÙˆÙ„ ØªØ­Ø¯ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
      if (!hasLocation && (userData.role === 'customer' || isNewUser)) {
        try {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
              async (pos) => {
                const autoLocation = {
                  lat: pos.coords.latitude,
                  lng: pos.coords.longitude,
                  address: 'Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ'
                }
                // Ø­ÙØ¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨
                await updateDoc(doc(db, 'users', uid), {
                  savedLocation: autoLocation,
                  location: { lat: autoLocation.lat, lng: autoLocation.lng }
                })
                // Ø­ÙØ¸ ÙÙŠ sessionStorage
                sessionStorage.setItem('broast_session_location', JSON.stringify({ lat: autoLocation.lat, lng: autoLocation.lng }))
              },
              (err) => {
                console.warn('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:', err)
              },
              { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            )
          }
        } catch (locErr) {
          console.warn('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹:', locErr)
        }
      }

      // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
      if (userData.role === 'owner') {
        nav('/owner')
      } else if (userData.role === 'admin') {
        nav('/admin')
      } else if (userData.role === 'developer') {
        nav('/developer')
      } else if (userData.role === 'courier') {
        nav('/courier')
      } else {
        nav('/')
      }
    } catch (err: any) {
      console.error('Verify Error:', err)
      if (err.code === 'auth/invalid-verification-code') {
        dialog.error('Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­')
      } else if (err.code === 'auth/code-expired') {
        dialog.error('Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø±Ù…Ø²ØŒ Ø£Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„')
        setStep('phone')
      } else {
        dialog.error(err.message || 'ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚')
      }
    } finally {
      setLoading(false)
    }
  }

  // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²
  const resendOTP = () => {
    if (countdown > 0) return
    setStep('phone')
    setOtp('')
    setConfirmationResult(null)
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-sky-50 via-white to-sky-100 px-4">
      {/* Ø®Ù„ÙÙŠØ© Ø²Ø®Ø±ÙÙŠØ© */}
      <div className="absolute top-0 left-0 w-72 h-72 bg-sky-300/20 rounded-full blur-3xl"></div>
      <div className="absolute bottom-0 right-0 w-72 h-72 bg-sky-400/20 rounded-full blur-3xl"></div>
      
      {/* reCAPTCHA Container */}
      <div ref={recaptchaRef} id="recaptcha-container"></div>
      
      <div className="relative bg-white/80 backdrop-blur-xl border border-sky-100 rounded-[2rem] shadow-2xl shadow-sky-200/50 w-full max-w-md p-8">
        
        {/* Ø´Ø¹Ø§Ø± */}
        <div className="flex flex-col items-center mb-8">
          <div className="w-20 h-20 bg-gradient-to-br from-sky-500 to-sky-600 rounded-2xl flex items-center justify-center shadow-xl shadow-sky-300/50 mb-4">
            <span className="text-4xl">ğŸ</span>
          </div>
          <h1 className="text-3xl font-black text-sky-600">Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª</h1>
          <p className="text-sky-500 mt-1">
            {step === 'phone' ? 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„' : 'Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚'}
          </p>
        </div>

        {/* Ø®Ø·ÙˆØ© Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ */}
        {step === 'phone' && (
          <div className="space-y-4">
            <div className="relative">
              <Phone className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-sky-400" />
              <input
                type="tel"
                placeholder="05xxxxxxxx"
                dir="ltr"
                className="w-full rounded-2xl p-4 pr-12 bg-sky-50 text-sky-900 border-2 border-sky-100 
                           focus:outline-none focus:border-sky-400 focus:ring-4 focus:ring-sky-100 transition-all text-center text-lg tracking-wider"
                value={phone}
                onChange={(e) => setPhone(e.target.value.replace(/\D/g, ''))}
                maxLength={10}
              />
            </div>

            <p className="text-sm text-gray-500 text-center">
              Ø³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ù…Ø² ØªØ­Ù‚Ù‚ Ø¹Ø¨Ø± SMS
            </p>

            <button
              onClick={sendOTP}
              disabled={loading || phone.length < 9}
              className="w-full flex items-center justify-center gap-3 bg-gradient-to-r from-sky-500 to-sky-600 hover:from-sky-600 hover:to-sky-700 text-white font-bold p-4 rounded-2xl 
                         shadow-xl shadow-sky-300/50 transition-all hover:scale-[1.02] hover:shadow-sky-400/50 disabled:opacity-50 disabled:hover:scale-100"
            >
              {loading ? (
                <>
                  <RefreshCw className="w-5 h-5 animate-spin" />
                  Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...
                </>
              ) : (
                <>
                  <ArrowRight className="w-5 h-5" />
                  Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚
                </>
              )}
            </button>
          </div>
        )}

        {/* Ø®Ø·ÙˆØ© Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ */}
        {step === 'otp' && (
          <div className="space-y-4">
            <div className="text-center mb-4">
              <p className="text-gray-600">Ø£Ø±Ø³Ù„Ù†Ø§ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰</p>
              <p className="font-bold text-sky-600 text-lg" dir="ltr">{formatPhoneNumber(phone)}</p>
            </div>

            <div className="relative">
              <KeyRound className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-sky-400" />
              <input
                type="text"
                inputMode="numeric"
                placeholder="000000"
                dir="ltr"
                className="w-full rounded-2xl p-4 pr-12 bg-sky-50 text-sky-900 border-2 border-sky-100 
                           focus:outline-none focus:border-sky-400 focus:ring-4 focus:ring-sky-100 transition-all text-center text-2xl tracking-[0.5em] font-bold"
                value={otp}
                onChange={(e) => setOtp(e.target.value.replace(/\D/g, ''))}
                maxLength={6}
                autoFocus
              />
            </div>

            <button
              onClick={verifyOTP}
              disabled={loading || otp.length !== 6}
              className="w-full flex items-center justify-center gap-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold p-4 rounded-2xl 
                         shadow-xl shadow-green-300/50 transition-all hover:scale-[1.02] hover:shadow-green-400/50 disabled:opacity-50 disabled:hover:scale-100"
            >
              {loading ? (
                <>
                  <RefreshCw className="w-5 h-5 animate-spin" />
                  Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...
                </>
              ) : (
                <>
                  <LogIn className="w-5 h-5" />
                  ØªØ£ÙƒÙŠØ¯ ÙˆØ¯Ø®ÙˆÙ„
                </>
              )}
            </button>

            {/* Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø² */}
            <div className="text-center">
              {countdown > 0 ? (
                <p className="text-gray-500 text-sm">
                  Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¯ <span className="font-bold text-sky-600">{countdown}</span> Ø«Ø§Ù†ÙŠØ©
                </p>
              ) : (
                <button
                  onClick={resendOTP}
                  className="text-sky-600 hover:text-sky-700 font-semibold text-sm"
                >
                  Ù„Ù… ÙŠØµÙ„Ùƒ Ø§Ù„Ø±Ù…Ø²ØŸ Ø£Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                </button>
              )}
            </div>

            {/* ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù‚Ù… */}
            <button
              onClick={() => { setStep('phone'); setOtp(''); }}
              className="w-full text-gray-500 hover:text-gray-700 text-sm"
            >
              â† ØªØºÙŠÙŠØ± Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
            </button>
          </div>
        )}

        {/* Ø±Ø§Ø¨Ø· Ù„Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ø£Ø®Ø±Ù‰ */}
        <div className="mt-8 pt-6 border-t border-sky-100">
          <p className="text-center text-sm text-gray-500 mb-3">
            ØµØ§Ø­Ø¨ Ù…Ø·Ø¹Ù… Ø£Ùˆ Ù…Ù†Ø¯ÙˆØ¨ØŸ
          </p>
          <Link 
            to="/login"
            className="block text-center text-sky-600 hover:text-sky-700 font-semibold"
          >
            ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ â†’
          </Link>
        </div>
      </div>
    </div>
  )
}

==========================================================================================
FILE: src/pages/DebugOrders.tsx
==========================================================================================
// src/pages/DebugOrders.tsx
import React, { useEffect, useState } from "react"
import { collection, getDocs, limit, orderBy, query } from "firebase/firestore"
import { db, app } from "@/firebase"
import { useAuth } from "@/auth"
import { Navigate } from "react-router-dom"

export const DebugOrders: React.FC = () => {
  const { role, loading: authLoading } = useAuth()
  const [rows, setRows] = useState<any[]>([])
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)

  useEffect(() => {
    // Ù„Ø§ Ù†Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø·ÙˆØ±
    if (authLoading || role !== 'developer') return
    
    (async () => {
      try {
        setError(null)
        // Ù†Ø¬ÙŠØ¨ Ø£ÙŠ 10 Ø·Ù„Ø¨Ø§Øª Ø¨Ø¯ÙˆÙ† ÙÙ„ØªØ±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆÙŠØ© â€” Ù…Ø§ ÙŠØ­ØªØ§Ø¬ ÙÙ‡Ø§Ø±Ø³
        const qy = query(
          collection(db, "orders"),
          orderBy("createdAt", "desc"),
          limit(10)
        )
        const snap = await getDocs(qy)
        const list = snap.docs.map(d => {
          const x: any = d.data()
          return {
            id: d.id,
            restaurantId: x.restaurantId ?? null,
            firstItemOwnerId: x?.items?.[0]?.ownerId ?? null,
            customerId: x.customerId ?? null,
            createdAtISO: x.createdAt?.toDate?.()?.toISOString?.() ?? null,
          }
        })
        setRows(list)
      } catch (e: any) {
        // Ù„Ùˆ Ù…Ø§ ÙÙŠÙ‡ ÙÙ‡Ø±Ø³ØŒ Ø¬Ø±Ù‘Ø¨ Ø¨Ø¯ÙˆÙ† orderBy
        if (String(e?.message || "").includes("index")) {
          try {
            const snap = await getDocs(collection(db, "orders"))
            const list = snap.docs.map(d => {
              const x: any = d.data()
              return {
                id: d.id,
                restaurantId: x.restaurantId ?? null,
                firstItemOwnerId: x?.items?.[0]?.ownerId ?? null,
                customerId: x.customerId ?? null,
                createdAtISO: x.createdAt?.toDate?.()?.toISOString?.() ?? null,
              }
            })
            setRows(list)
            setError("âš ï¸ Ù…Ø§ ÙÙŠÙ‡ ÙÙ‡Ø±Ø³ Ù„Ù€ createdAt â€” Ø¹Ø±Ø¶Ù†Ø§ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¯ÙˆÙ† ØªØ±ØªÙŠØ¨.")
          } catch (e2: any) {
            setError("âŒ ÙØ´Ù„ Ø§Ù„Ø¬Ù„Ø¨ Ø­ØªÙ‰ Ø¨Ø¯ÙˆÙ† ØªØ±ØªÙŠØ¨: " + (e2?.message || e2))
          }
        } else {
          setError("âŒ Ø®Ø·Ø£ Ø§Ù„Ø¬Ù„Ø¨: " + (e?.message || e))
        }
      } finally {
        setLoading(false)
      }
    })()
  }, [authLoading, role])

  // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©: ÙÙ‚Ø· Ù„Ù„Ù…Ø·ÙˆØ±
  if (authLoading) {
    return <div className="p-8 text-center">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  }
  
  if (role !== 'developer') {
    return <Navigate to="/" replace />
  }

  const projectId = (app.options as any)?.projectId

  return (
    <div className="p-4 space-y-3">
      <h1 className="text-xl font-bold">ğŸ”§ DEBUG: Orders Snapshot (Ù„Ù„Ù…Ø·ÙˆØ± ÙÙ‚Ø·)</h1>
      <div className="text-sm">
        ProjectId: <b>{String(projectId)}</b>
      </div>
      {error && <div className="text-red-600 text-sm">{error}</div>}
      {loading && <div>â³ Loadingâ€¦</div>}

      {!loading && rows.length === 0 && (
        <div className="text-gray-600">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙŠ Ù…Ø³ØªÙ†Ø¯Ø§Øª ÙÙŠ collection: <code>orders</code> ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.</div>
      )}

      {rows.map(r => (
        <div key={r.id} className="bg-white rounded-xl shadow p-3 text-sm">
          <div className="font-mono text-xs text-gray-500">#{r.id}</div>
          <div>restaurantId: <b>{String(r.restaurantId)}</b></div>
          <div>items[0].ownerId: <b>{String(r.firstItemOwnerId)}</b></div>
          <div>customerId: <b>{String(r.customerId)}</b></div>
          <div>createdAt: <b>{r.createdAtISO || "â€”"}</b></div>
        </div>
      ))}
    </div>
  )
}

==========================================================================================
FILE: src/pages/Developer.tsx
==========================================================================================
import React, { useEffect, useState } from 'react'
import { useAuth } from '@/auth'
import { RoleGate } from '@/routes/RoleGate'
import { 
  Trash2, Users, Settings, RefreshCw, Database, Shield, Server, 
  Edit3, Save, X, ChevronDown, ChevronUp, Building2, Wallet, Package, Truck, UserPlus, Plus,
  FileCheck, AlertCircle, CheckCircle, Clock, ExternalLink
} from 'lucide-react'
import { useToast } from '@/components/ui/Toast'
import { useDialog } from '@/components/ui/ConfirmDialog'
import { db, app, auth } from '@/firebase'
import { createUserWithEmailAndPassword, signInWithEmailAndPassword } from 'firebase/auth'
import { 
  collection, getDocs, doc, getDoc, setDoc, updateDoc, deleteDoc, 
  serverTimestamp, addDoc, query, where, orderBy, limit 
} from 'firebase/firestore'
import { ref, uploadBytes, getDownloadURL, getStorage } from 'firebase/storage'

// Firebase config Ù„Ù„Ø¹Ø±Ø¶
const firebaseConfig = {
  projectId: app.options.projectId,
  authDomain: app.options.authDomain,
  storageBucket: app.options.storageBucket,
  messagingSenderId: app.options.messagingSenderId,
  appId: app.options.appId,
}

type Stats = {
  users: number
  restaurants: number
  menuItems: number
  orders: number
  pendingOrders: number
  deliveredOrders: number
  admins: number
  couriers: number
  customers: number
  owners: number
  totalAppEarnings: number
}

type AppSettings = {
  deliveryFee?: number
  minOrderAmount?: number
  maxDeliveryDistance?: number
  workingHours?: { open: string; close: string }
  maintenanceMode?: boolean
  appVersion?: string
  platformFee?: number
  adminCommissionRate?: number
}

type User = {
  uid: string
  email: string
  name?: string
  role: string
  phone?: string
  createdAt?: any
}

type Restaurant = {
  id: string
  name: string
  ownerId: string
  email?: string
  phone?: string
  city?: string
  location?: string
  logoUrl?: string
  referredBy?: string
  referrerType?: string
  isVerified?: boolean
  verifiedAt?: any
  createdAt?: any
}

type Order = {
  id: string
  customerId: string
  restaurantId?: string
  restaurantName?: string
  items: any[]
  subtotal: number
  deliveryFee: number
  total: number
  status: string
  address: string
  courierId?: string
  platformFee?: number
  adminCommission?: number
  referredBy?: string
  createdAt?: any
}

type Admin = {
  uid: string
  email: string
  name?: string
  walletBalance: number
  totalEarnings: number
  restaurantsCount: number
  restaurants: Restaurant[]
}

// Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©
type Task = {
  id: string
  title: string
  description: string
  assignedTo: string // UID Ø§Ù„Ù…Ø´Ø±Ù
  assignedToName?: string
  status: 'pending' | 'in_progress' | 'completed' | 'cancelled'
  priority: 'low' | 'medium' | 'high'
  dueDate?: any
  createdBy: string
  createdAt?: any
  updatedAt?: any
  completedAt?: any
  notes?: string
}

// ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù„ÙˆØ­Ø©
type Tab = 'overview' | 'restaurants' | 'orders' | 'users' | 'couriers' | 'admins' | 'settings' | 'finance' | 'tools' | 'tasks' | 'licenses' | 'packages' | 'storeAnalytics'

// Ù†ÙˆØ¹ Ø·Ù„Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø©
type PackageRequest = {
  id: string
  restaurantId: string
  restaurantName: string
  ownerName?: string
  ownerPhone?: string
  status: 'pending' | 'bank_sent' | 'payment_sent' | 'approved' | 'rejected' | 'expired'
  bankAccountImageUrl?: string
  paymentProofImageUrl?: string
  subscriptionAmount: number
  subscriptionDuration: number
  developerNotes?: string
  ownerNotes?: string
  requestedAt?: any
  bankSentAt?: any
  paymentSentAt?: any
  approvedAt?: any
  rejectedAt?: any
  expiresAt?: any
  createdAt?: any
  updatedAt?: any
}


export const Developer: React.FC = () => {
  const { user } = useAuth()
  const toast = useToast()
  const dialog = useDialog()
  const storage = getStorage(app)
  
  const [activeTab, setActiveTab] = useState<Tab>('overview')
  const [loading, setLoading] = useState(true)
  const [refreshing, setRefreshing] = useState(false)
  
  // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  const [stats, setStats] = useState<Stats>({
    users: 0, restaurants: 0, menuItems: 0, orders: 0, 
    pendingOrders: 0, deliveredOrders: 0, admins: 0, couriers: 0, 
    customers: 0, owners: 0, totalAppEarnings: 0
  })
  const [settings, setSettings] = useState<AppSettings>({})
  const [users, setUsers] = useState<User[]>([])
  const [restaurants, setRestaurants] = useState<Restaurant[]>([])
  const [orders, setOrders] = useState<Order[]>([])
  const [admins, setAdmins] = useState<Admin[]>([])
  
  // Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªØ­Ø±ÙŠØ±
  const [editingSettings, setEditingSettings] = useState(false)
  const [settingsForm, setSettingsForm] = useState<AppSettings>({})
  const [editingRestaurant, setEditingRestaurant] = useState<string | null>(null)
  const [restaurantForm, setRestaurantForm] = useState<Partial<Restaurant>>({})
  const [uploadingLogo, setUploadingLogo] = useState(false)
  const [editingUser, setEditingUser] = useState<string | null>(null)
  const [userForm, setUserForm] = useState<Partial<User>>({})
  
  // ÙÙ„Ø§ØªØ±
  const [orderFilter, setOrderFilter] = useState<string>('all')
  const [userFilter, setUserFilter] = useState<string>('all')
  const [expandedAdmin, setExpandedAdmin] = useState<string | null>(null)
  
  // Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯
  const [showAddAdmin, setShowAddAdmin] = useState(false)
  const [newAdminEmail, setNewAdminEmail] = useState('')
  const [newAdminName, setNewAdminName] = useState('')
  const [newAdminPassword, setNewAdminPassword] = useState('')
  const [newAdminPhone, setNewAdminPhone] = useState('')
  const [creatingAdmin, setCreatingAdmin] = useState(false)

  // Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨ Ø¬Ø¯ÙŠØ¯
  const [showAddCourier, setShowAddCourier] = useState(false)
  const [newCourierEmail, setNewCourierEmail] = useState('')
  const [newCourierName, setNewCourierName] = useState('')
  const [newCourierPassword, setNewCourierPassword] = useState('')
  const [newCourierPhone, setNewCourierPhone] = useState('')
  const [creatingCourier, setCreatingCourier] = useState(false)

  // Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯
  const [showAddRestaurant, setShowAddRestaurant] = useState(false)
  const [newRestaurantName, setNewRestaurantName] = useState('')
  const [newRestaurantCity, setNewRestaurantCity] = useState('')
  const [newRestaurantPhone, setNewRestaurantPhone] = useState('')
  const [newRestaurantEmail, setNewRestaurantEmail] = useState('')
  const [newRestaurantOwnerEmail, setNewRestaurantOwnerEmail] = useState('')
  const [newRestaurantOwnerPassword, setNewRestaurantOwnerPassword] = useState('')
  const [creatingRestaurant, setCreatingRestaurant] = useState(false)

  // Ø§Ù„Ù…Ù‡Ø§Ù…
  const [tasks, setTasks] = useState<Task[]>([])
  const [showAddTask, setShowAddTask] = useState(false)
  const [newTaskTitle, setNewTaskTitle] = useState('')
  const [newTaskDescription, setNewTaskDescription] = useState('')
  const [newTaskAssignedTo, setNewTaskAssignedTo] = useState('')
  const [newTaskPriority, setNewTaskPriority] = useState<'low' | 'medium' | 'high'>('medium')
  const [newTaskDueDate, setNewTaskDueDate] = useState('')
  const [creatingTask, setCreatingTask] = useState(false)
  const [taskFilter, setTaskFilter] = useState<string>('all')

  // Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
  const [packageRequests, setPackageRequests] = useState<PackageRequest[]>([])
  const [packageFilter, setPackageFilter] = useState<string>('all')
  const [uploadingBankImage, setUploadingBankImage] = useState<string | null>(null)
  const [bankImageFile, setBankImageFile] = useState<File | null>(null)
  const [subscriptionAmount, setSubscriptionAmount] = useState<number>(99)
  const [subscriptionDuration, setSubscriptionDuration] = useState<number>(30)
  
  // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  const currentDeveloperEmail = user?.email || ''

  // ===== Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯ =====
  const handleCreateNewAdmin = async () => {
    if (!newAdminEmail.trim() || !newAdminPassword.trim()) {
      toast.warning('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±')
      return
    }
    if (newAdminPassword.length < 6) {
      toast.warning('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„')
      return
    }

    const confirmed = await dialog.confirm(
      `Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯:\n\nğŸ“§ ${newAdminEmail}\nğŸ‘¤ ${newAdminName || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}\n\nÙ…Ù„Ø§Ø­Ø¸Ø©: Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ Ù…Ø¤Ù‚ØªØ§Ù‹ØŒ Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.`,
      { title: 'Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯' }
    )
    if (!confirmed) return

    setCreatingAdmin(true)
    try {
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Firebase Auth
      const userCred = await createUserWithEmailAndPassword(auth, newAdminEmail.trim(), newAdminPassword)
      const newUid = userCred.user.uid

      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firestore
      await setDoc(doc(db, 'users', newUid), {
        email: newAdminEmail.trim(),
        name: newAdminName.trim() || 'Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯',
        phone: newAdminPhone.trim() || '',
        role: 'admin',
        createdAt: serverTimestamp(),
      })

      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ÙØ¸Ø© Ù„Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯
      await setDoc(doc(db, 'wallets', newUid), {
        balance: 0,
        totalEarnings: 0,
        totalWithdrawn: 0,
        transactions: [],
        updatedAt: serverTimestamp(),
      })

      toast.success('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø´Ø±Ù Ø¨Ù†Ø¬Ø§Ø­ âœ…')
      toast.info('âš ï¸ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ÙƒØŒ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰')
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      setNewAdminEmail('')
      setNewAdminName('')
      setNewAdminPassword('')
      setNewAdminPhone('')
      setShowAddAdmin(false)
      
    } catch (err: any) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±Ù:', err)
      if (err.code === 'auth/email-already-in-use') {
        toast.error('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹')
      } else if (err.code === 'auth/invalid-email') {
        toast.error('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­')
      } else if (err.code === 'auth/weak-password') {
        toast.error('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹')
      } else {
        toast.error('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±Ù: ' + (err.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'))
      }
    } finally {
      setCreatingAdmin(false)
    }
  }

  // ===== Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø¯ÙˆØ¨ Ø¬Ø¯ÙŠØ¯ =====
  const handleCreateNewCourier = async () => {
    if (!newCourierEmail.trim() || !newCourierPassword.trim()) {
      toast.warning('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±')
      return
    }
    if (newCourierPassword.length < 6) {
      toast.warning('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„')
      return
    }

    const confirmed = await dialog.confirm(
      `Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ù†Ø¯ÙˆØ¨ Ø¬Ø¯ÙŠØ¯:\n\nğŸ“§ ${newCourierEmail}\nğŸ‘¤ ${newCourierName || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}\nğŸ“± ${newCourierPhone || 'Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…'}`,
      { title: 'Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø¯ÙˆØ¨ Ø¬Ø¯ÙŠØ¯' }
    )
    if (!confirmed) return

    setCreatingCourier(true)
    try {
      const userCred = await createUserWithEmailAndPassword(auth, newCourierEmail.trim(), newCourierPassword)
      const newUid = userCred.user.uid

      await setDoc(doc(db, 'users', newUid), {
        email: newCourierEmail.trim(),
        name: newCourierName.trim() || 'Ù…Ù†Ø¯ÙˆØ¨ Ø¬Ø¯ÙŠØ¯',
        phone: newCourierPhone.trim() || '',
        role: 'courier',
        createdAt: serverTimestamp(),
      })

      toast.success('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…')
      toast.info('âš ï¸ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ÙƒØŒ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰')
      
      setNewCourierEmail('')
      setNewCourierName('')
      setNewCourierPassword('')
      setNewCourierPhone('')
      setShowAddCourier(false)
      
    } catch (err: any) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨:', err)
      if (err.code === 'auth/email-already-in-use') {
        toast.error('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹')
      } else {
        toast.error('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ' + (err.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'))
      }
    } finally {
      setCreatingCourier(false)
    }
  }

  // ===== Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯ =====
  const handleCreateNewRestaurant = async () => {
    if (!newRestaurantName.trim()) {
      toast.warning('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…')
      return
    }
    if (!newRestaurantOwnerEmail.trim() || !newRestaurantOwnerPassword.trim()) {
      toast.warning('Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù…')
      return
    }

    const confirmed = await dialog.confirm(
      `Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯:\n\nğŸª ${newRestaurantName}\nğŸ“ ${newRestaurantCity || 'Ø¨Ø¯ÙˆÙ† Ù…Ø¯ÙŠÙ†Ø©'}\nğŸ‘¤ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù…: ${newRestaurantOwnerEmail}`,
      { title: 'Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯' }
    )
    if (!confirmed) return

    setCreatingRestaurant(true)
    try {
      // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù…
      const userCred = await createUserWithEmailAndPassword(auth, newRestaurantOwnerEmail.trim(), newRestaurantOwnerPassword)
      const newOwnerId = userCred.user.uid

      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù…
      await setDoc(doc(db, 'users', newOwnerId), {
        email: newRestaurantOwnerEmail.trim(),
        name: newRestaurantName.trim() + ' - Ù…Ø§Ù„Ùƒ',
        role: 'owner',
        createdAt: serverTimestamp(),
      })

      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø·Ø¹Ù…
      await setDoc(doc(db, 'restaurants', newOwnerId), {
        name: newRestaurantName.trim(),
        ownerId: newOwnerId,
        email: newRestaurantEmail.trim() || newRestaurantOwnerEmail.trim(),
        phone: newRestaurantPhone.trim() || '',
        city: newRestaurantCity.trim() || '',
        referredBy: user?.uid, // Ø§Ù„Ù…Ø·ÙˆØ± Ù‡Ùˆ Ù…Ù† Ø£Ø¶Ø§Ù Ø§Ù„Ù…Ø·Ø¹Ù…
        referrerType: 'developer',
        createdAt: serverTimestamp(),
      })

      toast.success('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø·Ø¹Ù… ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø§Ù„Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…')
      toast.info('âš ï¸ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ÙƒØŒ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰')
      
      setNewRestaurantName('')
      setNewRestaurantCity('')
      setNewRestaurantPhone('')
      setNewRestaurantEmail('')
      setNewRestaurantOwnerEmail('')
      setNewRestaurantOwnerPassword('')
      setShowAddRestaurant(false)
      
    } catch (err: any) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø·Ø¹Ù…:', err)
      if (err.code === 'auth/email-already-in-use') {
        toast.error('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹')
      } else {
        toast.error('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø·Ø¹Ù…: ' + (err.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'))
      }
    } finally {
      setCreatingRestaurant(false)
    }
  }

  // ===== Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© =====
  const getFinanceStats = () => {
    const now = new Date()
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())
    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000)
    const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000)

    const todayOrders = orders.filter(o => {
      const orderDate = o.createdAt?.toDate?.() || new Date(0)
      return orderDate >= today && o.status !== 'cancelled'
    })

    const weekOrders = orders.filter(o => {
      const orderDate = o.createdAt?.toDate?.() || new Date(0)
      return orderDate >= weekAgo && o.status !== 'cancelled'
    })

    const monthOrders = orders.filter(o => {
      const orderDate = o.createdAt?.toDate?.() || new Date(0)
      return orderDate >= monthAgo && o.status !== 'cancelled'
    })

    const deliveredOrders = orders.filter(o => o.status === 'delivered')

    return {
      todayRevenue: todayOrders.reduce((sum, o) => sum + (o.total || 0), 0),
      todayOrders: todayOrders.length,
      todayPlatformFee: todayOrders.reduce((sum, o) => sum + (o.platformFee || 0), 0),
      weekRevenue: weekOrders.reduce((sum, o) => sum + (o.total || 0), 0),
      weekOrders: weekOrders.length,
      weekPlatformFee: weekOrders.reduce((sum, o) => sum + (o.platformFee || 0), 0),
      monthRevenue: monthOrders.reduce((sum, o) => sum + (o.total || 0), 0),
      monthOrders: monthOrders.length,
      monthPlatformFee: monthOrders.reduce((sum, o) => sum + (o.platformFee || 0), 0),
      totalRevenue: deliveredOrders.reduce((sum, o) => sum + (o.total || 0), 0),
      totalPlatformFee: deliveredOrders.reduce((sum, o) => sum + (o.platformFee || 0), 0),
      totalAdminCommission: deliveredOrders.reduce((sum, o) => sum + (o.adminCommission || 0), 0),
    }
  }

  // ===== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =====
  const loadData = async () => {
    try {
      // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„ØªÙˆØ§Ø²ÙŠ
      const [usersSnap, restaurantsSnap, menuSnap, ordersSnap, walletsSnap] = await Promise.all([
        getDocs(collection(db, 'users')),
        getDocs(collection(db, 'restaurants')),
        getDocs(collection(db, 'menuItems')),
        getDocs(collection(db, 'orders')),
        getDocs(collection(db, 'wallets')),
      ])

      // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„ (Ù‚Ø¯ Ù„Ø§ ØªÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©)
      let tasksSnap: any = { docs: [] }
      try {
        tasksSnap = await getDocs(collection(db, 'tasks'))
      } catch (err) {
        // Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø¨Ø¹Ø¯
      }

      // Ø¬Ù„Ø¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
      let packageRequestsSnap: any = { docs: [] }
      try {
        packageRequestsSnap = await getDocs(collection(db, 'packageRequests'))
      } catch (err) {
        // Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ù‚Ø§Øª Ø¨Ø¹Ø¯
      }

      // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
      const usersData = usersSnap.docs.map(d => ({ uid: d.id, ...d.data() } as User))
      setUsers(usersData)
      
      // Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
      const restaurantsData = restaurantsSnap.docs.map(d => ({ id: d.id, ...d.data() } as Restaurant))
      setRestaurants(restaurantsData)
      
      // Ø§Ù„Ø·Ù„Ø¨Ø§Øª
      const ordersData = ordersSnap.docs.map(d => ({ id: d.id, ...d.data() } as Order))
      setOrders(ordersData)

      // Ø§Ù„Ù…Ù‡Ø§Ù…
      const tasksData: Task[] = tasksSnap.docs.map((d: any) => ({ id: d.id, ...d.data() } as Task))
      setTasks(tasksData.sort((a: Task, b: Task) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0)))

      // Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
      const packageRequestsData: PackageRequest[] = packageRequestsSnap.docs.map((d: any) => ({ id: d.id, ...d.data() } as PackageRequest))
      setPackageRequests(packageRequestsData.sort((a: PackageRequest, b: PackageRequest) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0)))
      
      // Ø§Ù„Ù…Ø­Ø§ÙØ¸
      const walletsData: Record<string, any> = {}
      walletsSnap.docs.forEach(d => {
        walletsData[d.id] = d.data()
      })
      
      // Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      const appWallet = walletsData['app_earnings'] || { balance: 0, totalEarnings: 0 }
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      const adminsData = usersData.filter(u => u.role === 'admin')
      const couriersData = usersData.filter(u => u.role === 'courier')
      const customersData = usersData.filter(u => u.role === 'customer')
      const ownersData = usersData.filter(u => u.role === 'owner')
      
      // Ø¨Ù†Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† Ù…Ø¹ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù‡Ù…
      const adminsWithRestaurants: Admin[] = adminsData.map(admin => {
        const adminRestaurants = restaurantsData.filter(r => r.referredBy === admin.uid)
        const wallet = walletsData[admin.uid] || { balance: 0, totalEarnings: 0 }
        return {
          uid: admin.uid,
          email: admin.email,
          name: admin.name,
          walletBalance: wallet.balance || 0,
          totalEarnings: wallet.totalEarnings || 0,
          restaurantsCount: adminRestaurants.length,
          restaurants: adminRestaurants,
        }
      })
      setAdmins(adminsWithRestaurants)
      
      setStats({
        users: usersData.length,
        restaurants: restaurantsData.length,
        menuItems: menuSnap.size,
        orders: ordersData.length,
        pendingOrders: ordersData.filter(o => o.status === 'pending').length,
        deliveredOrders: ordersData.filter(o => o.status === 'delivered').length,
        admins: adminsData.length,
        couriers: couriersData.length,
        customers: customersData.length,
        owners: ownersData.length,
        totalAppEarnings: appWallet.totalEarnings || 0,
      })

      // Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      const settingsSnap = await getDoc(doc(db, 'settings', 'general'))
      if (settingsSnap.exists()) {
        const data = settingsSnap.data() as AppSettings
        setSettings(data)
        setSettingsForm(data)
      } else {
        const defaultSettings: AppSettings = {
          deliveryFee: 7,
          minOrderAmount: 20,
          maxDeliveryDistance: 15,
          workingHours: { open: '09:00', close: '23:00' },
          maintenanceMode: false,
          appVersion: '1.0.0',
          platformFee: 1.0, // 1 Ø±ÙŠØ§Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„ÙƒÙ„ Ù…Ù†ØªØ¬
          adminCommissionRate: 0.75, // 75 Ù‡Ù„Ù„Ø© Ù„Ù„Ù…Ø´Ø±Ù Ù„ÙƒÙ„ Ù…Ù†ØªØ¬
        }
        setSettings(defaultSettings)
        setSettingsForm(defaultSettings)
      }
    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', err)
      toast.error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª')
    } finally {
      setLoading(false)
      setRefreshing(false)
    }
  }

  useEffect(() => {
    loadData()
  }, [])

  const handleRefresh = () => {
    setRefreshing(true)
    loadData()
    toast.info('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...')
  }

  // ===== Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª =====
  const handleSaveSettings = async () => {
    try {
      await setDoc(doc(db, 'settings', 'general'), settingsForm, { merge: true })
      setSettings(settingsForm)
      setEditingSettings(false)
      toast.success('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…')
    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', err)
      toast.error('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª')
    }
  }

  // ===== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø·Ø¹Ù… =====
  const handleUpdateRestaurant = async (id: string) => {
    try {
      await updateDoc(doc(db, 'restaurants', id), {
        ...restaurantForm,
        updatedAt: serverTimestamp(),
      })
      setEditingRestaurant(null)
      toast.success('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø·Ø¹Ù… Ø¨Ù†Ø¬Ø§Ø­ âœ…')
      loadData()
    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø·Ø¹Ù…:', err)
      toast.error('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø·Ø¹Ù…')
    }
  }

  // ===== Ø±ÙØ¹ Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø·Ø¹Ù… =====
  const handleUploadLogo = async (id: string, file: File) => {
    try {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
      if (!file.type.startsWith('image/')) {
        toast.warning('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© ÙÙ‚Ø·')
        return
      }
      if (file.size > 5 * 1024 * 1024) {
        toast.warning('Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ±ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ù‚Ù„ Ù…Ù† 5MB')
        return
      }
      setUploadingLogo(true)
      const cleanName = file.name.replace(/\s+/g, '_')
      const path = `restaurants/${id}/logo_${Date.now()}_${cleanName}`
      const storageRef = ref(storage, path)
      const metadata = {
        contentType: file.type || 'image/jpeg',
        cacheControl: 'public,max-age=31536000,immutable',
      }
      await uploadBytes(storageRef, file, metadata)
      const url = await getDownloadURL(storageRef)
      
      await updateDoc(doc(db, 'restaurants', id), {
        logoUrl: url,
        updatedAt: serverTimestamp(),
      })
      
      toast.success('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ âœ…')
      loadData()
    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±:', err)
      toast.error('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±')
    } finally {
      setUploadingLogo(false)
    }
  }

  // ===== Ø­Ø°Ù Ù…Ø·Ø¹Ù… =====
  const handleDeleteRestaurant = async (id: string) => {
    const confirmed = await dialog.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø·Ø¹Ù…ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹!', { 
      title: 'Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù…',
      dangerous: true 
    })
    if (!confirmed) return
    try {
      await deleteDoc(doc(db, 'restaurants', id))
      toast.success('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù… Ø¨Ù†Ø¬Ø§Ø­')
      loadData()
    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù…:', err)
      toast.error('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø·Ø¹Ù…')
    }
  }

  // ===== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… =====
  const handleUpdateUser = async (uid: string) => {
    try {
      await updateDoc(doc(db, 'users', uid), {
        ...userForm,
        updatedAt: serverTimestamp(),
      })
      setEditingUser(null)
      toast.success('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­ âœ…')
      loadData()
    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', err)
      toast.error('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…')
    }
  }

  // ===== Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù… =====
  const handleDeleteUser = async (uid: string) => {
    const confirmed = await dialog.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹!', {
      title: 'Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
      dangerous: true
    })
    if (!confirmed) return
    try {
      await deleteDoc(doc(db, 'users', uid))
      toast.success('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª')
      toast.warning('Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¬Ø¨ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Firebase Auth')
      loadData()
    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', err)
      toast.error('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…')
    }
  }

  // ===== ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ =====
  const handleUpdateOrderStatus = async (orderId: string, newStatus: string) => {
    try {
      await updateDoc(doc(db, 'orders', orderId), {
        status: newStatus,
        updatedAt: serverTimestamp(),
      })
      toast.success('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ âœ…')
      loadData()
    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨:', err)
      toast.error('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨')
    }
  }

  // ===== Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± =====
  const roleLabel = (role: string) => {
    switch (role) {
      case 'customer': return 'ğŸ‘¤ Ø¹Ù…ÙŠÙ„'
      case 'owner': return 'ğŸª ØµØ§Ø­Ø¨ Ù…Ø·Ø¹Ù…'
      case 'courier': return 'ğŸš— Ù…Ù†Ø¯ÙˆØ¨'
      case 'admin': return 'ğŸ‘‘ Ù…Ø´Ø±Ù'
      case 'developer': return 'ğŸ‘¨â€ğŸ’» Ù…Ø·ÙˆØ±'
      default: return role
    }
  }

  // ===== Ø£Ø³Ù…Ø§Ø¡ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ù„Ø¨ =====
  const statusLabel = (status: string) => {
    switch (status) {
      case 'pending': return 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'
      case 'accepted': return 'âœ… Ù…Ù‚Ø¨ÙˆÙ„'
      case 'preparing': return 'ğŸ‘¨â€ğŸ³ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±'
      case 'ready': return 'ğŸ“¦ Ø¬Ø§Ù‡Ø²'
      case 'out_for_delivery': return 'ğŸš— ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚'
      case 'delivered': return 'âœ”ï¸ ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…'
      case 'cancelled': return 'âŒ Ù…Ù„ØºÙŠ'
      default: return status
    }
  }

  if (loading) {
    return (
      <RoleGate allow={['developer']}>
        <div className="flex items-center justify-center h-96">
          <div className="text-center">
            <RefreshCw className="w-12 h-12 text-primary animate-spin mx-auto mb-4" />
            <p className="text-lg text-gray-600">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ±...</p>
          </div>
        </div>
      </RoleGate>
    )
  }

  return (
    <RoleGate allow={['developer']}>
      <div className="space-y-6">
        {/* Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© */}
        <div className="flex items-center justify-between flex-wrap gap-4">
          <div>
            <h1 className="text-3xl font-extrabold text-primary">ğŸ‘¨â€ğŸ’» Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h1>
            <p className="text-gray-600 mt-1">Ø¥Ø¯Ø§Ø±Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</p>
          </div>
          <button
            onClick={handleRefresh}
            disabled={refreshing}
            className="flex items-center gap-2 bg-primary hover:bg-sky-600 text-white px-4 py-2 rounded-xl font-semibold transition disabled:opacity-50"
          >
            <RefreshCw className={`w-5 h-5 ${refreshing ? 'animate-spin' : ''}`} />
            ØªØ­Ø¯ÙŠØ«
          </button>
        </div>

        {/* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */}
        <div className="flex flex-wrap gap-2 border-b pb-4">
          {[
            { id: 'overview', label: 'ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©' },
            { id: 'finance', label: 'ğŸ’° Ø§Ù„Ù…Ø§Ù„ÙŠØ©' },
            { id: 'restaurants', label: 'ğŸª Ø§Ù„Ù…Ø·Ø§Ø¹Ù…' },
            { id: 'storeAnalytics', label: 'ğŸ“ˆ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø±' },
            { id: 'packages', label: 'ğŸ“¦ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø§Øª' },
            { id: 'licenses', label: 'ğŸ“„ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ' },
            { id: 'orders', label: 'ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª' },
            { id: 'users', label: 'ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†' },
            { id: 'couriers', label: 'ğŸš— Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨' },
            { id: 'admins', label: 'ğŸ‘‘ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†' },
            { id: 'tasks', label: 'ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù…' },
            { id: 'settings', label: 'âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª' },
            { id: 'tools', label: 'ğŸ› ï¸ Ø§Ù„Ø£Ø¯ÙˆØ§Øª' },
          ].map(tab => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id as Tab)}
              className={`flex items-center gap-2 px-4 py-2 rounded-xl font-semibold transition ${
                activeTab === tab.id 
                  ? 'bg-primary text-white' 
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              {tab.label}
            </button>
          ))}
        </div>

        {/* ===== Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© ===== */}
        {activeTab === 'overview' && (
          <div className="space-y-6">
            {/* ğŸ”” ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù‡Ø§Ù…Ø© */}
            {packageRequests.filter(r => ['pending', 'payment_sent'].includes(r.status)).length > 0 && (
              <div className="bg-gradient-to-r from-amber-100 to-orange-100 border-2 border-amber-300 rounded-2xl p-5 shadow-lg">
                <div className="flex items-center justify-between flex-wrap gap-4">
                  <div className="flex items-center gap-3">
                    <div className="w-12 h-12 bg-amber-500 rounded-xl flex items-center justify-center animate-pulse">
                      <Package className="w-6 h-6 text-white" />
                    </div>
                    <div>
                      <h3 className="text-lg font-bold text-amber-800">ğŸ”” Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ù‚Ø§Øª ØªØ­ØªØ§Ø¬ Ø¥Ø¬Ø±Ø§Ø¡</h3>
                      <p className="text-amber-700">
                        {packageRequests.filter(r => r.status === 'pending').length > 0 && (
                          <span>â³ {packageRequests.filter(r => r.status === 'pending').length} Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</span>
                        )}
                        {packageRequests.filter(r => r.status === 'pending').length > 0 && packageRequests.filter(r => r.status === 'payment_sent').length > 0 && ' â€¢ '}
                        {packageRequests.filter(r => r.status === 'payment_sent').length > 0 && (
                          <span>ğŸ’³ {packageRequests.filter(r => r.status === 'payment_sent').length} Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯</span>
                        )}
                      </p>
                    </div>
                  </div>
                  <button
                    onClick={() => setActiveTab('packages')}
                    className="bg-amber-500 hover:bg-amber-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg transition transform hover:scale-105"
                  >
                    ğŸ“¦ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                  </button>
                </div>
              </div>
            )}

            {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© */}
            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
              <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-4 text-white text-center">
                <p className="text-3xl font-bold">{stats.users}</p>
                <p className="text-sm opacity-90">ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
              </div>
              <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-2xl p-4 text-white text-center">
                <p className="text-3xl font-bold">{stats.restaurants}</p>
                <p className="text-sm opacity-90">ğŸª Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</p>
              </div>
              <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-4 text-white text-center">
                <p className="text-3xl font-bold">{stats.orders}</p>
                <p className="text-sm opacity-90">ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
              </div>
              <div className="bg-gradient-to-br from-amber-500 to-amber-600 rounded-2xl p-4 text-white text-center cursor-pointer hover:scale-105 transition" onClick={() => setActiveTab('packages')}>
                <p className="text-3xl font-bold">{packageRequests.filter(r => r.status === 'pending').length}</p>
                <p className="text-sm opacity-90">ğŸ“¦ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>
              </div>
              <div className="bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-2xl p-4 text-white text-center">
                <p className="text-3xl font-bold">{stats.couriers}</p>
                <p className="text-sm opacity-90">ğŸš— Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</p>
              </div>
              <div className="bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-4 text-white text-center">
                <p className="text-3xl font-bold">{stats.totalAppEarnings.toFixed(2)}</p>
                <p className="text-sm opacity-90">ğŸ’° Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</p>
              </div>
            </div>

            {/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase */}
            <div className="bg-white rounded-2xl shadow-lg p-6">
              <div className="flex items-center gap-3 mb-4">
                <Server className="w-6 h-6 text-orange-500" />
                <h2 className="text-xl font-bold">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase</h2>
              </div>
              <div className="grid md:grid-cols-2 gap-4">
                <div className="bg-gray-50 rounded-xl p-3">
                  <p className="text-xs text-gray-500">Project ID</p>
                  <p className="font-mono text-sm">{firebaseConfig.projectId}</p>
                </div>
                <div className="bg-gray-50 rounded-xl p-3">
                  <p className="text-xs text-gray-500">Storage Bucket</p>
                  <p className="font-mono text-sm">{firebaseConfig.storageBucket}</p>
                </div>
              </div>
              <div className="mt-4 flex flex-wrap gap-2">
                <a
                  href={`https://console.firebase.google.com/project/${firebaseConfig.projectId}/overview`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-sm bg-orange-100 hover:bg-orange-200 text-orange-700 px-3 py-1 rounded-lg"
                >
                  ğŸ”¥ Console
                </a>
                <a
                  href={`https://console.firebase.google.com/project/${firebaseConfig.projectId}/firestore`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-lg"
                >
                  ğŸ“Š Firestore
                </a>
                <a
                  href={`https://console.firebase.google.com/project/${firebaseConfig.projectId}/authentication`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-sm bg-green-100 hover:bg-green-200 text-green-700 px-3 py-1 rounded-lg"
                >
                  ğŸ” Auth
                </a>
                <a
                  href={`https://console.firebase.google.com/project/${firebaseConfig.projectId}/storage`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-sm bg-purple-100 hover:bg-purple-200 text-purple-700 px-3 py-1 rounded-lg"
                >
                  ğŸ“ Storage
                </a>
              </div>
            </div>

            {/* ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† */}
            <div className="bg-white rounded-2xl shadow-lg p-6">
              <h2 className="text-xl font-bold mb-4">ğŸ“Š ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
              <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                <div className="text-center p-4 bg-blue-50 rounded-xl">
                  <p className="text-2xl font-bold text-blue-600">{stats.customers}</p>
                  <p className="text-sm text-gray-600">Ø¹Ù…Ù„Ø§Ø¡</p>
                </div>
                <div className="text-center p-4 bg-green-50 rounded-xl">
                  <p className="text-2xl font-bold text-green-600">{stats.owners}</p>
                  <p className="text-sm text-gray-600">Ø£ØµØ­Ø§Ø¨ Ù…Ø·Ø§Ø¹Ù…</p>
                </div>
                <div className="text-center p-4 bg-yellow-50 rounded-xl">
                  <p className="text-2xl font-bold text-yellow-600">{stats.couriers}</p>
                  <p className="text-sm text-gray-600">Ù…Ù†Ø§Ø¯ÙŠØ¨</p>
                </div>
                <div className="text-center p-4 bg-purple-50 rounded-xl">
                  <p className="text-2xl font-bold text-purple-600">{stats.admins}</p>
                  <p className="text-sm text-gray-600">Ù…Ø´Ø±ÙÙŠÙ†</p>
                </div>
                <div className="text-center p-4 bg-red-50 rounded-xl">
                  <p className="text-2xl font-bold text-red-600">1</p>
                  <p className="text-sm text-gray-600">Ù…Ø·ÙˆØ±</p>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* ===== Ø§Ù„Ù…Ø§Ù„ÙŠØ© ===== */}
        {activeTab === 'finance' && (
          <div className="space-y-6">
            {(() => {
              const financeStats = getFinanceStats()
              return (
                <>
                  {/* Ù…Ù„Ø®Øµ Ù…Ø§Ù„ÙŠ */}
                  <div className="bg-gradient-to-r from-green-600 to-emerald-700 rounded-2xl shadow-lg p-6 text-white">
                    <h2 className="text-2xl font-bold mb-4">ğŸ’° Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ</h2>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                      <div className="bg-white/20 rounded-xl p-4 text-center">
                        <p className="text-3xl font-bold">{financeStats.totalRevenue.toFixed(0)}</p>
                        <p className="text-sm opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø±.Ø³)</p>
                      </div>
                      <div className="bg-white/20 rounded-xl p-4 text-center">
                        <p className="text-3xl font-bold">{financeStats.totalPlatformFee.toFixed(2)}</p>
                        <p className="text-sm opacity-90">Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø±.Ø³)</p>
                      </div>
                      <div className="bg-white/20 rounded-xl p-4 text-center">
                        <p className="text-3xl font-bold">{financeStats.totalAdminCommission.toFixed(2)}</p>
                        <p className="text-sm opacity-90">Ø¹Ù…ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† (Ø±.Ø³)</p>
                      </div>
                      <div className="bg-white/20 rounded-xl p-4 text-center">
                        <p className="text-3xl font-bold">{(financeStats.totalPlatformFee + financeStats.totalAdminCommission).toFixed(2)}</p>
                        <p className="text-sm opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ø±.Ø³)</p>
                      </div>
                    </div>
                  </div>

                  {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø²Ù…Ù†ÙŠØ© */}
                  <div className="grid md:grid-cols-3 gap-6">
                    {/* Ø§Ù„ÙŠÙˆÙ… */}
                    <div className="bg-white rounded-2xl shadow-lg p-6">
                      <h3 className="text-lg font-bold text-blue-600 mb-4">ğŸ“… Ø§Ù„ÙŠÙˆÙ…</h3>
                      <div className="space-y-3">
                        <div className="flex justify-between">
                          <span className="text-gray-600">Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</span>
                          <span className="font-bold">{financeStats.todayOrders}</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-gray-600">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:</span>
                          <span className="font-bold">{financeStats.todayRevenue.toFixed(2)} Ø±.Ø³</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-gray-600">Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:</span>
                          <span className="font-bold text-green-600">{financeStats.todayPlatformFee.toFixed(2)} Ø±.Ø³</span>
                        </div>
                      </div>
                    </div>

                    {/* Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ */}
                    <div className="bg-white rounded-2xl shadow-lg p-6">
                      <h3 className="text-lg font-bold text-purple-600 mb-4">ğŸ“… Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…</h3>
                      <div className="space-y-3">
                        <div className="flex justify-between">
                          <span className="text-gray-600">Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</span>
                          <span className="font-bold">{financeStats.weekOrders}</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-gray-600">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:</span>
                          <span className="font-bold">{financeStats.weekRevenue.toFixed(2)} Ø±.Ø³</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-gray-600">Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:</span>
                          <span className="font-bold text-green-600">{financeStats.weekPlatformFee.toFixed(2)} Ø±.Ø³</span>
                        </div>
                      </div>
                    </div>

                    {/* Ø§Ù„Ø´Ù‡Ø± */}
                    <div className="bg-white rounded-2xl shadow-lg p-6">
                      <h3 className="text-lg font-bold text-orange-600 mb-4">ğŸ“… Ø¢Ø®Ø± 30 ÙŠÙˆÙ…</h3>
                      <div className="space-y-3">
                        <div className="flex justify-between">
                          <span className="text-gray-600">Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</span>
                          <span className="font-bold">{financeStats.monthOrders}</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-gray-600">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:</span>
                          <span className="font-bold">{financeStats.monthRevenue.toFixed(2)} Ø±.Ø³</span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-gray-600">Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:</span>
                          <span className="font-bold text-green-600">{financeStats.monthPlatformFee.toFixed(2)} Ø±.Ø³</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø£Ø¯Ø§Ø¡Ù‹ */}
                  <div className="bg-white rounded-2xl shadow-lg p-6">
                    <h3 className="text-lg font-bold mb-4">ğŸ† Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø£Ø¯Ø§Ø¡Ù‹</h3>
                    <div className="space-y-3">
                      {restaurants
                        .map(r => ({
                          ...r,
                          ordersCount: orders.filter(o => o.restaurantId === r.id && o.status === 'delivered').length,
                          revenue: orders.filter(o => o.restaurantId === r.id && o.status === 'delivered').reduce((sum, o) => sum + (o.total || 0), 0),
                        }))
                        .sort((a, b) => b.revenue - a.revenue)
                        .slice(0, 5)
                        .map((r, i) => (
                          <div key={r.id} className="flex items-center justify-between bg-gray-50 rounded-xl p-3">
                            <div className="flex items-center gap-3">
                              <span className="text-2xl">{i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : `#${i + 1}`}</span>
                              <div>
                                <p className="font-bold">{r.name}</p>
                                <p className="text-sm text-gray-500">{r.ordersCount} Ø·Ù„Ø¨</p>
                              </div>
                            </div>
                            <p className="font-bold text-green-600">{r.revenue.toFixed(2)} Ø±.Ø³</p>
                          </div>
                        ))}
                    </div>
                  </div>
                </>
              )
            })()}
          </div>
        )}

        {/* ===== Ø§Ù„Ù…Ø·Ø§Ø¹Ù… ===== */}
        {activeTab === 'restaurants' && (
          <div className="space-y-4">
            <div className="flex items-center justify-between flex-wrap gap-4">
              <h2 className="text-xl font-bold">ğŸª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… ({restaurants.length})</h2>
              <button
                onClick={() => setShowAddRestaurant(!showAddRestaurant)}
                className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-xl font-semibold"
              >
                {showAddRestaurant ? 'âŒ Ø¥Ù„ØºØ§Ø¡' : 'â• Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù…'}
              </button>
            </div>

            {/* Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù… */}
            {showAddRestaurant && (
              <div className="bg-green-50 rounded-2xl p-6 border-2 border-green-200">
                <h3 className="text-lg font-bold text-green-800 mb-4">ğŸª Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯</h3>
                <div className="grid md:grid-cols-2 gap-4">
                  <div>
                    <label className="text-sm text-gray-600 block mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù… *</label>
                    <input
                      type="text"
                      placeholder="Ù…Ø«Ø§Ù„: Ù…Ø·Ø¹Ù… Ø§Ù„Ø´Ø§Ù…"
                      value={newRestaurantName}
                      onChange={e => setNewRestaurantName(e.target.value)}
                      className="w-full border rounded-xl p-3"
                    />
                  </div>
                  <div>
                    <label className="text-sm text-gray-600 block mb-1">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                    <input
                      type="text"
                      placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±ÙŠØ§Ø¶"
                      value={newRestaurantCity}
                      onChange={e => setNewRestaurantCity(e.target.value)}
                      className="w-full border rounded-xl p-3"
                    />
                  </div>
                  <div>
                    <label className="text-sm text-gray-600 block mb-1">Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø·Ø¹Ù…</label>
                    <input
                      type="tel"
                      placeholder="05xxxxxxxx"
                      value={newRestaurantPhone}
                      onChange={e => setNewRestaurantPhone(e.target.value)}
                      className="w-full border rounded-xl p-3"
                    />
                  </div>
                  <div>
                    <label className="text-sm text-gray-600 block mb-1">Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø·Ø¹Ù…</label>
                    <input
                      type="email"
                      placeholder="restaurant@example.com"
                      value={newRestaurantEmail}
                      onChange={e => setNewRestaurantEmail(e.target.value)}
                      className="w-full border rounded-xl p-3"
                    />
                  </div>
                </div>
                
                <div className="border-t mt-4 pt-4">
                  <h4 className="font-bold text-green-800 mb-3">ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… (Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„)</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <label className="text-sm text-gray-600 block mb-1">Ø¥ÙŠÙ…ÙŠÙ„ ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… *</label>
                      <input
                        type="email"
                        placeholder="owner@example.com"
                        value={newRestaurantOwnerEmail}
                        onChange={e => setNewRestaurantOwnerEmail(e.target.value)}
                        className="w-full border rounded-xl p-3"
                      />
                    </div>
                    <div>
                      <label className="text-sm text-gray-600 block mb-1">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                      <input
                        type="password"
                        placeholder="6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"
                        value={newRestaurantOwnerPassword}
                        onChange={e => setNewRestaurantOwnerPassword(e.target.value)}
                        className="w-full border rounded-xl p-3"
                      />
                    </div>
                  </div>
                </div>

                <button
                  onClick={handleCreateNewRestaurant}
                  disabled={creatingRestaurant || !newRestaurantName.trim() || !newRestaurantOwnerEmail.trim() || !newRestaurantOwnerPassword.trim()}
                  className="mt-4 w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-bold disabled:opacity-50 flex items-center justify-center gap-2"
                >
                  {creatingRestaurant ? (
                    <>
                      <RefreshCw className="w-5 h-5 animate-spin" />
                      Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...
                    </>
                  ) : (
                    'ğŸª Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø·Ø¹Ù…'
                  )}
                </button>
              </div>
            )}
            
            <div className="space-y-4">
              {restaurants.map(restaurant => (
                <div key={restaurant.id} className="bg-white rounded-2xl shadow p-4">
                  {editingRestaurant === restaurant.id ? (
                    // ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø±ÙŠØ±
                    <div className="space-y-4">
                      <div className="grid md:grid-cols-2 gap-4">
                        <div>
                          <label className="text-sm text-gray-600">Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…</label>
                          <input
                            type="text"
                            value={restaurantForm.name || ''}
                            onChange={e => setRestaurantForm({ ...restaurantForm, name: e.target.value })}
                            className="w-full border rounded-xl p-2 mt-1"
                          />
                        </div>
                        <div>
                          <label className="text-sm text-gray-600">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                          <input
                            type="text"
                            value={restaurantForm.phone || ''}
                            onChange={e => setRestaurantForm({ ...restaurantForm, phone: e.target.value })}
                            className="w-full border rounded-xl p-2 mt-1"
                          />
                        </div>
                        <div>
                          <label className="text-sm text-gray-600">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                          <input
                            type="email"
                            value={restaurantForm.email || ''}
                            onChange={e => setRestaurantForm({ ...restaurantForm, email: e.target.value })}
                            className="w-full border rounded-xl p-2 mt-1"
                          />
                        </div>
                        <div>
                          <label className="text-sm text-gray-600">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                          <input
                            type="text"
                            value={restaurantForm.city || ''}
                            onChange={e => setRestaurantForm({ ...restaurantForm, city: e.target.value })}
                            className="w-full border rounded-xl p-2 mt-1"
                          />
                        </div>
                        <div className="md:col-span-2">
                          <label className="text-sm text-gray-600">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                          <input
                            type="text"
                            value={restaurantForm.location || ''}
                            onChange={e => setRestaurantForm({ ...restaurantForm, location: e.target.value })}
                            className="w-full border rounded-xl p-2 mt-1"
                          />
                        </div>
                        <div className="md:col-span-2">
                          <label className="text-sm text-gray-600">Ø±Ø¨Ø· Ø¨Ù…Ø´Ø±Ù (Ù„Ù„Ø¹Ù…ÙˆÙ„Ø©)</label>
                          <select
                            value={restaurantForm.referredBy || ''}
                            onChange={e => setRestaurantForm({ ...restaurantForm, referredBy: e.target.value })}
                            className="w-full border rounded-xl p-2 mt-1"
                          >
                            <option value="">-- Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø±Ù (Ø§Ù„Ù…Ø·ÙˆØ± ÙÙ‚Ø·) --</option>
                            {users
                              .filter(u => u.role === 'admin')
                              .map(admin => (
                                <option key={admin.uid} value={admin.uid}>
                                  ğŸ‘‘ {admin.name || admin.email}
                                </option>
                              ))}
                          </select>
                          <p className="text-xs text-gray-500 mt-1">
                            Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø±ØªØ¨Ø· ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø¹Ù…ÙˆÙ„Ø© Ù…Ù† Ø·Ù„Ø¨Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ù…Ø·Ø¹Ù…
                          </p>
                        </div>
                      </div>
                      
                      {/* Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø± */}
                      <div>
                        <label className="text-sm text-gray-600">Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø·Ø¹Ù…</label>
                        <input
                          type="file"
                          accept="image/*"
                          onChange={e => {
                            const file = e.target.files?.[0]
                            if (file) handleUploadLogo(restaurant.id, file)
                          }}
                          className="w-full border rounded-xl p-2 mt-1"
                          disabled={uploadingLogo}
                        />
                        {uploadingLogo && <p className="text-sm text-gray-500 mt-1">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...</p>}
                      </div>
                      
                      <div className="flex gap-2">
                        <button
                          onClick={() => handleUpdateRestaurant(restaurant.id)}
                          className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-xl"
                        >
                          <Save className="w-4 h-4" /> Ø­ÙØ¸
                        </button>
                        <button
                          onClick={() => setEditingRestaurant(null)}
                          className="flex items-center gap-2 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-xl"
                        >
                          <X className="w-4 h-4" /> Ø¥Ù„ØºØ§Ø¡
                        </button>
                      </div>
                    </div>
                  ) : (
                    // ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶
                    <div className="flex items-start gap-4">
                      {/* Ø§Ù„Ø´Ø¹Ø§Ø± */}
                      <div className="w-16 h-16 rounded-xl bg-gray-100 overflow-hidden flex-shrink-0">
                        {restaurant.logoUrl ? (
                          <img src={restaurant.logoUrl} alt={restaurant.name} className="w-full h-full object-cover" />
                        ) : (
                          <div className="w-full h-full flex items-center justify-center text-2xl">ğŸª</div>
                        )}
                      </div>
                      
                      {/* Ø§Ù„ØªÙØ§ØµÙŠÙ„ */}
                      <div className="flex-1">
                        <div className="flex items-center gap-2">
                          <h3 className="font-bold text-lg">{restaurant.name}</h3>
                          {restaurant.isVerified && (
                            <span className="inline-flex items-center gap-1 px-2 py-0.5 bg-green-100 text-green-700 text-xs font-bold rounded-full">
                              <CheckCircle className="w-3 h-3" /> Ù…ÙˆØ«Ù‚Ø©
                            </span>
                          )}
                        </div>
                        <div className="text-sm text-gray-600 space-y-1 mt-1">
                          {restaurant.phone && <p>ğŸ“± {restaurant.phone}</p>}
                          {restaurant.email && <p>ğŸ“§ {restaurant.email}</p>}
                          {restaurant.city && <p>ğŸ“ {restaurant.city}</p>}
                          {restaurant.referredBy && (
                            <p className="text-purple-600">
                              ğŸ‘‘ Ù…Ø¶Ø§Ù Ù…Ù†: {admins.find(a => a.uid === restaurant.referredBy)?.name || restaurant.referredBy.slice(0, 8)}
                            </p>
                          )}
                        </div>
                      </div>
                      
                      {/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */}
                      <div className="flex flex-col gap-2">
                        <div className="flex gap-2">
                          {/* Ø²Ø± Ø§Ù„ØªÙˆØ«ÙŠÙ‚ */}
                          <button
                            onClick={async () => {
                              const newStatus = !restaurant.isVerified
                              const confirmed = await dialog.confirm(
                                newStatus 
                                  ? `Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙˆØ«ÙŠÙ‚ Ø£Ø³Ø±Ø© "${restaurant.name}"ØŸ Ø³ØªØ¸Ù‡Ø± Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡.`
                                  : `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ ØªÙˆØ«ÙŠÙ‚ Ø£Ø³Ø±Ø© "${restaurant.name}"ØŸ`,
                                { 
                                  title: newStatus ? 'âœ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø±Ø©' : 'âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚',
                                  confirmText: newStatus ? 'Ù†Ø¹Ù…ØŒ ÙˆØ«Ù‘Ù‚' : 'Ù†Ø¹Ù…ØŒ Ø£Ù„ØºÙ Ø§Ù„ØªÙˆØ«ÙŠÙ‚',
                                }
                              )
                              if (!confirmed) return
                              try {
                                await updateDoc(doc(db, 'restaurants', restaurant.id), {
                                  isVerified: newStatus,
                                  verifiedAt: newStatus ? serverTimestamp() : null,
                                  updatedAt: serverTimestamp(),
                                })
                                toast.success(newStatus ? 'ØªÙ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø±Ø© âœ…' : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚')
                                loadData()
                              } catch (err) {
                                toast.error('Ø­Ø¯Ø« Ø®Ø·Ø£')
                                console.error(err)
                              }
                            }}
                            className={`p-2 rounded-xl ${restaurant.isVerified ? 'bg-green-100 hover:bg-green-200 text-green-600' : 'bg-gray-100 hover:bg-gray-200 text-gray-600'}`}
                            title={restaurant.isVerified ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆØ«ÙŠÙ‚' : 'ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø±Ø©'}
                          >
                            <CheckCircle className="w-5 h-5" />
                          </button>
                          <button
                            onClick={() => {
                              setEditingRestaurant(restaurant.id)
                              setRestaurantForm(restaurant)
                            }}
                            className="p-2 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-xl"
                            title="ØªØ­Ø±ÙŠØ±"
                          >
                            <Edit3 className="w-5 h-5" />
                          </button>
                          <button
                            onClick={() => handleDeleteRestaurant(restaurant.id)}
                            className="p-2 bg-red-100 hover:bg-red-200 text-red-600 rounded-xl"
                            title="Ø­Ø°Ù"
                          >
                            <Trash2 className="w-5 h-5" />
                          </button>
                        </div>
                        {/* Ø±Ø¨Ø· Ø³Ø±ÙŠØ¹ Ø¨Ù…Ø´Ø±Ù */}
                        <select
                          value={restaurant.referredBy || ''}
                          onChange={async (e) => {
                            const newAdminId = e.target.value
                            try {
                              await updateDoc(doc(db, 'restaurants', restaurant.id), {
                                referredBy: newAdminId || null,
                                updatedAt: serverTimestamp()
                              })
                              toast.success(newAdminId ? 'ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ù…Ø·Ø¹Ù… Ø¨Ø§Ù„Ù…Ø´Ø±Ù' : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø±Ø¨Ø· Ø§Ù„Ù…Ø´Ø±Ù')
                              loadData()
                            } catch (err) {
                              toast.error('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø¨Ø·')
                            }
                          }}
                          className="text-xs border rounded-lg p-1"
                          title="Ø±Ø¨Ø· Ø¨Ù…Ø´Ø±Ù"
                        >
                          <option value="">ğŸ‘¤ Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø±Ù</option>
                          {users
                            .filter(u => u.role === 'admin')
                            .map(admin => (
                              <option key={admin.uid} value={admin.uid}>
                                ğŸ‘‘ {admin.name || admin.email}
                              </option>
                            ))}
                        </select>
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>
        )}

        {/* ===== Ø§Ù„Ø·Ù„Ø¨Ø§Øª ===== */}
        {activeTab === 'orders' && (
          <div className="space-y-4">
            <div className="flex items-center justify-between flex-wrap gap-4">
              <h2 className="text-xl font-bold">ğŸ“¦ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ({orders.length})</h2>
              <select
                value={orderFilter}
                onChange={e => setOrderFilter(e.target.value)}
                className="border rounded-xl p-2"
              >
                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                <option value="accepted">Ù…Ù‚Ø¨ÙˆÙ„</option>
                <option value="preparing">Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</option>
                <option value="ready">Ø¬Ø§Ù‡Ø²</option>
                <option value="out_for_delivery">ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚</option>
                <option value="delivered">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                <option value="cancelled">Ù…Ù„ØºÙŠ</option>
              </select>
            </div>
            
            <div className="space-y-3">
              {orders
                .filter(o => orderFilter === 'all' || o.status === orderFilter)
                .sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0))
                .map(order => (
                  <div key={order.id} className="bg-white rounded-2xl shadow p-4">
                    <div className="flex items-start justify-between flex-wrap gap-4">
                      <div>
                        <h3 className="font-bold">Ø·Ù„Ø¨ #{order.id.slice(-8)}</h3>
                        <p className="text-sm text-gray-600">ğŸª {order.restaurantName || 'Ù…Ø·Ø¹Ù…'}</p>
                        <p className="text-sm text-gray-600">ğŸ“ {order.address}</p>
                        <p className="text-sm text-gray-600">ğŸ’° {order.total?.toFixed(2)} Ø±.Ø³</p>
                        {order.platformFee && (
                          <p className="text-xs text-green-600">
                            Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: {order.platformFee} Ø±.Ø³ 
                            {order.adminCommission ? ` | Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø´Ø±Ù: ${order.adminCommission} Ø±.Ø³` : ''}
                          </p>
                        )}
                      </div>
                      
                      <div className="text-left">
                        <span className={`inline-block px-3 py-1 rounded-xl text-sm font-semibold ${
                          order.status === 'delivered' ? 'bg-green-100 text-green-700' :
                          order.status === 'cancelled' ? 'bg-red-100 text-red-700' :
                          order.status === 'pending' ? 'bg-yellow-100 text-yellow-700' :
                          'bg-blue-100 text-blue-700'
                        }`}>
                          {statusLabel(order.status)}
                        </span>
                        
                        {/* ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© */}
                        <select
                          value={order.status}
                          onChange={e => handleUpdateOrderStatus(order.id, e.target.value)}
                          className="mt-2 w-full border rounded-lg p-1 text-sm"
                        >
                          <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                          <option value="accepted">Ù…Ù‚Ø¨ÙˆÙ„</option>
                          <option value="preparing">Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</option>
                          <option value="ready">Ø¬Ø§Ù‡Ø²</option>
                          <option value="out_for_delivery">ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚</option>
                          <option value="delivered">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                          <option value="cancelled">Ù…Ù„ØºÙŠ</option>
                        </select>
                      </div>
                    </div>
                    
                    {/* Ø§Ù„Ø£ØµÙ†Ø§Ù */}
                    <div className="mt-3 pt-3 border-t">
                      <p className="text-sm text-gray-500 mb-1">Ø§Ù„Ø£ØµÙ†Ø§Ù:</p>
                      <div className="flex flex-wrap gap-2">
                        {order.items?.map((item, i) => (
                          <span key={i} className="text-xs bg-gray-100 px-2 py-1 rounded">
                            {item.name} Ã— {item.qty}
                          </span>
                        ))}
                      </div>
                    </div>
                  </div>
                ))}
            </div>
          </div>
        )}

        {/* ===== Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ===== */}
        {activeTab === 'users' && (
          <div className="space-y-4">
            <div className="flex items-center justify-between flex-wrap gap-4">
              <h2 className="text-xl font-bold">ğŸ‘¤ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ({users.length})</h2>
              <select
                value={userFilter}
                onChange={e => setUserFilter(e.target.value)}
                className="border rounded-xl p-2"
              >
                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</option>
                <option value="customer">Ø¹Ù…Ù„Ø§Ø¡</option>
                <option value="owner">Ø£ØµØ­Ø§Ø¨ Ù…Ø·Ø§Ø¹Ù…</option>
                <option value="courier">Ù…Ù†Ø§Ø¯ÙŠØ¨</option>
                <option value="admin">Ù…Ø´Ø±ÙÙŠÙ†</option>
                <option value="developer">Ù…Ø·ÙˆØ±ÙŠÙ†</option>
              </select>
            </div>
            
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
              {users
                .filter(u => userFilter === 'all' || u.role === userFilter)
                .map(u => (
                  <div key={u.uid} className="bg-white rounded-2xl shadow p-4">
                    {editingUser === u.uid ? (
                      <div className="space-y-3">
                        <input
                          type="text"
                          placeholder="Ø§Ù„Ø§Ø³Ù…"
                          value={userForm.name || ''}
                          onChange={e => setUserForm({ ...userForm, name: e.target.value })}
                          className="w-full border rounded-xl p-2"
                        />
                        <input
                          type="text"
                          placeholder="Ø§Ù„Ù‡Ø§ØªÙ"
                          value={userForm.phone || ''}
                          onChange={e => setUserForm({ ...userForm, phone: e.target.value })}
                          className="w-full border rounded-xl p-2"
                        />
                        <select
                          value={userForm.role || 'customer'}
                          onChange={e => setUserForm({ ...userForm, role: e.target.value })}
                          className="w-full border rounded-xl p-2"
                        >
                          <option value="customer">Ø¹Ù…ÙŠÙ„</option>
                          <option value="owner">ØµØ§Ø­Ø¨ Ù…Ø·Ø¹Ù…</option>
                          <option value="courier">Ù…Ù†Ø¯ÙˆØ¨</option>
                          <option value="admin">Ù…Ø´Ø±Ù</option>
                          <option value="developer">Ù…Ø·ÙˆØ±</option>
                        </select>
                        <div className="flex gap-2">
                          <button
                            onClick={() => handleUpdateUser(u.uid)}
                            className="flex-1 bg-green-600 text-white py-2 rounded-xl"
                          >
                            Ø­ÙØ¸
                          </button>
                          <button
                            onClick={() => setEditingUser(null)}
                            className="flex-1 bg-gray-500 text-white py-2 rounded-xl"
                          >
                            Ø¥Ù„ØºØ§Ø¡
                          </button>
                        </div>
                      </div>
                    ) : (
                      <>
                        <div className="flex items-start justify-between">
                          <div>
                            <h3 className="font-bold">{u.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</h3>
                            <p className="text-sm text-gray-600">{u.email}</p>
                            <p className="text-xs mt-1">{roleLabel(u.role)}</p>
                          </div>
                          <div className="flex gap-1">
                            <button
                              onClick={() => {
                                setEditingUser(u.uid)
                                setUserForm(u)
                              }}
                              className="p-1.5 bg-blue-100 text-blue-600 rounded-lg"
                            >
                              <Edit3 className="w-4 h-4" />
                            </button>
                            <button
                              onClick={() => handleDeleteUser(u.uid)}
                              className="p-1.5 bg-red-100 text-red-600 rounded-lg"
                            >
                              <Trash2 className="w-4 h-4" />
                            </button>
                          </div>
                        </div>
                      </>
                    )}
                  </div>
                ))}
            </div>
          </div>
        )}

        {/* ===== Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ ===== */}
        {activeTab === 'couriers' && (
          <div className="space-y-4">
            <div className="flex items-center justify-between flex-wrap gap-4">
              <h2 className="text-xl font-bold">ğŸš— Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ ({stats.couriers})</h2>
              <button
                onClick={() => setShowAddCourier(!showAddCourier)}
                className="flex items-center gap-2 bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-xl font-semibold"
              >
                {showAddCourier ? 'âŒ Ø¥Ù„ØºØ§Ø¡' : 'â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨'}
              </button>
            </div>

            {/* Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨ */}
            {showAddCourier && (
              <div className="bg-cyan-50 rounded-2xl p-6 border-2 border-cyan-200">
                <h3 className="text-lg font-bold text-cyan-800 mb-4">ğŸš— Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨ Ø¬Ø¯ÙŠØ¯</h3>
                <div className="grid md:grid-cols-2 gap-4">
                  <div>
                    <label className="text-sm text-gray-600 block mb-1">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
                    <input
                      type="email"
                      placeholder="courier@example.com"
                      value={newCourierEmail}
                      onChange={e => setNewCourierEmail(e.target.value)}
                      className="w-full border rounded-xl p-3"
                    />
                  </div>
                  <div>
                    <label className="text-sm text-gray-600 block mb-1">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                    <input
                      type="password"
                      placeholder="6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"
                      value={newCourierPassword}
                      onChange={e => setNewCourierPassword(e.target.value)}
                      className="w-full border rounded-xl p-3"
                    />
                  </div>
                  <div>
                    <label className="text-sm text-gray-600 block mb-1">Ø§Ù„Ø§Ø³Ù…</label>
                    <input
                      type="text"
                      placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨"
                      value={newCourierName}
                      onChange={e => setNewCourierName(e.target.value)}
                      className="w-full border rounded-xl p-3"
                    />
                  </div>
                  <div>
                    <label className="text-sm text-gray-600 block mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input
                      type="tel"
                      placeholder="05xxxxxxxx"
                      value={newCourierPhone}
                      onChange={e => setNewCourierPhone(e.target.value)}
                      className="w-full border rounded-xl p-3"
                    />
                  </div>
                </div>
                <button
                  onClick={handleCreateNewCourier}
                  disabled={creatingCourier || !newCourierEmail.trim() || !newCourierPassword.trim()}
                  className="mt-4 w-full bg-cyan-600 hover:bg-cyan-700 text-white py-3 rounded-xl font-bold disabled:opacity-50 flex items-center justify-center gap-2"
                >
                  {creatingCourier ? (
                    <>
                      <RefreshCw className="w-5 h-5 animate-spin" />
                      Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...
                    </>
                  ) : (
                    'ğŸš— Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨'
                  )}
                </button>
              </div>
            )}
            
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
              {users.filter(u => u.role === 'courier').map(courier => (
                <div key={courier.uid} className="bg-white rounded-2xl shadow p-4">
                  <div className="flex items-center gap-3">
                    <div className="w-12 h-12 bg-cyan-100 rounded-full flex items-center justify-center text-2xl">
                      ğŸš—
                    </div>
                    <div>
                      <h3 className="font-bold">{courier.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</h3>
                      <p className="text-sm text-gray-600">{courier.email}</p>
                      {courier.phone && <p className="text-sm text-gray-600">ğŸ“± {courier.phone}</p>}
                    </div>
                  </div>
                  
                  {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ */}
                  <div className="mt-4 pt-3 border-t">
                    <div className="grid grid-cols-2 gap-2 text-center">
                      <div className="bg-green-50 rounded-lg p-2">
                        <p className="text-lg font-bold text-green-600">
                          {orders.filter(o => o.courierId === courier.uid && o.status === 'delivered').length}
                        </p>
                        <p className="text-xs text-gray-600">Ø·Ù„Ø¨Ø§Øª Ù…Ø³Ù„Ù…Ø©</p>
                      </div>
                      <div className="bg-blue-50 rounded-lg p-2">
                        <p className="text-lg font-bold text-blue-600">
                          {orders.filter(o => o.courierId === courier.uid && o.status === 'out_for_delivery').length}
                        </p>
                        <p className="text-xs text-gray-600">ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚</p>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
              
              {stats.couriers === 0 && (
                <div className="col-span-full text-center py-12 text-gray-500">
                  Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø§Ø¯ÙŠØ¨ Ù…Ø³Ø¬Ù„ÙŠÙ†
                </div>
              )}
            </div>
          </div>
        )}

        {/* ===== Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† ===== */}
        {activeTab === 'admins' && (
          <div className="space-y-4">
            <div className="flex items-center justify-between flex-wrap gap-4">
              <h2 className="text-xl font-bold">ğŸ‘‘ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† ÙˆØ¹Ù…ÙˆÙ„Ø§ØªÙ‡Ù… ({admins.length})</h2>
              <button
                onClick={() => setShowAddAdmin(!showAddAdmin)}
                className="flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-xl font-semibold transition"
              >
                <UserPlus className="w-5 h-5" />
                {showAddAdmin ? 'Ø¥Ù„ØºØ§Ø¡' : 'Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù'}
              </button>
            </div>
            
            {/* Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù */}
            {showAddAdmin && (
              <div className="bg-purple-50 rounded-2xl p-6 border-2 border-purple-200">
                <h3 className="text-lg font-bold text-purple-800 mb-4">ğŸ‘‘ ØªØ±Ù‚ÙŠØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Ù…Ø´Ø±Ù</h3>
                <p className="text-sm text-purple-600 mb-4">Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù„ØªØ±Ù‚ÙŠØªÙ‡ Ø¥Ù„Ù‰ Ø¯ÙˆØ± Ø§Ù„Ù…Ø´Ø±ÙØŒ Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</p>
                
                {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ† */}
                <div className="mb-4">
                  <label className="text-sm font-semibold text-gray-700 block mb-2">ØªØ±Ù‚ÙŠØ© Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯:</label>
                  <div className="grid gap-2 max-h-48 overflow-y-auto">
                    {users.filter(u => u.role === 'customer').slice(0, 10).map(u => (
                      <div key={u.uid} className="flex items-center justify-between bg-white p-3 rounded-xl">
                        <div>
                          <p className="font-semibold">{u.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</p>
                          <p className="text-sm text-gray-500">{u.email}</p>
                        </div>
                        <button
                          onClick={async () => {
                            const confirmed = await dialog.confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ±Ù‚ÙŠØ© ${u.name || u.email} Ø¥Ù„Ù‰ Ù…Ø´Ø±ÙØŸ`, {
                              title: 'ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ù…Ø´Ø±Ù'
                            })
                            if (!confirmed) return
                            try {
                              await updateDoc(doc(db, 'users', u.uid), { role: 'admin' })
                              toast.success('ØªÙ… ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Ù…Ø´Ø±Ù âœ…')
                              setShowAddAdmin(false)
                              loadData()
                            } catch (err) {
                              toast.error('ÙØ´Ù„ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…')
                            }
                          }}
                          className="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded-lg text-sm"
                        >
                          ØªØ±Ù‚ÙŠØ© ğŸ‘‘
                        </button>
                      </div>
                    ))}
                    {users.filter(u => u.role === 'customer').length === 0 && (
                      <p className="text-gray-500 text-center py-4">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ ÙŠÙ…ÙƒÙ† ØªØ±Ù‚ÙŠØªÙ‡Ù…</p>
                    )}
                  </div>
                </div>
                
                {/* Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯ */}
                <div className="border-t pt-4 mt-4">
                  <h4 className="text-md font-bold text-purple-800 mb-3">âœ¨ Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯:</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <label className="text-sm text-gray-600 block mb-1">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
                      <input
                        type="email"
                        placeholder="admin@example.com"
                        value={newAdminEmail}
                        onChange={e => setNewAdminEmail(e.target.value)}
                        className="w-full border rounded-xl p-3 text-gray-900"
                      />
                    </div>
                    <div>
                      <label className="text-sm text-gray-600 block mb-1">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                      <input
                        type="password"
                        placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)"
                        value={newAdminPassword}
                        onChange={e => setNewAdminPassword(e.target.value)}
                        className="w-full border rounded-xl p-3 text-gray-900"
                      />
                    </div>
                    <div>
                      <label className="text-sm text-gray-600 block mb-1">Ø§Ù„Ø§Ø³Ù…</label>
                      <input
                        type="text"
                        placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù"
                        value={newAdminName}
                        onChange={e => setNewAdminName(e.target.value)}
                        className="w-full border rounded-xl p-3 text-gray-900"
                      />
                    </div>
                    <div>
                      <label className="text-sm text-gray-600 block mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                      <input
                        type="tel"
                        placeholder="05xxxxxxxx"
                        value={newAdminPhone}
                        onChange={e => setNewAdminPhone(e.target.value)}
                        className="w-full border rounded-xl p-3 text-gray-900"
                      />
                    </div>
                  </div>
                  
                  <button
                    onClick={handleCreateNewAdmin}
                    disabled={creatingAdmin || !newAdminEmail.trim() || !newAdminPassword.trim()}
                    className="mt-4 w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white py-3 rounded-xl font-bold transition disabled:opacity-50 flex items-center justify-center gap-2"
                  >
                    {creatingAdmin ? (
                      <>
                        <RefreshCw className="w-5 h-5 animate-spin" />
                        Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...
                      </>
                    ) : (
                      <>
                        <UserPlus className="w-5 h-5" />
                        Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø´Ø±Ù
                      </>
                    )}
                  </button>
                  
                  <p className="text-xs text-orange-600 mt-2">
                    âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯ØŒ Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
                  </p>
                </div>
                
                <div className="border-t pt-4 mt-4">
                  <p className="text-xs text-gray-500">ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ø§Ù‹ ØªØºÙŠÙŠØ± Ø¯ÙˆØ± Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† ØªØ¨ÙˆÙŠØ¨ "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"</p>
                </div>
              </div>
            )}
            
            <div className="space-y-4">
              {admins.map(admin => (
                <div key={admin.uid} className="bg-white rounded-2xl shadow overflow-hidden">
                  {/* Ø±Ø£Ø³ Ø§Ù„Ù…Ø´Ø±Ù */}
                  <div 
                    className="p-4 cursor-pointer hover:bg-gray-50"
                    onClick={() => setExpandedAdmin(expandedAdmin === admin.uid ? null : admin.uid)}
                  >
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <div className="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center text-2xl">
                          ğŸ‘‘
                        </div>
                        <div>
                          <h3 className="font-bold">{admin.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</h3>
                          <p className="text-sm text-gray-600">{admin.email}</p>
                        </div>
                      </div>
                      
                      <div className="flex items-center gap-4">
                        {/* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */}
                        <div className="text-left">
                          <div className="flex items-center gap-2">
                            <Wallet className="w-4 h-4 text-green-600" />
                            <span className="font-bold text-green-600">{admin.walletBalance.toFixed(2)} Ø±.Ø³</span>
                          </div>
                          <p className="text-xs text-gray-500">
                            Ø¥Ø¬Ù…Ø§Ù„ÙŠ: {admin.totalEarnings.toFixed(2)} Ø±.Ø³ | {admin.restaurantsCount} Ù…Ø·Ø¹Ù…
                          </p>
                        </div>
                        
                        {expandedAdmin === admin.uid ? (
                          <ChevronUp className="w-5 h-5 text-gray-400" />
                        ) : (
                          <ChevronDown className="w-5 h-5 text-gray-400" />
                        )}
                      </div>
                    </div>
                  </div>
                  
                  {/* Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„ØªØ§Ø¨Ø¹Ø© */}
                  {expandedAdmin === admin.uid && (
                    <div className="border-t bg-gray-50 p-4">
                      <h4 className="font-semibold text-sm text-gray-700 mb-3">
                        ğŸª Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø¨ÙˆØ§Ø³Ø·Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…Ø´Ø±Ù ({admin.restaurants.length}):
                      </h4>
                      
                      {admin.restaurants.length > 0 ? (
                        <div className="grid md:grid-cols-2 gap-3">
                          {admin.restaurants.map(r => (
                            <div key={r.id} className="bg-white rounded-xl p-3 flex items-center gap-3">
                              <div className="w-10 h-10 rounded-lg bg-gray-100 overflow-hidden">
                                {r.logoUrl ? (
                                  <img src={r.logoUrl} alt={r.name} className="w-full h-full object-cover" />
                                ) : (
                                  <div className="w-full h-full flex items-center justify-center">ğŸª</div>
                                )}
                              </div>
                              <div>
                                <p className="font-semibold text-sm">{r.name}</p>
                                <p className="text-xs text-gray-500">{r.city || 'Ø¨Ø¯ÙˆÙ† Ù…Ø¯ÙŠÙ†Ø©'}</p>
                              </div>
                            </div>
                          ))}
                        </div>
                      ) : (
                        <p className="text-gray-500 text-sm">Ù„Ù… ÙŠØ¶Ù Ø£ÙŠ Ù…Ø·Ø§Ø¹Ù… Ø¨Ø¹Ø¯</p>
                      )}
                      
                      {/* Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª */}
                      <div className="mt-4 pt-3 border-t">
                        <div className="grid grid-cols-3 gap-3 text-center">
                          <div className="bg-green-100 rounded-lg p-2">
                            <p className="font-bold text-green-700">{admin.walletBalance.toFixed(2)}</p>
                            <p className="text-xs text-gray-600">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                          </div>
                          <div className="bg-blue-100 rounded-lg p-2">
                            <p className="font-bold text-blue-700">{admin.totalEarnings.toFixed(2)}</p>
                            <p className="text-xs text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</p>
                          </div>
                          <div className="bg-purple-100 rounded-lg p-2">
                            <p className="font-bold text-purple-700">
                              {orders.filter(o => o.referredBy === admin.uid).length}
                            </p>
                            <p className="text-xs text-gray-600">Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ù…Ø·Ø§Ø¹Ù…Ù‡</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              ))}
              
              {admins.length === 0 && (
                <div className="text-center py-12 text-gray-500 bg-white rounded-2xl">
                  Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø±ÙÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†
                </div>
              )}
            </div>
          </div>
        )}

        {/* ===== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===== */}
        {activeTab === 'settings' && (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <h2 className="text-xl font-bold">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h2>
              {!editingSettings ? (
                <button
                  onClick={() => setEditingSettings(true)}
                  className="bg-primary hover:bg-sky-600 text-white px-4 py-2 rounded-xl"
                >
                  âœï¸ ØªØ¹Ø¯ÙŠÙ„
                </button>
              ) : (
                <div className="flex gap-2">
                  <button
                    onClick={() => { setEditingSettings(false); setSettingsForm(settings) }}
                    className="bg-gray-500 text-white px-4 py-2 rounded-xl"
                  >
                    Ø¥Ù„ØºØ§Ø¡
                  </button>
                  <button
                    onClick={handleSaveSettings}
                    className="bg-green-600 text-white px-4 py-2 rounded-xl"
                  >
                    ğŸ’¾ Ø­ÙØ¸
                  </button>
                </div>
              )}
            </div>
            
            <div className="bg-white rounded-2xl shadow p-6">
              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                {/* Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ */}
                <div>
                  <label className="text-sm text-gray-600 block mb-1">ğŸ’° Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ (Ø±.Ø³)</label>
                  {editingSettings ? (
                    <input
                      type="number"
                      value={settingsForm.deliveryFee || 0}
                      onChange={e => setSettingsForm({ ...settingsForm, deliveryFee: Number(e.target.value) })}
                      className="w-full border rounded-xl p-3"
                    />
                  ) : (
                    <p className="text-2xl font-bold">{settings.deliveryFee || 7} Ø±.Ø³</p>
                  )}
                </div>

                {/* Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */}
                <div>
                  <label className="text-sm text-gray-600 block mb-1">ğŸ’µ Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ / Ù…Ù†ØªØ¬ (Ø±.Ø³)</label>
                  {editingSettings ? (
                    <input
                      type="number"
                      step="0.1"
                      value={settingsForm.platformFee || 1.0}
                      onChange={e => setSettingsForm({ ...settingsForm, platformFee: Number(e.target.value) })}
                      className="w-full border rounded-xl p-3"
                    />
                  ) : (
                    <p className="text-2xl font-bold">{settings.platformFee || 1.0} Ø±.Ø³/Ù…Ù†ØªØ¬</p>
                  )}
                </div>

                {/* Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø´Ø±Ù */}
                <div>
                  <label className="text-sm text-gray-600 block mb-1">ğŸ‘‘ Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø´Ø±Ù / Ù…Ù†ØªØ¬ (Ø±.Ø³)</label>
                  {editingSettings ? (
                    <input
                      type="number"
                      step="0.05"
                      value={settingsForm.adminCommissionRate || 0.75}
                      onChange={e => setSettingsForm({ ...settingsForm, adminCommissionRate: Number(e.target.value) })}
                      className="w-full border rounded-xl p-3"
                    />
                  ) : (
                    <p className="text-2xl font-bold">{settings.adminCommissionRate || 0.75} Ø±.Ø³/Ù…Ù†ØªØ¬</p>
                  )}
                </div>

                {/* Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø·Ù„Ø¨ */}
                <div>
                  <label className="text-sm text-gray-600 block mb-1">ğŸ›’ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø·Ù„Ø¨</label>
                  {editingSettings ? (
                    <input
                      type="number"
                      value={settingsForm.minOrderAmount || 0}
                      onChange={e => setSettingsForm({ ...settingsForm, minOrderAmount: Number(e.target.value) })}
                      className="w-full border rounded-xl p-3"
                    />
                  ) : (
                    <p className="text-2xl font-bold">{settings.minOrderAmount || 20} Ø±.Ø³</p>
                  )}
                </div>

                {/* Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ */}
                <div>
                  <label className="text-sm text-gray-600 block mb-1">ğŸ• Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</label>
                  {editingSettings ? (
                    <div className="flex gap-2">
                      <input
                        type="time"
                        value={settingsForm.workingHours?.open || '09:00'}
                        onChange={e => setSettingsForm({ ...settingsForm, workingHours: { ...settingsForm.workingHours!, open: e.target.value } })}
                        className="flex-1 border rounded-xl p-3"
                      />
                      <input
                        type="time"
                        value={settingsForm.workingHours?.close || '23:00'}
                        onChange={e => setSettingsForm({ ...settingsForm, workingHours: { ...settingsForm.workingHours!, close: e.target.value } })}
                        className="flex-1 border rounded-xl p-3"
                      />
                    </div>
                  ) : (
                    <p className="text-2xl font-bold">
                      {settings.workingHours?.open || '09:00'} - {settings.workingHours?.close || '23:00'}
                    </p>
                  )}
                </div>

                {/* ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© */}
                <div>
                  <label className="text-sm text-gray-600 block mb-1">ğŸ”§ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©</label>
                  {editingSettings ? (
                    <label className="flex items-center gap-2 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={settingsForm.maintenanceMode || false}
                        onChange={e => setSettingsForm({ ...settingsForm, maintenanceMode: e.target.checked })}
                        className="w-6 h-6"
                      />
                      <span className="text-lg">{settingsForm.maintenanceMode ? 'Ù…ÙØ¹Ù‘Ù„' : 'Ù…Ø¹Ø·Ù‘Ù„'}</span>
                    </label>
                  ) : (
                    <p className={`text-2xl font-bold ${settings.maintenanceMode ? 'text-red-600' : 'text-green-600'}`}>
                      {settings.maintenanceMode ? 'ğŸ”´ Ù…ÙØ¹Ù‘Ù„' : 'ğŸŸ¢ Ù…Ø¹Ø·Ù‘Ù„'}
                    </p>
                  )}
                </div>
              </div>
            </div>

            {/* Ø´Ø±Ø­ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª */}
            <div className="bg-sky-50 border-l-4 border-sky-500 rounded-lg p-6">
              <h3 className="font-bold text-sky-900 mb-3">ğŸ’° Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª (Ù„ÙƒÙ„ Ù…Ù†ØªØ¬ = 1.75 Ø±.Ø³):</h3>
              <div className="text-sky-800 space-y-2">
                <p>â€¢ <strong>Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:</strong> {settings.platformFee || 1.0} Ø±.Ø³ Ã— Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
                <p>â€¢ <strong>Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø´Ø±Ù:</strong> {settings.adminCommissionRate || 0.75} Ø±.Ø³ Ã— Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
                <div className="bg-white rounded-xl p-4 mt-3">
                  <p className="font-bold mb-2">ğŸ“ Ù…Ø«Ø§Ù„: Ø·Ù„Ø¨ ÙÙŠÙ‡ 5 Ù…Ù†ØªØ¬Ø§Øª</p>
                  <p>â€¢ <strong>Ø¥Ø°Ø§ Ø§Ù„Ù…Ø·Ø¹Ù… Ù…Ø¶Ø§Ù Ù…Ù† Ù…Ø´Ø±Ù:</strong></p>
                  <ul className="mr-6 list-disc text-sm">
                    <li>Ø§Ù„Ù…Ø´Ø±Ù ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰: 5 Ã— {settings.adminCommissionRate || 0.75} = <strong>{(5 * (settings.adminCommissionRate || 0.75)).toFixed(2)} Ø±.Ø³</strong></li>
                    <li>Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰: 5 Ã— {settings.platformFee || 1.0} = <strong>{(5 * (settings.platformFee || 1.0)).toFixed(2)} Ø±.Ø³</strong></li>
                    <li className="text-green-700">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <strong>{(5 * 1.75).toFixed(2)} Ø±.Ø³</strong></li>
                  </ul>
                  <p className="mt-2">â€¢ <strong>Ø¥Ø°Ø§ Ø§Ù„Ù…Ø·Ø¹Ù… Ù…Ø¶Ø§Ù Ù…Ù† Ø§Ù„Ù…Ø·ÙˆØ±:</strong></p>
                  <ul className="mr-6 list-disc text-sm">
                    <li>Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø´ÙŠØ¡: 5 Ã— 1.75 = <strong>{(5 * 1.75).toFixed(2)} Ø±.Ø³</strong></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* ===== Ø§Ù„Ù…Ù‡Ø§Ù… ===== */}
        {activeTab === 'tasks' && (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <h2 className="text-xl font-bold">ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>
              <button
                onClick={() => setShowAddTask(true)}
                className="flex items-center gap-2 bg-primary hover:bg-sky-600 text-white px-4 py-2 rounded-xl font-semibold transition"
              >
                <Plus className="w-5 h-5" />
                Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©
              </button>
            </div>

            {/* ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */}
            <div className="flex flex-wrap gap-2">
              {(['all', 'pending', 'in_progress', 'completed', 'cancelled'] as const).map(filter => (
                <button
                  key={filter}
                  onClick={() => setTaskFilter(filter)}
                  className={`px-4 py-2 rounded-xl font-semibold transition ${
                    taskFilter === filter
                      ? 'bg-primary text-white'
                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  {filter === 'all' && 'ğŸ“‹ Ø§Ù„ÙƒÙ„'}
                  {filter === 'pending' && 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}
                  {filter === 'in_progress' && 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°'}
                  {filter === 'completed' && 'âœ… Ù…ÙƒØªÙ…Ù„Ø©'}
                  {filter === 'cancelled' && 'âŒ Ù…Ù„ØºØ§Ø©'}
                </button>
              ))}
            </div>

            {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ø§Ù… */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="bg-yellow-50 rounded-xl p-4 text-center">
                <p className="text-2xl font-bold text-yellow-600">
                  {tasks.filter(t => t.status === 'pending').length}
                </p>
                <p className="text-sm text-yellow-700">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>
              </div>
              <div className="bg-blue-50 rounded-xl p-4 text-center">
                <p className="text-2xl font-bold text-blue-600">
                  {tasks.filter(t => t.status === 'in_progress').length}
                </p>
                <p className="text-sm text-blue-700">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°</p>
              </div>
              <div className="bg-green-50 rounded-xl p-4 text-center">
                <p className="text-2xl font-bold text-green-600">
                  {tasks.filter(t => t.status === 'completed').length}
                </p>
                <p className="text-sm text-green-700">Ù…ÙƒØªÙ…Ù„Ø©</p>
              </div>
              <div className="bg-red-50 rounded-xl p-4 text-center">
                <p className="text-2xl font-bold text-red-600">
                  {tasks.filter(t => t.status === 'cancelled').length}
                </p>
                <p className="text-sm text-red-700">Ù…Ù„ØºØ§Ø©</p>
              </div>
            </div>

            {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */}
            <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
              {tasks
                .filter(t => taskFilter === 'all' || t.status === taskFilter)
                .length === 0 ? (
                <div className="p-8 text-center text-gray-500">
                  <p className="text-4xl mb-2">ğŸ“‹</p>
                  <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… {taskFilter !== 'all' && 'ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©'}</p>
                </div>
              ) : (
                <div className="divide-y">
                  {tasks
                    .filter(t => taskFilter === 'all' || t.status === taskFilter)
                    .map(task => {
                      const admin = users.find(u => u.uid === task.assignedTo)
                      return (
                        <div key={task.id} className="p-4 hover:bg-gray-50">
                          <div className="flex items-start justify-between gap-4">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-1">
                                <span className={`px-2 py-0.5 rounded text-xs font-semibold ${
                                  task.priority === 'high' ? 'bg-red-100 text-red-700' :
                                  task.priority === 'medium' ? 'bg-yellow-100 text-yellow-700' :
                                  'bg-gray-100 text-gray-700'
                                }`}>
                                  {task.priority === 'high' ? 'ğŸ”´ Ø¹Ø§Ù„ÙŠØ©' : task.priority === 'medium' ? 'ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø©' : 'âšª Ù…Ù†Ø®ÙØ¶Ø©'}
                                </span>
                                <span className={`px-2 py-0.5 rounded text-xs font-semibold ${
                                  task.status === 'pending' ? 'bg-yellow-100 text-yellow-700' :
                                  task.status === 'in_progress' ? 'bg-blue-100 text-blue-700' :
                                  task.status === 'completed' ? 'bg-green-100 text-green-700' :
                                  'bg-red-100 text-red-700'
                                }`}>
                                  {task.status === 'pending' && 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}
                                  {task.status === 'in_progress' && 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°'}
                                  {task.status === 'completed' && 'âœ… Ù…ÙƒØªÙ…Ù„Ø©'}
                                  {task.status === 'cancelled' && 'âŒ Ù…Ù„ØºØ§Ø©'}
                                </span>
                              </div>
                              <h3 className="font-bold text-gray-800">{task.title}</h3>
                              {task.description && (
                                <p className="text-sm text-gray-600 mt-1">{task.description}</p>
                              )}
                              <div className="flex flex-wrap gap-3 mt-2 text-xs text-gray-500">
                                <span>ğŸ‘¤ {admin?.name || task.assignedToName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                                {task.dueDate && (
                                  <span>ğŸ“… {new Date(task.dueDate).toLocaleDateString('ar-SA')}</span>
                                )}
                                <span>ğŸ• {task.createdAt?.toDate?.()?.toLocaleDateString('ar-SA') || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                              </div>
                              {task.notes && (
                                <p className="text-sm text-gray-500 mt-2 bg-gray-50 p-2 rounded">ğŸ’¬ {task.notes}</p>
                              )}
                            </div>
                            <div className="flex flex-col gap-2">
                              {task.status === 'pending' && (
                                <button
                                  onClick={async () => {
                                    try {
                                      await updateDoc(doc(db, 'tasks', task.id), {
                                        status: 'in_progress',
                                        updatedAt: serverTimestamp()
                                      })
                                      toast.success('ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©')
                                      loadData()
                                    } catch (err) {
                                      toast.error('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø©')
                                    }
                                  }}
                                  className="text-blue-600 hover:bg-blue-50 p-2 rounded-lg transition"
                                  title="Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©"
                                >
                                  â–¶ï¸
                                </button>
                              )}
                              {(task.status === 'pending' || task.status === 'in_progress') && (
                                <>
                                  <button
                                    onClick={async () => {
                                      try {
                                        await updateDoc(doc(db, 'tasks', task.id), {
                                          status: 'completed',
                                          completedAt: serverTimestamp(),
                                          updatedAt: serverTimestamp()
                                        })
                                        toast.success('ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©')
                                        loadData()
                                      } catch (err) {
                                        toast.error('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø©')
                                      }
                                    }}
                                    className="text-green-600 hover:bg-green-50 p-2 rounded-lg transition"
                                    title="Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©"
                                  >
                                    âœ…
                                  </button>
                                  <button
                                    onClick={async () => {
                                      const confirmed = await dialog.confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ', { dangerous: true })
                                      if (!confirmed) return
                                      try {
                                        await updateDoc(doc(db, 'tasks', task.id), {
                                          status: 'cancelled',
                                          updatedAt: serverTimestamp()
                                        })
                                        toast.success('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©')
                                        loadData()
                                      } catch (err) {
                                        toast.error('ÙØ´Ù„ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©')
                                      }
                                    }}
                                    className="text-red-600 hover:bg-red-50 p-2 rounded-lg transition"
                                    title="Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©"
                                  >
                                    âŒ
                                  </button>
                                </>
                              )}
                              <button
                                onClick={async () => {
                                  const confirmed = await dialog.confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ', { dangerous: true })
                                  if (!confirmed) return
                                  try {
                                    await deleteDoc(doc(db, 'tasks', task.id))
                                    toast.success('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©')
                                    loadData()
                                  } catch (err) {
                                    toast.error('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©')
                                  }
                                }}
                                className="text-gray-400 hover:text-red-600 hover:bg-red-50 p-2 rounded-lg transition"
                                title="Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©"
                              >
                                ğŸ—‘ï¸
                              </button>
                            </div>
                          </div>
                        </div>
                      )
                    })}
                </div>
              )}
            </div>

            {/* Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© */}
            {showAddTask && (
              <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                <div className="bg-white rounded-2xl w-full max-w-lg p-6">
                  <h3 className="text-xl font-bold mb-4">ğŸ“‹ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-semibold mb-1">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø© *</label>
                      <input
                        type="text"
                        value={newTaskTitle}
                        onChange={e => setNewTaskTitle(e.target.value)}
                        className="w-full border rounded-xl px-4 py-2"
                        placeholder="Ù…Ø«Ø§Ù„: Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-semibold mb-1">Ø§Ù„ÙˆØµÙ</label>
                      <textarea
                        value={newTaskDescription}
                        onChange={e => setNewTaskDescription(e.target.value)}
                        className="w-full border rounded-xl px-4 py-2 h-24"
                        placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©..."
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-semibold mb-1">ØªØ¹ÙŠÙŠÙ† Ø¥Ù„Ù‰ *</label>
                      <select
                        value={newTaskAssignedTo}
                        onChange={e => setNewTaskAssignedTo(e.target.value)}
                        className="w-full border rounded-xl px-4 py-2"
                      >
                        <option value="">-- Ø§Ø®ØªØ± Ù…Ø´Ø±Ù --</option>
                        {users
                          .filter(u => u.role === 'admin')
                          .map(admin => (
                            <option key={admin.uid} value={admin.uid}>
                              {admin.name || admin.email}
                            </option>
                          ))}
                      </select>
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-semibold mb-1">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                        <select
                          value={newTaskPriority}
                          onChange={e => setNewTaskPriority(e.target.value as 'low' | 'medium' | 'high')}
                          className="w-full border rounded-xl px-4 py-2"
                        >
                          <option value="low">âšª Ù…Ù†Ø®ÙØ¶Ø©</option>
                          <option value="medium">ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø©</option>
                          <option value="high">ğŸ”´ Ø¹Ø§Ù„ÙŠØ©</option>
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</label>
                        <input
                          type="date"
                          value={newTaskDueDate}
                          onChange={e => setNewTaskDueDate(e.target.value)}
                          className="w-full border rounded-xl px-4 py-2"
                        />
                      </div>
                    </div>
                  </div>
                  <div className="flex gap-3 mt-6">
                    <button
                      onClick={() => {
                        setShowAddTask(false)
                        setNewTaskTitle('')
                        setNewTaskDescription('')
                        setNewTaskAssignedTo('')
                        setNewTaskPriority('medium')
                        setNewTaskDueDate('')
                      }}
                      className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 rounded-xl font-semibold transition"
                    >
                      Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button
                      onClick={async () => {
                        if (!newTaskTitle.trim() || !newTaskAssignedTo) {
                          toast.error('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©')
                          return
                        }
                        setCreatingTask(true)
                        try {
                          const assignedAdmin = users.find(u => u.uid === newTaskAssignedTo)
                          await addDoc(collection(db, 'tasks'), {
                            title: newTaskTitle.trim(),
                            description: newTaskDescription.trim(),
                            assignedTo: newTaskAssignedTo,
                            assignedToName: assignedAdmin?.name || assignedAdmin?.email || '',
                            status: 'pending',
                            priority: newTaskPriority,
                            dueDate: newTaskDueDate || null,
                            createdBy: user?.uid,
                            createdAt: serverTimestamp(),
                            updatedAt: serverTimestamp(),
                            completedAt: null,
                            notes: ''
                          })
                          toast.success('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­')
                          setShowAddTask(false)
                          setNewTaskTitle('')
                          setNewTaskDescription('')
                          setNewTaskAssignedTo('')
                          setNewTaskPriority('medium')
                          setNewTaskDueDate('')
                          loadData()
                        } catch (err) {
                          console.error(err)
                          toast.error('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©')
                        } finally {
                          setCreatingTask(false)
                        }
                      }}
                      disabled={creatingTask}
                      className="flex-1 bg-primary hover:bg-sky-600 text-white py-2 rounded-xl font-semibold transition disabled:opacity-50"
                    >
                      {creatingTask ? 'Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...' : 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©'}
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        )}

        {/* ===== Ø§Ù„Ø£Ø¯ÙˆØ§Øª ===== */}
        {activeTab === 'tools' && (
          <div className="space-y-6">
            <h2 className="text-xl font-bold">ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>

            {/* Ø£Ø¯ÙˆØ§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */}
            <div className="bg-white rounded-2xl shadow-lg p-6">
              <h3 className="text-lg font-bold mb-4">ğŸ“Š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                {/* ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */}
                <button
                  onClick={() => {
                    const data = {
                      exportDate: new Date().toISOString(),
                      users: users.length,
                      restaurants: restaurants.length,
                      orders: orders.length,
                      admins: admins.length,
                      stats,
                      settings,
                    }
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' })
                    const url = URL.createObjectURL(blob)
                    const a = document.createElement('a')
                    a.href = url
                    a.download = `app-data-${new Date().toISOString().split('T')[0]}.json`
                    a.click()
                    toast.success('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­')
                  }}
                  className="flex items-center gap-3 bg-blue-100 hover:bg-blue-200 text-blue-800 p-4 rounded-xl transition"
                >
                  <span className="text-2xl">ğŸ“¥</span>
                  <div className="text-right">
                    <p className="font-bold">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                    <p className="text-xs opacity-75">ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ø®Øµ JSON</p>
                  </div>
                </button>

                {/* ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª */}
                <button
                  onClick={() => {
                    const csv = [
                      ['Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨', 'Ø§Ù„Ù…Ø·Ø¹Ù…', 'Ø§Ù„Ù…Ø¨Ù„Øº', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®'].join(','),
                      ...orders.map(o => [
                        o.id.slice(-8),
                        o.restaurantName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        o.total,
                        o.status,
                        o.createdAt?.toDate?.()?.toLocaleDateString('ar-SA') || ''
                      ].join(','))
                    ].join('\n')
                    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8' })
                    const url = URL.createObjectURL(blob)
                    const a = document.createElement('a')
                    a.href = url
                    a.download = `orders-${new Date().toISOString().split('T')[0]}.csv`
                    a.click()
                    toast.success('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨Ù†Ø¬Ø§Ø­')
                  }}
                  className="flex items-center gap-3 bg-green-100 hover:bg-green-200 text-green-800 p-4 rounded-xl transition"
                >
                  <span className="text-2xl">ğŸ“‹</span>
                  <div className="text-right">
                    <p className="font-bold">ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                    <p className="text-xs opacity-75">Ù…Ù„Ù CSV Ù„Ù„Ø¥ÙƒØ³Ù„</p>
                  </div>
                </button>

                {/* ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† */}
                <button
                  onClick={() => {
                    const csv = [
                      ['Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„', 'Ø§Ù„Ø¯ÙˆØ±', 'Ø§Ù„Ù‡Ø§ØªÙ'].join(','),
                      ...users.map(u => [
                        u.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…',
                        u.email,
                        u.role,
                        u.phone || ''
                      ].join(','))
                    ].join('\n')
                    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8' })
                    const url = URL.createObjectURL(blob)
                    const a = document.createElement('a')
                    a.href = url
                    a.download = `users-${new Date().toISOString().split('T')[0]}.csv`
                    a.click()
                    toast.success('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­')
                  }}
                  className="flex items-center gap-3 bg-purple-100 hover:bg-purple-200 text-purple-800 p-4 rounded-xl transition"
                >
                  <span className="text-2xl">ğŸ‘¥</span>
                  <div className="text-right">
                    <p className="font-bold">ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                    <p className="text-xs opacity-75">Ù…Ù„Ù CSV Ù„Ù„Ø¥ÙƒØ³Ù„</p>
                  </div>
                </button>
              </div>
            </div>

            {/* Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© */}
            <div className="bg-white rounded-2xl shadow-lg p-6">
              <h3 className="text-lg font-bold mb-4">ğŸ”§ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</h3>
              <div className="grid md:grid-cols-2 gap-4">
                {/* Ø¥Ù„ØºØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© */}
                <button
                  onClick={async () => {
                    const pendingOrders = orders.filter(o => o.status === 'pending')
                    if (pendingOrders.length === 0) {
                      toast.info('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©')
                      return
                    }
                    const confirmed = await dialog.confirm(
                      `Ø³ÙŠØªÙ… Ø¥Ù„ØºØ§Ø¡ ${pendingOrders.length} Ø·Ù„Ø¨ Ù…Ø¹Ù„Ù‚. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ`,
                      { title: 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©', dangerous: true }
                    )
                    if (!confirmed) return
                    try {
                      await Promise.all(pendingOrders.map(o => 
                        updateDoc(doc(db, 'orders', o.id), { status: 'cancelled', updatedAt: serverTimestamp() })
                      ))
                      toast.success(`ØªÙ… Ø¥Ù„ØºØ§Ø¡ ${pendingOrders.length} Ø·Ù„Ø¨`)
                      loadData()
                    } catch (err) {
                      toast.error('ÙØ´Ù„ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª')
                    }
                  }}
                  className="flex items-center gap-3 bg-yellow-100 hover:bg-yellow-200 text-yellow-800 p-4 rounded-xl transition"
                >
                  <span className="text-2xl">â³</span>
                  <div className="text-right">
                    <p className="font-bold">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</p>
                    <p className="text-xs opacity-75">{orders.filter(o => o.status === 'pending').length} Ø·Ù„Ø¨ Ù…Ø¹Ù„Ù‚</p>
                  </div>
                </button>

                {/* ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© */}
                <button
                  onClick={async () => {
                    const oldDate = new Date()
                    oldDate.setMonth(oldDate.getMonth() - 3)
                    const oldOrders = orders.filter(o => {
                      const orderDate = o.createdAt?.toDate?.() || new Date()
                      return orderDate < oldDate && (o.status === 'delivered' || o.status === 'cancelled')
                    })
                    if (oldOrders.length === 0) {
                      toast.info('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©')
                      return
                    }
                    const confirmed = await dialog.confirm(
                      `Ø³ÙŠØªÙ… Ø­Ø°Ù ${oldOrders.length} Ø·Ù„Ø¨ Ù‚Ø¯ÙŠÙ… (Ø£ÙƒØ«Ø± Ù…Ù† 3 Ø£Ø´Ù‡Ø±). Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ`,
                      { title: 'Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©', dangerous: true }
                    )
                    if (!confirmed) return
                    try {
                      await Promise.all(oldOrders.map(o => deleteDoc(doc(db, 'orders', o.id))))
                      toast.success(`ØªÙ… Ø­Ø°Ù ${oldOrders.length} Ø·Ù„Ø¨ Ù‚Ø¯ÙŠÙ…`)
                      loadData()
                    } catch (err) {
                      toast.error('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨Ø§Øª')
                    }
                  }}
                  className="flex items-center gap-3 bg-orange-100 hover:bg-orange-200 text-orange-800 p-4 rounded-xl transition"
                >
                  <span className="text-2xl">ğŸ—‘ï¸</span>
                  <div className="text-right">
                    <p className="font-bold">ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</p>
                    <p className="text-xs opacity-75">Ø­Ø°Ù Ø£Ù‚Ø¯Ù… Ù…Ù† 3 Ø£Ø´Ù‡Ø±</p>
                  </div>
                </button>
              </div>
            </div>

            {/* Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø© */}
            <div className="bg-white rounded-2xl shadow-lg p-6">
              <h3 className="text-lg font-bold mb-4">ğŸ”— Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</h3>
              <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                <a
                  href={`https://console.firebase.google.com/project/${firebaseConfig.projectId}/firestore`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center gap-3 bg-blue-50 hover:bg-blue-100 text-blue-800 p-4 rounded-xl transition"
                >
                  <span className="text-2xl">ğŸ“Š</span>
                  <span className="font-semibold">Firestore</span>
                </a>
                <a
                  href={`https://console.firebase.google.com/project/${firebaseConfig.projectId}/authentication/users`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center gap-3 bg-green-50 hover:bg-green-100 text-green-800 p-4 rounded-xl transition"
                >
                  <span className="text-2xl">ğŸ”</span>
                  <span className="font-semibold">Authentication</span>
                </a>
                <a
                  href={`https://console.firebase.google.com/project/${firebaseConfig.projectId}/storage`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center gap-3 bg-purple-50 hover:bg-purple-100 text-purple-800 p-4 rounded-xl transition"
                >
                  <span className="text-2xl">ğŸ“</span>
                  <span className="font-semibold">Storage</span>
                </a>
                <a
                  href={`https://console.firebase.google.com/project/${firebaseConfig.projectId}/hosting`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center gap-3 bg-orange-50 hover:bg-orange-100 text-orange-800 p-4 rounded-xl transition"
                >
                  <span className="text-2xl">ğŸŒ</span>
                  <span className="font-semibold">Hosting</span>
                </a>
              </div>
            </div>

            {/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… */}
            <div className="bg-gray-50 rounded-2xl p-6">
              <h3 className="text-lg font-bold mb-4">â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
              <div className="grid md:grid-cols-2 gap-4 text-sm">
                <div>
                  <p className="text-gray-500">Project ID</p>
                  <p className="font-mono">{firebaseConfig.projectId}</p>
                </div>
                <div>
                  <p className="text-gray-500">Storage Bucket</p>
                  <p className="font-mono">{firebaseConfig.storageBucket}</p>
                </div>
                <div>
                  <p className="text-gray-500">Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</p>
                  <p className="font-bold">{settings.appVersion || '1.0.0'}</p>
                </div>
                <div>
                  <p className="text-gray-500">ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©</p>
                  <p className={`font-bold ${settings.maintenanceMode ? 'text-red-600' : 'text-green-600'}`}>
                    {settings.maintenanceMode ? 'ğŸ”´ Ù…ÙØ¹Ù‘Ù„' : 'ğŸŸ¢ Ù…Ø¹Ø·Ù‘Ù„'}
                  </p>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* ===== Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ ===== */}
        {activeTab === 'licenses' && (
          <LicensesReviewSection 
            restaurants={restaurants} 
            onUpdate={handleRefresh}
            toast={toast}
            dialog={dialog}
          />
        )}

        {/* ===== Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø§Øª ===== */}
        {activeTab === 'packages' && (
          <PackageRequestsSection
            packageRequests={packageRequests}
            onUpdate={handleRefresh}
            toast={toast}
            dialog={dialog}
            storage={storage}
          />
        )}

        {/* ===== Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø± ===== */}
        {activeTab === 'storeAnalytics' && (
          <StoreAnalyticsSection
            restaurants={restaurants}
            orders={orders}
            toast={toast}
          />
        )}

        {/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… */}
        <div className="bg-gray-100 rounded-2xl p-4 text-sm">
          <div className="flex flex-wrap gap-4 text-gray-600">
            <span>ğŸ“§ {user?.email}</span>
            <span>ğŸ†” {user?.uid.slice(0, 12)}...</span>
            <span>ğŸ“… {new Date().toLocaleDateString('ar-SA')}</span>
          </div>
        </div>
      </div>
    </RoleGate>
  )
}

export default Developer

// ===== Ù…ÙƒÙˆÙ† Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ =====
type LicenseRestaurant = {
  id: string
  name: string
  ownerId: string
  email?: string
  phone?: string
  city?: string
  commercialLicenseUrl?: string
  licenseStatus?: 'pending' | 'approved' | 'rejected'
  licenseNotes?: string
}

const LicensesReviewSection: React.FC<{
  restaurants: any[]
  onUpdate: () => void
  toast: any
  dialog: any
}> = ({ restaurants, onUpdate, toast, dialog }) => {
  const [filter, setFilter] = useState<'all' | 'pending' | 'approved' | 'rejected' | 'missing' | 'sent_messages'>('pending')
  const [reviewNotes, setReviewNotes] = useState<Record<string, string>>({})
  const [updating, setUpdating] = useState<string | null>(null)
  const [messageText, setMessageText] = useState('')
  const [sendingTo, setSendingTo] = useState<string | null>(null)
  const [selectedMissing, setSelectedMissing] = useState<Set<string>>(new Set())
  const [bulkMessage, setBulkMessage] = useState('')
  
  // Ø³Ø¬Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©
  const [sentMessages, setSentMessages] = useState<any[]>([])
  const [loadingMessages, setLoadingMessages] = useState(false)
  const [sendingBulk, setSendingBulk] = useState(false)

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨
  useEffect(() => {
    if (filter === 'sent_messages' && sentMessages.length === 0) {
      loadSentMessages()
    }
  }, [filter])

  const loadSentMessages = async () => {
    setLoadingMessages(true)
    try {
      const q = query(
        collection(db, 'notifications'),
        where('type', '==', 'license_reminder'),
        orderBy('createdAt', 'desc'),
        limit(100)
      )
      const snap = await getDocs(q)
      const messages = snap.docs.map(d => ({
        id: d.id,
        ...d.data(),
        createdAt: d.data().createdAt?.toDate?.() || null,
      }))
      setSentMessages(messages)
    } catch (err: any) {
      console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:', err)
      // Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„ÙÙ‡Ø±Ø³ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
      toast.warning('ØªØ­ØªØ§Ø¬ Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙÙ‡Ø±Ø³ Ù…Ø±ÙƒØ¨ Ù„Ù€ notifications (type + createdAt)')
    } finally {
      setLoadingMessages(false)
    }
  }

  // Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„ØªÙŠ Ù„Ø¯ÙŠÙ‡Ø§ ØªØ±Ø§Ø®ÙŠØµ
  const restaurantsWithLicenses = restaurants.filter(
    (r: LicenseRestaurant) => r.commercialLicenseUrl
  ) as LicenseRestaurant[]

  // Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„ØªÙŠ Ù„Ù… ØªØ±ÙØ¹ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ
  const restaurantsWithoutLicenses = restaurants.filter(
    (r: LicenseRestaurant) => !r.commercialLicenseUrl
  ) as LicenseRestaurant[]

  // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
  const filteredRestaurants = restaurantsWithLicenses.filter((r: LicenseRestaurant) => {
    if (filter === 'all') return true
    if (filter === 'missing') return false // ÙŠØªÙ… Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ù‚Ø³Ù… Ù…Ù†ÙØµÙ„
    if (filter === 'sent_messages') return false // Ù‚Ø³Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù†ÙØµÙ„
    return r.licenseStatus === filter || (!r.licenseStatus && filter === 'pending')
  })

  // Ø¹Ø¯Ø¯ ÙƒÙ„ Ø­Ø§Ù„Ø©
  const counts = {
    all: restaurantsWithLicenses.length,
    pending: restaurantsWithLicenses.filter(r => !r.licenseStatus || r.licenseStatus === 'pending').length,
    approved: restaurantsWithLicenses.filter(r => r.licenseStatus === 'approved').length,
    rejected: restaurantsWithLicenses.filter(r => r.licenseStatus === 'rejected').length,
    missing: restaurantsWithoutLicenses.length,
    sent_messages: sentMessages.length,
  }

  // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù…Ø·Ø¹Ù… ÙˆØ§Ø­Ø¯
  const sendMessageToRestaurant = async (restaurant: LicenseRestaurant, message: string) => {
    if (!message.trim()) {
      toast.warning('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©')
      return
    }

    setSendingTo(restaurant.id)
    try {
      await addDoc(collection(db, 'notifications'), {
        type: 'license_reminder',
        recipientId: restaurant.ownerId,
        recipientType: 'owner',
        restaurantId: restaurant.id,
        restaurantName: restaurant.name,
        title: 'âš ï¸ ØªØ°ÙƒÙŠØ±: Ø±ÙØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ',
        message: message,
        read: false,
        createdAt: serverTimestamp(),
      })
      toast.success(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù€ ${restaurant.name}`)
      setMessageText('')
    } catch (err: any) {
      toast.error('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ' + (err.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'))
    } finally {
      setSendingTo(null)
    }
  }

  // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©
  const sendBulkMessage = async () => {
    if (!bulkMessage.trim()) {
      toast.warning('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©')
      return
    }
    
    const targets = selectedMissing.size > 0 
      ? restaurantsWithoutLicenses.filter(r => selectedMissing.has(r.id))
      : restaurantsWithoutLicenses

    if (targets.length === 0) {
      toast.warning('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø·Ø§Ø¹Ù… Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©')
      return
    }

    const confirmed = await dialog.confirm(
      `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù€ ${targets.length} Ù…Ø·Ø¹Ù…ØŸ`,
      { title: 'Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©' }
    )
    if (!confirmed) return

    setSendingBulk(true)
    try {
      const promises = targets.map(restaurant => 
        addDoc(collection(db, 'notifications'), {
          type: 'license_reminder',
          recipientId: restaurant.ownerId,
          recipientType: 'owner',
          restaurantId: restaurant.id,
          restaurantName: restaurant.name,
          title: 'âš ï¸ ØªØ°ÙƒÙŠØ±: Ø±ÙØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ',
          message: bulkMessage,
          read: false,
          createdAt: serverTimestamp(),
        })
      )
      await Promise.all(promises)
      toast.success(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù€ ${targets.length} Ù…Ø·Ø¹Ù… Ø¨Ù†Ø¬Ø§Ø­ âœ“`)
      setBulkMessage('')
      setSelectedMissing(new Set())
    } catch (err: any) {
      toast.error('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ' + (err.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'))
    } finally {
      setSendingBulk(false)
    }
  }

  // ØªØ­Ø¯ÙŠØ¯/Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
  const toggleSelectAll = () => {
    if (selectedMissing.size === restaurantsWithoutLicenses.length) {
      setSelectedMissing(new Set())
    } else {
      setSelectedMissing(new Set(restaurantsWithoutLicenses.map(r => r.id)))
    }
  }

  // ØªØ¨Ø¯ÙŠÙ„ ØªØ­Ø¯ÙŠØ¯ Ù…Ø·Ø¹Ù…
  const toggleSelectRestaurant = (id: string) => {
    const newSet = new Set(selectedMissing)
    if (newSet.has(id)) {
      newSet.delete(id)
    } else {
      newSet.add(id)
    }
    setSelectedMissing(newSet)
  }

  // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ±Ø®ÙŠØµ
  const updateLicenseStatus = async (restaurantId: string, status: 'approved' | 'rejected') => {
    const notes = reviewNotes[restaurantId] || ''
    
    if (status === 'rejected' && !notes.trim()) {
      toast.warning('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶')
      return
    }

    const actionText = status === 'approved' ? 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰' : 'Ø±ÙØ¶'
    const confirmed = await dialog.confirm(
      `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ${actionText} ØªØ±Ø§Ø®ÙŠØµ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø·Ø¹Ù…ØŸ`,
      { title: `${actionText} Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ` }
    )
    if (!confirmed) return

    setUpdating(restaurantId)
    try {
      await updateDoc(doc(db, 'restaurants', restaurantId), {
        licenseStatus: status,
        licenseNotes: status === 'rejected' ? notes : '',
        updatedAt: serverTimestamp(),
      })
      toast.success(status === 'approved' ? 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ âœ“' : 'ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ')
      setReviewNotes(prev => ({ ...prev, [restaurantId]: '' }))
      onUpdate()
    } catch (err: any) {
      toast.error('ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«: ' + (err.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'))
    } finally {
      setUpdating(null)
    }
  }

  // Ø­Ø°Ù Ø§Ù„ØªØ±Ø®ÙŠØµ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±ÙØ¹
  const deleteLicenseAndNotify = async (restaurant: LicenseRestaurant, licenseType: 'commercial') => {
    const licenseText = 'Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ'
    
    const confirmed = await dialog.confirm(
      `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${licenseText} Ù„Ù€ "${restaurant.name}"ØŸ\nØ³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø·Ø¹Ù… Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø±ÙØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ.`,
      { title: `ğŸ—‘ï¸ Ø­Ø°Ù ${licenseText}` }
    )
    if (!confirmed) return

    setUpdating(restaurant.id)
    try {
      // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡Ø§
      const updateData: any = {
        licenseStatus: null,
        licenseNotes: '',
        updatedAt: serverTimestamp(),
        commercialLicenseUrl: null
      }

      // Ø­Ø°Ù Ø§Ù„ØªØ±Ø®ÙŠØµ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      await updateDoc(doc(db, 'restaurants', restaurant.id), updateData)

      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø·Ø¹Ù…
      await addDoc(collection(db, 'notifications'), {
        type: 'license_deleted',
        recipientId: restaurant.ownerId,
        recipientType: 'owner',
        restaurantId: restaurant.id,
        restaurantName: restaurant.name,
        title: `âš ï¸ ØªÙ… Ø­Ø°Ù ${licenseText}`,
        message: `ØªÙ… Ø­Ø°Ù ${licenseText} Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…Ø·Ø¹Ù…Ùƒ. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø±ÙØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ Ø§Ù„ØµØ­ÙŠØ­ Ù…Ù† ØµÙØ­Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù….`,
        read: false,
        createdAt: serverTimestamp(),
      })

      toast.success(`ØªÙ… Ø­Ø°Ù ${licenseText} ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø·Ø¹Ù… âœ“`)
      onUpdate()
    } catch (err: any) {
      toast.error('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„ØªØ±Ø®ÙŠØµ: ' + (err.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'))
    } finally {
      setUpdating(null)
    }
  }

  const statusBadge = (status?: string) => {
    switch (status) {
      case 'approved':
        return <span className="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-100 text-green-700 text-xs font-semibold"><CheckCircle className="w-3 h-3" /> Ù…ÙˆØ§ÙÙ‚</span>
      case 'rejected':
        return <span className="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-red-100 text-red-700 text-xs font-semibold"><AlertCircle className="w-3 h-3" /> Ù…Ø±ÙÙˆØ¶</span>
      default:
        return <span className="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-100 text-yellow-700 text-xs font-semibold"><Clock className="w-3 h-3" /> Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
    }
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between flex-wrap gap-4">
        <h2 className="text-xl font-bold flex items-center gap-2">
          <FileCheck className="w-6 h-6 text-sky-500" />
          Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ
        </h2>
        <div className="flex gap-2 flex-wrap">
          {(['pending', 'approved', 'rejected', 'all', 'missing', 'sent_messages'] as const).map(f => (
            <button
              key={f}
              onClick={() => setFilter(f)}
              className={`px-3 py-1.5 rounded-lg text-sm font-medium transition ${
                filter === f
                  ? f === 'missing' ? 'bg-orange-500 text-white' 
                    : f === 'sent_messages' ? 'bg-purple-500 text-white'
                    : 'bg-sky-500 text-white'
                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
              }`}
            >
              {f === 'all' && `Ø§Ù„ÙƒÙ„ (${counts.all})`}
              {f === 'pending' && `Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© (${counts.pending})`}
              {f === 'approved' && `Ù…ÙˆØ§ÙÙ‚ (${counts.approved})`}
              {f === 'rejected' && `Ù…Ø±ÙÙˆØ¶ (${counts.rejected})`}
              {f === 'missing' && `âš ï¸ Ù„Ù… ÙŠØ±ÙØ¹ (${counts.missing})`}
              {f === 'sent_messages' && `ğŸ“¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©`}
            </button>
          ))}
        </div>
      </div>

      {/* ===== Ù‚Ø³Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø© ===== */}
      {filter === 'sent_messages' && (
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <h3 className="font-bold text-purple-700 flex items-center gap-2">
              ğŸ“¨ Ø³Ø¬Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù„Ù„Ù…Ø·Ø§Ø¹Ù…
            </h3>
            <button
              onClick={loadSentMessages}
              disabled={loadingMessages}
              className="px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-xl font-medium transition disabled:opacity-50"
            >
              {loadingMessages ? 'â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...' : 'ğŸ”„ ØªØ­Ø¯ÙŠØ«'}
            </button>
          </div>

          {loadingMessages ? (
            <div className="text-center py-12">
              <div className="w-10 h-10 border-4 border-purple-200 border-t-purple-500 rounded-full animate-spin mx-auto mb-4" />
              <p className="text-gray-500">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...</p>
            </div>
          ) : sentMessages.length === 0 ? (
            <div className="text-center py-12 bg-gray-50 rounded-2xl">
              <p className="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ù…Ø±Ø³Ù„Ø© Ø¨Ø¹Ø¯</p>
              <p className="text-gray-400 text-sm mt-2">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙŠ ØªØ±Ø³Ù„Ù‡Ø§ Ù„Ù„Ù…Ø·Ø§Ø¹Ù… Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</p>
            </div>
          ) : (
            <div className="space-y-3">
              {sentMessages.map((msg: any) => (
                <div key={msg.id} className="bg-white rounded-xl shadow p-4 border-r-4 border-purple-500">
                  <div className="flex items-start justify-between gap-4">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-2">
                        <span className="font-bold text-gray-800">{msg.restaurantName || 'Ù…Ø·Ø¹Ù…'}</span>
                        {msg.read ? (
                          <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full">âœ“ Ù…Ù‚Ø±ÙˆØ¡Ø©</span>
                        ) : (
                          <span className="text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full">â³ Ù„Ù… ØªÙÙ‚Ø±Ø£</span>
                        )}
                      </div>
                      <p className="text-sm text-gray-600 font-semibold mb-1">{msg.title}</p>
                      <p className="text-gray-700 text-sm bg-gray-50 p-3 rounded-lg">{msg.message}</p>
                    </div>
                    <div className="text-left text-xs text-gray-400 whitespace-nowrap">
                      {msg.createdAt ? new Date(msg.createdAt).toLocaleDateString('ar-SA', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit',
                      }) : '-'}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      )}

      {/* Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„ØªÙŠ Ù„Ù… ØªØ±ÙØ¹ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ */}
      {filter === 'missing' && (
        <div className="space-y-4">
          {restaurantsWithoutLicenses.length === 0 ? (
            <div className="text-center py-12 text-gray-400">
              <CheckCircle className="w-16 h-16 mx-auto mb-4 text-green-400" />
              <p className="text-green-600 font-semibold">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø±ÙØ¹Øª ØªØ±Ø§Ø®ÙŠØµÙ‡Ø§ âœ“</p>
            </div>
          ) : (
            <>
              {/* Ø±Ø³Ø§Ù„Ø© Ø¬Ù…Ø§Ø¹ÙŠØ© */}
              <div className="bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200 rounded-2xl p-5">
                <h3 className="font-bold text-orange-800 mb-3 flex items-center gap-2">
                  ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©
                </h3>
                <div className="flex items-center gap-3 mb-3">
                  <label className="flex items-center gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      checked={selectedMissing.size === restaurantsWithoutLicenses.length}
                      onChange={toggleSelectAll}
                      className="w-5 h-5 rounded border-orange-300 text-orange-500 focus:ring-orange-500"
                    />
                    <span className="text-sm text-orange-700">
                      ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ({restaurantsWithoutLicenses.length})
                    </span>
                  </label>
                  {selectedMissing.size > 0 && (
                    <span className="text-sm bg-orange-200 text-orange-800 px-2 py-1 rounded-full">
                      Ù…Ø­Ø¯Ø¯: {selectedMissing.size}
                    </span>
                  )}
                </div>
                <textarea
                  placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ Ø³ØªØ±Ø³Ù„ Ù„Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© (Ø£Ùˆ Ø¬Ù…ÙŠØ¹Ù‡Ø§ Ø¥Ø°Ø§ Ù„Ù… ØªØ­Ø¯Ø¯)..."
                  value={bulkMessage}
                  onChange={(e) => setBulkMessage(e.target.value)}
                  className="w-full border border-orange-200 rounded-xl p-3 text-sm resize-none h-24 focus:ring-2 focus:ring-orange-400 focus:border-transparent"
                />
                <button
                  onClick={sendBulkMessage}
                  disabled={sendingBulk || !bulkMessage.trim()}
                  className="mt-3 w-full flex items-center justify-center gap-2 bg-orange-500 hover:bg-orange-600 text-white py-2.5 rounded-xl font-semibold transition disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {sendingBulk ? (
                    <>
                      <RefreshCw className="w-5 h-5 animate-spin" />
                      Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...
                    </>
                  ) : (
                    <>
                      ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù€ {selectedMissing.size > 0 ? selectedMissing.size : restaurantsWithoutLicenses.length} Ù…Ø·Ø¹Ù…
                    </>
                  )}
                </button>
              </div>

              {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù… */}
              <div className="grid gap-3">
                {restaurantsWithoutLicenses.map((r: LicenseRestaurant) => (
                  <div key={r.id} className="bg-white border rounded-2xl p-4 shadow-sm hover:shadow-md transition">
                    <div className="flex items-start gap-3">
                      <input
                        type="checkbox"
                        checked={selectedMissing.has(r.id)}
                        onChange={() => toggleSelectRestaurant(r.id)}
                        className="w-5 h-5 mt-1 rounded border-gray-300 text-orange-500 focus:ring-orange-500"
                      />
                      <div className="flex-1">
                        <div className="flex items-start justify-between gap-3 mb-2">
                          <div>
                            <h3 className="font-bold text-gray-800">{r.name}</h3>
                            <p className="text-sm text-gray-500">{r.city || 'Ø¨Ø¯ÙˆÙ† Ù…Ø¯ÙŠÙ†Ø©'}</p>
                          </div>
                          <span className="inline-flex items-center gap-1 px-2 py-1 rounded-full bg-orange-100 text-orange-700 text-xs font-semibold">
                            <AlertCircle className="w-3 h-3" />
                            Ù„Ù… ÙŠØ±ÙØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ
                          </span>
                        </div>
                        
                        {/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ */}
                        <div className="flex flex-wrap gap-3 text-sm text-gray-600 mb-3">
                          {r.email && <span>ğŸ“§ {r.email}</span>}
                          {r.phone && <span>ğŸ“± {r.phone}</span>}
                        </div>

                        {/* Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙØ±Ø¯ÙŠØ© */}
                        <div className="flex gap-2">
                          <input
                            type="text"
                            placeholder="Ø±Ø³Ø§Ù„Ø© Ø³Ø±ÙŠØ¹Ø©..."
                            value={sendingTo === r.id ? messageText : ''}
                            onChange={(e) => {
                              setSendingTo(r.id)
                              setMessageText(e.target.value)
                            }}
                            onFocus={() => setSendingTo(r.id)}
                            className="flex-1 border rounded-lg px-3 py-2 text-sm"
                          />
                          <button
                            onClick={() => sendMessageToRestaurant(r, messageText)}
                            disabled={sendingTo === r.id && !messageText.trim()}
                            className="px-4 py-2 bg-sky-500 hover:bg-sky-600 text-white rounded-lg text-sm font-medium transition disabled:opacity-50"
                          >
                            Ø¥Ø±Ø³Ø§Ù„
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </>
          )}
        </div>
      )}

      {filter !== 'missing' && filteredRestaurants.length === 0 ? (
        <div className="text-center py-12 text-gray-400">
          <FileCheck className="w-16 h-16 mx-auto mb-4 opacity-50" />
          <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ±Ø§Ø®ÙŠØµ {filter === 'pending' ? 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' : filter === 'approved' ? 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§' : filter === 'rejected' ? 'Ù…Ø±ÙÙˆØ¶Ø©' : ''}</p>
        </div>
      ) : filter !== 'missing' && (
        <div className="grid gap-4">
          {filteredRestaurants.map((r: LicenseRestaurant) => (
            <div key={r.id} className="bg-white border rounded-2xl p-5 shadow-sm">
              <div className="flex items-start justify-between gap-4 mb-4">
                <div>
                  <h3 className="font-bold text-lg">{r.name}</h3>
                  <p className="text-sm text-gray-500">{r.city || 'Ø¨Ø¯ÙˆÙ† Ù…Ø¯ÙŠÙ†Ø©'} â€¢ {r.email || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯'}</p>
                </div>
                {statusBadge(r.licenseStatus)}
              </div>

              {/* Ø¹Ø±Ø¶ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ */}
              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                {r.commercialLicenseUrl && (
                  <div className="bg-gray-50 rounded-xl p-3">
                    <div className="flex items-center justify-between mb-2">
                      <p className="text-sm font-semibold text-gray-700">ğŸ“œ Ø§Ù„Ø±Ø®ØµØ© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</p>
                      <button
                        onClick={() => deleteLicenseAndNotify(r, 'commercial')}
                        disabled={updating === r.id}
                        className="p-1.5 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition"
                        title="Ø­Ø°Ù Ø§Ù„Ø±Ø®ØµØ© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </div>
                    <a
                      href={r.commercialLicenseUrl}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="inline-flex items-center gap-1 text-sky-600 hover:text-sky-800 text-sm"
                    >
                      <ExternalLink className="w-4 h-4" />
                      Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù
                    </a>
                  </div>
                )}
              </div>

              {/* Ø²Ø± Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ */}
              {r.commercialLicenseUrl && (
                <button
                  onClick={() => deleteLicenseAndNotify(r, 'commercial')}
                  disabled={updating === r.id}
                  className="w-full flex items-center justify-center gap-2 mb-4 py-2 px-4 border-2 border-dashed border-red-200 text-red-500 hover:bg-red-50 hover:border-red-300 rounded-xl text-sm font-medium transition"
                >
                  <Trash2 className="w-4 h-4" />
                  Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨
                </button>
              )}

              {/* Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø±ÙØ¶ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© */}
              {r.licenseStatus === 'rejected' && r.licenseNotes && (
                <div className="bg-red-50 text-red-700 rounded-xl p-3 mb-4 text-sm">
                  <strong>Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶:</strong> {r.licenseNotes}
                </div>
              )}

              {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© */}
              {r.licenseStatus !== 'approved' && (
                <div className="space-y-3">
                  <textarea
                    placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ø±ÙØ¶)..."
                    value={reviewNotes[r.id] || ''}
                    onChange={(e) => setReviewNotes(prev => ({ ...prev, [r.id]: e.target.value }))}
                    className="w-full border rounded-xl p-3 text-sm resize-none h-20"
                  />
                  <div className="flex gap-3">
                    <button
                      onClick={() => updateLicenseStatus(r.id, 'approved')}
                      disabled={updating === r.id}
                      className="flex-1 flex items-center justify-center gap-2 bg-green-500 hover:bg-green-600 text-white py-2.5 rounded-xl font-semibold transition disabled:opacity-50"
                    >
                      <CheckCircle className="w-5 h-5" />
                      Ù…ÙˆØ§ÙÙ‚Ø©
                    </button>
                    <button
                      onClick={() => updateLicenseStatus(r.id, 'rejected')}
                      disabled={updating === r.id}
                      className="flex-1 flex items-center justify-center gap-2 bg-red-500 hover:bg-red-600 text-white py-2.5 rounded-xl font-semibold transition disabled:opacity-50"
                    >
                      <AlertCircle className="w-5 h-5" />
                      Ø±ÙØ¶
                    </button>
                  </div>
                </div>
              )}

{/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§ */}
              {r.licenseStatus === 'approved' && (
                <div className="space-y-3">
                  <textarea
                    placeholder="Ø³Ø¨Ø¨ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©..."
                    value={reviewNotes[r.id] || ''}
                    onChange={(e) => setReviewNotes(prev => ({ ...prev, [r.id]: e.target.value }))}
                    className="w-full border border-yellow-200 rounded-xl p-3 text-sm resize-none h-20 focus:ring-2 focus:ring-yellow-400 focus:border-transparent"
                  />
                  <div className="flex gap-3">
                    <button
                      onClick={() => updateLicenseStatus(r.id, 'rejected')}
                      disabled={updating === r.id}
                      className="flex-1 flex items-center justify-center gap-2 bg-yellow-500 hover:bg-yellow-600 text-white py-2.5 rounded-xl font-semibold transition disabled:opacity-50"
                    >
                      <AlertCircle className="w-5 h-5" />
                      Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
                    </button>
                    <button
                      onClick={() => deleteLicenseAndNotify(r, 'commercial')}
                      disabled={updating === r.id}
                      className="flex-1 flex items-center justify-center gap-2 bg-red-500 hover:bg-red-600 text-white py-2.5 rounded-xl font-semibold transition disabled:opacity-50"
                    >
                      <Trash2 className="w-5 h-5" />
                      Ø­Ø°Ù ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨
                    </button>
                  </div>
                </div>
              )}
            </div>
          ))}
        </div>
      )}
    </div>
  )
}

// ===== Ù…ÙƒÙˆÙ† Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø§Øª =====
type PackageRequestItem = {
  id: string
  restaurantId: string
  restaurantName: string
  ownerName?: string
  ownerPhone?: string
  status: 'pending' | 'bank_sent' | 'payment_sent' | 'approved' | 'rejected' | 'expired'
  bankAccountImageUrl?: string
  paymentProofImageUrl?: string
  subscriptionAmount: number
  subscriptionDuration: number
  developerNotes?: string
  ownerNotes?: string
  requestedAt?: any
  bankSentAt?: any
  paymentSentAt?: any
  approvedAt?: any
  rejectedAt?: any
  expiresAt?: any
  createdAt?: any
}

// ===== Ù…ÙƒÙˆÙ† Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø± =====
const StoreAnalyticsSection: React.FC<{
  restaurants: Restaurant[]
  orders: Order[]
  toast: any
}> = ({ restaurants, orders, toast }) => {
  const [selectedStore, setSelectedStore] = useState<string | null>(null)
  const [storeStats, setStoreStats] = useState<Record<string, any>>({})
  const [loadingStats, setLoadingStats] = useState(false)

  // Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ØªØ¬Ø± Ù…Ø¹ÙŠÙ†
  const loadStoreStats = async (restaurantId: string) => {
    setLoadingStats(true)
    try {
      // Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
      const statsDoc = await getDoc(doc(db, 'restaurantStats', restaurantId))
      const visitStats = statsDoc.exists() ? statsDoc.data() : null

      // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ø±
      const storeOrders = orders.filter(o => o.restaurantId === restaurantId)
      const deliveredOrders = storeOrders.filter(o => o.status === 'delivered')

      // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù
      const menuQuery = query(collection(db, 'menuItems'), where('ownerId', '==', restaurantId))
      const menuSnap = await getDocs(menuQuery)

      // Ø¬Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
      let registrations = 0
      try {
        const regQuery = query(collection(db, 'customerRegistrations'), where('restaurantId', '==', restaurantId))
        const regSnap = await getDocs(regQuery)
        registrations = regSnap.size
      } catch {}

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª
      const totalRevenue = deliveredOrders.reduce((sum, o) => sum + (o.total || 0), 0)
      
      // Ø­Ø³Ø§Ø¨ Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…
      const todayKey = new Date().toISOString().split('T')[0]
      const todayViews = visitStats?.dailyViews?.[todayKey] || 0

      setStoreStats(prev => ({
        ...prev,
        [restaurantId]: {
          totalOrders: storeOrders.length,
          deliveredOrders: deliveredOrders.length,
          totalRevenue,
          menuItemsCount: menuSnap.size,
          profileViews: visitStats?.totalProfileViews || 0,
          menuViews: visitStats?.totalMenuViews || 0,
          itemViews: visitStats?.totalItemViews || 0,
          shareClicks: visitStats?.totalShareClicks || 0,
          whatsappShares: visitStats?.whatsappShareCount || 0,
          registeredCustomers: registrations,
          todayViews,
          dailyViews: visitStats?.dailyViews || {}
        }
      }))
    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªØ¬Ø±:', err)
      toast.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª')
    } finally {
      setLoadingStats(false)
    }
  }

  // ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ù…ØªØ¬Ø±
  const handleSelectStore = (restaurantId: string) => {
    setSelectedStore(restaurantId)
    if (!storeStats[restaurantId]) {
      loadStoreStats(restaurantId)
    }
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h2 className="text-xl font-bold">ğŸ“ˆ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªØ§Ø¬Ø±</h2>
        <span className="text-gray-500">{restaurants.length} Ù…ØªØ¬Ø±</span>
      </div>

      {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø± */}
      <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
        {restaurants.map(r => {
          const rStats = storeStats[r.id]
          return (
            <div
              key={r.id}
              onClick={() => handleSelectStore(r.id)}
              className={`bg-white rounded-2xl shadow p-4 cursor-pointer transition hover:shadow-lg ${
                selectedStore === r.id ? 'ring-2 ring-sky-500' : ''
              }`}
            >
              <div className="flex items-center gap-3 mb-3">
                {r.logoUrl ? (
                  <img src={r.logoUrl} alt={r.name} className="w-12 h-12 rounded-xl object-cover" />
                ) : (
                  <div className="w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center">
                    ğŸª
                  </div>
                )}
                <div className="flex-1">
                  <h3 className="font-bold text-gray-900">{r.name}</h3>
                  <p className="text-xs text-gray-500">{r.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                </div>
              </div>

              {rStats && (
                <div className="grid grid-cols-3 gap-2 text-center text-xs">
                  <div className="bg-blue-50 rounded-lg p-2">
                    <p className="font-bold text-blue-700">{rStats.profileViews}</p>
                    <p className="text-blue-600">Ø²ÙŠØ§Ø±Ø©</p>
                  </div>
                  <div className="bg-green-50 rounded-lg p-2">
                    <p className="font-bold text-green-700">{rStats.deliveredOrders}</p>
                    <p className="text-green-600">Ø·Ù„Ø¨</p>
                  </div>
                  <div className="bg-purple-50 rounded-lg p-2">
                    <p className="font-bold text-purple-700">{rStats.whatsappShares}</p>
                    <p className="text-purple-600">Ù…Ø´Ø§Ø±ÙƒØ©</p>
                  </div>
                </div>
              )}
            </div>
          )
        })}
      </div>

      {/* ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯ */}
      {selectedStore && (
        <div className="bg-white rounded-2xl shadow-lg p-6">
          {loadingStats ? (
            <div className="text-center py-8">
              <RefreshCw className="w-8 h-8 animate-spin mx-auto text-sky-500" />
              <p className="text-gray-500 mt-2">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
            </div>
          ) : storeStats[selectedStore] ? (
            <div className="space-y-6">
              {/* Ø¹Ù†ÙˆØ§Ù† */}
              <div className="flex items-center justify-between border-b pb-4">
                <div className="flex items-center gap-3">
                  {restaurants.find(r => r.id === selectedStore)?.logoUrl ? (
                    <img 
                      src={restaurants.find(r => r.id === selectedStore)?.logoUrl} 
                      alt="" 
                      className="w-16 h-16 rounded-xl object-cover"
                    />
                  ) : (
                    <div className="w-16 h-16 bg-gray-100 rounded-xl flex items-center justify-center text-2xl">ğŸª</div>
                  )}
                  <div>
                    <h3 className="text-xl font-bold">
                      {restaurants.find(r => r.id === selectedStore)?.name}
                    </h3>
                    <p className="text-gray-500">
                      {restaurants.find(r => r.id === selectedStore)?.city}
                    </p>
                  </div>
                </div>
                <button
                  onClick={() => loadStoreStats(selectedStore)}
                  className="p-2 bg-gray-100 hover:bg-gray-200 rounded-xl"
                >
                  <RefreshCw className="w-5 h-5" />
                </button>
              </div>

              {/* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */}
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4">
                  <p className="text-3xl font-bold text-blue-700">{storeStats[selectedStore].profileViews}</p>
                  <p className="text-sm text-blue-600">Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ØµÙØ­Ø©</p>
                </div>
                <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4">
                  <p className="text-3xl font-bold text-green-700">{storeStats[selectedStore].todayViews}</p>
                  <p className="text-sm text-green-600">Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                </div>
                <div className="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4">
                  <p className="text-3xl font-bold text-purple-700">{storeStats[selectedStore].whatsappShares}</p>
                  <p className="text-sm text-purple-600">Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨</p>
                </div>
                <div className="bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl p-4">
                  <p className="text-3xl font-bold text-amber-700">{storeStats[selectedStore].shareClicks}</p>
                  <p className="text-sm text-amber-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª</p>
                </div>
              </div>

              {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª */}
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div className="bg-white border-2 border-gray-200 rounded-xl p-4">
                  <p className="text-2xl font-bold">{storeStats[selectedStore].totalOrders}</p>
                  <p className="text-sm text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                </div>
                <div className="bg-white border-2 border-gray-200 rounded-xl p-4">
                  <p className="text-2xl font-bold">{storeStats[selectedStore].deliveredOrders}</p>
                  <p className="text-sm text-gray-600">Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</p>
                </div>
                <div className="bg-white border-2 border-gray-200 rounded-xl p-4">
                  <p className="text-2xl font-bold text-green-600">{storeStats[selectedStore].totalRevenue.toFixed(0)}</p>
                  <p className="text-sm text-gray-600">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ø±.Ø³)</p>
                </div>
                <div className="bg-white border-2 border-gray-200 rounded-xl p-4">
                  <p className="text-2xl font-bold">{storeStats[selectedStore].menuItemsCount}</p>
                  <p className="text-sm text-gray-600">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù</p>
                </div>
              </div>

              {/* Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø· */}
              <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-4">
                <h4 className="font-bold text-indigo-800 mb-2">ğŸ‘¥ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø³Ø±Ø©</h4>
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-white rounded-lg p-3 text-center">
                    <p className="text-2xl font-bold text-indigo-600">{storeStats[selectedStore].registeredCustomers}</p>
                    <p className="text-xs text-indigo-500">Ø¹Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø·</p>
                  </div>
                  <div className="bg-white rounded-lg p-3 text-center">
                    <p className="text-2xl font-bold text-purple-600">{storeStats[selectedStore].itemViews}</p>
                    <p className="text-xs text-purple-500">Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù</p>
                  </div>
                </div>
              </div>

              {/* Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© */}
              {Object.keys(storeStats[selectedStore].dailyViews || {}).length > 0 && (
                <div className="bg-gray-50 rounded-xl p-4">
                  <h4 className="font-bold text-gray-800 mb-3">ğŸ“Š Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…)</h4>
                  <div className="flex items-end gap-2 h-32">
                    {(() => {
                      const dailyViews = storeStats[selectedStore].dailyViews || {}
                      const last7Days = []
                      for (let i = 6; i >= 0; i--) {
                        const d = new Date()
                        d.setDate(d.getDate() - i)
                        const key = d.toISOString().split('T')[0]
                        last7Days.push({ date: key, views: dailyViews[key] || 0 })
                      }
                      const maxViews = Math.max(...last7Days.map(d => d.views), 1)
                      
                      return last7Days.map((day, i) => (
                        <div key={day.date} className="flex-1 flex flex-col items-center gap-1">
                          <div 
                            className="w-full bg-sky-500 rounded-t"
                            style={{ height: `${(day.views / maxViews) * 100}%`, minHeight: day.views > 0 ? '4px' : '0' }}
                          />
                          <span className="text-xs text-gray-500">
                            {new Date(day.date).toLocaleDateString('ar-SA', { weekday: 'short' })}
                          </span>
                          <span className="text-xs font-bold">{day.views}</span>
                        </div>
                      ))
                    })()}
                  </div>
                </div>
              )}
            </div>
          ) : (
            <p className="text-center text-gray-500 py-8">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…ØªØ¬Ø± Ù„Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙ‡</p>
          )}
        </div>
      )}
    </div>
  )
}

const PackageRequestsSection: React.FC<{
  packageRequests: PackageRequestItem[]
  onUpdate: () => void
  toast: any
  dialog: any
  storage: any
}> = ({ packageRequests, onUpdate, toast, dialog, storage }) => {
  const [filter, setFilter] = useState<string>('all')
  const [updating, setUpdating] = useState<string | null>(null)
  const [bankImageFile, setBankImageFile] = useState<File | null>(null)
  const [subscriptionAmount, setSubscriptionAmount] = useState<number>(99)
  const [selectedRequestId, setSelectedRequestId] = useState<string | null>(null)
  const [sendingNotification, setSendingNotification] = useState<string | null>(null)
  const [customMessage, setCustomMessage] = useState<string>('')
  const [showMessageInput, setShowMessageInput] = useState<string | null>(null)

  // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©/Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø·Ø¹Ù…
  const sendNotificationToRestaurant = async (request: PackageRequestItem, message: string) => {
    if (!message.trim()) {
      toast.warning('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©')
      return
    }
    
    setSendingNotification(request.id)
    try {
      await addDoc(collection(db, 'notifications'), {
        recipientId: request.restaurantId,
        title: 'ğŸ“¬ Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',
        message: message.trim(),
        type: 'admin_message',
        read: false,
        data: { requestId: request.id },
        createdAt: serverTimestamp(),
      })
      
      toast.success('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ“¬')
      setShowMessageInput(null)
      setCustomMessage('')
    } catch (err: any) {
      toast.error(`ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${err.message}`)
    } finally {
      setSendingNotification(null)
    }
  }

  // ÙÙ„ØªØ±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  const filteredRequests = packageRequests.filter(r => {
    if (filter === 'all') return true
    return r.status === filter
  })

  // Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
  const pendingCount = packageRequests.filter(r => r.status === 'pending').length
  const bankSentCount = packageRequests.filter(r => r.status === 'bank_sent').length
  const paymentSentCount = packageRequests.filter(r => r.status === 'payment_sent').length
  const approvedCount = packageRequests.filter(r => r.status === 'approved').length

  // ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø­Ø§Ù„Ø©
  const getStatusLabel = (status: string) => {
    switch (status) {
      case 'pending': return { label: 'Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯', color: 'bg-yellow-100 text-yellow-700', icon: 'â³' }
      case 'bank_sent': return { label: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„', color: 'bg-blue-100 text-blue-700', icon: 'ğŸ¦' }
      case 'payment_sent': return { label: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯', color: 'bg-purple-100 text-purple-700', icon: 'ğŸ’³' }
      case 'approved': return { label: 'Ù…ÙØ¹Ù‘Ù„', color: 'bg-green-100 text-green-700', icon: 'âœ…' }
      case 'rejected': return { label: 'Ù…Ø±ÙÙˆØ¶', color: 'bg-red-100 text-red-700', icon: 'âŒ' }
      case 'expired': return { label: 'Ù…Ù†ØªÙ‡ÙŠ', color: 'bg-gray-100 text-gray-700', icon: 'â°' }
      default: return { label: status, color: 'bg-gray-100', icon: 'ğŸ“¦' }
    }
  }

  // Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ
  const handleSendBankAccount = async (requestId: string) => {
    if (!bankImageFile) {
      toast.warning('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ')
      return
    }

    setUpdating(requestId)
    try {
      // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
      const path = `bankAccounts/${Date.now()}_${bankImageFile.name}`
      const storageRef = ref(storage, path)
      await uploadBytes(storageRef, bankImageFile)
      const imageUrl = await getDownloadURL(storageRef)

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨
      await updateDoc(doc(db, 'packageRequests', requestId), {
        status: 'bank_sent',
        bankAccountImageUrl: imageUrl,
        subscriptionAmount,
        bankSentAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
      })

      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø£Ø³Ø±Ø©
      const request = packageRequests.find(r => r.id === requestId)
      if (request) {
        await addDoc(collection(db, 'notifications'), {
          recipientId: request.restaurantId,
          title: 'ğŸ¦ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ',
          message: `ÙŠØ±Ø¬Ù‰ ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ù„Øº ${subscriptionAmount} Ø±ÙŠØ§Ù„ Ø«Ù… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„`,
          type: 'package_bank_sent',
          read: false,
          data: { requestId, amount: subscriptionAmount },
          createdAt: serverTimestamp(),
        })
      }

      toast.success('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø¨Ù†Ø¬Ø§Ø­')
      setBankImageFile(null)
      setSelectedRequestId(null)
      onUpdate()
    } catch (err: any) {
      toast.error(`ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${err.message}`)
    } finally {
      setUpdating(null)
    }
  }

  // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø©
  const handleApprovePayment = async (request: PackageRequestItem) => {
    const confirmed = await dialog.confirm(
      `Ù‡Ù„ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªÙ„Ø§Ù… Ù…Ø¨Ù„Øº ${request.subscriptionAmount} Ø±ÙŠØ§Ù„ ÙˆØªÙØ¹ÙŠÙ„ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ² Ù„Ù€ "${request.restaurantName}"ØŸ`,
      { title: 'âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø©', confirmText: 'Ù†Ø¹Ù…ØŒ ÙØ¹Ù‘Ù„ Ø§Ù„Ø¨Ø§Ù‚Ø©' }
    )
    if (!confirmed) return

    setUpdating(request.id)
    try {
      const expiresAt = new Date()
      expiresAt.setDate(expiresAt.getDate() + (request.subscriptionDuration || 30))

      // ØªØ­Ø¯ÙŠØ« Ø·Ù„Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø©
      await updateDoc(doc(db, 'packageRequests', request.id), {
        status: 'approved',
        approvedAt: serverTimestamp(),
        expiresAt,
        updatedAt: serverTimestamp(),
      })

      // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø© ÙÙŠ Ø§Ù„Ù…Ø·Ø¹Ù…
      await updateDoc(doc(db, 'restaurants', request.restaurantId), {
        packageType: 'premium',
        packageSubscribedAt: serverTimestamp(),
        packageExpiresAt: expiresAt,
        packageRequest: null,
        updatedAt: serverTimestamp(),
      })

      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø£Ø³Ø±Ø©
      await addDoc(collection(db, 'notifications'), {
        recipientId: request.restaurantId,
        title: 'ğŸ‰ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ²!',
        message: `Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ² Ø­ØªÙ‰ ${expiresAt.toLocaleDateString('ar-SA')}`,
        type: 'package_approved',
        read: false,
        data: { requestId: request.id },
        createdAt: serverTimestamp(),
      })

      toast.success('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰')
      onUpdate()
    } catch (err: any) {
      toast.error(`ÙØ´Ù„ Ø§Ù„ØªÙØ¹ÙŠÙ„: ${err.message}`)
    } finally {
      setUpdating(null)
    }
  }

  // Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨
  const handleRejectRequest = async (request: PackageRequestItem) => {
    const confirmed = await dialog.confirm(
      `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø±ÙØ¶ Ø·Ù„Ø¨ "${request.restaurantName}"ØŸ`,
      { title: 'âŒ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨', confirmText: 'Ù†Ø¹Ù…ØŒ Ø§Ø±ÙØ¶', dangerous: true }
    )
    if (!confirmed) return

    setUpdating(request.id)
    try {
      await updateDoc(doc(db, 'packageRequests', request.id), {
        status: 'rejected',
        rejectedAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
      })

      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±
      await addDoc(collection(db, 'notifications'), {
        recipientId: request.restaurantId,
        title: 'âŒ ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ',
        message: 'Ù„Ù„Ø£Ø³Ù ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§ÙƒÙƒ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ². ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø³Ø¨Ø¨.',
        type: 'package_rejected',
        read: false,
        createdAt: serverTimestamp(),
      })

      toast.success('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨')
      onUpdate()
    } catch (err: any) {
      toast.error(`ÙØ´Ù„ Ø§Ù„Ø±ÙØ¶: ${err.message}`)
    } finally {
      setUpdating(null)
    }
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between flex-wrap gap-4">
        <div className="flex items-center gap-3">
          <Package className="w-8 h-8 text-amber-500" />
          <div>
            <h2 className="text-2xl font-bold">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</h2>
            <p className="text-gray-600">Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø© Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ²</p>
          </div>
        </div>
      </div>

      {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div className="bg-yellow-50 rounded-xl p-4 text-center border border-yellow-200">
          <p className="text-3xl font-bold text-yellow-600">{pendingCount}</p>
          <p className="text-sm text-yellow-700">â³ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</p>
        </div>
        <div className="bg-blue-50 rounded-xl p-4 text-center border border-blue-200">
          <p className="text-3xl font-bold text-blue-600">{bankSentCount}</p>
          <p className="text-sm text-blue-700">ğŸ¦ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„</p>
        </div>
        <div className="bg-purple-50 rounded-xl p-4 text-center border border-purple-200">
          <p className="text-3xl font-bold text-purple-600">{paymentSentCount}</p>
          <p className="text-sm text-purple-700">ğŸ’³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯</p>
        </div>
        <div className="bg-green-50 rounded-xl p-4 text-center border border-green-200">
          <p className="text-3xl font-bold text-green-600">{approvedCount}</p>
          <p className="text-sm text-green-700">âœ… Ù…ÙØ¹Ù‘Ù„</p>
        </div>
      </div>

      {/* ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© */}
      <div className="flex flex-wrap gap-2">
        {[
          { id: 'all', label: 'Ø§Ù„ÙƒÙ„' },
          { id: 'pending', label: 'â³ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©' },
          { id: 'bank_sent', label: 'ğŸ¦ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„' },
          { id: 'payment_sent', label: 'ğŸ’³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯' },
          { id: 'approved', label: 'âœ… Ù…ÙØ¹Ù‘Ù„Ø©' },
          { id: 'rejected', label: 'âŒ Ù…Ø±ÙÙˆØ¶Ø©' },
        ].map(f => (
          <button
            key={f.id}
            onClick={() => setFilter(f.id)}
            className={`px-4 py-2 rounded-xl font-semibold transition ${
              filter === f.id
                ? 'bg-amber-500 text-white'
                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
            }`}
          >
            {f.label}
          </button>
        ))}
      </div>

      {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª */}
      {filteredRequests.length === 0 ? (
        <div className="text-center py-16 bg-gray-50 rounded-2xl">
          <Package className="w-16 h-16 text-gray-300 mx-auto mb-4" />
          <p className="text-gray-500 text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª {filter !== 'all' && 'Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø©'}</p>
        </div>
      ) : (
        <div className="space-y-4">
          {filteredRequests.map(request => {
            const statusInfo = getStatusLabel(request.status)
            return (
              <div key={request.id} className="bg-white rounded-2xl shadow-lg overflow-hidden">
                {/* Ø±Ø£Ø³ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */}
                <div className="bg-gradient-to-r from-amber-500 to-orange-500 p-4 text-white">
                  <div className="flex items-center justify-between flex-wrap gap-3">
                    <div className="flex items-center gap-3">
                      <div className="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center text-2xl">
                        ğŸ‘¨â€ğŸ³
                      </div>
                      <div>
                        <h3 className="font-bold text-lg">{request.restaurantName}</h3>
                        <p className="text-white/80 text-sm">
                          {request.ownerName || 'ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø³Ø±Ø©'} â€¢ {request.ownerPhone || 'Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù…'}
                        </p>
                      </div>
                    </div>
                    <div className="flex items-center gap-2">
                      {/* Ø²Ø± Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨ */}
                      {request.ownerPhone && (
                        <a
                          href={`https://wa.me/${request.ownerPhone.replace(/[^0-9]/g, '').replace(/^0/, '966')}`}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="flex items-center gap-1 bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-xl text-sm font-semibold transition"
                        >
                          ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨
                        </a>
                      )}
                      <div className={`px-4 py-2 rounded-full text-sm font-bold ${statusInfo.color}`}>
                        {statusInfo.icon} {statusInfo.label}
                      </div>
                    </div>
                  </div>
                </div>

                {/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */}
                <div className="p-4 space-y-4">
                  {/* ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ */}
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                    <div>
                      <p className="text-gray-500">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨</p>
                      <p className="font-semibold">
                        {request.requestedAt?.toDate?.()?.toLocaleDateString('ar-SA') || 
                         request.createdAt?.toDate?.()?.toLocaleDateString('ar-SA') || '-'}
                      </p>
                    </div>
                    <div>
                      <p className="text-gray-500">Ø§Ù„Ù…Ø¨Ù„Øº</p>
                      <p className="font-semibold text-green-600">{request.subscriptionAmount || 99} Ø±.Ø³</p>
                    </div>
                    <div>
                      <p className="text-gray-500">Ø§Ù„Ù…Ø¯Ø©</p>
                      <p className="font-semibold">{request.subscriptionDuration || 30} ÙŠÙˆÙ…</p>
                    </div>
                    <div>
                      <p className="text-gray-500">Ù…Ø¹Ø±Ù Ø§Ù„Ø£Ø³Ø±Ø©</p>
                      <p className="font-mono text-xs">{request.restaurantId.slice(0, 12)}...</p>
                    </div>
                  </div>

                  {/* === Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙˆØ§ØµÙ„ === */}
                  <div className="border-t pt-4">
                    {showMessageInput === request.id ? (
                      <div className="space-y-3 bg-sky-50 p-4 rounded-xl">
                        <h4 className="font-bold text-sky-600">ğŸ“¬ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø£Ø³Ø±Ø©</h4>
                        <textarea
                          value={customMessage}
                          onChange={(e) => setCustomMessage(e.target.value)}
                          placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."
                          className="w-full border rounded-lg p-3 resize-none"
                          rows={3}
                        />
                        <div className="flex gap-2">
                          <button
                            onClick={() => sendNotificationToRestaurant(request, customMessage)}
                            disabled={sendingNotification === request.id || !customMessage.trim()}
                            className="flex-1 bg-sky-500 hover:bg-sky-600 text-white py-2 rounded-xl font-semibold disabled:opacity-50"
                          >
                            {sendingNotification === request.id ? 'Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...' : 'ğŸ“¬ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©'}
                          </button>
                          <button
                            onClick={() => {
                              setShowMessageInput(null)
                              setCustomMessage('')
                            }}
                            className="px-4 bg-gray-200 hover:bg-gray-300 rounded-xl"
                          >
                            Ø¥Ù„ØºØ§Ø¡
                          </button>
                        </div>
                      </div>
                    ) : (
                      <div className="flex flex-wrap gap-2">
                        <button
                          onClick={() => setShowMessageInput(request.id)}
                          className="flex items-center gap-2 bg-sky-100 hover:bg-sky-200 text-sky-700 px-4 py-2 rounded-xl font-semibold transition"
                        >
                          ğŸ“¬ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
                        </button>
                        {request.ownerPhone && (
                          <a
                            href={`https://wa.me/${request.ownerPhone.replace(/[^0-9]/g, '').replace(/^0/, '966')}`}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="flex items-center gap-2 bg-green-100 hover:bg-green-200 text-green-700 px-4 py-2 rounded-xl font-semibold transition"
                          >
                            ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨
                          </a>
                        )}
                        {!request.ownerPhone && (
                          <span className="text-gray-400 text-sm self-center">âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù‡Ø§ØªÙ</span>
                        )}
                      </div>
                    )}
                  </div>

                  {/* === Ø­Ø§Ù„Ø©: Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ù†Ùƒ === */}
                  {request.status === 'pending' && (
                    <div className="border-t pt-4 space-y-3">
                      <h4 className="font-bold text-amber-600">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</h4>
                      
                      {selectedRequestId === request.id ? (
                        <div className="space-y-3 bg-amber-50 p-4 rounded-xl">
                          <div>
                            <label className="block text-sm font-semibold mb-1">ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ (IBAN)</label>
                            <input
                              type="file"
                              accept="image/*"
                              onChange={(e) => setBankImageFile(e.target.files?.[0] || null)}
                              className="w-full border rounded-lg p-2"
                            />
                          </div>
                          <div>
                            <label className="block text-sm font-semibold mb-1">Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø±ÙŠØ§Ù„)</label>
                            <input
                              type="number"
                              value={subscriptionAmount}
                              onChange={(e) => setSubscriptionAmount(Number(e.target.value))}
                              className="w-full border rounded-lg p-2"
                              min={1}
                            />
                          </div>
                          <div className="flex gap-2">
                            <button
                              onClick={() => handleSendBankAccount(request.id)}
                              disabled={updating === request.id || !bankImageFile}
                              className="flex-1 bg-amber-500 hover:bg-amber-600 text-white py-2 rounded-xl font-semibold disabled:opacity-50"
                            >
                              {updating === request.id ? 'Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...' : 'ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø£Ø³Ø±Ø©'}
                            </button>
                            <button
                              onClick={() => {
                                setSelectedRequestId(null)
                                setBankImageFile(null)
                              }}
                              className="px-4 bg-gray-200 hover:bg-gray-300 rounded-xl"
                            >
                              Ø¥Ù„ØºØ§Ø¡
                            </button>
                          </div>
                        </div>
                      ) : (
                        <div className="flex gap-2">
                          <button
                            onClick={() => setSelectedRequestId(request.id)}
                            className="flex-1 bg-amber-500 hover:bg-amber-600 text-white py-3 rounded-xl font-semibold"
                          >
                            ğŸ¦ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ
                          </button>
                          <button
                            onClick={() => handleRejectRequest(request)}
                            disabled={updating === request.id}
                            className="px-6 bg-red-100 hover:bg-red-200 text-red-700 rounded-xl font-semibold"
                          >
                            âŒ Ø±ÙØ¶
                          </button>
                        </div>
                      )}
                    </div>
                  )}

                  {/* === Ø­Ø§Ù„Ø©: Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ === */}
                  {request.status === 'bank_sent' && (
                    <div className="border-t pt-4">
                      <div className="bg-blue-50 p-4 rounded-xl">
                        <p className="text-blue-700 font-semibold mb-2">ğŸ¦ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</p>
                        <p className="text-blue-600 text-sm">Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ù„Øº {request.subscriptionAmount} Ø±ÙŠØ§Ù„ Ù…Ù† Ø§Ù„Ø£Ø³Ø±Ø©</p>
                        {request.bankAccountImageUrl && (
                          <a
                            href={request.bankAccountImageUrl}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="inline-flex items-center gap-1 text-blue-600 hover:underline mt-2 text-sm"
                          >
                            <ExternalLink className="w-4 h-4" />
                            Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±Ø³Ù„Ø©
                          </a>
                        )}
                      </div>
                    </div>
                  )}

                  {/* === Ø­Ø§Ù„Ø©: Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯ (Ø§Ù„Ø£Ø³Ø±Ø© Ø­ÙˆÙ„Øª) === */}
                  {request.status === 'payment_sent' && (
                    <div className="border-t pt-4 space-y-3">
                      <div className="bg-purple-50 p-4 rounded-xl">
                        <p className="text-purple-700 font-semibold mb-2">ğŸ’³ Ø§Ù„Ø£Ø³Ø±Ø© Ø£Ø±Ø³Ù„Øª Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„</p>
                        {request.paymentProofImageUrl && (
                          <a
                            href={request.paymentProofImageUrl}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="inline-flex items-center gap-2 bg-white px-4 py-2 rounded-lg text-purple-600 hover:bg-purple-100 transition"
                          >
                            <ExternalLink className="w-5 h-5" />
                            Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„
                          </a>
                        )}
                      </div>
                      <div className="flex gap-2">
                        <button
                          onClick={() => handleApprovePayment(request)}
                          disabled={updating === request.id}
                          className="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-bold disabled:opacity-50"
                        >
                          {updating === request.id ? 'Ø¬Ø§Ø±Ù Ø§Ù„ØªÙØ¹ÙŠÙ„...' : 'âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø©'}
                        </button>
                        <button
                          onClick={() => handleRejectRequest(request)}
                          disabled={updating === request.id}
                          className="px-6 bg-red-100 hover:bg-red-200 text-red-700 rounded-xl font-semibold"
                        >
                          âŒ Ø±ÙØ¶
                        </button>
                      </div>
                    </div>
                  )}

                  {/* === Ø­Ø§Ù„Ø©: Ù…ÙØ¹Ù‘Ù„ === */}
                  {request.status === 'approved' && (
                    <div className="border-t pt-4">
                      <div className="bg-green-50 p-4 rounded-xl flex items-center gap-3">
                        <CheckCircle className="w-8 h-8 text-green-500" />
                        <div>
                          <p className="text-green-700 font-semibold">âœ… Ø§Ù„Ø¨Ø§Ù‚Ø© Ù…ÙØ¹Ù‘Ù„Ø©</p>
                          <p className="text-green-600 text-sm">
                            ØªÙ†ØªÙ‡ÙŠ ÙÙŠ: {request.expiresAt?.toDate?.()?.toLocaleDateString('ar-SA') || '-'}
                          </p>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* === Ø­Ø§Ù„Ø©: Ù…Ø±ÙÙˆØ¶ === */}
                  {request.status === 'rejected' && (
                    <div className="border-t pt-4">
                      <div className="bg-red-50 p-4 rounded-xl">
                        <p className="text-red-700 font-semibold">âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨</p>
                        <p className="text-red-600 text-sm">
                          Ø¨ØªØ§Ø±ÙŠØ®: {request.rejectedAt?.toDate?.()?.toLocaleDateString('ar-SA') || '-'}
                        </p>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )
          })}
        </div>
      )}
    </div>
  )
}

==========================================================================================
FILE: src/pages/EditRestaurant.tsx
==========================================================================================
// src/pages/EditRestaurant.tsx
import React, { useEffect, useMemo, useState } from "react"
import { ref, uploadBytes, getDownloadURL } from "firebase/storage"
import { doc, getDoc, setDoc } from "firebase/firestore"
import { db, storage } from "@/firebase"
import { useAuth } from "@/auth"
import { useToast } from "@/components/ui/Toast"
import { SAUDI_CITIES } from "@/utils/cities"
import { MapPin, FileText, ShieldCheck, AlertCircle, CheckCircle, Clock, Store, Building2, Briefcase, Lock } from "lucide-react"

type RestaurantForm = {
  name: string
  phone: string
  city: string
  location: string
  logoUrl?: string
  isOpen?: boolean // Ù‡Ù„ Ø§Ù„Ù…ØªØ¬Ø± Ù…ÙØªÙˆØ­ Ù„Ù„Ø·Ù„Ø¨Ø§Øª
  allowDelivery?: boolean // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙˆØµÙŠÙ„
  allowPickup?: boolean // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…
  commercialLicenseUrl?: string
  licenseStatus?: 'pending' | 'approved' | 'rejected'
  licenseNotes?: string
  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ
  bankName?: string
  bankAccountName?: string
  bankAccountNumber?: string
  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ¸ÙŠÙ
  isHiring?: boolean
  hiringDescription?: string
  hiringContact?: string
}

export const EditRestaurant: React.FC = () => {
  const { user } = useAuth()
  const toast = useToast()

  const [form, setForm] = useState<RestaurantForm>({
    name: "",
    phone: "",
    city: "",
    location: "",
    logoUrl: "",
    isOpen: true, // Ø§Ù„Ù…ØªØ¬Ø± Ù…ÙØªÙˆØ­ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
    allowDelivery: true, // Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…ÙØ¹Ù„ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
    allowPickup: false,
    commercialLicenseUrl: "",
    licenseStatus: undefined,
    licenseNotes: "",
    bankName: "",
    bankAccountName: "",
    bankAccountNumber: "",
    isHiring: false,
    hiringDescription: "",
    hiringContact: "",
  })

  const [file, setFile] = useState<File | null>(null)
  const [preview, setPreview] = useState<string>("")
  const [commercialFile, setCommercialFile] = useState<File | null>(null)
  const [loading, setLoading] = useState<boolean>(true)
  const [saving, setSaving] = useState<boolean>(false)
  const canSave = useMemo(() => !saving && !!user, [saving, user])

  // ====== Load current data ======
  useEffect(() => {
    if (!user) return
    ;(async () => {
      try {
        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        const snap = await getDoc(doc(db, "restaurants", user.uid))
        if (snap.exists()) {
          const data = snap.data() as RestaurantForm
          
          // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ Ù…Ù† subcollection Ù…Ù†ÙØµÙ„ (Ù…Ø­Ù…ÙŠ)
          let bankData = { bankName: "", bankAccountName: "", bankAccountNumber: "" }
          try {
            const bankSnap = await getDoc(doc(db, "restaurants", user.uid, "private", "bankInfo"))
            if (bankSnap.exists()) {
              const bd = bankSnap.data()
              bankData = {
                bankName: bd.bankName ?? "",
                bankAccountName: bd.bankAccountName ?? "",
                bankAccountNumber: bd.bankAccountNumber ?? "",
              }
            }
          } catch (e) {
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© - Ù‡Ø°Ø§ Ø·Ø¨ÙŠØ¹ÙŠ
          }
          
          setForm({
            name: data.name ?? "",
            phone: data.phone ?? "",
            city: data.city ?? "",
            location: data.location ?? "",
            logoUrl: data.logoUrl ?? "",
            isOpen: (data as any).isOpen ?? true,
            allowDelivery: (data as any).allowDelivery ?? true,
            allowPickup: (data as any).allowPickup ?? false,
            commercialLicenseUrl: (data as any).commercialLicenseUrl ?? "",
            licenseStatus: (data as any).licenseStatus,
            licenseNotes: (data as any).licenseNotes ?? "",
            bankName: bankData.bankName,
            bankAccountName: bankData.bankAccountName,
            bankAccountNumber: bankData.bankAccountNumber,
            isHiring: (data as any).isHiring ?? false,
            hiringDescription: (data as any).hiringDescription ?? "",
            hiringContact: (data as any).hiringContact ?? "",
          })
        }
      } catch (e: any) {
        toast.error("ØªØ¹Ø°Ù‘Ø±Øª Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù…")
        // console.error(e)
      } finally {
        setLoading(false)
      }
    })()
  }, [user, toast])

  // Ù†Ø¸Ø§ÙØ© Ù…Ø¹Ø§ÙŠÙ†Ø© blob
  useEffect(() => {
    return () => {
      if (preview) URL.revokeObjectURL(preview)
    }
  }, [preview])

  // ====== Handlers ======
  const onChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target
    setForm((p) => ({ ...p, [name]: value }))
  }

  const onPickLogo = (e: React.ChangeEvent<HTMLInputElement>) => {
    const f = e.target.files?.[0] || null
    setFile(f)
    if (f) {
      const url = URL.createObjectURL(f)
      setPreview(url)
    } else {
      setPreview("")
    }
  }

  const uploadLogoIfNeeded = async (): Promise<string | undefined> => {
    if (!user || !file) return undefined

    // ÙØ­Øµ Ø®ÙÙŠÙ: Ù†ÙˆØ¹/Ø­Ø¬Ù…
    const isImage = /^image\//.test(file.type)
    if (!isImage) {
      toast.warning("Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„ÙŠØ³ ØµÙˆØ±Ø©")
      return undefined
    }
    const MAX = 3 * 1024 * 1024 // 3MB
    if (file.size > MAX) {
      toast.warning("Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ±ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ù‚Ù„ Ù…Ù† 3MB")
      return undefined
    }

    // Ø§Ø³Ù… Ù…Ù„Ù ÙØ±ÙŠØ¯ + Ø§Ù…ØªØ¯Ø§Ø¯ ØµØ­ÙŠØ­
    const cleanName = file.name.replace(/\s+/g, "_")
    const path = `restaurants/${user.uid}/logo_${Date.now()}_${cleanName}`
    const r = ref(storage, path)
    const metadata = {
      contentType: file.type || "image/jpeg",
      cacheControl: "public,max-age=31536000,immutable",
    }

    // Ø±ÙØ¹
    await uploadBytes(r, file, metadata)
    const url = await getDownloadURL(r)

    // ÙƒØ³Ø± Ø§Ù„ÙƒØ§Ø´ Ø¹Ù„Ù‰ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©
    const busted = `${url}${url.includes("?") ? "&" : "?"}v=${Date.now()}`
    return busted
  }

  // Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„ØªØ±Ø®ÙŠØµ
  const uploadLicenseFile = async (licenseFile: File, type: 'commercial' | 'health'): Promise<string | undefined> => {
    if (!user || !licenseFile) return undefined

    const isValidType = /^(image\/|application\/pdf)/.test(licenseFile.type)
    if (!isValidType) {
      toast.warning("Ø§Ù„Ù…Ù„Ù ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ØµÙˆØ±Ø© Ø£Ùˆ PDF")
      return undefined
    }
    const MAX = 5 * 1024 * 1024 // 5MB
    if (licenseFile.size > MAX) {
      toast.warning("Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ±ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£Ù‚Ù„ Ù…Ù† 5MB")
      return undefined
    }

    const cleanName = licenseFile.name.replace(/\s+/g, "_")
    const path = `restaurants/${user.uid}/licenses/${type}_${Date.now()}_${cleanName}`
    const r = ref(storage, path)
    const metadata = {
      contentType: licenseFile.type,
      cacheControl: "public,max-age=31536000,immutable",
    }

    await uploadBytes(r, licenseFile, metadata)
    return await getDownloadURL(r)
  }

  const onSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!user) {
      toast.warning("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹")
      return
    }
    if (!form.name.trim()) {
      toast.warning("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…")
      return
    }

    setSaving(true)
    try {
      let logoUrl = form.logoUrl
      let commercialLicenseUrl = form.commercialLicenseUrl
      let licenseStatus = form.licenseStatus

      if (file) {
        toast.info("â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø± â€¦")
        const uploaded = await uploadLogoIfNeeded()
        if (uploaded) logoUrl = uploaded
      }

      // Ø±ÙØ¹ Ø§Ù„Ø±Ø®ØµØ© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©
      if (commercialFile) {
        toast.info("â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø±Ø®ØµØ© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© â€¦")
        const uploaded = await uploadLicenseFile(commercialFile, 'commercial')
        if (uploaded) {
          commercialLicenseUrl = uploaded
          licenseStatus = 'pending' // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±Ø®ÙŠØµ
        }
      }

      // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ ÙÙ‚Ø· Ù„Ù„Ø¹Ø±Ø¶ØŒ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø© ÙÙŠ subcollection)
      const { bankAccountName, bankAccountNumber, ...publicData } = form
      
      await setDoc(
        doc(db, "restaurants", user.uid),
        { 
          ...publicData, 
          logoUrl,
          commercialLicenseUrl,
          licenseStatus,
        },
        { merge: true }
      )

      // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ ÙÙŠ subcollection Ù…Ø­Ù…ÙŠ Ù…Ù†ÙØµÙ„
      if (form.bankName || bankAccountName || bankAccountNumber) {
        await setDoc(
          doc(db, "restaurants", user.uid, "private", "bankInfo"),
          {
            bankName: form.bankName || "",
            bankAccountName: bankAccountName || "",
            bankAccountNumber: bankAccountNumber || "",
          },
          { merge: true }
        )
      }

      // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„ÙØ§Øª
      if (preview) URL.revokeObjectURL(preview)
      setPreview("")
      setFile(null)
      setCommercialFile(null)

      toast.success("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰", { title: "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ø¹Ù…" })
    } catch (err: any) {
      // Ø£Ù…ÙˆØ± Ø´Ø§Ø¦Ø¹Ø©: App CheckØŒ Ù‚ÙˆØ§Ø¹Ø¯ Storage/FirestoreØŒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      toast.error(`ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: ${err?.message || "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}`)
      // console.error("Save error:", err)
    } finally {
      setSaving(false)
    }
  }

  if (loading) return <div className="p-6 text-center">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div>

  return (
    <div className="max-w-md mx-auto p-6 bg-white rounded-2xl shadow-lg mt-8 text-gray-900">
      <h1 className="text-2xl font-bold text-center mb-6">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù…</h1>

      <form onSubmit={onSubmit} className="space-y-4">
        {/* Logo picker + tiny preview */}
        <div className="space-y-2">
          <label className="block font-semibold">Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø·Ø¹Ù…</label>

          <div className="flex items-center gap-3">
            {/* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© ØµØºÙŠØ±Ø© */}
            <div className="w-14 h-14 rounded-full overflow-hidden border bg-gray-100 shrink-0">
              {/* Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© â€¢ Ø¨Ø¹Ø¯Ù‡Ø§ Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø­ÙÙˆØ¸ */}
              {(preview || form.logoUrl) ? (
                <img
                  src={preview || form.logoUrl}
                  className="w-full h-full object-cover"
                  onError={(e: any) => (e.currentTarget.style.display = "none")}
                  alt="logo"
                />
              ) : null}
            </div>

            <input type="file" accept="image/*" onChange={onPickLogo} />
          </div>

          {file && (
            <div className="text-xs text-gray-600">
              Ø³ÙŠØªÙ… Ø±ÙØ¹: <span className="font-semibold">{file.name}</span>
            </div>
          )}
        </div>

        <input
          name="name"
          placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…"
          value={form.name}
          onChange={onChange}
          className="w-full border p-3 rounded-xl"
        />
        <input
          name="phone"
          placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„"
          value={form.phone}
          onChange={onChange}
          className="w-full border p-3 rounded-xl"
        />
        <div className="relative">
          <MapPin className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-sky-400 pointer-events-none" />
          <select
            name="city"
            value={form.city}
            onChange={(e) => setForm(p => ({ ...p, city: e.target.value }))}
            className="w-full border p-3 pr-10 rounded-xl bg-white appearance-none cursor-pointer focus:border-sky-400 focus:ring-2 focus:ring-sky-100"
          >
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
            {SAUDI_CITIES.map(city => (
              <option key={city} value={city}>{city}</option>
            ))}
          </select>
        </div>
        <input
          name="location"
          placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹"
          value={form.location}
          onChange={onChange}
          className="w-full border p-3 rounded-xl"
        />

        {/* Ù‚Ø³Ù… Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù… */}
        <div className="border-t pt-4 mt-4">
          <h2 className="text-lg font-bold mb-4 flex items-center gap-2">
            <Store className="w-5 h-5 text-green-500" />
            Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ù„Ø¨
          </h2>
          
          {/* Ø²Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªØ¬Ø±: Ù…ØªØ§Ø­/Ù…ØºÙ„Ù‚ */}
          <div className={`flex items-center justify-between p-4 rounded-xl mb-3 ${form.isOpen ? 'bg-green-50 border-2 border-green-200' : 'bg-red-50 border-2 border-red-200'}`}>
            <div className="flex items-center gap-3">
              <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${form.isOpen ? 'bg-green-500' : 'bg-red-500'}`}>
                {form.isOpen ? (
                  <Store className="w-5 h-5 text-white" />
                ) : (
                  <Lock className="w-5 h-5 text-white" />
                )}
              </div>
              <div>
                <p className={`font-semibold ${form.isOpen ? 'text-green-800' : 'text-red-800'}`}>
                  {form.isOpen ? 'âœ“ Ø§Ù„Ù…ØªØ¬Ø± Ù…ØªØ§Ø­' : 'âœ• Ø§Ù„Ù…ØªØ¬Ø± Ù…ØºÙ„Ù‚'}
                </p>
                <p className="text-sm text-gray-500">
                  {form.isOpen ? 'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙŠÙ…ÙƒÙ†Ù‡Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†' : 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ø·Ù„Ø© Ù…Ø¤Ù‚ØªØ§Ù‹'}
                </p>
              </div>
            </div>
            <button
              type="button"
              onClick={() => setForm(p => ({ ...p, isOpen: !p.isOpen }))}
              className={`relative w-14 h-8 rounded-full transition-colors ${form.isOpen ? 'bg-green-500' : 'bg-red-400'}`}
            >
              <span className={`absolute top-1 w-6 h-6 bg-white rounded-full shadow transition-transform ${form.isOpen ? 'right-1' : 'left-1'}`} />
            </button>
          </div>
          {!form.isOpen && (
            <p className="mb-3 text-sm text-red-600 bg-red-50 p-2 rounded-lg">
              âš ï¸ Ø§Ù„Ù…ØªØ¬Ø± Ù…ØºÙ„Ù‚ - Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„Ù† ÙŠØªÙ…ÙƒÙ†ÙˆØ§ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ø£ØµÙ†Ø§Ù Ù„Ù„Ø³Ù„Ø©
            </p>
          )}

          {/* Ø²Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙˆØµÙŠÙ„ */}
          <div className="flex items-center justify-between p-4 bg-gray-50 rounded-xl mb-3">
            <div className="flex items-center gap-3">
              <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${form.allowDelivery ? 'bg-sky-500' : 'bg-gray-300'}`}>
                <MapPin className="w-5 h-5 text-white" />
              </div>
              <div>
                <p className="font-semibold text-gray-800">Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
                <p className="text-sm text-gray-500">ØªÙˆØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</p>
              </div>
            </div>
            <button
              type="button"
              onClick={() => setForm(p => ({ ...p, allowDelivery: !p.allowDelivery }))}
              className={`relative w-14 h-8 rounded-full transition-colors ${form.allowDelivery ? 'bg-sky-500' : 'bg-gray-300'}`}
            >
              <span className={`absolute top-1 w-6 h-6 bg-white rounded-full shadow transition-transform ${form.allowDelivery ? 'right-1' : 'left-1'}`} />
            </button>
          </div>
          {form.allowDelivery && (
            <p className="mb-3 text-sm text-sky-600 bg-sky-50 p-2 rounded-lg">
              ğŸš— Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…ÙØ¹Ù‘Ù„ - Ø³ØªØ¸Ù‡Ø± Ø¹Ù„Ø§Ù…Ø© "ØªÙˆØµÙŠÙ„" Ø¨Ø¬Ø§Ù†Ø¨ Ù…Ø·Ø¹Ù…Ùƒ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡
            </p>
          )}
          
          {/* Ø²Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù… */}
          <div className="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
            <div className="flex items-center gap-3">
              <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${form.allowPickup ? 'bg-green-500' : 'bg-gray-300'}`}>
                <Store className="w-5 h-5 text-white" />
              </div>
              <div>
                <p className="font-semibold text-gray-800">Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…</p>
                <p className="text-sm text-gray-500">Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ø§ØªÙ‡Ù… Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø·Ø¹Ù…</p>
              </div>
            </div>
            <button
              type="button"
              onClick={() => setForm(p => ({ ...p, allowPickup: !p.allowPickup }))}
              className={`relative w-14 h-8 rounded-full transition-colors ${form.allowPickup ? 'bg-green-500' : 'bg-gray-300'}`}
            >
              <span className={`absolute top-1 w-6 h-6 bg-white rounded-full shadow transition-transform ${form.allowPickup ? 'right-1' : 'left-1'}`} />
            </button>
          </div>
          {form.allowPickup && (
            <p className="mt-2 text-sm text-green-600 bg-green-50 p-2 rounded-lg">
              âœ“ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙŠÙ…ÙƒÙ†Ù‡Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ø§ØªÙ‡Ù… Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø·Ø¹Ù… (Ø¨Ø¯ÙˆÙ† Ø±Ø³ÙˆÙ… ØªÙˆØµÙŠÙ„)
            </p>
          )}
        </div>

        {/* Ù‚Ø³Ù… Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ */}
        <div className="border-t pt-4 mt-4">
          <h2 className="text-lg font-bold mb-4 flex items-center gap-2">
            <FileText className="w-5 h-5 text-sky-500" />
            Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ ÙˆØ§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª
          </h2>

          {/* Ø­Ø§Ù„Ø© Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ */}
          {form.licenseStatus && (
            <div className={`mb-4 p-3 rounded-xl flex items-center gap-2 ${
              form.licenseStatus === 'approved' ? 'bg-green-50 text-green-700' :
              form.licenseStatus === 'rejected' ? 'bg-red-50 text-red-700' :
              'bg-yellow-50 text-yellow-700'
            }`}>
              {form.licenseStatus === 'approved' && <CheckCircle className="w-5 h-5" />}
              {form.licenseStatus === 'rejected' && <AlertCircle className="w-5 h-5" />}
              {form.licenseStatus === 'pending' && <Clock className="w-5 h-5" />}
              <span className="font-semibold">
                {form.licenseStatus === 'approved' && 'Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§ âœ“'}
                {form.licenseStatus === 'rejected' && 'Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ù…Ø±ÙÙˆØ¶Ø©'}
                {form.licenseStatus === 'pending' && 'Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©...'}
              </span>
            </div>
          )}
          {form.licenseNotes && form.licenseStatus === 'rejected' && (
            <div className="mb-4 p-3 bg-red-50 rounded-xl text-red-600 text-sm">
              <strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> {form.licenseNotes}
            </div>
          )}

          {/* Ø§Ù„Ø±Ø®ØµØ© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© */}
          <div className="space-y-2 mb-4">
            <label className="block font-semibold text-gray-700 flex items-center gap-2">
              <ShieldCheck className="w-4 h-4 text-orange-500" />
              Ø§Ù„Ø±Ø®ØµØ© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©
            </label>
            <div className="flex items-center gap-3">
              {form.commercialLicenseUrl && (
                <a 
                  href={form.commercialLicenseUrl} 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="text-sky-500 hover:text-sky-700 text-sm underline"
                >
                  Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ
                </a>
              )}
              <input 
                type="file" 
                accept="image/*,.pdf" 
                onChange={(e) => setCommercialFile(e.target.files?.[0] || null)}
                className="text-sm"
              />
            </div>
            {commercialFile && (
              <div className="text-xs text-gray-600">
                Ø³ÙŠØªÙ… Ø±ÙØ¹: <span className="font-semibold">{commercialFile.name}</span>
              </div>
            )}
          </div>

        </div>

        {/* Ù‚Ø³Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ */}
        <div className="border-t pt-4 mt-4">
          <h2 className="text-lg font-bold mb-4 flex items-center gap-2">
            <Building2 className="w-5 h-5 text-green-500" />
            Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ
          </h2>
          <p className="text-sm text-gray-500 mb-4 bg-green-50 p-3 rounded-xl">
            ğŸ’° Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ù„ÙŠØªÙ…ÙƒÙ† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ù„Øº Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø©
          </p>

          <div className="space-y-3">
            <div className="relative">
              <select
                name="bankName"
                value={form.bankName || ""}
                onChange={(e) => setForm(p => ({ ...p, bankName: e.target.value }))}
                className="w-full border p-3 rounded-xl bg-white appearance-none cursor-pointer focus:border-green-400 focus:ring-2 focus:ring-green-100"
              >
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù†Ùƒ</option>
                <option value="Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ">Ø¨Ù†Ùƒ Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ</option>
                <option value="Ø§Ù„Ø£Ù‡Ù„ÙŠ">Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ</option>
                <option value="Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡">Ù…ØµØ±Ù Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡</option>
                <option value="Ø§Ù„Ø±ÙŠØ§Ø¶">Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                <option value="Ø§Ù„Ø¨Ù„Ø§Ø¯">Ø¨Ù†Ùƒ Ø§Ù„Ø¨Ù„Ø§Ø¯</option>
                <option value="Ø§Ù„Ø¬Ø²ÙŠØ±Ø©">Ø¨Ù†Ùƒ Ø§Ù„Ø¬Ø²ÙŠØ±Ø©</option>
                <option value="Ø§Ù„Ø¹Ø±Ø¨ÙŠ">Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ</option>
                <option value="Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ">Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ Ø§Ù„ÙØ±Ù†Ø³ÙŠ</option>
                <option value="Ø³Ø§Ø¨">Ø¨Ù†Ùƒ Ø³Ø§Ø¨</option>
                <option value="stc pay">STC Pay</option>
                <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
              </select>
            </div>

            <input
              name="bankAccountName"
              placeholder="Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨"
              value={form.bankAccountName || ""}
              onChange={onChange}
              className="w-full border p-3 rounded-xl focus:border-green-400 focus:ring-2 focus:ring-green-100"
            />

            <input
              name="bankAccountNumber"
              placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù† Ø£Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨"
              value={form.bankAccountNumber || ""}
              onChange={onChange}
              className="w-full border p-3 rounded-xl focus:border-green-400 focus:ring-2 focus:ring-green-100 font-mono text-left"
              dir="ltr"
            />

            {form.bankName && form.bankAccountName && form.bankAccountNumber && (
              <div className="bg-green-50 border border-green-200 rounded-xl p-3 text-green-700 text-sm">
                âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ Ù…ÙƒØªÙ…Ù„Ø© - Ø³ÙŠØªÙ…ÙƒÙ† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† Ø±Ø¤ÙŠØªÙ‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨
              </div>
            )}
          </div>
        </div>

        {/* Ù‚Ø³Ù… Ø§Ù„ØªÙˆØ¸ÙŠÙ */}
        <div className="border-t pt-4 mt-4">
          <h2 className="text-lg font-bold mb-4 flex items-center gap-2">
            <Briefcase className="w-5 h-5 text-purple-500" />
            ØªÙˆØ¸ÙŠÙ Ø¹Ø§Ù…Ù„Ø§Øª Ù„Ù„Ø·Ø¨Ø®
          </h2>
          <p className="text-sm text-gray-500 mb-4 bg-purple-50 p-3 rounded-xl">
            ğŸ‘©â€ğŸ³ ÙØ¹Ù‘Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø± Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ¨Ø­Ø« Ø¹Ù† Ø¹Ø§Ù…Ù„Ø§Øª Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„Ø·Ø¨Ø®
          </p>

          {/* Ø²Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙˆØ¸ÙŠÙ */}
          <div className="flex items-center justify-between p-4 bg-gray-50 rounded-xl mb-4">
            <div className="flex items-center gap-3">
              <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${form.isHiring ? 'bg-purple-500' : 'bg-gray-300'}`}>
                <Briefcase className="w-5 h-5 text-white" />
              </div>
              <div>
                <p className="font-semibold text-gray-800">Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸ÙØ§Øª</p>
                <p className="text-sm text-gray-500">Ø¹Ø±Ø¶ Ø¥Ø¹Ù„Ø§Ù† ØªÙˆØ¸ÙŠÙ ÙÙŠ ØµÙØ­ØªÙƒ</p>
              </div>
            </div>
            <button
              type="button"
              onClick={() => setForm(p => ({ ...p, isHiring: !p.isHiring }))}
              className={`relative w-14 h-8 rounded-full transition-colors ${form.isHiring ? 'bg-purple-500' : 'bg-gray-300'}`}
            >
              <span className={`absolute top-1 w-6 h-6 bg-white rounded-full shadow transition-transform ${form.isHiring ? 'right-1' : 'left-1'}`} />
            </button>
          </div>

          {form.isHiring && (
            <div className="space-y-3 bg-purple-50 p-4 rounded-xl">
              <textarea
                name="hiringDescription"
                placeholder="ÙˆØµÙ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù…Ø«Ø§Ù„: Ù†Ø¨Ø­Ø« Ø¹Ù† Ø·Ø¨Ø§Ø®Ø© Ù…Ø§Ù‡Ø±Ø© Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆØ§Ù… Ø¬Ø²Ø¦ÙŠ...)"
                value={form.hiringDescription || ""}
                onChange={(e) => setForm(p => ({ ...p, hiringDescription: e.target.value }))}
                className="w-full border p-3 rounded-xl focus:border-purple-400 focus:ring-2 focus:ring-purple-100 min-h-[100px]"
                rows={3}
              />

              <input
                name="hiringContact"
                placeholder="Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù„Ù„ØªÙˆØ¸ÙŠÙ (ÙˆØ§ØªØ³Ø§Ø¨)"
                value={form.hiringContact || ""}
                onChange={onChange}
                className="w-full border p-3 rounded-xl focus:border-purple-400 focus:ring-2 focus:ring-purple-100"
              />

              {form.hiringDescription && form.hiringContact && (
                <div className="bg-purple-100 border border-purple-200 rounded-xl p-3 text-purple-700 text-sm">
                  âœ… Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ØªÙˆØ¸ÙŠÙ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ ØµÙØ­ØªÙƒ
                </div>
              )}
            </div>
          )}
        </div>

        <button
          type="submit"
          disabled={!canSave}
          className="w-full bg-gray-900 hover:bg-gray-800 text-white py-3 rounded-xl font-semibold transition disabled:opacity-60"
        >
          {saving ? "Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸â€¦" : "Ø­ÙØ¸"}
        </button>
      </form>
    </div>
  )
}

export default EditRestaurant

==========================================================================================
FILE: src/pages/Landing.tsx
==========================================================================================
// src/pages/Landing.tsx
import React from "react";
import { Link } from "react-router-dom";
import { useAuth } from "@/auth";
import { 
  Store, ShoppingCart, Package, User, Truck, Shield, Code2, 
  ChefHat, ClipboardList, Settings, LogIn, UserPlus, Phone, Loader2
} from "lucide-react";

// Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù‚Ø³Ù… - Ù…Ø­Ø³Ù† Ù„Ù„Ø¬ÙˆØ§Ù„
const SectionCard: React.FC<{
  to: string;
  icon: React.ReactNode;
  label: string;
  color: string;
  emoji?: string;
}> = ({ to, icon, label, color, emoji }) => (
  <Link
    to={to}
    className={`flex flex-col items-center justify-center gap-2 p-4 sm:p-5 rounded-2xl bg-gradient-to-br ${color} text-white shadow-lg shadow-sky-200/30 active:scale-95 transition-all duration-200 backdrop-blur-sm`}
  >
    <div className="w-12 h-12 sm:w-14 sm:h-14 bg-white/25 backdrop-blur rounded-xl flex items-center justify-center">
      {emoji ? <span className="text-2xl sm:text-3xl">{emoji}</span> : icon}
    </div>
    <span className="font-bold text-sm sm:text-base text-center leading-tight">{label}</span>
  </Link>
);

export const Landing: React.FC = () => {
  const { user, role, loading, logout } = useAuth();

  // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ - Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± ØµÙØ­Ø© Ø§Ù„Ø²Ø§Ø¦Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
  if (loading) {
    return (
      <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-sky-50 via-white to-sky-100">
        <div className="w-20 h-20 mb-6 bg-gradient-to-br from-sky-500 to-sky-600 rounded-3xl flex items-center justify-center shadow-2xl animate-pulse">
          <span className="text-5xl">ğŸ—</span>
        </div>
        <Loader2 className="w-8 h-8 text-sky-500 animate-spin mb-3" />
        <p className="text-sky-600 font-semibold">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-sky-50 via-white to-sky-100 px-3 py-4 sm:px-4 sm:py-6">
      
      {/* Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„ØªØ±Ø­ÙŠØ¨ - Ø£ØµØºØ± Ù„Ù„Ø¬ÙˆØ§Ù„ */}
      <div className="text-center mb-6">
        <div className="w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-3 bg-gradient-to-br from-sky-500 to-sky-600 rounded-2xl sm:rounded-3xl flex items-center justify-center shadow-xl">
          <span className="text-4xl sm:text-5xl">ğŸ—</span>
        </div>
        <h1 className="text-2xl sm:text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-sky-600 to-sky-500 mb-1">
          Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª
        </h1>
        {user && (
          <p className="text-sky-600/80 text-sm">
            Ø£Ù‡Ù„Ø§Ù‹ {user.displayName || user.email?.split('@')[0]} ğŸ‘‹
          </p>
        )}
      </div>

      {/* ===== Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø²Ø§Ø¦Ø± (ØºÙŠØ± Ù…Ø³Ø¬Ù„) ===== */}
      {!user && (
        <div className="max-w-sm mx-auto space-y-4">
          <div className="grid grid-cols-2 gap-3">
            <SectionCard
              to="/restaurants"
              emoji="ğŸ´"
              icon={<Store className="w-6 h-6" />}
              label="ØªØµÙØ­ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…"
              color="from-sky-500 to-sky-600"
            />
            <SectionCard
              to="/customer-login"
              emoji="ğŸ“±"
              icon={<Phone className="w-6 h-6" />}
              label="Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¬ÙˆØ§Ù„"
              color="from-green-500 to-green-600"
            />
            <SectionCard
              to="/login"
              emoji="ğŸ”‘"
              icon={<LogIn className="w-6 h-6" />}
              label="Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„"
              color="from-amber-500 to-orange-500"
            />
            <SectionCard
              to="/register"
              emoji="âœ¨"
              icon={<UserPlus className="w-6 h-6" />}
              label="Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯"
              color="from-purple-500 to-purple-600"
            />
          </div>
          <p className="text-center text-sky-600/70 text-xs">
            Ø£Ø´Ù‡Ù‰ Ø§Ù„Ø£ÙƒÙ„Ø§Øª Ø§Ù„Ø¨ÙŠØªÙŠØ© ØªÙˆØµÙ„Ùƒ Ù„ÙŠÙ† Ø¨Ø§Ø¨Ùƒ ğŸš—
          </p>
        </div>
      )}

      {/* ===== Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ ===== */}
      {role === "customer" && (
        <div className="max-w-sm mx-auto space-y-4">
          <div className="grid grid-cols-2 gap-3">
            <SectionCard
              to="/restaurants"
              emoji="ğŸ´"
              icon={<Store className="w-6 h-6" />}
              label="Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†"
              color="from-sky-500 to-sky-600"
            />
            <SectionCard
              to="/cart"
              emoji="ğŸ›’"
              icon={<ShoppingCart className="w-6 h-6" />}
              label="Ø§Ù„Ø³Ù„Ø©"
              color="from-green-500 to-green-600"
            />
            <SectionCard
              to="/orders"
              emoji="ğŸ“¦"
              icon={<Package className="w-6 h-6" />}
              label="Ø·Ù„Ø¨Ø§ØªÙŠ"
              color="from-amber-500 to-orange-500"
            />
            <SectionCard
              to="/profile"
              emoji="ğŸ‘¤"
              icon={<User className="w-6 h-6" />}
              label="Ø¨ÙŠØ§Ù†Ø§ØªÙŠ"
              color="from-purple-500 to-purple-600"
            />
          </div>
          <button
            onClick={logout}
            className="w-full py-3 rounded-xl glass-light text-sky-600 font-semibold text-sm active:bg-white/70 transition"
          >
            ğŸšª Ø®Ø±ÙˆØ¬
          </button>
        </div>
      )}

      {/* ===== Ø£Ù‚Ø³Ø§Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… ===== */}
      {role === "owner" && (
        <div className="max-w-sm mx-auto space-y-4">
          <div className="grid grid-cols-2 gap-3">
            <SectionCard
              to="/owner"
              emoji="ğŸ“Š"
              icon={<ChefHat className="w-6 h-6" />}
              label="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…"
              color="from-sky-500 to-sky-600"
            />
            <SectionCard
              to="/owner/orders"
              emoji="ğŸ“‹"
              icon={<ClipboardList className="w-6 h-6" />}
              label="Ø§Ù„Ø·Ù„Ø¨Ø§Øª"
              color="from-green-500 to-green-600"
            />
            <SectionCard
              to="/owner/menu"
              emoji="ğŸ½ï¸"
              icon={<Store className="w-6 h-6" />}
              label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©"
              color="from-amber-500 to-orange-500"
            />
            <SectionCard
              to="/owner/edit"
              emoji="âš™ï¸"
              icon={<Settings className="w-6 h-6" />}
              label="Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù…"
              color="from-purple-500 to-purple-600"
            />
            <SectionCard
              to="/owner/courier-requests"
              emoji="ğŸš—"
              icon={<Truck className="w-6 h-6" />}
              label="Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†"
              color="from-cyan-500 to-cyan-600"
            />
            <SectionCard
              to="/profile"
              emoji="ğŸ‘¤"
              icon={<User className="w-6 h-6" />}
              label="Ø­Ø³Ø§Ø¨ÙŠ"
              color="from-gray-500 to-gray-600"
            />
          </div>
          <button
            onClick={logout}
            className="w-full py-3 rounded-xl glass-light text-sky-600 font-semibold text-sm active:bg-white/70 transition"
          >
            ğŸšª Ø®Ø±ÙˆØ¬
          </button>
        </div>
      )}

      {/* ===== Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ===== */}
      {role === "courier" && (
        <div className="max-w-sm mx-auto space-y-4">
          <div className="grid grid-cols-2 gap-3">
            <SectionCard
              to="/courier"
              emoji="ğŸ“¦"
              icon={<Truck className="w-6 h-6" />}
              label="Ø·Ù„Ø¨Ø§Øª Ø¬Ø§Ù‡Ø²Ø©"
              color="from-sky-500 to-sky-600"
            />
            <SectionCard
              to="/courier/hiring"
              emoji="ğŸª"
              icon={<Store className="w-6 h-6" />}
              label="Ø§Ù†Ø¶Ù… Ù„Ù…Ø·Ø¹Ù…"
              color="from-green-500 to-green-600"
            />
            <SectionCard
              to="/profile"
              emoji="ğŸ‘¤"
              icon={<User className="w-6 h-6" />}
              label="Ø­Ø³Ø§Ø¨ÙŠ"
              color="from-purple-500 to-purple-600"
            />
          </div>
          <button
            onClick={logout}
            className="w-full py-3 rounded-xl glass-light text-sky-600 font-semibold text-sm active:bg-white/70 transition"
          >
            ğŸšª Ø®Ø±ÙˆØ¬
          </button>
        </div>
      )}

      {/* ===== Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø´Ø±Ù ===== */}
      {role === "admin" && (
        <div className="max-w-sm mx-auto space-y-4">
          <div className="grid grid-cols-2 gap-3">
            <SectionCard
              to="/admin"
              emoji="ğŸ‘‘"
              icon={<Shield className="w-6 h-6" />}
              label="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…"
              color="from-sky-500 to-sky-600"
            />
            <SectionCard
              to="/admin/restaurants"
              emoji="ğŸª"
              icon={<Store className="w-6 h-6" />}
              label="Ø§Ù„Ù…Ø·Ø§Ø¹Ù…"
              color="from-green-500 to-green-600"
            />
            <SectionCard
              to="/admin/orders"
              emoji="ğŸ“¦"
              icon={<Package className="w-6 h-6" />}
              label="Ø§Ù„Ø·Ù„Ø¨Ø§Øª"
              color="from-amber-500 to-orange-500"
            />
            <SectionCard
              to="/restaurants"
              emoji="ğŸ›’"
              icon={<ShoppingCart className="w-6 h-6" />}
              label="Ø§Ø·Ù„Ø¨ ÙƒØ¹Ù…ÙŠÙ„"
              color="from-purple-500 to-purple-600"
            />
            <SectionCard
              to="/profile"
              emoji="ğŸ‘¤"
              icon={<User className="w-6 h-6" />}
              label="Ø­Ø³Ø§Ø¨ÙŠ"
              color="from-gray-500 to-gray-600"
            />
          </div>
          <button
            onClick={logout}
            className="w-full py-3 rounded-xl glass-light text-sky-600 font-semibold text-sm active:bg-white/70 transition"
          >
            ğŸšª Ø®Ø±ÙˆØ¬
          </button>
        </div>
      )}

      {/* ===== Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø·ÙˆØ± ===== */}
      {role === "developer" && (
        <div className="max-w-sm mx-auto space-y-4">
          <div className="grid grid-cols-2 gap-3">
            <SectionCard
              to="/developer"
              emoji="ğŸ’»"
              icon={<Code2 className="w-6 h-6" />}
              label="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…"
              color="from-sky-500 to-sky-600"
            />
            <SectionCard
              to="/restaurants"
              emoji="ğŸ´"
              icon={<Store className="w-6 h-6" />}
              label="Ø§Ù„Ù…Ø·Ø§Ø¹Ù…"
              color="from-green-500 to-green-600"
            />
            <SectionCard
              to="/admin/orders"
              emoji="ğŸ“¦"
              icon={<Package className="w-6 h-6" />}
              label="Ø§Ù„Ø·Ù„Ø¨Ø§Øª"
              color="from-amber-500 to-orange-500"
            />
            <SectionCard
              to="/profile"
              emoji="ğŸ‘¤"
              icon={<User className="w-6 h-6" />}
              label="Ø­Ø³Ø§Ø¨ÙŠ"
              color="from-purple-500 to-purple-600"
            />
          </div>
          <button
            onClick={logout}
            className="w-full py-3 rounded-xl glass-light text-sky-600 font-semibold text-sm active:bg-white/70 transition"
          >
            ğŸšª Ø®Ø±ÙˆØ¬
          </button>
        </div>
      )}

    </div>
  );
};

==========================================================================================
FILE: src/pages/Login.tsx
==========================================================================================
// src/pages/Login.tsx
import React, { useState } from 'react'
import { signInWithEmailAndPassword, sendPasswordResetEmail } from 'firebase/auth'
import { auth, db } from '@/firebase'
import { doc, getDoc } from 'firebase/firestore'
import { Link, useNavigate } from 'react-router-dom'
import { Mail, Lock, LogIn, Sparkles, KeyRound, ArrowRight, Loader2 } from 'lucide-react'
import { useDialog } from '@/components/ui/ConfirmDialog'
import { useToast } from '@/components/ui/Toast'

export const Login: React.FC = () => {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [loading, setLoading] = useState(false)
  const [showForgotPassword, setShowForgotPassword] = useState(false)
  const [resetEmail, setResetEmail] = useState('')
  const [resetLoading, setResetLoading] = useState(false)
  const nav = useNavigate()
  const dialog = useDialog()
  const toast = useToast()

  const submit = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)
    try {
      const userCred = await signInWithEmailAndPassword(auth, email, password)
      const uid = userCred.user.uid

      const snap = await getDoc(doc(db, "users", uid))
      if (snap.exists()) {
        const userData = snap.data()

        if (userData.role === "owner") {
          nav("/owner")
        } else if (userData.role === "admin") {
          nav("/admin")
        } else if (userData.role === "developer") {
          nav("/developer")
        } else if (userData.role === "courier") {
          nav("/courier")
        } else {
          nav("/")
        }
      } else {
        dialog.warning('Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Auth Ù„ÙƒÙ† Ù„Ø§ ØªÙˆØ¬Ø¯ Ù„Ù‡ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firestore')
      }
    } catch (e: any) {
      dialog.error(e.message, { title: 'Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„' })
    } finally {
      setLoading(false)
    }
  }

  // Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
  const handleForgotPassword = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!resetEmail.trim()) {
      toast.warning('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ')
      return
    }
    
    setResetLoading(true)
    try {
      await sendPasswordResetEmail(auth, resetEmail.trim().toLowerCase())
      toast.success('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±! ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø±ÙŠØ¯Ùƒ ğŸ“§')
      // Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø¶Ø§ÙÙŠØ©
      setTimeout(() => {
        dialog.info('Ø¥Ø°Ø§ Ù„Ù… ØªØ¬Ø¯ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨Ø© (Spam)', {
          title: 'ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©'
        })
      }, 1000)
      setShowForgotPassword(false)
      setResetEmail('')
    } catch (error: any) {
      console.error('Reset password error:', error)
      if (error.code === 'auth/user-not-found') {
        toast.error('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø³Ø¬Ù„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ')
      } else if (error.code === 'auth/invalid-email') {
        toast.error('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­')
      } else if (error.code === 'auth/too-many-requests') {
        toast.error('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ø§Øª ÙƒØ«ÙŠØ±Ø©ØŒ Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰')
      } else {
        toast.error(`Ø­Ø¯Ø« Ø®Ø·Ø£: ${error.message}`)
      }
    } finally {
      setResetLoading(false)
    }
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-sky-50 via-white to-sky-100 px-4">
      {/* Ø®Ù„ÙÙŠØ© Ø²Ø®Ø±ÙÙŠØ© */}
      <div className="absolute top-0 left-0 w-72 h-72 bg-sky-300/20 rounded-full blur-3xl"></div>
      <div className="absolute bottom-0 right-0 w-72 h-72 bg-sky-400/20 rounded-full blur-3xl"></div>
      
      <div className="relative bg-white/80 backdrop-blur-xl border border-sky-100 rounded-[2rem] shadow-2xl shadow-sky-200/50 w-full max-w-md p-8">
        
        {/* Ø´Ø¹Ø§Ø± */}
        <div className="flex flex-col items-center mb-8">
          <div className="w-20 h-20 bg-gradient-to-br from-sky-500 to-sky-600 rounded-2xl flex items-center justify-center shadow-xl shadow-sky-300/50 mb-4">
            <span className="text-4xl">  ğŸ</span>
          </div>
          <h1 className="text-3xl font-black text-sky-600">Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª</h1>
          <p className="text-sky-500 mt-1">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>
        </div>

        {/* Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */}
        <form onSubmit={submit} className="space-y-4">
          <div className="relative">
            <Mail className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-sky-400" />
            <input
              type="email"
              placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„"
              className="w-full rounded-2xl p-4 pr-12 bg-sky-50 text-sky-900 border-2 border-sky-100 
                         focus:outline-none focus:border-sky-400 focus:ring-4 focus:ring-sky-100 transition-all"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
            />
          </div>
          <div className="relative">
            <Lock className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-sky-400" />
            <input
              type="password"
              placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
              className="w-full rounded-2xl p-4 pr-12 bg-sky-50 text-sky-900 border-2 border-sky-100 
                         focus:outline-none focus:border-sky-400 focus:ring-4 focus:ring-sky-100 transition-all"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
            />
          </div>

          {/* Ø±Ø§Ø¨Ø· Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */}
          <div className="text-left">
            <button
              type="button"
              onClick={() => {
                setShowForgotPassword(true)
                setResetEmail(email) // Ù†Ù‚Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø®Ù„
              }}
              className="text-sm text-sky-500 hover:text-sky-700 font-medium hover:underline"
            >
              ğŸ”‘ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ
            </button>
          </div>

          <button
            disabled={loading}
            className="w-full flex items-center justify-center gap-3 bg-gradient-to-r from-sky-500 to-sky-600 hover:from-sky-600 hover:to-sky-700 text-white font-bold p-4 rounded-2xl 
                       shadow-xl shadow-sky-300/50 transition-all hover:scale-[1.02] hover:shadow-sky-400/50"
          >
            {loading ? (
              <>Ø¬Ø§Ø±Ù Ø§Ù„Ø¯Ø®ÙˆÙ„...</>
            ) : (
              <>
                <LogIn className="w-5 h-5" />
                Ø¯Ø®ÙˆÙ„
              </>
            )}
          </button>
        </form>

        {/* Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */}
        <p className="mt-8 text-center text-sky-600">
          Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ{' '}
          <Link 
            className="text-sky-500 hover:text-sky-700 font-bold" 
            to="/register"
          >
            Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¢Ù† âœ¨
          </Link>
        </p>

        {/* Ø±Ø§Ø¨Ø· ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ */}
        <div className="mt-6 pt-6 border-t border-sky-100">
          <p className="text-center text-sm text-gray-500 mb-3">
            Ø¹Ù…ÙŠÙ„ ØªØ±ÙŠØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ØŸ
          </p>
          <Link 
            to="/customer-login"
            className="block w-full text-center bg-green-50 hover:bg-green-100 text-green-700 font-semibold py-3 px-4 rounded-2xl transition"
          >
            ğŸ“± Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
          </Link>
        </div>
      </div>

      {/* Ù†Ø§ÙØ°Ø© Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */}
      {showForgotPassword && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md p-8 relative">
            {/* Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ */}
            <button
              onClick={() => setShowForgotPassword(false)}
              className="absolute top-4 left-4 p-2 hover:bg-gray-100 rounded-full transition"
            >
              <ArrowRight className="w-5 h-5 text-gray-500" />
            </button>

            {/* Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† */}
            <div className="text-center mb-6">
              <div className="w-16 h-16 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                <KeyRound className="w-8 h-8 text-white" />
              </div>
              <h2 className="text-2xl font-bold text-gray-800">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</h2>
              <p className="text-gray-500 mt-2 text-sm">
                Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ø§Ø¨Ø· Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
              </p>
            </div>

            {/* Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† */}
            <form onSubmit={handleForgotPassword} className="space-y-4">
              <div className="relative">
                <Mail className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-amber-500" />
                <input
                  type="email"
                  placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
                  className="w-full rounded-2xl p-4 pr-12 bg-amber-50 text-gray-900 border-2 border-amber-100 
                             focus:outline-none focus:border-amber-400 focus:ring-4 focus:ring-amber-100 transition-all"
                  value={resetEmail}
                  onChange={(e) => setResetEmail(e.target.value)}
                  autoFocus
                />
              </div>

              <button
                type="submit"
                disabled={resetLoading}
                className="w-full flex items-center justify-center gap-3 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-bold p-4 rounded-2xl 
                           shadow-xl shadow-amber-300/50 transition-all hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {resetLoading ? (
                  <>
                    <Loader2 className="w-5 h-5 animate-spin" />
                    Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...
                  </>
                ) : (
                  <>
                    <Mail className="w-5 h-5" />
                    Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
                  </>
                )}
              </button>
            </form>

            {/* Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹ÙˆØ¯Ø© */}
            <button
              onClick={() => setShowForgotPassword(false)}
              className="w-full mt-4 text-center text-gray-500 hover:text-gray-700 font-medium"
            >
              Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
          </div>
        </div>
      )}
    </div>
  )
}

==========================================================================================
FILE: src/pages/ManageMenu.tsx
==========================================================================================
// src/pages/ManageMenu.tsx
import React, { useEffect, useMemo, useRef, useState } from 'react'
import { db, app } from '@/firebase'
import {
  addDoc,
  collection,
  deleteDoc,
  doc,
  getDocs,
  query,
  where,
  updateDoc,
} from 'firebase/firestore'
import {
  getDownloadURL,
  getStorage,
  ref,
  uploadBytesResumable,
} from 'firebase/storage'
import { useAuth } from '@/auth'
import { useDialog } from '@/components/ui/ConfirmDialog'

/* =======================
   Toast Ù…Ø­Ù„ÙŠ Ø¨Ø³ÙŠØ· Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø©
   ======================= */
type ToastKind = 'success' | 'error' | 'info' | 'warning'
const Toast: React.FC<{ kind: ToastKind; message: string; onClose: () => void }> = ({ kind, message, onClose }) => {
  const base =
    kind === 'success' ? 'bg-green-600' :
    kind === 'error'   ? 'bg-rose-600'  :
    kind === 'warning' ? 'bg-amber-500' : 'bg-slate-800'
  useEffect(() => {
    const t = setTimeout(onClose, 2500)
    return () => clearTimeout(t)
  }, [onClose])
  return (
    <div className={`fixed bottom-4 right-4 z-50 rounded-xl px-4 py-3 text-white shadow-lg ${base}`}>
      {message}
    </div>
  )
}

/* =======================
   Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ ÙˆØ§Ù„Ø­Ø§Ù„Ø©
   ======================= */
type Item = {
  id?: string
  name: string
  desc?: string
  price: number           // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
  imageUrl?: string
  available: boolean
  categoryId?: string
  ownerId?: string
  file?: File | null
  // Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª
  discountPercent?: number // Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… (0-100)
  discountExpiresAt?: Date | string // ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø®ØµÙ…

  // Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªÙØ§Ø¦Ù„Ø©
  _tempId?: string
  _optimistic?: boolean
  _progress?: number // 0..100
}

const emptyItem = (): Item => ({
  name: '',
  desc: '',
  price: 0,
  available: true,
  file: null,
  discountPercent: 0,
  discountExpiresAt: '',
})

/** Ø¶ØºØ· Ø®ÙÙŠÙ Ù„Ù„ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø±ÙØ¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) */
async function compressImage(file: File, maxW = 900, quality = 0.8): Promise<Blob> {
  try {
    const bitmap = await createImageBitmap(file)
    const scale = Math.min(1, maxW / bitmap.width)
    const w = Math.round(bitmap.width * scale)
    const h = Math.round(bitmap.height * scale)

    const canvas = document.createElement('canvas')
    canvas.width = w
    canvas.height = h
    const ctx = canvas.getContext('2d')!
    ctx.drawImage(bitmap, 0, 0, w, h)

    const type = file.type.includes('png') ? 'image/png' : 'image/jpeg'
    const blob = await new Promise<Blob>((res) => canvas.toBlob((b) => res(b!), type, quality))
    return blob
  } catch {
    return file
  }
}

export const ManageMenu: React.FC = () => {
  const { user } = useAuth()
  const confirmDialog = useDialog()
  const [items, setItems] = useState<Item[]>([])
  const [loading, setLoading] = useState(true)
  const [form, setForm] = useState<Item>(emptyItem())
  const [saving, setSaving] = useState(false)
  
  // âœ… Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
  const [editingId, setEditingId] = useState<string | null>(null)
  const [editForm, setEditForm] = useState<Item>(emptyItem())
  const [editSaving, setEditSaving] = useState(false)
  const editFileRef = useRef<HTMLInputElement | null>(null)

  // Toast state
  const [toast, setToast] = useState<{ kind: ToastKind; message: string } | null>(null)
  const notify = (kind: ToastKind, message: string) => setToast({ kind, message })

  // âš ï¸ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙƒØª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ (Ø¨Ø¯ÙˆÙ† URL ÙŠØ¯ÙˆÙŠ)
  const storage = getStorage(app)
  const fileRef = useRef<HTMLInputElement | null>(null)

  // âœ… ØªØ­Ù…ÙŠÙ„ Ø£ØµÙ†Ø§Ù Ù…Ø§Ù„Ùƒ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙ‚Ø·
  const load = async () => {
    if (!user) return
    setLoading(true)
    const q = query(collection(db, 'menuItems'), where('ownerId', '==', user.uid))
    const snap = await getDocs(q)
    setItems(snap.docs.map(d => ({ id: d.id, ...(d.data() as any) })))
    setLoading(false)
  }

  useEffect(() => { load() }, [user])

  // âœ… Ø¥Ø¶Ø§ÙØ© Ù…ØªÙØ§Ø¦Ù„Ø© + Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù‘Ù… + Ø¶ØºØ· ØµÙˆØ±Ø©
  const save = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!user) {
      notify('warning', 'âš ï¸ Ù„Ø§Ø²Ù… ØªØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„')
      return
    }

    const price = Number(form.price || 0)
    if (!form.name.trim()) {
      notify('warning', 'âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù')
      return
    }
    if (!Number.isFinite(price) || price <= 0) {
      notify('warning', 'âš ï¸ Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± ØµØ§Ù„Ø­')
      return
    }

    setSaving(true)

    // 1) Ø£Ø¶Ù Ø¨Ø·Ø§Ù‚Ø© Ù…Ø­Ù„ÙŠØ© ÙÙˆØ±ÙŠØ© (Optimistic)
    const tempId = 'temp_' + Date.now()
    const localPreview = form.file ? URL.createObjectURL(form.file) : undefined

    const optimistic: Item = {
      _tempId: tempId,
      _optimistic: true,
      _progress: form.file ? 1 : 100,
      name: form.name,
      desc: form.desc || '',
      price,
      imageUrl: localPreview,
      available: form.available ?? true,
      ownerId: user.uid,
    }
    setItems(prev => [optimistic, ...prev])

    try {
      // 2) Ø§Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù† ÙˆÙØ¬Ø¯Øª (Ù…Ø¹ ØªÙ‚Ø¯Ù…)
      let imageUrl: string | undefined
      if (form.file) {
        const blob = await compressImage(form.file)
        const safeName = form.file.name.replace(/\s+/g, '_').slice(-60)
        const path = `menuImages/${user.uid}_${Date.now()}_${safeName}`
        const storageRef = ref(storage, path)
        const task = uploadBytesResumable(storageRef, blob, {
          contentType: form.file.type || 'image/jpeg',
        })

        await new Promise<void>((resolve, reject) => {
          task.on(
            'state_changed',
            snap => {
              const p = Math.round((snap.bytesTransferred / snap.totalBytes) * 100)
              setItems(prev => prev.map(i => i._tempId === tempId ? { ...i, _progress: p } : i))
            },
            reject,
            async () => {
              const url = await getDownloadURL(task.snapshot.ref)
              // bust cache ÙÙˆØ±ÙŠØ§Ù‹
              imageUrl = `${url}${url.includes('?') ? '&' : '?'}v=${Date.now()}`
              resolve()
            }
          )
        })
      }

      // 3) Ø£Ù†Ø´Ø¦ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ÙÙŠ ÙØ§ÙŠØ±Ø³ØªÙˆØ±
      const payload: any = {
        name: optimistic.name,
        desc: optimistic.desc,
        price,
        imageUrl: imageUrl || '',
        available: optimistic.available,
        ownerId: user.uid,
        ...(optimistic.categoryId ? { categoryId: optimistic.categoryId } : {}),
        // Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø®ØµÙ…
        ...(form.discountPercent && form.discountPercent > 0 ? { discountPercent: form.discountPercent } : {}),
        ...(form.discountExpiresAt ? { discountExpiresAt: new Date(form.discountExpiresAt) } : {}),
      }
      const created = await addDoc(collection(db, 'menuItems'), payload)

      // 4) Ø¨Ø¯Ù‘Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ø¨Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
      setItems(prev =>
        prev.map(i =>
          i._tempId === tempId
            ? { ...i, id: created.id, imageUrl: imageUrl || i.imageUrl, _optimistic: false, _progress: 100 }
            : i
        )
      )

      notify('success', 'âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­')
    } catch (err: any) {
      // Ø±Ø¬ÙˆØ¹ Ø¹Ù† Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ùˆ ÙØ´Ù„
      setItems(prev => prev.filter(i => i._tempId !== tempId))
      notify('error', `âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù: ${err?.message || err}`)
    } finally {
      setSaving(false)
      // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      setForm(emptyItem())
      if (fileRef.current) fileRef.current.value = ''
      // Ø­Ø±Ø± Ø§Ù„Ù€ blob Ù„Ùˆ ÙÙŠÙ‡
      if (localPreview) URL.revokeObjectURL(localPreview)
    }
  }

  // âœ… ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ù…ØªÙØ§Ø¦Ù„
  const toggle = async (id?: string, avail?: boolean) => {
    if (!id) return
    setItems(prev => prev.map(i => (i.id === id ? { ...i, available: !avail } : i)))
    try {
      await updateDoc(doc(db, 'menuItems', id), { available: !avail })
      notify('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©')
    } catch {
      setItems(prev => prev.map(i => (i.id === id ? { ...i, available: !!avail } : i)))
      notify('error', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØºÙŠÙŠØ±. Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.')
    }
  }

  // âœ… Ø­Ø°Ù Ù…ØªÙØ§Ø¦Ù„
  const remove = async (id?: string) => {
    if (!id) return
    const confirmed = await confirmDialog.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†Ù Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ', { dangerous: true, title: 'Ø­Ø°Ù Ø§Ù„ØµÙ†Ù' })
    if (!confirmed) return
    const prev = items
    setItems(p => p.filter(x => x.id !== id))
    try {
      await deleteDoc(doc(db, 'menuItems', id))
      notify('success', 'ØªÙ… Ø§Ù„Ø­Ø°Ù')
    } catch {
      setItems(prev)
      notify('error', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù. Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.')
    }
  }

  // âœ… Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
  const startEdit = (item: Item) => {
    setEditingId(item.id || null)
    setEditForm({ ...item, file: null })
  }

  // âœ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
  const cancelEdit = () => {
    setEditingId(null)
    setEditForm(emptyItem())
    if (editFileRef.current) editFileRef.current.value = ''
  }

  // âœ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
  const saveEdit = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!user || !editingId) return

    const price = Number(editForm.price || 0)
    if (!editForm.name.trim()) {
      notify('warning', 'âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù')
      return
    }
    if (!Number.isFinite(price) || price <= 0) {
      notify('warning', 'âš ï¸ Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± ØµØ§Ù„Ø­')
      return
    }

    setEditSaving(true)
    const prevItems = items

    // ØªØ­Ø¯ÙŠØ« Ù…ØªÙØ§Ø¦Ù„ Ù„Ù„Ù€ UI
    setItems(prev => prev.map(i => 
      i.id === editingId 
        ? { ...i, name: editForm.name, desc: editForm.desc, price, available: editForm.available }
        : i
    ))

    try {
      let imageUrl = editForm.imageUrl

      // Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù† ÙˆÙØ¬Ø¯Øª
      if (editForm.file) {
        const blob = await compressImage(editForm.file)
        const safeName = editForm.file.name.replace(/\s+/g, '_').slice(-60)
        const path = `menuImages/${user.uid}_${Date.now()}_${safeName}`
        const storageRef = ref(storage, path)
        const task = uploadBytesResumable(storageRef, blob, {
          contentType: editForm.file.type || 'image/jpeg',
        })

        await new Promise<void>((resolve, reject) => {
          task.on('state_changed', null, reject, async () => {
            const url = await getDownloadURL(task.snapshot.ref)
            imageUrl = `${url}${url.includes('?') ? '&' : '?'}v=${Date.now()}`
            resolve()
          })
        })
      }

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ÙÙŠ Firestore
      await updateDoc(doc(db, 'menuItems', editingId), {
        name: editForm.name,
        desc: editForm.desc || '',
        price,
        available: editForm.available,
        ...(imageUrl ? { imageUrl } : {}),
        // ØªØ­Ø¯ÙŠØ« Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø®ØµÙ…
        discountPercent: editForm.discountPercent || 0,
        ...(editForm.discountExpiresAt ? { discountExpiresAt: new Date(editForm.discountExpiresAt) } : { discountExpiresAt: null }),
      })

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ UI Ø¨Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      if (imageUrl) {
        setItems(prev => prev.map(i => i.id === editingId ? { ...i, imageUrl } : i))
      }

      notify('success', 'âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­')
      cancelEdit()
    } catch (err: any) {
      // Ø±Ø¬ÙˆØ¹ Ø¹Ù† Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù„Ùˆ ÙØ´Ù„
      setItems(prevItems)
      notify('error', `âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${err?.message || err}`)
    } finally {
      setEditSaving(false)
    }
  }

  if (loading) {
    return (
      <div className="grid lg:grid-cols-2 gap-6">
        <div className="bg-white rounded-2xl shadow p-6 space-y-3">
          <div className="h-6 w-40 bg-gray-200 rounded animate-pulse" />
          <div className="h-10 w-full bg-gray-200 rounded animate-pulse" />
          <div className="h-24 w-full bg-gray-200 rounded animate-pulse" />
          <div className="h-10 w-full bg-gray-200 rounded animate-pulse" />
          <div className="h-10 w-32 bg-gray-200 rounded animate-pulse" />
        </div>
        <div className="space-y-3">
          {[1,2,3].map(i => (
            <div key={i} className="bg-white rounded-2xl shadow p-4 flex items-center gap-4">
              <div className="w-20 h-20 bg-gray-200 rounded-xl animate-pulse" />
              <div className="flex-1 space-y-2">
                <div className="h-4 w-48 bg-gray-200 rounded animate-pulse" />
                <div className="h-3 w-64 bg-gray-200 rounded animate-pulse" />
                <div className="h-4 w-24 bg-gray-200 rounded animate-pulse" />
              </div>
            </div>
          ))}
        </div>
      </div>
    )
  }

  return (
    <>
      {toast && <Toast kind={toast.kind} message={toast.message} onClose={() => setToast(null)} />}

      <div className="grid lg:grid-cols-2 gap-6">
        {/* ğŸ“ ÙÙˆØ±Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */}
        <form onSubmit={save} className="bg-white rounded-2xl shadow p-6 space-y-3">
          <h2 className="text-lg font-bold">Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</h2>

          <input
            className="w-full border rounded-xl p-3"
            placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù"
            value={form.name}
            onChange={e => setForm({ ...form, name: e.target.value })}
          />

          <textarea
            className="w-full border rounded-xl p-3"
            placeholder="Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
            value={form.desc}
            onChange={e => setForm({ ...form, desc: e.target.value })}
          />

          <input
            className="w-full border rounded-xl p-3"
            placeholder="Ø§Ù„Ø³Ø¹Ø±"
            type="number"
            min={0}
            step={0.5}
            inputMode="decimal"
            value={Number.isFinite(form.price) ? form.price : 0}
            onChange={e => setForm({ ...form, price: Number(e.target.value) })}
          />

          {/* Ù‚Ø³Ù… Ø§Ù„Ø®ØµÙ… */}
          <div className="border border-dashed border-amber-300 rounded-xl p-4 bg-amber-50/50 space-y-3">
            <h3 className="text-sm font-bold text-amber-700 flex items-center gap-2">
              ğŸ·ï¸ Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            </h3>
            <div className="grid grid-cols-2 gap-3">
              <div>
                <label className="text-xs text-gray-600 mb-1 block">Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… %</label>
                <input
                  className="w-full border rounded-xl p-3"
                  placeholder="Ù…Ø«Ø§Ù„: 20"
                  type="number"
                  min={0}
                  max={100}
                  value={form.discountPercent || ''}
                  onChange={e => setForm({ ...form, discountPercent: Number(e.target.value) || 0 })}
                />
              </div>
              <div>
                <label className="text-xs text-gray-600 mb-1 block">ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ</label>
                <input
                  className="w-full border rounded-xl p-3"
                  type="date"
                  value={form.discountExpiresAt ? (typeof form.discountExpiresAt === 'string' ? form.discountExpiresAt : new Date(form.discountExpiresAt).toISOString().split('T')[0]) : ''}
                  onChange={e => setForm({ ...form, discountExpiresAt: e.target.value })}
                />
              </div>
            </div>
            {form.discountPercent && form.discountPercent > 0 && (
              <div className="text-sm bg-green-100 text-green-700 p-2 rounded-lg">
                Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: <strong>{(form.price - (form.price * (form.discountPercent / 100))).toFixed(2)} Ø±.Ø³</strong>
                <span className="line-through text-gray-400 mr-2">{form.price.toFixed(2)} Ø±.Ø³</span>
              </div>
            )}
          </div>

          <input
            ref={fileRef}
            className="w-full border rounded-xl p-3"
            type="file"
            accept="image/*"
            onChange={e => setForm({ ...form, file: e.target.files?.[0] || null })}
          />

          <label className="flex items-center gap-2 text-sm">
            <input
              type="checkbox"
              checked={form.available}
              onChange={e => setForm({ ...form, available: e.target.checked })}
            />
            Ù…ØªØ§Ø­
          </label>

          <button
            className="px-4 py-2 rounded-xl bg-gray-900 text-white disabled:opacity-60"
            disabled={saving}
          >
            {saving ? 'Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸â€¦' : 'Ø­ÙØ¸'}
          </button>
        </form>

        {/* ğŸ›’ Ø¹Ø±Ø¶ Ø§Ù„Ø£ØµÙ†Ø§Ù */}
        <div className="space-y-3">
          {items.map(it => (
            <div key={it.id || it._tempId} className="bg-white rounded-2xl shadow p-4">
              {/* ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */}
              {editingId === it.id ? (
                <form onSubmit={saveEdit} className="space-y-3">
                  <div className="flex items-center gap-3 mb-3">
                    <img
                      src={editForm.file ? URL.createObjectURL(editForm.file) : (editForm.imageUrl || '')}
                      className="w-20 h-20 object-cover rounded-xl bg-gray-100"
                      onError={(e: any) => { e.currentTarget.style.display = 'none' }}
                    />
                    <div className="flex-1">
                      <label className="text-sm text-gray-600 block mb-1">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</label>
                      <input
                        ref={editFileRef}
                        type="file"
                        accept="image/*"
                        className="w-full text-sm border rounded-lg p-2"
                        onChange={e => setEditForm({ ...editForm, file: e.target.files?.[0] || null })}
                      />
                    </div>
                  </div>

                  <input
                    className="w-full border rounded-xl p-3"
                    placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù"
                    value={editForm.name}
                    onChange={e => setEditForm({ ...editForm, name: e.target.value })}
                  />

                  <textarea
                    className="w-full border rounded-xl p-3"
                    placeholder="Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
                    value={editForm.desc || ''}
                    onChange={e => setEditForm({ ...editForm, desc: e.target.value })}
                  />

                  <input
                    className="w-full border rounded-xl p-3"
                    placeholder="Ø§Ù„Ø³Ø¹Ø±"
                    type="number"
                    min={0}
                    step={0.5}
                    inputMode="decimal"
                    value={Number.isFinite(editForm.price) ? editForm.price : 0}
                    onChange={e => setEditForm({ ...editForm, price: Number(e.target.value) })}
                  />

                  {/* Ù‚Ø³Ù… Ø§Ù„Ø®ØµÙ… ÙÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */}
                  <div className="border border-dashed border-amber-300 rounded-xl p-4 bg-amber-50/50 space-y-3">
                    <h3 className="text-sm font-bold text-amber-700 flex items-center gap-2">
                      ğŸ·ï¸ Ø§Ù„Ø®ØµÙ…
                    </h3>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <label className="text-xs text-gray-600 mb-1 block">Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… %</label>
                        <input
                          className="w-full border rounded-xl p-3"
                          placeholder="Ù…Ø«Ø§Ù„: 20"
                          type="number"
                          min={0}
                          max={100}
                          value={editForm.discountPercent || ''}
                          onChange={e => setEditForm({ ...editForm, discountPercent: Number(e.target.value) || 0 })}
                        />
                      </div>
                      <div>
                        <label className="text-xs text-gray-600 mb-1 block">ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ</label>
                        <input
                          className="w-full border rounded-xl p-3"
                          type="date"
                          value={editForm.discountExpiresAt ? (typeof editForm.discountExpiresAt === 'string' ? editForm.discountExpiresAt : new Date(editForm.discountExpiresAt).toISOString().split('T')[0]) : ''}
                          onChange={e => setEditForm({ ...editForm, discountExpiresAt: e.target.value })}
                        />
                      </div>
                    </div>
                    {editForm.discountPercent && editForm.discountPercent > 0 && (
                      <div className="text-sm bg-green-100 text-green-700 p-2 rounded-lg">
                        Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: <strong>{(editForm.price - (editForm.price * (editForm.discountPercent / 100))).toFixed(2)} Ø±.Ø³</strong>
                        <span className="line-through text-gray-400 mr-2">{editForm.price.toFixed(2)} Ø±.Ø³</span>
                      </div>
                    )}
                    {editForm.discountPercent && editForm.discountPercent > 0 && (
                      <button
                        type="button"
                        onClick={() => setEditForm({ ...editForm, discountPercent: 0, discountExpiresAt: '' })}
                        className="text-xs text-red-500 hover:text-red-700"
                      >
                        âŒ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®ØµÙ…
                      </button>
                    )}
                  </div>

                  <label className="flex items-center gap-2 text-sm">
                    <input
                      type="checkbox"
                      checked={editForm.available}
                      onChange={e => setEditForm({ ...editForm, available: e.target.checked })}
                    />
                    Ù…ØªØ§Ø­
                  </label>

                  <div className="flex gap-2">
                    <button
                      type="submit"
                      disabled={editSaving}
                      className="flex-1 px-4 py-2 rounded-xl bg-green-600 text-white disabled:opacity-60"
                    >
                      {editSaving ? 'Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸â€¦' : 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'}
                    </button>
                    <button
                      type="button"
                      onClick={cancelEdit}
                      disabled={editSaving}
                      className="px-4 py-2 rounded-xl bg-gray-400 text-white disabled:opacity-60"
                    >
                      Ø¥Ù„ØºØ§Ø¡
                    </button>
                  </div>
                </form>
              ) : (
                /* ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø§Ø¯ÙŠ */
                <div className="flex items-center gap-4">
                  <div className="relative">
                    <img
                      src={it.imageUrl || ''}
                      className="w-20 h-20 object-cover rounded-xl bg-gray-100"
                      onError={(e: any) => { e.currentTarget.style.display = 'none' }}
                    />
                    {it._optimistic && (
                      <div className="absolute -bottom-2 left-0 right-0">
                        <div className="h-1 w-20 rounded bg-gray-200 overflow-hidden">
                          <div
                            className="h-full bg-yellow-500 transition-[width]"
                            style={{ width: `${it._progress || 1}%` }}
                          />
                        </div>
                      </div>
                    )}
                  </div>

                  <div className="flex-1">
                    <div className="font-bold">{it.name}</div>
                    {it.desc && <div className="text-sm text-gray-600">{it.desc}</div>}
                    {/* Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ù…Ø¹ Ø§Ù„Ø®ØµÙ… */}
                    {(() => {
                      const hasDiscount = it.discountPercent && it.discountPercent > 0
                      const expiryDate = (it.discountExpiresAt as any)?.toDate?.() || (it.discountExpiresAt ? new Date(it.discountExpiresAt as string) : null)
                      const isValid = !expiryDate || expiryDate > new Date()
                      
                      if (hasDiscount && isValid) {
                        return (
                          <div className="mt-1 flex items-center gap-2 flex-wrap">
                            <span className="font-bold text-green-600">{(it.price - (it.price * ((it.discountPercent || 0) / 100))).toFixed(2)} Ø±.Ø³</span>
                            <span className="text-sm text-gray-400 line-through">{it.price?.toFixed?.(2)} Ø±.Ø³</span>
                            <span className="bg-red-500 text-white text-xs px-2 py-0.5 rounded-full">Ø®ØµÙ… {it.discountPercent}%</span>
                          </div>
                        )
                      }
                      return <div className="font-semibold mt-1">{it.price?.toFixed?.(2)} Ø±.Ø³</div>
                    })()}
                    {it._optimistic && <div className="text-xs text-yellow-600 mt-1">ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸â€¦</div>}
                  </div>

                  <div className="flex flex-col sm:flex-row gap-2">
                    <button
                      onClick={() => startEdit(it)}
                      disabled={!!it._optimistic}
                      className="px-3 py-2 rounded-xl text-sm bg-amber-500 text-white disabled:opacity-50"
                    >
                      âœï¸ ØªØ¹Ø¯ÙŠÙ„
                    </button>
                    <button
                      onClick={() => toggle(it.id, it.available)}
                      disabled={!!it._optimistic}
                      className="px-3 py-2 rounded-xl text-sm bg-blue-600 text-white disabled:opacity-50"
                    >
                      {it.available ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„'}
                    </button>
                    <button
                      onClick={() => remove(it.id)}
                      disabled={!!it._optimistic}
                      className="px-3 py-2 rounded-xl text-sm bg-red-600 text-white disabled:opacity-50"
                    >
                      Ø­Ø°Ù
                    </button>
                  </div>
                </div>
              )}
            </div>
          ))}
          {items.length === 0 && <div className="text-gray-600">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù Ø¨Ø¹Ø¯.</div>}
        </div>
      </div>
    </>
  )
}

export default ManageMenu

==========================================================================================
FILE: src/pages/MenuPage.tsx
==========================================================================================
// src/pages/MenuPage.tsx
import React, { useEffect, useState } from 'react'
import { db } from '@/firebase'
import { collection, getDocs, query, where, doc, getDoc, updateDoc, increment, documentId, addDoc, serverTimestamp, deleteDoc } from 'firebase/firestore'
import { useCart } from '@/hooks/useCart'
import { Link, useSearchParams } from 'react-router-dom'
import { useAuth } from '@/auth'
import { useToast } from '@/components/ui/Toast'
import { MenuItem, Restaurant, Promotion } from '@/types'
import { 
  Megaphone, X, MapPin, Phone, Star, ShoppingBag, ArrowRight, 
  CheckCircle, Building2, Copy, Package, Clock,
  Utensils, Share2, Users, Briefcase, MessageCircle, Heart, Lock
} from 'lucide-react'

type MenuItemWithRestaurant = MenuItem & { restaurant?: Restaurant }

const chunkArray = <T,>(arr: T[], size: number): T[][] => {
  const chunks: T[][] = []
  for (let i = 0; i < arr.length; i += size) {
    chunks.push(arr.slice(i, i + size))
  }
  return chunks
}

export const MenuPage: React.FC = () => {
  const [items, setItems] = useState<MenuItemWithRestaurant[]>([])
  const [loading, setLoading] = useState(true)
  const [restaurant, setRestaurant] = useState<Restaurant | null>(null)
  const [activePromotion, setActivePromotion] = useState<Promotion | null>(null)
  const [showPromotion, setShowPromotion] = useState(true)
  const [isFollowing, setIsFollowing] = useState(false)
  const [followDocId, setFollowDocId] = useState<string | null>(null)
  const [followersCount, setFollowersCount] = useState(0)
  const { add, subtotal, items: cartItems } = useCart()
  const { user, role } = useAuth()
  const toast = useToast()
  const [searchParams] = useSearchParams()
  const restaurantId = searchParams.get('restaurant')

  const SERVICE_FEE_PER_ITEM = 1.75

  const copyToClipboard = (text: string) => {
    navigator.clipboard.writeText(text)
    toast.success('ØªÙ… Ø§Ù„Ù†Ø³Ø®! ğŸ“‹')
  }

  const shareProfile = () => {
    if (navigator.share) {
      navigator.share({
        title: restaurant?.name || 'Ø£Ø³Ø±Ø© Ù…Ù†ØªØ¬Ø©',
        text: `ØªÙØ¶Ù„ Ø¨Ø²ÙŠØ§Ø±Ø© ${restaurant?.name} Ø¹Ù„Ù‰ Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª`,
        url: window.location.href
      })
    } else {
      copyToClipboard(window.location.href)
    }
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†
  useEffect(() => {
    if (!restaurantId) return
    
    const checkFollowStatus = async () => {
      // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†
      try {
        const followersQuery = query(
          collection(db, 'storeFollowers'),
          where('restaurantId', '==', restaurantId)
        )
        const followersSnap = await getDocs(followersQuery)
        setFollowersCount(followersSnap.size)
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØ§Ø¨Ø¹
        if (user) {
          const userFollowQuery = query(
            collection(db, 'storeFollowers'),
            where('restaurantId', '==', restaurantId),
            where('followerId', '==', user.uid)
          )
          const userFollowSnap = await getDocs(userFollowQuery)
          if (!userFollowSnap.empty) {
            setIsFollowing(true)
            setFollowDocId(userFollowSnap.docs[0].id)
          }
        }
      } catch (err) {
        console.warn('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©:', err)
      }
    }
    
    checkFollowStatus()
  }, [restaurantId, user])

  // Ù…ØªØ§Ø¨Ø¹Ø©/Ø¥Ù„ØºØ§Ø¡ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…ØªØ¬Ø±
  const toggleFollow = async () => {
    if (!user) {
      toast.warning('Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©')
      return
    }
    if (!restaurantId) return
    
    try {
      if (isFollowing && followDocId) {
        // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
        await deleteDoc(doc(db, 'storeFollowers', followDocId))
        setIsFollowing(false)
        setFollowDocId(null)
        setFollowersCount(prev => Math.max(0, prev - 1))
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªØ¬Ø±
        const statsRef = doc(db, 'restaurantStats', restaurantId)
        await updateDoc(statsRef, {
          followersCount: increment(-1)
        }).catch(() => {})
        
        toast.info('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©')
      } else {
        // Ù…ØªØ§Ø¨Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©
        const newFollow = await addDoc(collection(db, 'storeFollowers'), {
          followerId: user.uid,
          followerName: user.displayName || user.email?.split('@')[0] || 'Ø¹Ù…ÙŠÙ„',
          restaurantId,
          createdAt: serverTimestamp()
        })
        setIsFollowing(true)
        setFollowDocId(newFollow.id)
        setFollowersCount(prev => prev + 1)
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªØ¬Ø±
        const statsRef = doc(db, 'restaurantStats', restaurantId)
        const statsSnap = await getDoc(statsRef)
        if (statsSnap.exists()) {
          await updateDoc(statsRef, {
            followersCount: increment(1)
          })
        } else {
          // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¬Ø¯ÙŠØ¯
          await addDoc(collection(db, 'restaurantStats'), {
            restaurantId,
            totalProfileViews: 0,
            totalMenuViews: 0,
            totalItemViews: 0,
            totalShareClicks: 0,
            whatsappShareCount: 0,
            registeredCustomers: 0,
            appDownloads: 0,
            followersCount: 1,
            dailyViews: {},
            updatedAt: serverTimestamp()
          })
        }
        
        toast.success('Ø£Ù†Øª Ø§Ù„Ø¢Ù† ØªØªØ§Ø¨Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ø±! ğŸ’œ')
      }
    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©:', err)
      toast.error('Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰')
    }
  }

  useEffect(() => {
    (async () => {
      let qy
      
      if (restaurantId) {
        qy = query(
          collection(db, 'menuItems'), 
          where('available', '==', true),
          where('ownerId', '==', restaurantId)
        )
        
        const rSnap = await getDoc(doc(db, 'restaurants', restaurantId))
        if (rSnap.exists()) {
          setRestaurant({ id: rSnap.id, ...rSnap.data() } as Restaurant)
        }

        try {
          const promoQuery = query(
            collection(db, 'promotions'),
            where('ownerId', '==', restaurantId),
            where('isActive', '==', true)
          )
          const promoSnap = await getDocs(promoQuery)
          if (!promoSnap.empty) {
            const promos = promoSnap.docs.map(d => ({
              id: d.id,
              ...d.data(),
              expiresAt: d.data().expiresAt?.toDate?.(),
            } as Promotion))
            
            const now = new Date()
            const activePromos = promos.filter(p => !p.expiresAt || new Date(p.expiresAt) > now)
            
            if (activePromos.length > 0) {
              const promo = activePromos[0]
              setActivePromotion(promo)
              await updateDoc(doc(db, 'promotions', promo.id), {
                viewsCount: increment(1)
              })
            }
          }
        } catch (err) {}
      } else {
        qy = query(collection(db, 'menuItems'), where('available', '==', true))
      }
      
      const snap = await getDocs(qy)
      const itemsData: MenuItem[] = snap.docs.map(d => ({ id: d.id, ...d.data() } as MenuItem))

      const uniqueOwnerIds = [...new Set(itemsData.map(it => it.ownerId).filter(Boolean))] as string[]
      const restaurantsMap = new Map<string, Restaurant>()
      
      if (uniqueOwnerIds.length > 0) {
        const chunks = chunkArray(uniqueOwnerIds, 30)
        for (const chunk of chunks) {
          const q = query(collection(db, 'restaurants'), where(documentId(), 'in', chunk))
          const rSnap = await getDocs(q)
          rSnap.docs.forEach(d => restaurantsMap.set(d.id, { id: d.id, ...d.data() } as Restaurant))
        }
      }

      const enriched = itemsData.map(it => ({
        ...it,
        restaurant: it.ownerId ? restaurantsMap.get(it.ownerId) : undefined
      }))

      setItems(enriched)
      setLoading(false)
    })()
  }, [restaurantId])

  const handleAdd = (it: MenuItem) => {
    if (!it.ownerId) {
      toast.warning('âš ï¸ Ø§Ù„ØµÙ†Ù ØºÙŠØ± Ù…Ø±ØªØ¨Ø· Ø¨Ù…Ø·Ø¹Ù…')
      return
    }

    const currentRestaurantId = cartItems[0]?.ownerId
    if (currentRestaurantId && currentRestaurantId !== it.ownerId) {
      toast.warning('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø·Ø¹Ù… ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø·Ù„Ø¨')
      return
    }

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù…Ø¹ Ø§Ù„Ø®ØµÙ… Ø¥Ù† ÙˆØ¬Ø¯
    const hasDiscount = it.discountPercent && it.discountPercent > 0
    const expiryDate = (it.discountExpiresAt as any)?.toDate?.() || (it.discountExpiresAt ? new Date(it.discountExpiresAt) : null)
    const isDiscountValid = hasDiscount && (!expiryDate || expiryDate > new Date())
    
    const basePrice = it.price + SERVICE_FEE_PER_ITEM
    const finalPrice = isDiscountValid 
      ? basePrice - (basePrice * ((it.discountPercent || 0) / 100))
      : basePrice

    add({ 
      id: it.id, 
      name: it.name, 
      price: finalPrice, 
      ownerId: it.ownerId 
    })
    toast.success('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…')
  }

  if (loading) {
    return (
      <div className="flex flex-col items-center justify-center h-screen gap-4">
        <div className="w-16 h-16 border-4 border-amber-500 border-t-transparent rounded-full animate-spin" />
        <p className="text-gray-400 text-lg">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
      </div>
    )
  }

  const canOrder = user && (role === 'customer' || role === 'admin' || role === 'developer' || !role)
  
  // Ù‡Ù„ Ø§Ù„Ù…ØªØ¬Ø± Ù…ÙØªÙˆØ­ Ù„Ù„Ø·Ù„Ø¨Ø§ØªØŸ (Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ù…ÙØªÙˆØ­ Ø¥Ø°Ø§ Ù„Ù… ØªÙØ­Ø¯Ø¯ Ø§Ù„Ù‚ÙŠÙ…Ø©)
  const isStoreOpen = restaurant?.isOpen !== false
  
  // Ù‡Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ø± Ù‡Ùˆ Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØŸ
  const isOwnStore = user && restaurantId === user.uid

  const getTierBadge = (tier?: string) => {
    switch (tier) {
      case 'gold': return { label: 'Ø°Ù‡Ø¨ÙŠ', bg: 'bg-gradient-to-r from-yellow-400 to-amber-500', icon: 'ğŸ‘‘' }
      case 'silver': return { label: 'ÙØ¶ÙŠ', bg: 'bg-gradient-to-r from-gray-300 to-gray-400', icon: 'ğŸ¥ˆ' }
      default: return { label: 'Ø¨Ø±ÙˆÙ†Ø²ÙŠ', bg: 'bg-gradient-to-r from-orange-500 to-orange-600', icon: 'ğŸ¥‰' }
    }
  }

  const tier = getTierBadge(restaurant?.sellerTier)

  return (
    <div className="min-h-screen pb-32 -mx-4 -mt-4">
      
      {/* ========== Ø¨Ø§Ù†Ø± Ø§Ù„Ù…ØªØ¬Ø± Ù…ØºÙ„Ù‚ ========== */}
      {!isStoreOpen && !isOwnStore && (
        <div className="bg-gradient-to-l from-red-500 to-rose-600 text-white p-4 flex items-center justify-center gap-3">
          <Lock className="w-6 h-6" />
          <span className="font-bold text-lg">ğŸš« Ø§Ù„Ù…ØªØ¬Ø± Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠØ§Ù‹ - Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø·Ù„Ø¨</span>
        </div>
      )}
      
      {/* ========== Ø¨Ø§Ù†Ø± Ù„Ù„ØµØ§Ø­Ø¨ ========== */}
      {isOwnStore && (
        <div className="bg-gradient-to-l from-emerald-500 to-teal-600 text-white p-4 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <Building2 className="w-6 h-6" />
            <span className="font-bold">Ù‡Ø°Ø§ Ù…ØªØ¬Ø±Ùƒ! Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±:</span>
          </div>
          <Link 
            to="/"
            className="bg-white text-emerald-600 px-4 py-2 rounded-full font-bold hover:bg-gray-100 transition flex items-center gap-2"
          >
            Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            <ArrowRight className="w-4 h-4" />
          </Link>
        </div>
      )}
      
      {/* ========== Ø§Ù„Ù‡ÙŠØ¯Ø± Ù…Ø¹ Ø§Ù„ØºÙ„Ø§Ù ========== */}
      <div className="relative">
        {/* Ø§Ù„ØºÙ„Ø§Ù */}
        <div className="h-48 sm:h-56 bg-gradient-to-br from-amber-500 via-orange-500 to-red-500 relative overflow-hidden">
          <div className="absolute inset-0 bg-black/20" />
          {/* Ø£Ø´ÙƒØ§Ù„ Ø¯ÙŠÙƒÙˆØ±ÙŠØ© */}
          <div className="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2" />
          <div className="absolute bottom-0 left-0 w-48 h-48 bg-black/10 rounded-full translate-y-1/2 -translate-x-1/2" />
          
          {/* Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ */}
          <Link 
            to="/restaurants" 
            className="absolute top-4 right-4 flex items-center gap-2 bg-black/30 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm font-bold hover:bg-black/50 transition"
          >
            <ArrowRight className="w-4 h-4" />
            Ø±Ø¬ÙˆØ¹
          </Link>
          
          {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø© */}
          <div className="absolute top-4 left-4 flex items-center gap-2">
            {/* Ø²Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© */}
            {!isOwnStore && (
              <button 
                onClick={toggleFollow}
                className={`flex items-center gap-2 px-4 py-2 backdrop-blur-sm rounded-full font-bold transition ${
                  isFollowing 
                    ? 'bg-pink-500 text-white hover:bg-pink-600' 
                    : 'bg-black/30 text-white hover:bg-black/50'
                }`}
              >
                <Heart className={`w-5 h-5 ${isFollowing ? 'fill-white' : ''}`} />
                <span className="text-sm">{isFollowing ? 'Ù…ØªØ§Ø¨ÙØ¹' : 'Ù…ØªØ§Ø¨Ø¹Ø©'}</span>
              </button>
            )}
            
            {/* Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© */}
            <button 
              onClick={shareProfile}
              className="p-3 bg-black/30 backdrop-blur-sm rounded-full text-white hover:bg-black/50 transition"
            >
              <Share2 className="w-5 h-5" />
            </button>
          </div>
        </div>

        {/* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */}
        {restaurant && (
          <div className="mx-4 -mt-20 relative z-10">
            <div className="bg-gray-900 rounded-3xl shadow-2xl border border-gray-800 overflow-hidden">
              
              {/* Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ù„ÙˆÙŠ: Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„Ø§Ø³Ù… */}
              <div className="p-6 text-center relative">
                {/* Ø¥Ø·Ø§Ø± Ø§Ù„Ø´Ø¹Ø§Ø± */}
                <div className="relative inline-block mb-4">
                  <div className="w-28 h-28 rounded-full bg-gradient-to-br from-amber-400 to-orange-500 p-1 shadow-2xl">
                    <div className="w-full h-full rounded-full bg-white overflow-hidden">
                      {restaurant.logoUrl ? (
                        <img src={restaurant.logoUrl} alt={restaurant.name} className="w-full h-full object-cover" />
                      ) : (
                        <div className="w-full h-full bg-gradient-to-br from-amber-50 to-orange-100 flex items-center justify-center">
                          <span className="text-5xl">ğŸ½ï¸</span>
                        </div>
                      )}
                    </div>
                  </div>
                  
                  {/* Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ */}
                  {(restaurant.isVerified || restaurant.licenseStatus === 'approved') ? (
                    <div className="absolute -bottom-1 -right-1 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center border-4 border-gray-900 shadow-lg" title="Ø£Ø³Ø±Ø© Ù…ÙˆØ«Ù‚Ø©">
                      <CheckCircle className="w-5 h-5 text-white" />
                    </div>
                  ) : (
                    <div className="absolute -bottom-1 -right-1 w-8 h-8 bg-amber-500 rounded-full flex items-center justify-center border-4 border-gray-900 shadow-lg" title="Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙˆØ«ÙŠÙ‚">
                      <Clock className="w-5 h-5 text-white" />
                    </div>
                  )}
                </div>

                {/* Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø±Ø© */}
                <h1 className="text-2xl sm:text-3xl font-black text-white mb-2">{restaurant.name}</h1>
                
                {/* Ø§Ù„Ù…ÙˆÙ‚Ø¹ */}
                {restaurant.city && (
                  <div className="flex items-center justify-center gap-2 text-gray-400 mb-3">
                    <MapPin className="w-4 h-4" />
                    <span>{restaurant.city}</span>
                  </div>
                )}

                {/* Ø§Ù„Ø´Ø§Ø±Ø§Øª */}
                <div className="flex items-center justify-center gap-2 flex-wrap">
                  {/* Ø´Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªØ¬Ø± */}
                  {isStoreOpen ? (
                    <span className="bg-green-500 text-white text-xs font-bold px-3 py-1.5 rounded-full animate-pulse">
                      âœ“ Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù†
                    </span>
                  ) : (
                    <span className="bg-red-500 text-white text-xs font-bold px-3 py-1.5 rounded-full">
                      ğŸš« Ù…ØºÙ„Ù‚
                    </span>
                  )}
                  <span className={`${tier.bg} text-white text-xs font-bold px-3 py-1.5 rounded-full shadow-lg`}>
                    {tier.icon} {tier.label}
                  </span>
                  {(restaurant.isVerified || restaurant.licenseStatus === 'approved') ? (
                    <span className="bg-green-500 text-white text-xs font-bold px-3 py-1.5 rounded-full">
                      âœ“ Ø£Ø³Ø±Ø© Ù…ÙˆØ«Ù‚Ø©
                    </span>
                  ) : (
                    <span className="bg-amber-500 text-white text-xs font-bold px-3 py-1.5 rounded-full">
                      Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙˆØ«ÙŠÙ‚
                    </span>
                  )}
                </div>
              </div>

              {/* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */}
              <div className="grid grid-cols-5 border-t border-gray-800">
                <div className="p-3 text-center border-l border-gray-800">
                  <Heart className="w-5 h-5 text-pink-400 mx-auto mb-1" />
                  <p className="text-lg font-black text-white">{followersCount}</p>
                  <p className="text-[10px] text-gray-500">Ù…ØªØ§Ø¨Ø¹</p>
                </div>
                <div className="p-3 text-center border-l border-gray-800">
                  <Utensils className="w-5 h-5 text-amber-400 mx-auto mb-1" />
                  <p className="text-lg font-black text-white">{items.length}</p>
                  <p className="text-[10px] text-gray-500">ØµÙ†Ù</p>
                </div>
                <div className="p-3 text-center border-l border-gray-800">
                  <Package className="w-5 h-5 text-green-400 mx-auto mb-1" />
                  <p className="text-lg font-black text-white">{restaurant.totalOrders || 0}</p>
                  <p className="text-[10px] text-gray-500">Ø·Ù„Ø¨</p>
                </div>
                <div className="p-3 text-center border-l border-gray-800">
                  <Star className="w-5 h-5 text-yellow-400 mx-auto mb-1" />
                  <p className="text-lg font-black text-white">{restaurant.averageRating?.toFixed(1) || '0'}</p>
                  <p className="text-[10px] text-gray-500">ØªÙ‚ÙŠÙŠÙ…</p>
                </div>
                <div className="p-3 text-center">
                  <Clock className="w-5 h-5 text-sky-400 mx-auto mb-1" />
                  <p className="text-lg font-black text-white">{restaurant.onTimeDeliveryRate ? `${Math.round(restaurant.onTimeDeliveryRate)}%` : 'â€”'}</p>
                  <p className="text-[10px] text-gray-500">Ø§Ù„ØªØ²Ø§Ù…</p>
                </div>
              </div>

              {/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ */}
              <div className="p-4 border-t border-gray-800 space-y-3">
                {/* ğŸ”’ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù…Ø®ÙÙŠ Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - Ø§Ù„ØªÙˆØ§ØµÙ„ ÙÙ‚Ø· Ø¹Ø¨Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ */}
                {/* Ø§Ù„Ø±Ù‚Ù… ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© (admin/developer) ÙˆØµØ§Ø­Ø¨Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ */}
                {(role === 'admin' || role === 'developer' || (role === 'owner' && user?.uid === restaurantId)) && restaurant.phone && (
                  <a 
                    href={`tel:${restaurant.phone}`}
                    className="flex items-center justify-between p-3 bg-green-500/10 hover:bg-green-500/20 rounded-xl transition"
                  >
                    <div className="flex items-center gap-3">
                      <div className="w-10 h-10 bg-green-500 rounded-xl flex items-center justify-center">
                        <Phone className="w-5 h-5 text-white" />
                      </div>
                      <div>
                        <p className="text-white font-bold">Ø§ØªØµÙ„ Ø§Ù„Ø¢Ù†</p>
                        <p className="text-green-400 text-sm" dir="ltr">{restaurant.phone}</p>
                      </div>
                    </div>
                    <ArrowRight className="w-5 h-5 text-green-400 rotate-180" />
                  </a>
                )}

                {restaurant.location && (
                  <div className="flex items-center gap-3 p-3 bg-gray-800/50 rounded-xl">
                    <div className="w-10 h-10 bg-sky-500/20 rounded-xl flex items-center justify-center">
                      <MapPin className="w-5 h-5 text-sky-400" />
                    </div>
                    <p className="text-gray-300 text-sm">{restaurant.location}</p>
                  </div>
                )}
              </div>

              {/* Ù‚Ø³Ù… Ø§Ù„ØªÙˆØ¸ÙŠÙ */}
              {restaurant.isHiring && (
                <div className="p-4 border-t border-gray-800">
                  <div className="bg-gradient-to-br from-purple-900/40 to-pink-900/40 rounded-2xl p-4 border border-purple-700/30">
                    <div className="flex items-center gap-2 mb-3">
                      <div className="w-10 h-10 bg-purple-500 rounded-xl flex items-center justify-center">
                        <Briefcase className="w-5 h-5 text-white" />
                      </div>
                      <div>
                        <span className="text-purple-400 font-bold block">ğŸ”” Ù†ÙˆØ¸Ù‘Ù Ø§Ù„Ø¢Ù†!</span>
                        <span className="text-purple-300/70 text-xs">ÙØ±Øµ Ø¹Ù…Ù„ Ù…ØªØ§Ø­Ø©</span>
                      </div>
                    </div>
                    
                    {restaurant.hiringDescription && (
                      <p className="text-gray-300 text-sm mb-4 leading-relaxed bg-gray-900/40 p-3 rounded-xl">
                        {restaurant.hiringDescription}
                      </p>
                    )}

                    {/* ğŸ”’ Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ¸ÙŠÙ Ù…Ø®ÙÙŠ Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØµØ§Ø­Ø¨Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ */}
                    {(role === 'admin' || role === 'developer' || (role === 'owner' && user?.uid === restaurantId)) && restaurant.hiringContact && (
                      <a
                        href={`https://wa.me/${restaurant.hiringContact.replace(/\D/g, '')}`}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="flex items-center justify-center gap-2 w-full py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white rounded-xl font-bold transition"
                      >
                        <MessageCircle className="w-5 h-5" />
                        ØªÙˆØ§ØµÙ„ Ù„Ù„ØªÙˆØ¸ÙŠÙ
                      </a>
                    )}
                  </div>
                </div>
              )}
            </div>
          </div>
        )}
      </div>

      {/* ========== Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù…Ù…ÙˆÙ„ ========== */}
      {activePromotion && showPromotion && (
        <div className="mx-4 mt-6 bg-gradient-to-r from-purple-900 via-purple-800 to-pink-900 rounded-2xl shadow-xl overflow-hidden relative">
          <button
            onClick={() => setShowPromotion(false)}
            className="absolute top-3 left-3 z-10 p-2 bg-black/40 hover:bg-black/60 rounded-full text-white transition"
          >
            <X className="w-4 h-4" />
          </button>

          <div className="absolute top-3 right-3 z-10 inline-flex items-center gap-1 px-3 py-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xs font-bold rounded-full shadow">
            <Megaphone className="w-3 h-3" />
            Ø¥Ø¹Ù„Ø§Ù†
          </div>

          {activePromotion.mediaUrl && (
            <img src={activePromotion.mediaUrl} alt="" className="w-full h-40 object-cover" />
          )}
          <div className="p-4">
            {activePromotion.title && <h3 className="text-lg font-bold text-white mb-1">{activePromotion.title}</h3>}
            {activePromotion.description && <p className="text-purple-100 text-sm">{activePromotion.description}</p>}
          </div>
        </div>
      )}

      {/* ========== Ù‚Ø³Ù… Ø§Ù„Ø£ØµÙ†Ø§Ù ========== */}
      <div className="px-4 mt-6">
        <div className="flex items-center gap-3 mb-4">
          <div className="w-10 h-10 bg-amber-500/20 rounded-xl flex items-center justify-center">
            <Utensils className="w-5 h-5 text-amber-400" />
          </div>
          <h2 className="text-xl font-bold text-white">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</h2>
          <span className="bg-amber-500/20 text-amber-400 text-sm font-bold px-3 py-1 rounded-full mr-auto">
            {items.length}
          </span>
        </div>

        {items.length === 0 ? (
          <div className="text-center py-16 bg-gray-800/30 rounded-2xl">
            <ShoppingBag className="w-16 h-16 text-gray-600 mx-auto mb-4" />
            <p className="text-gray-400 text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù Ø­Ø§Ù„ÙŠØ§Ù‹</p>
          </div>
        ) : (
          <div className="grid grid-cols-2 gap-3">
            {items.map(it => (
              <div 
                key={it.id} 
                className="bg-gray-800 rounded-2xl overflow-hidden border border-gray-700/50 hover:border-amber-500/50 shadow-lg transition-all"
              >
                <div className="relative h-28 sm:h-36 overflow-hidden">
                  {it.imageUrl ? (
                    <img src={it.imageUrl} alt={it.name} className="w-full h-full object-cover" />
                  ) : (
                    <div className="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-700 to-gray-800">
                      <span className="text-4xl opacity-30">ğŸ½ï¸</span>
                    </div>
                  )}
                  
                  {/* Ø´Ø§Ø±Ø© Ø§Ù„Ø®ØµÙ… */}
                  {(() => {
                    const hasDiscount = it.discountPercent && it.discountPercent > 0;
                    const expiryDate = it.discountExpiresAt?.toDate?.() || (it.discountExpiresAt ? new Date(it.discountExpiresAt) : null);
                    const isValid = !expiryDate || expiryDate > new Date();
                    if (hasDiscount && isValid) {
                      return (
                        <div className="absolute top-2 right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg animate-pulse">
                          Ø®ØµÙ… {it.discountPercent}%
                        </div>
                      );
                    }
                    return null;
                  })()}
                  
                  {/* Ø§Ù„Ø³Ø¹Ø± */}
                  {(() => {
                    const hasDiscount = it.discountPercent && it.discountPercent > 0;
                    const expiryDate = it.discountExpiresAt?.toDate?.() || (it.discountExpiresAt ? new Date(it.discountExpiresAt) : null);
                    const isValid = !expiryDate || expiryDate > new Date();
                    const originalPrice = it.price + SERVICE_FEE_PER_ITEM;
                    
                    if (hasDiscount && isValid) {
                      const discountedPrice = originalPrice - (originalPrice * ((it.discountPercent || 0) / 100));
                      return (
                        <div className="absolute bottom-2 left-2 flex items-center gap-1.5">
                          <span className="bg-green-500 text-white font-black text-sm px-2 py-1 rounded-full shadow">
                            {discountedPrice.toFixed(0)} Ø±.Ø³
                          </span>
                          <span className="bg-black/60 text-gray-300 text-xs px-1.5 py-0.5 rounded-full line-through">
                            {originalPrice.toFixed(0)}
                          </span>
                        </div>
                      );
                    }
                    return (
                      <div className="absolute bottom-2 left-2 bg-black/80 px-2 py-1 rounded-full">
                        <span className="font-black text-amber-400 text-sm">
                          {originalPrice.toFixed(0)} Ø±.Ø³
                        </span>
                      </div>
                    );
                  })()}
                </div>

                <div className="p-3">
                  <h3 className="font-bold text-white text-sm mb-2 line-clamp-1">{it.name}</h3>
                  {canOrder && isStoreOpen && (
                    <button 
                      onClick={() => handleAdd(it)}
                      className="w-full py-2 rounded-xl font-bold text-sm bg-gradient-to-r from-amber-500 to-orange-500 text-black"
                    >
                      + Ø£Ø¶Ù
                    </button>
                  )}
                  {canOrder && !isStoreOpen && (
                    <div className="w-full py-2 rounded-xl font-bold text-sm bg-gray-600 text-gray-300 text-center flex items-center justify-center gap-2">
                      <Lock className="w-4 h-4" />
                      Ù…ØºÙ„Ù‚
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* ========== Ø´Ø±ÙŠØ· Ø§Ù„Ø³Ù„Ø© ========== */}
      {subtotal > 0 && canOrder && (
        <div className="fixed bottom-0 left-0 right-0 z-50 p-4 bg-gradient-to-t from-gray-900 via-gray-900/98 to-transparent">
          <Link 
            to="/checkout" 
            className="flex items-center justify-between w-full max-w-lg mx-auto px-5 py-4 rounded-2xl bg-gradient-to-r from-sky-500 to-blue-600 text-white shadow-2xl font-bold"
          >
            <div className="flex items-center gap-3">
              <div className="relative">
                <ShoppingBag className="w-6 h-6" />
                <span className="absolute -top-2 -right-2 w-5 h-5 bg-amber-400 text-black text-xs font-black rounded-full flex items-center justify-center">
                  {cartItems.reduce((sum, i) => sum + i.qty, 0)}
                </span>
              </div>
              <span>Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©</span>
            </div>
            <span className="text-xl font-black">{subtotal.toFixed(2)} Ø±.Ø³</span>
          </Link>
        </div>
      )}
    </div>
  )
}

==========================================================================================
FILE: src/pages/NotificationsPage.tsx
==========================================================================================
import React, { useEffect, useState } from 'react'
import { useAuth } from '@/auth'
import { db } from '@/firebase'
import { 
  collection, query, where, orderBy, onSnapshot, 
  updateDoc, deleteDoc, doc, Timestamp 
} from 'firebase/firestore'
import { Bell, Check, Trash2, AlertCircle, RefreshCw, ArrowRight } from 'lucide-react'
import { useToast } from '@/components/ui/Toast'
import { useNavigate } from 'react-router-dom'

type Notification = {
  id: string
  type: string
  recipientId: string
  recipientType: string
  restaurantId?: string
  restaurantName?: string
  title: string
  message: string
  read: boolean
  createdAt: Timestamp
}

export const NotificationsPage: React.FC = () => {
  const { user } = useAuth()
  const toast = useToast()
  const navigate = useNavigate()
  const [notifications, setNotifications] = useState<Notification[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    if (!user) return

    const q = query(
      collection(db, 'notifications'),
      where('recipientId', '==', user.uid),
      orderBy('createdAt', 'desc')
    )

    const unsub = onSnapshot(q, (snap) => {
      const notifs = snap.docs.map(d => ({ id: d.id, ...d.data() })) as Notification[]
      setNotifications(notifs)
      setLoading(false)
    }, (err) => {
      console.error('Error fetching notifications:', err)
      setLoading(false)
    })

    return () => unsub()
  }, [user])

  const markAsRead = async (notifId: string) => {
    try {
      await updateDoc(doc(db, 'notifications', notifId), { read: true })
    } catch (err) {
      console.error('Error marking as read:', err)
    }
  }

  const markAllAsRead = async () => {
    const unread = notifications.filter(n => !n.read)
    try {
      await Promise.all(unread.map(n => 
        updateDoc(doc(db, 'notifications', n.id), { read: true })
      ))
      toast.success('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡')
    } catch (err) {
      toast.error('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª')
    }
  }

  const deleteNotification = async (notifId: string) => {
    try {
      await deleteDoc(doc(db, 'notifications', notifId))
      toast.success('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±')
    } catch (err) {
      toast.error('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±')
    }
  }

  const formatDate = (timestamp: Timestamp) => {
    if (!timestamp) return ''
    const date = timestamp.toDate()
    const now = new Date()
    const diff = now.getTime() - date.getTime()
    const minutes = Math.floor(diff / 60000)
    const hours = Math.floor(diff / 3600000)
    const days = Math.floor(diff / 86400000)

    if (minutes < 1) return 'Ø§Ù„Ø¢Ù†'
    if (minutes < 60) return `Ù…Ù†Ø° ${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`
    if (hours < 24) return `Ù…Ù†Ø° ${hours} Ø³Ø§Ø¹Ø©`
    if (days < 7) return `Ù…Ù†Ø° ${days} ÙŠÙˆÙ…`
    return date.toLocaleDateString('ar-SA')
  }

  const unreadCount = notifications.filter(n => !n.read).length

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <RefreshCw className="w-8 h-8 animate-spin text-sky-500" />
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-50 to-white">
      {/* Header */}
      <div className="bg-white shadow-sm sticky top-0 z-10">
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <button
              onClick={() => navigate(-1)}
              className="flex items-center gap-2 text-gray-600 hover:text-gray-800"
            >
              <ArrowRight className="w-5 h-5" />
              Ø±Ø¬ÙˆØ¹
            </button>
            <h1 className="text-xl font-bold flex items-center gap-2">
              <Bell className="w-6 h-6 text-sky-500" />
              Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
              {unreadCount > 0 && (
                <span className="bg-red-500 text-white text-xs px-2 py-0.5 rounded-full">
                  {unreadCount}
                </span>
              )}
            </h1>
            {unreadCount > 0 && (
              <button
                onClick={markAllAsRead}
                className="text-sm text-sky-600 hover:text-sky-800"
              >
                Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒÙ„
              </button>
            )}
          </div>
        </div>
      </div>

      {/* Content */}
      <div className="max-w-2xl mx-auto px-4 py-6">
        {notifications.length === 0 ? (
          <div className="text-center py-16">
            <Bell className="w-16 h-16 mx-auto mb-4 text-gray-300" />
            <p className="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</p>
          </div>
        ) : (
          <div className="space-y-3">
            {notifications.map(notif => (
              <div
                key={notif.id}
                className={`bg-white rounded-2xl p-4 shadow-sm border transition hover:shadow-md ${
                  !notif.read ? 'border-sky-200 bg-sky-50/50' : 'border-gray-100'
                }`}
                onClick={() => !notif.read && markAsRead(notif.id)}
              >
                <div className="flex items-start gap-3">
                  <div className={`p-2 rounded-xl ${
                    notif.type === 'license_reminder' 
                      ? 'bg-orange-100 text-orange-600'
                      : 'bg-sky-100 text-sky-600'
                  }`}>
                    <AlertCircle className="w-5 h-5" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="flex items-start justify-between gap-2">
                      <h3 className="font-semibold text-gray-800">{notif.title}</h3>
                      <span className="text-xs text-gray-400 whitespace-nowrap">
                        {formatDate(notif.createdAt)}
                      </span>
                    </div>
                    <p className="text-sm text-gray-600 mt-1">{notif.message}</p>
                    {!notif.read && (
                      <span className="inline-block mt-2 text-xs bg-sky-100 text-sky-700 px-2 py-0.5 rounded-full">
                        Ø¬Ø¯ÙŠØ¯
                      </span>
                    )}
                  </div>
                  <div className="flex flex-col gap-1">
                    {!notif.read && (
                      <button
                        onClick={(e) => {
                          e.stopPropagation()
                          markAsRead(notif.id)
                        }}
                        className="p-1.5 text-gray-400 hover:text-green-500 transition"
                        title="ØªØ­Ø¯ÙŠØ¯ ÙƒÙ…Ù‚Ø±ÙˆØ¡"
                      >
                        <Check className="w-4 h-4" />
                      </button>
                    )}
                    <button
                      onClick={(e) => {
                        e.stopPropagation()
                        deleteNotification(notif.id)
                      }}
                      className="p-1.5 text-gray-400 hover:text-red-500 transition"
                      title="Ø­Ø°Ù"
                    >
                      <Trash2 className="w-4 h-4" />
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  )
}

export default NotificationsPage

==========================================================================================
FILE: src/pages/OrdersAdmin.tsx
==========================================================================================
// src/pages/OrdersAdmin.tsx
import React, { useEffect, useMemo, useState } from 'react'
import { collection, doc, onSnapshot, updateDoc, serverTimestamp } from 'firebase/firestore'
import { db } from '@/firebase'
import { useAuth } from '@/auth'
import { useNavigate } from 'react-router-dom'
import { MessageCircle } from 'lucide-react'

type Order = any

// âœ… ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª
const badge = (s: string) => {
  const map: Record<string, string> = {
    pending: 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
    accepted: 'âœ… ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„',
    preparing: 'ğŸ‘¨â€ğŸ³ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±',
    ready: 'ğŸ“¦ Ø¬Ø§Ù‡Ø²',
    out_for_delivery: 'ğŸšš ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚',
    delivered: 'ğŸ‰ ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…',
    cancelled: 'âŒ Ù…Ù„ØºÙŠ',
  }
  return map[s] || s
}

// âœ… Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„Ø§Øª
const statusColor = (s: string) => {
  switch (s) {
    case 'pending': return 'bg-gray-200 text-gray-800'
    case 'accepted': return 'bg-blue-200 text-blue-800'
    case 'preparing': return 'bg-yellow-200 text-yellow-800'
    case 'ready': return 'bg-purple-200 text-purple-800'
    case 'out_for_delivery': return 'bg-indigo-200 text-indigo-800'
    case 'delivered': return 'bg-green-200 text-green-800'
    case 'cancelled': return 'bg-red-200 text-red-800'
    default: return 'bg-gray-100 text-gray-700'
  }
}

export const OrdersAdmin: React.FC = () => {
  const { user } = useAuth()
  const nav = useNavigate()
  const [orders, setOrders] = useState<Order[]>([])
  const [error, setError] = useState<string | null>(null)
  const [deliveryFees, setDeliveryFees] = useState<Record<string, number>>({})

  const restaurantUid = useMemo(() => user?.uid ?? null, [user])

  useEffect(() => {
    if (!restaurantUid) return
    setError(null)

    const unsub = onSnapshot(
      collection(db, 'orders'),
      (snap) => {
        const all = snap.docs.map(d => ({ id: d.id, ...(d.data() as any) }))
        const mine = all.filter((o: any) => {
          const r1 = o.restaurantId === restaurantUid
          const r2 = o?.items?.[0]?.ownerId === restaurantUid
          return r1 || r2
        })

        mine.sort((a: any, b: any) => {
          const ta = a.createdAt?.toMillis?.() ?? 0
          const tb = b.createdAt?.toMillis?.() ?? 0
          return tb - ta
        })

        setOrders(mine)
        setError(null)
      },
      (err) => {
        console.error('Firestore error:', err)
        setError('Ø­Ø¯Ø«Øª Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª.')
      }
    )

    return () => unsub()
  }, [restaurantUid])

  const updateStatus = async (id: string, status: string, order?: any) => {
    const updates: any = { 
      status, 
      updatedAt: serverTimestamp()
    }
    
    // Ø¹Ù†Ø¯ Ø§Ù„Ù‚Ø¨ÙˆÙ„ØŒ Ù†Ø¶ÙŠÙ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆÙ†Ø­Ø¯Ø« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
    if (status === 'accepted' && order?.deliveryType === 'delivery') {
      const fee = deliveryFees[id] || 0
      updates.deliveryFee = fee
      updates.total = (order.subtotal || 0) + fee
    }
    
    await updateDoc(doc(db, 'orders', id), updates)
  }

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-extrabold text-yellow-500">ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>

      {error && <div className="text-red-500 text-sm mb-2">{error}</div>}

      {orders.map((o: any) => (
        <div 
          key={o.id} 
          className="bg-white rounded-2xl shadow-xl p-5 text-gray-900 space-y-4 transition hover:shadow-2xl"
        >
          {/* ğŸ§¾ Ø±Ø£Ø³ Ø§Ù„Ø·Ù„Ø¨ */}
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
            <div className="font-bold text-lg">
              Ø·Ù„Ø¨ #{o.id.slice(-6)} 
              <span className="text-gray-500 text-sm ml-2">
                {o.items?.map((i:any)=>`${i.name}Ã—${i.qty}`).join(' â€¢ ')}
              </span>
            </div>
            <div className="font-extrabold text-xl text-green-600">{o.total?.toFixed?.(2)} Ø±.Ø³</div>
          </div>

          {/* ğŸ“Œ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© */}
          <div className="flex items-center gap-2">
            <span className="text-sm font-semibold">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
            <span className={`px-3 py-1 rounded-full text-sm font-bold ${statusColor(o.status)}`}>
              {badge(o.status || 'pending')}
            </span>
          </div>

          {/* ğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */}
          <div className="text-sm text-gray-700">
            <span className="font-semibold">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span> {o.address}
          </div>

          {/* ğŸ—ºï¸ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© */}
          {o.location && (
            <div className="mt-3">
              <h3 className="font-semibold text-sm text-gray-800 mb-2">ğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„:</h3>
              <iframe
                title={`map-${o.id}`}
                width="100%"
                height="250"
                style={{ borderRadius: '12px' }}
                loading="lazy"
                allowFullScreen
                src={`https://www.google.com/maps?q=${o.location.lat},${o.location.lng}&hl=ar&z=15&output=embed`}
              ></iframe>
            </div>
          )}

          {/* ï¿½ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */}
          {o.status === 'pending' && o.deliveryType === 'delivery' && (
            <div className="bg-amber-50 border border-amber-200 rounded-xl p-4">
              <label className="block text-sm font-bold text-amber-800 mb-2">
                ğŸ’µ Ø­Ø¯Ø¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ù‚Ø¨ÙˆÙ„:
              </label>
              <div className="flex items-center gap-3">
                <input
                  type="number"
                  min="0"
                  step="0.5"
                  placeholder="Ù…Ø«Ø§Ù„: 10"
                  value={deliveryFees[o.id] || ''}
                  onChange={(e) => setDeliveryFees(prev => ({ ...prev, [o.id]: parseFloat(e.target.value) || 0 }))}
                  className="flex-1 px-4 py-3 border-2 border-amber-300 rounded-xl focus:border-amber-500 focus:ring-2 focus:ring-amber-200 text-lg font-bold text-center"
                />
                <span className="text-amber-700 font-bold">Ø±.Ø³</span>
              </div>
              <p className="text-xs text-amber-600 mt-2">Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ù†Ø¯ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨</p>
            </div>
          )}

          {/* Ø¹Ø±Ø¶ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© */}
          {o.deliveryFee !== undefined && o.deliveryFee > 0 && (
            <div className="text-sm text-gray-700">
              <span className="font-semibold">Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„:</span> {o.deliveryFee?.toFixed?.(2)} Ø±.Ø³
            </div>
          )}

          {/* ğŸ”˜ Ø£Ø²Ø±Ø§Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© */}
          <div className="mt-3 grid grid-cols-2 sm:flex sm:flex-wrap gap-2">
            {/* Ø²Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ */}
            {!o.courierId && ['pending', 'accepted', 'preparing', 'ready'].includes(o.status) && (
              <button
                onClick={() => nav(`/chat?orderId=${o.id}`)}
                className="px-4 py-2 rounded-xl text-sm font-semibold bg-gradient-to-r from-orange-500 to-amber-500 text-white hover:shadow-lg transition flex items-center gap-2"
              >
                <MessageCircle className="w-4 h-4" />
                Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ ğŸ’¬
              </button>
            )}
            
            {['accepted','preparing','ready','out_for_delivery','delivered','cancelled'].map(s => {
              // Ù…Ù†Ø¹ Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ø¨Ø¯ÙˆÙ† ØªØ­Ø¯ÙŠØ¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„
              const needsFee = s === 'accepted' && o.status === 'pending' && o.deliveryType === 'delivery'
              const hasFee = deliveryFees[o.id] !== undefined && deliveryFees[o.id] >= 0
              const disabled = needsFee && !hasFee
              
              return (
                <button 
                  key={s} 
                  onClick={()=>updateStatus(o.id, s, o)} 
                  disabled={disabled}
                  className={`px-4 py-2 rounded-xl text-sm font-semibold transition ${disabled ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-gray-100 hover:bg-gray-200'}`}
                  title={disabled ? 'Ø­Ø¯Ø¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹' : ''}
                >
                  {badge(s)}
                </button>
              )
            })}
          </div>
        </div>
      ))}

      {orders.length === 0 && !error && (
        <div className="text-gray-400 text-center text-lg">ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</div>
      )}
    </div>
  )
}

==========================================================================================
FILE: src/pages/OwnerDashboard.tsx
==========================================================================================
// src/pages/OwnerDashboard.tsx
import React, { useEffect, useState } from 'react'
import { Link } from 'react-router-dom'
import { useAuth } from '@/auth'
import { db } from '@/firebase'
import { 
  collection, query, where, getDocs, doc, getDoc, orderBy, updateDoc, increment, setDoc, serverTimestamp
} from 'firebase/firestore'
import { 
  Utensils, ClipboardList, Settings, Crown, Sparkles, Megaphone, Building2,
  TrendingUp, ShoppingBag, Star, Truck, Wallet, Package, 
  ChefHat, Clock, CheckCircle, AlertCircle, RefreshCw, Phone, MapPin,
  Briefcase, Eye, MessageCircle, Plus, Edit3, BarChart3, 
  Users, Gift, Zap, Shield, Camera, Globe, Bell, ArrowRight,
  Store, Layers, PieChart, Target, Award, Flame, Heart, Share2, Copy, Link2,
  UserPlus, Download, ExternalLink
} from 'lucide-react'
import { useToast } from '@/components/ui/Toast'

type Restaurant = {
  name: string
  logoUrl?: string
  phone?: string
  city?: string
  location?: string
  description?: string
  packageType?: 'free' | 'premium'
  packageExpiresAt?: any
  isVerified?: boolean
  rating?: number
  deliveryRate?: number
  totalOrders?: number
  bankName?: string
  bankAccountName?: string
  bankAccountNumber?: string
  isHiring?: boolean
  hiringDescription?: string
  hiringContact?: string
  sellerTier?: string
}

type Order = {
  id: string
  status: string
  total: number
  subtotal: number
  deliveryFee: number
  createdAt?: any
  items: any[]
}

type MenuItem = {
  id: string
  name: string
  price: number
  available: boolean
}

type Promotion = {
  id: string
  isActive: boolean
  viewsCount?: number
  expiresAt?: any
}

type Stats = {
  todayOrders: number
  todayRevenue: number
  weekOrders: number
  weekRevenue: number
  monthOrders: number
  monthRevenue: number
  totalOrders: number
  totalRevenue: number
  pendingOrders: number
  preparingOrders: number
  deliveredOrders: number
  cancelledOrders: number
  menuItems: number
  availableItems: number
  averageRating: number
  deliveryRate: number
  activePromotions: number
  totalViews: number
  uniqueCustomers: number
  // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
  profileViews: number
  menuViews: number
  itemViews: number
  shareClicks: number
  whatsappShares: number
  registeredViaLink: number
  todayViews: number
  followersCount: number
}

type RestaurantStats = {
  totalProfileViews: number
  totalMenuViews: number
  totalItemViews: number
  totalShareClicks: number
  whatsappShareCount: number
  registeredCustomers: number
  appDownloads: number
  followersCount: number
  dailyViews: Record<string, number>
}

export const OwnerDashboard: React.FC = () => {
  const { user } = useAuth()
  const toast = useToast()
  const [loading, setLoading] = useState(true)
  const [refreshing, setRefreshing] = useState(false)
  const [restaurant, setRestaurant] = useState<Restaurant | null>(null)
  const [activeTab, setActiveTab] = useState<'overview' | 'orders' | 'menu' | 'marketing' | 'settings'>('overview')
  const [stats, setStats] = useState<Stats>({
    todayOrders: 0, todayRevenue: 0,
    weekOrders: 0, weekRevenue: 0,
    monthOrders: 0, monthRevenue: 0,
    totalOrders: 0, totalRevenue: 0,
    pendingOrders: 0, preparingOrders: 0,
    deliveredOrders: 0, cancelledOrders: 0,
    menuItems: 0, availableItems: 0,
    averageRating: 0, deliveryRate: 0,
    activePromotions: 0, totalViews: 0,
    uniqueCustomers: 0,
    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    profileViews: 0, menuViews: 0, itemViews: 0,
    shareClicks: 0, whatsappShares: 0,
    registeredViaLink: 0, todayViews: 0, followersCount: 0
  })
  const [copied, setCopied] = useState(false)
  const [restaurantStats, setRestaurantStats] = useState<RestaurantStats | null>(null)

  // Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØªØ¬Ø± Ù…Ø¹ ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
  const getStoreLink = (source?: string) => {
    const baseUrl = `${window.location.origin}/menu?restaurant=${user?.uid}`
    return source ? `${baseUrl}&ref=${source}` : baseUrl
  }

  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
  const trackShare = async (type: 'copy' | 'whatsapp' | 'social') => {
    if (!user?.uid) return
    try {
      const statsRef = doc(db, 'restaurantStats', user.uid)
      const updates: Record<string, any> = {
        totalShareClicks: increment(1),
        updatedAt: serverTimestamp()
      }
      if (type === 'whatsapp') {
        updates.whatsappShareCount = increment(1)
      }
      await updateDoc(statsRef, updates).catch(async () => {
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯
        await setDoc(statsRef, {
          totalProfileViews: 0,
          totalMenuViews: 0,
          totalItemViews: 0,
          totalShareClicks: 1,
          whatsappShareCount: type === 'whatsapp' ? 1 : 0,
          registeredCustomers: 0,
          appDownloads: 0,
          dailyViews: {},
          updatedAt: serverTimestamp()
        })
      })
    } catch (err) {
      console.warn('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:', err)
    }
  }

  // Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØªØ¬Ø±
  const copyStoreLink = async () => {
    const link = getStoreLink('copy')
    await navigator.clipboard.writeText(link)
    setCopied(true)
    setTimeout(() => setCopied(false), 2000)
    toast.success('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·! ğŸ“‹')
    trackShare('copy')
  }

  // Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
  const shareToWhatsapp = () => {
    const link = getStoreLink('whatsapp')
    const text = encodeURIComponent(`ğŸ½ï¸ ØªÙØ¶Ù„ Ø¨Ø²ÙŠØ§Ø±Ø© Ù…ØªØ¬Ø± ${restaurant?.name || 'Ù…ØªØ¬Ø±ÙŠ'} Ø¹Ù„Ù‰ Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª!\n\n${link}`)
    window.open(`https://wa.me/?text=${text}`, '_blank')
    toast.success('Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨... ğŸ“±')
    trackShare('whatsapp')
  }

  // Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ØªØ¬Ø± (Ø¹Ø§Ù…Ø©)
  const shareStore = async () => {
    const link = getStoreLink('social')
    if (navigator.share) {
      try {
        await navigator.share({
          title: restaurant?.name || 'Ù…ØªØ¬Ø±ÙŠ',
          text: `ØªÙØ¶Ù„ Ø¨Ø²ÙŠØ§Ø±Ø© ${restaurant?.name} Ø¹Ù„Ù‰ Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª`,
          url: link
        })
        trackShare('social')
      } catch (err) {
        copyStoreLink()
      }
    } else {
      copyStoreLink()
    }
  }
  const [recentOrders, setRecentOrders] = useState<Order[]>([])
  const [topItems, setTopItems] = useState<{ name: string; count: number }[]>([])

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  const loadData = async () => {
    if (!user?.uid) return

    try {
      // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù…
      const restaurantDoc = await getDoc(doc(db, 'restaurants', user.uid))
      if (restaurantDoc.exists()) {
        setRestaurant(restaurantDoc.data() as Restaurant)
      }

      // Ø¬Ù„Ø¨ Ø§Ù„Ø£ØµÙ†Ø§Ù
      const menuQuery = query(
        collection(db, 'menuItems'),
        where('ownerId', '==', user.uid)
      )
      const menuSnap = await getDocs(menuQuery)
      const menuItems = menuSnap.docs.map(d => ({ id: d.id, ...d.data() } as MenuItem))

      // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
      const ordersQuery = query(
        collection(db, 'orders'),
        where('ownerId', '==', user.uid),
        orderBy('createdAt', 'desc')
      )
      const ordersSnap = await getDocs(ordersQuery)
      const orders = ordersSnap.docs.map(d => ({ id: d.id, ...d.data() } as Order))

      // Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
      let activePromotions = 0
      let totalViews = 0
      try {
        const promoQuery = query(
          collection(db, 'promotions'),
          where('ownerId', '==', user.uid)
        )
        const promoSnap = await getDocs(promoQuery)
        promoSnap.docs.forEach(d => {
          const data = d.data() as Promotion
          if (data.isActive) activePromotions++
          totalViews += data.viewsCount || 0
        })
      } catch (e) {}

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²Ù…Ù†ÙŠØ©
      const now = new Date()
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())
      const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000)
      const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000)

      const todayOrders = orders.filter(o => {
        const orderDate = o.createdAt?.toDate?.() || new Date(0)
        return orderDate >= today && o.status !== 'cancelled'
      })

      const weekOrders = orders.filter(o => {
        const orderDate = o.createdAt?.toDate?.() || new Date(0)
        return orderDate >= weekAgo && o.status !== 'cancelled'
      })

      const monthOrders = orders.filter(o => {
        const orderDate = o.createdAt?.toDate?.() || new Date(0)
        return orderDate >= monthAgo && o.status !== 'cancelled'
      })

      const deliveredOrders = orders.filter(o => o.status === 'delivered')
      const pendingOrders = orders.filter(o => o.status === 'pending')
      const preparingOrders = orders.filter(o => ['accepted', 'preparing'].includes(o.status))
      const cancelledOrders = orders.filter(o => o.status === 'cancelled')

      // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„ÙØ±ÙŠØ¯ÙŠÙ†
      const uniqueCustomerIds = new Set(orders.map((o: any) => o.customerId).filter(Boolean))

      // Ø­Ø³Ø§Ø¨ Ø£ÙƒØ«Ø± Ø§Ù„Ø£ØµÙ†Ø§Ù Ù…Ø¨ÙŠØ¹Ø§Ù‹
      const itemCounts: Record<string, number> = {}
      deliveredOrders.forEach(order => {
        order.items?.forEach((item: any) => {
          const name = item.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'
          itemCounts[name] = (itemCounts[name] || 0) + (item.qty || 1)
        })
      })
      const sortedItems = Object.entries(itemCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5)
        .map(([name, count]) => ({ name, count }))

      setTopItems(sortedItems)
      setRecentOrders(orders.slice(0, 5))
      
      // Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
      let profileViews = 0, menuViews = 0, itemViews = 0
      let shareClicks = 0, whatsappShares = 0, registeredViaLink = 0, todayViewsCount = 0, followersCount = 0
      try {
        const statsDoc = await getDoc(doc(db, 'restaurantStats', user.uid))
        if (statsDoc.exists()) {
          const statsData = statsDoc.data() as RestaurantStats
          setRestaurantStats(statsData)
          profileViews = statsData.totalProfileViews || 0
          menuViews = statsData.totalMenuViews || 0
          itemViews = statsData.totalItemViews || 0
          shareClicks = statsData.totalShareClicks || 0
          whatsappShares = statsData.whatsappShareCount || 0
          registeredViaLink = statsData.registeredCustomers || 0
          followersCount = statsData.followersCount || 0
          
          // Ø­Ø³Ø§Ø¨ Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…
          const todayKey = new Date().toISOString().split('T')[0]
          todayViewsCount = statsData.dailyViews?.[todayKey] || 0
        }
      } catch (e) {
        console.warn('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª:', e)
      }

      // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø³Ø±Ø©
      try {
        const registrationsQuery = query(
          collection(db, 'customerRegistrations'),
          where('restaurantId', '==', user.uid)
        )
        const registrationsSnap = await getDocs(registrationsQuery)
        registeredViaLink = registrationsSnap.size
      } catch (e) {}

      // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†
      try {
        const followersQuery = query(
          collection(db, 'storeFollowers'),
          where('restaurantId', '==', user.uid)
        )
        const followersSnap = await getDocs(followersQuery)
        followersCount = followersSnap.size
      } catch (e) {}
      
      setStats({
        todayOrders: todayOrders.length,
        todayRevenue: todayOrders.reduce((sum, o) => sum + (o.subtotal || 0), 0),
        weekOrders: weekOrders.length,
        weekRevenue: weekOrders.reduce((sum, o) => sum + (o.subtotal || 0), 0),
        monthOrders: monthOrders.length,
        monthRevenue: monthOrders.reduce((sum, o) => sum + (o.subtotal || 0), 0),
        totalOrders: orders.filter(o => o.status !== 'cancelled').length,
        totalRevenue: deliveredOrders.reduce((sum, o) => sum + (o.subtotal || 0), 0),
        pendingOrders: pendingOrders.length,
        preparingOrders: preparingOrders.length,
        deliveredOrders: deliveredOrders.length,
        cancelledOrders: cancelledOrders.length,
        menuItems: menuItems.length,
        availableItems: menuItems.filter(m => m.available).length,
        averageRating: restaurantDoc.data()?.rating || 0,
        deliveryRate: restaurantDoc.data()?.deliveryRate || 0,
        activePromotions,
        totalViews,
        uniqueCustomers: uniqueCustomerIds.size,
        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        profileViews,
        menuViews,
        itemViews,
        shareClicks,
        whatsappShares,
        registeredViaLink,
        todayViews: todayViewsCount,
        followersCount
      })

    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', err)
    } finally {
      setLoading(false)
      setRefreshing(false)
    }
  }

  useEffect(() => {
    loadData()
  }, [user?.uid])

  const handleRefresh = () => {
    setRefreshing(true)
    loadData()
  }

  // Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
  const getStatusInfo = (status: string) => {
    const statusMap: Record<string, { label: string; color: string; icon: any }> = {
      pending: { label: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„', color: 'bg-yellow-100 text-yellow-700', icon: Clock },
      accepted: { label: 'Ù…Ù‚Ø¨ÙˆÙ„', color: 'bg-blue-100 text-blue-700', icon: CheckCircle },
      preparing: { label: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±', color: 'bg-orange-100 text-orange-700', icon: ChefHat },
      ready: { label: 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙˆØµÙŠÙ„', color: 'bg-purple-100 text-purple-700', icon: Package },
      out_for_delivery: { label: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚', color: 'bg-indigo-100 text-indigo-700', icon: Truck },
      delivered: { label: 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„', color: 'bg-green-100 text-green-700', icon: CheckCircle },
      cancelled: { label: 'Ù…Ù„ØºÙŠ', color: 'bg-red-100 text-red-700', icon: AlertCircle },
    }
    return statusMap[status] || { label: status, color: 'bg-gray-100 text-gray-700', icon: Clock }
  }

  const getTierInfo = (tier?: string) => {
    switch (tier) {
      case 'gold': return { label: 'Ø°Ù‡Ø¨ÙŠ', color: 'from-yellow-400 to-amber-500', icon: 'ğŸ‘‘' }
      case 'silver': return { label: 'ÙØ¶ÙŠ', color: 'from-gray-300 to-gray-400', icon: 'ğŸ¥ˆ' }
      default: return { label: 'Ø¨Ø±ÙˆÙ†Ø²ÙŠ', color: 'from-orange-500 to-orange-600', icon: 'ğŸ¥‰' }
    }
  }

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[60vh]">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-amber-500 border-t-transparent rounded-full animate-spin mx-auto mb-4" />
          <p className="text-gray-600">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
      </div>
    )
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©
  const isPremium = restaurant?.packageType === 'premium'
  const tier = getTierInfo(restaurant?.sellerTier)

  // ===== ØµÙØ­Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© (Ø§Ù„Ø¨Ø³ÙŠØ·Ø©) =====
  if (!isPremium) {
    return (
      <div className="space-y-6 pb-20">
        {/* Ø¯Ø¹ÙˆØ© Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø© */}
        <div className="bg-gradient-to-br from-amber-500 via-orange-500 to-red-500 rounded-3xl shadow-2xl p-6 text-white relative overflow-hidden">
          <div className="absolute inset-0 opacity-10">
            <div className="absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2" />
          </div>
          
          <div className="relative z-10 text-center py-6">
            <div className="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
              <Crown className="w-10 h-10 text-yellow-300" />
            </div>
            <h2 className="text-2xl font-bold mb-2">ğŸŒŸ Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h2>
            <p className="text-white/80 mb-4">
              Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙØµÙ‘Ù„Ø© ÙˆÙ…Ø²Ø§ÙŠØ§ Ø­ØµØ±ÙŠØ©!
            </p>
            <Link
              to="/owner/packages"
              className="inline-flex items-center gap-2 bg-white text-amber-600 font-bold px-6 py-3 rounded-xl hover:bg-yellow-50 transition shadow-lg"
            >
              <Sparkles className="w-5 h-5" />
              Ø§ÙƒØªØ´Ù Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø¢Ù†
            </Link>
          </div>
        </div>

        {/* ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ */}
        {!restaurant?.bankName && (
          <Link 
            to="/owner/edit#bank"
            className="block bg-gradient-to-r from-red-50 to-orange-50 border-2 border-red-200 rounded-2xl p-4 hover:shadow-lg transition"
          >
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 bg-red-500 rounded-xl flex items-center justify-center flex-shrink-0">
                <Building2 className="w-6 h-6 text-white" />
              </div>
              <div className="flex-1">
                <h3 className="font-bold text-red-700">âš ï¸ Ø£Ø¶Ù Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¨Ù†ÙƒÙŠ!</h3>
                <p className="text-sm text-red-600">Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
              </div>
            </div>
          </Link>
        )}

        {/* ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */}
        {stats.pendingOrders > 0 && (
          <Link 
            to="/owner/orders"
            className="block bg-gradient-to-r from-yellow-50 to-amber-50 border-2 border-yellow-300 rounded-2xl p-4 hover:shadow-lg transition animate-pulse"
          >
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 bg-yellow-500 rounded-xl flex items-center justify-center flex-shrink-0">
                <ShoppingBag className="w-6 h-6 text-white" />
              </div>
              <div className="flex-1">
                <h3 className="font-bold text-yellow-700">ğŸ”” Ù„Ø¯ÙŠÙƒ {stats.pendingOrders} Ø·Ù„Ø¨ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„!</h3>
                <p className="text-sm text-yellow-600">Ø§Ø¶ØºØ· Ù„Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
              </div>
            </div>
          </Link>
        )}

        {/* Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */}
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <Link
            to="/owner/packages"
            className="rounded-2xl shadow-lg hover:shadow-2xl transition transform hover:-translate-y-1 bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 p-5 ring-2 ring-amber-300 relative overflow-hidden"
          >
            <div className="absolute top-0 left-0 right-0 bg-gradient-to-r from-amber-500 via-yellow-400 to-orange-500 py-1.5 text-center">
              <div className="flex items-center justify-center gap-2 text-white text-sm font-bold">
                <Sparkles className="w-4 h-4" />
                <span>Ø§ÙƒØªØ´Ù Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</span>
                <Sparkles className="w-4 h-4" />
              </div>
            </div>
            <div className="h-6" />
            <div className="flex items-center gap-3 mb-3">
              <Crown className="w-8 h-8 text-amber-500" />
              <h3 className="text-lg font-extrabold text-gray-900">Ø¨Ø§Ù‚Ø§Øª Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª</h3>
            </div>
            <p className="text-sm text-gray-600">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø²Ø§ÙŠØ§ Ø­ØµØ±ÙŠØ©!</p>
          </Link>

          <Link to="/owner/menu" className="rounded-2xl shadow-lg hover:shadow-2xl transition transform hover:-translate-y-1 bg-gradient-to-br from-yellow-50 to-white p-5">
            <div className="flex items-center gap-3 mb-3">
              <Utensils className="w-8 h-8 text-yellow-500" />
              <h3 className="text-lg font-extrabold text-gray-900">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>
            </div>
            <p className="text-sm text-gray-600">Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£ØµÙ†Ø§Ù ÙˆØ§Ù„ÙˆØ¬Ø¨Ø§Øª.</p>
          </Link>

          <Link to="/owner/orders" className="rounded-2xl shadow-lg hover:shadow-2xl transition transform hover:-translate-y-1 bg-gradient-to-br from-green-50 to-white p-5">
            <div className="flex items-center gap-3 mb-3">
              <ClipboardList className="w-8 h-8 text-green-500" />
              <h3 className="text-lg font-extrabold text-gray-900">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
            </div>
            <p className="text-sm text-gray-600">Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨.</p>
            {stats.pendingOrders > 0 && (
              <span className="bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold mt-2 inline-block">
                {stats.pendingOrders} Ø¬Ø¯ÙŠØ¯!
              </span>
            )}
          </Link>

          <Link to="/owner/edit" className="rounded-2xl shadow-lg hover:shadow-2xl transition transform hover:-translate-y-1 bg-gradient-to-br from-blue-50 to-white p-5">
            <div className="flex items-center gap-3 mb-3">
              <Settings className="w-8 h-8 text-blue-500" />
              <h3 className="text-lg font-extrabold text-gray-900">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
            </div>
            <p className="text-sm text-gray-600">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±.</p>
          </Link>
        </div>

        {/* Ù…Ø²Ø§ÙŠØ§ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø© */}
        <div className="bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl shadow-lg p-6 text-white">
          <div className="flex items-center gap-2 mb-4">
            <Crown className="w-6 h-6 text-amber-400" />
            <h3 className="text-lg font-bold">ğŸš€ Ù…Ø²Ø§ÙŠØ§ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h3>
          </div>
          
          <div className="grid grid-cols-2 gap-3 mb-4">
            <div className="flex items-center gap-2 text-gray-300 text-sm">
              <BarChart3 className="w-4 h-4 text-green-400" />
              <span>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø§Ù„ÙŠØ© Ù…ÙØµÙ‘Ù„Ø©</span>
            </div>
            <div className="flex items-center gap-2 text-gray-300 text-sm">
              <Star className="w-4 h-4 text-yellow-400" />
              <span>Ø£ÙƒØ«Ø± Ø§Ù„Ø£ØµÙ†Ø§Ù Ù…Ø¨ÙŠØ¹Ø§Ù‹</span>
            </div>
            <div className="flex items-center gap-2 text-gray-300 text-sm">
              <Megaphone className="w-4 h-4 text-purple-400" />
              <span>Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ù…ÙˆÙ„Ø© Ù…Ø¬Ø§Ù†ÙŠØ©</span>
            </div>
            <div className="flex items-center gap-2 text-gray-300 text-sm">
              <Shield className="w-4 h-4 text-blue-400" />
              <span>Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ù…ÙŠØ²Ø©</span>
            </div>
          </div>

          <Link
            to="/owner/packages"
            className="block w-full text-center bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold py-3 rounded-xl hover:from-amber-600 hover:to-orange-600 transition"
          >
            ğŸš€ Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†
          </Link>
        </div>
      </div>
    )
  }

  // ===== ØµÙØ­Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø© (Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø§Ù„ÙƒØ§Ù…Ù„) =====
  return (
    <div className="space-y-6 pb-24 -mx-4 -mt-4">
      
      {/* ========== Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ ========== */}
      <div className="relative">
        {/* Ø§Ù„ØºÙ„Ø§Ù */}
        <div className="h-40 sm:h-48 bg-gradient-to-br from-gray-900 via-gray-800 to-black relative overflow-hidden">
          <div className="absolute inset-0">
            <div className="absolute top-0 right-0 w-96 h-96 bg-amber-500/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2" />
            <div className="absolute bottom-0 left-0 w-64 h-64 bg-purple-500/20 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2" />
          </div>
          
          {/* Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« */}
          <button
            onClick={handleRefresh}
            disabled={refreshing}
            className="absolute top-4 left-4 p-2 bg-white/10 hover:bg-white/20 rounded-xl transition z-10"
          >
            <RefreshCw className={`w-5 h-5 text-white ${refreshing ? 'animate-spin' : ''}`} />
          </button>

          {/* Ø´Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© */}
          <div className="absolute top-4 right-4 z-10">
            <div className="bg-gradient-to-r from-amber-500 to-orange-500 px-4 py-1.5 rounded-full flex items-center gap-2 shadow-lg">
              <Crown className="w-4 h-4 text-white" />
              <span className="text-white font-bold text-sm">Ø¨Ø§Ù‚Ø© Ù…Ù…ÙŠØ²Ø©</span>
            </div>
          </div>
        </div>

        {/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± */}
        <div className="relative px-4 -mt-16">
          <div className="bg-white rounded-3xl shadow-xl p-5">
            <div className="flex items-start gap-4">
              {/* Ø§Ù„Ø´Ø¹Ø§Ø± */}
              <div className="relative -mt-12">
                <div className="w-24 h-24 rounded-2xl bg-white shadow-xl overflow-hidden border-4 border-white">
                  {restaurant?.logoUrl ? (
                    <img src={restaurant.logoUrl} alt={restaurant.name} className="w-full h-full object-cover" />
                  ) : (
                    <div className="w-full h-full bg-gradient-to-br from-amber-100 to-orange-100 flex items-center justify-center">
                      <Store className="w-10 h-10 text-amber-500" />
                    </div>
                  )}
                </div>
                {restaurant?.isVerified && (
                  <div className="absolute -bottom-1 -right-1 w-7 h-7 bg-blue-500 rounded-full flex items-center justify-center border-2 border-white">
                    <CheckCircle className="w-4 h-4 text-white" />
                  </div>
                )}
              </div>

              {/* Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */}
              <div className="flex-1 pt-2">
                <div className="flex items-center gap-2 flex-wrap">
                  <h1 className="text-xl font-bold text-gray-900">{restaurant?.name || 'Ù…ØªØ¬Ø±ÙŠ'}</h1>
                  <span className={`px-2 py-0.5 rounded-full text-xs font-bold text-white bg-gradient-to-r ${tier.color}`}>
                    {tier.icon} {tier.label}
                  </span>
                </div>
                
                {restaurant?.city && (
                  <p className="text-gray-500 text-sm flex items-center gap-1 mt-1">
                    <MapPin className="w-3 h-3" />
                    {restaurant.city}
                  </p>
                )}

                {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© */}
                <div className="flex items-center gap-4 mt-3">
                  <div className="flex items-center gap-1 text-sm">
                    <Star className="w-4 h-4 text-amber-500 fill-amber-500" />
                    <span className="font-bold">{stats.averageRating.toFixed(1)}</span>
                  </div>
                  <div className="text-gray-300">|</div>
                  <div className="text-sm text-gray-600">
                    <span className="font-bold text-gray-900">{stats.totalOrders}</span> Ø·Ù„Ø¨
                  </div>
                  <div className="text-gray-300">|</div>
                  <div className="text-sm text-gray-600">
                    <span className="font-bold text-gray-900">{stats.menuItems}</span> ØµÙ†Ù
                  </div>
                </div>
              </div>
            </div>

            {/* Ø£Ø²Ø±Ø§Ø± Ø³Ø±ÙŠØ¹Ø© */}
            <div className="flex gap-2 mt-4 overflow-x-auto pb-2 -mx-2 px-2">
              <Link to={`/menu?restaurant=${user?.uid}`} className="flex items-center gap-2 bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap">
                <Eye className="w-4 h-4" />
                Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…ØªØ¬Ø±
              </Link>
              <Link to="/owner/edit" className="flex items-center gap-2 bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap">
                <Edit3 className="w-4 h-4" />
                ØªØ¹Ø¯ÙŠÙ„
              </Link>
              <Link to="/owner/promotion" className="flex items-center gap-2 bg-purple-100 hover:bg-purple-200 text-purple-700 px-4 py-2 rounded-xl text-sm font-semibold whitespace-nowrap">
                <Megaphone className="w-4 h-4" />
                Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯
              </Link>
            </div>
          </div>
        </div>
      </div>

      {/* ========== Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ========== */}
      <div className="px-4 space-y-3">
        {/* ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */}
        {stats.pendingOrders > 0 && (
          <Link 
            to="/owner/orders"
            className="block bg-gradient-to-r from-red-500 to-orange-500 rounded-2xl p-4 text-white shadow-lg animate-pulse"
          >
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <Bell className="w-6 h-6" />
              </div>
              <div className="flex-1">
                <h3 className="font-bold text-lg">ğŸ”” {stats.pendingOrders} Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯!</h3>
                <p className="text-white/80 text-sm">Ø§Ø¶ØºØ· Ù„Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¢Ù†</p>
              </div>
              <ArrowRight className="w-6 h-6" />
            </div>
          </Link>
        )}

        {/* ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ */}
        {!restaurant?.bankName && (
          <Link 
            to="/owner/edit#bank"
            className="block bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-2xl p-4"
          >
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-amber-500 rounded-xl flex items-center justify-center">
                <Building2 className="w-5 h-5 text-white" />
              </div>
              <div className="flex-1">
                <h3 className="font-bold text-amber-700">Ø£Ø¶Ù Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¨Ù†ÙƒÙŠ</h3>
                <p className="text-sm text-amber-600">Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
              </div>
            </div>
          </Link>
        )}
      </div>

      {/* ========== Ø§Ù†Ø´Ø±ÙŠ Ù…ØªØ¬Ø±Ùƒ ========== */}
      <div className="px-4">
        <div className="bg-gradient-to-br from-purple-600 via-pink-600 to-rose-500 rounded-2xl p-5 text-white shadow-xl relative overflow-hidden">
          {/* Ø®Ù„ÙÙŠØ© Ø²Ø®Ø±ÙÙŠØ© */}
          <div className="absolute inset-0 opacity-20">
            <div className="absolute top-0 right-0 w-32 h-32 bg-white rounded-full -translate-y-1/2 translate-x-1/2" />
            <div className="absolute bottom-0 left-0 w-24 h-24 bg-white rounded-full translate-y-1/2 -translate-x-1/2" />
          </div>

          <div className="relative z-10">
            <div className="flex items-center gap-2 mb-3">
              <Share2 className="w-6 h-6" />
              <h2 className="text-lg font-bold">ğŸ“¢ Ø§Ù†Ø´Ø±ÙŠ Ù…ØªØ¬Ø±Ùƒ!</h2>
            </div>
            
            <p className="text-white/80 text-sm mb-4">
              Ø´Ø§Ø±ÙƒÙŠ Ø±Ø§Ø¨Ø· Ù…ØªØ¬Ø±Ùƒ Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ØŒ ØªÙˆÙŠØªØ±ØŒ Ø§Ù†Ø³ØªÙ‚Ø±Ø§Ù… Ø£Ùˆ Ø£ÙŠ Ù…Ù†ØµØ©!
            </p>

            {/* Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØªØ¬Ø± */}
            <div className="bg-white/10 backdrop-blur rounded-xl p-3 mb-4">
              <p className="text-white/60 text-xs mb-1">Ø±Ø§Ø¨Ø· Ù…ØªØ¬Ø±Ùƒ Ø§Ù„Ø®Ø§Øµ:</p>
              <div className="flex items-center gap-2">
                <div className="flex-1 bg-white/10 rounded-lg p-2 text-sm font-mono truncate" dir="ltr">
                  {window.location.origin}/menu?restaurant={user?.uid}
                </div>
                <button
                  onClick={copyStoreLink}
                  className={`p-2 rounded-lg transition ${copied ? 'bg-green-500' : 'bg-white/20 hover:bg-white/30'}`}
                >
                  {copied ? <CheckCircle className="w-5 h-5" /> : <Copy className="w-5 h-5" />}
                </button>
              </div>
            </div>

            {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© */}
            <div className="flex gap-2">
              {/* Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ */}
              <button
                onClick={shareToWhatsapp}
                className="flex-1 flex items-center justify-center gap-2 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl transition"
              >
                <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                </svg>
                ÙˆØ§ØªØ³Ø§Ø¨
              </button>
              <button
                onClick={shareStore}
                className="flex-1 flex items-center justify-center gap-2 bg-white text-purple-600 font-bold py-3 rounded-xl hover:bg-purple-50 transition"
              >
                <Share2 className="w-5 h-5" />
                Ù…Ø´Ø§Ø±ÙƒØ©
              </button>
              <Link
                to={`/menu?restaurant=${user?.uid}`}
                className="flex items-center justify-center gap-2 bg-white/20 hover:bg-white/30 px-4 py-3 rounded-xl transition"
              >
                <Eye className="w-5 h-5" />
                Ù…Ø¹Ø§ÙŠÙ†Ø©
              </Link>
            </div>

            {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø²ÙŠØ§Ø±Ø§Øª */}
            <div className="grid grid-cols-5 gap-2 mt-4 pt-4 border-t border-white/20">
              <div className="text-center">
                <p className="text-xl font-bold">{stats.followersCount}</p>
                <p className="text-white/70 text-[10px]">Ù…ØªØ§Ø¨Ø¹ ğŸ’œ</p>
              </div>
              <div className="text-center">
                <p className="text-xl font-bold">{stats.todayViews}</p>
                <p className="text-white/70 text-[10px]">Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
              </div>
              <div className="text-center">
                <p className="text-xl font-bold">{stats.profileViews}</p>
                <p className="text-white/70 text-[10px]">Ù…Ø´Ø§Ù‡Ø¯Ø© ØµÙØ­Ø©</p>
              </div>
              <div className="text-center">
                <p className="text-xl font-bold">{stats.whatsappShares}</p>
                <p className="text-white/70 text-[10px]">Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³</p>
              </div>
              <div className="text-center">
                <p className="text-xl font-bold">{stats.registeredViaLink}</p>
                <p className="text-white/70 text-[10px]">ØªØ³Ø¬ÙŠÙ„ Ø¹Ø¨Ø±Ùƒ</p>
              </div>
            </div>

            {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© */}
            <div className="grid grid-cols-3 gap-2 mt-2 pt-2 border-t border-white/20">
              <div className="text-center">
                <p className="text-2xl font-bold">{stats.uniqueCustomers}</p>
                <p className="text-white/70 text-xs">Ø¹Ù…ÙŠÙ„</p>
              </div>
              <div className="text-center">
                <p className="text-2xl font-bold">{stats.totalViews}</p>
                <p className="text-white/70 text-xs">Ù…Ø´Ø§Ù‡Ø¯Ø©</p>
              </div>
              <div className="text-center">
                <p className="text-2xl font-bold">{stats.totalOrders}</p>
                <p className="text-white/70 text-xs">Ø·Ù„Ø¨</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* ========== Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© ========== */}
      <div className="px-4">
        <div className="bg-gradient-to-br from-green-600 to-emerald-700 rounded-2xl p-5 text-white shadow-xl">
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-2">
              <Wallet className="w-6 h-6" />
              <h2 className="text-lg font-bold">ğŸ’° Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h2>
            </div>
            <Link to="/owner/orders" className="text-white/80 text-sm hover:text-white">
              Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ â†
            </Link>
          </div>

          <div className="grid grid-cols-2 gap-3">
            <div className="bg-white/10 backdrop-blur rounded-xl p-4">
              <p className="text-white/70 text-sm mb-1">Ø§Ù„ÙŠÙˆÙ…</p>
              <p className="text-2xl font-bold">{stats.todayRevenue.toFixed(0)} <span className="text-sm">Ø±.Ø³</span></p>
              <p className="text-white/60 text-xs mt-1">{stats.todayOrders} Ø·Ù„Ø¨</p>
            </div>
            <div className="bg-white/10 backdrop-blur rounded-xl p-4">
              <p className="text-white/70 text-sm mb-1">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
              <p className="text-2xl font-bold">{stats.weekRevenue.toFixed(0)} <span className="text-sm">Ø±.Ø³</span></p>
              <p className="text-white/60 text-xs mt-1">{stats.weekOrders} Ø·Ù„Ø¨</p>
            </div>
            <div className="bg-white/10 backdrop-blur rounded-xl p-4">
              <p className="text-white/70 text-sm mb-1">Ø§Ù„Ø´Ù‡Ø±</p>
              <p className="text-2xl font-bold">{stats.monthRevenue.toFixed(0)} <span className="text-sm">Ø±.Ø³</span></p>
              <p className="text-white/60 text-xs mt-1">{stats.monthOrders} Ø·Ù„Ø¨</p>
            </div>
            <div className="bg-white/20 backdrop-blur rounded-xl p-4 ring-2 ring-white/30">
              <p className="text-white/70 text-sm mb-1">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
              <p className="text-2xl font-bold">{stats.totalRevenue.toFixed(0)} <span className="text-sm">Ø±.Ø³</span></p>
              <p className="text-white/60 text-xs mt-1">{stats.deliveredOrders} Ù…ÙƒØªÙ…Ù„</p>
            </div>
          </div>
        </div>
      </div>

      {/* ========== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³Ø±ÙŠØ¹Ø© ========== */}
      <div className="px-4">
        <h2 className="text-lg font-bold text-gray-900 mb-3">âš¡ ØªØ­ÙƒÙ… Ø³Ø±ÙŠØ¹</h2>
        <div className="grid grid-cols-2 gap-3">
          {/* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª */}
          <Link 
            to="/owner/orders"
            className="bg-white rounded-2xl shadow-lg p-4 hover:shadow-xl transition border border-gray-100"
          >
            <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center mb-3">
              <ClipboardList className="w-6 h-6 text-white" />
            </div>
            <h3 className="font-bold text-gray-900">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
            <div className="flex items-center gap-2 mt-2">
              <span className="bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full text-xs font-bold">
                {stats.pendingOrders} Ø¬Ø¯ÙŠØ¯
              </span>
              <span className="bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full text-xs font-bold">
                {stats.preparingOrders} ØªØ­Ø¶ÙŠØ±
              </span>
            </div>
          </Link>

          {/* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */}
          <Link 
            to="/owner/menu"
            className="bg-white rounded-2xl shadow-lg p-4 hover:shadow-xl transition border border-gray-100"
          >
            <div className="w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl flex items-center justify-center mb-3">
              <Utensils className="w-6 h-6 text-white" />
            </div>
            <h3 className="font-bold text-gray-900">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>
            <div className="flex items-center gap-2 mt-2">
              <span className="bg-green-100 text-green-700 px-2 py-0.5 rounded-full text-xs font-bold">
                {stats.availableItems} Ù…ØªØ§Ø­
              </span>
              <span className="bg-gray-100 text-gray-700 px-2 py-0.5 rounded-full text-xs font-bold">
                {stats.menuItems} Ø¥Ø¬Ù…Ø§Ù„ÙŠ
              </span>
            </div>
          </Link>

          {/* Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª */}
          <Link 
            to="/owner/promotion"
            className="bg-white rounded-2xl shadow-lg p-4 hover:shadow-xl transition border border-gray-100"
          >
            <div className="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mb-3">
              <Megaphone className="w-6 h-6 text-white" />
            </div>
            <h3 className="font-bold text-gray-900">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h3>
            <div className="flex items-center gap-2 mt-2">
              <span className="bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full text-xs font-bold">
                {stats.activePromotions} Ù†Ø´Ø·
              </span>
              <span className="bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full text-xs font-bold flex items-center gap-1">
                <Eye className="w-3 h-3" />
                {stats.totalViews}
              </span>
            </div>
          </Link>

          {/* Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */}
          <Link 
            to="/owner/edit"
            className="bg-white rounded-2xl shadow-lg p-4 hover:shadow-xl transition border border-gray-100"
          >
            <div className="w-12 h-12 bg-gradient-to-br from-gray-600 to-gray-700 rounded-xl flex items-center justify-center mb-3">
              <Settings className="w-6 h-6 text-white" />
            </div>
            <h3 className="font-bold text-gray-900">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
            <p className="text-gray-500 text-xs mt-2">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</p>
          </Link>
        </div>
      </div>

      {/* ========== Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ========== */}
      <div className="px-4">
        <h2 className="text-lg font-bold text-gray-900 mb-3">ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
        <div className="bg-white rounded-2xl shadow-lg p-4 border border-gray-100">
          <div className="grid grid-cols-4 gap-2">
            <Link to="/owner/orders?status=pending" className="text-center p-3 bg-yellow-50 rounded-xl hover:bg-yellow-100 transition">
              <Clock className="w-6 h-6 text-yellow-500 mx-auto mb-1" />
              <p className="text-lg font-bold text-yellow-700">{stats.pendingOrders}</p>
              <p className="text-xs text-yellow-600">Ø¬Ø¯ÙŠØ¯</p>
            </Link>
            <Link to="/owner/orders?status=preparing" className="text-center p-3 bg-orange-50 rounded-xl hover:bg-orange-100 transition">
              <ChefHat className="w-6 h-6 text-orange-500 mx-auto mb-1" />
              <p className="text-lg font-bold text-orange-700">{stats.preparingOrders}</p>
              <p className="text-xs text-orange-600">ØªØ­Ø¶ÙŠØ±</p>
            </Link>
            <Link to="/owner/orders?status=delivered" className="text-center p-3 bg-green-50 rounded-xl hover:bg-green-100 transition">
              <CheckCircle className="w-6 h-6 text-green-500 mx-auto mb-1" />
              <p className="text-lg font-bold text-green-700">{stats.deliveredOrders}</p>
              <p className="text-xs text-green-600">Ù…ÙƒØªÙ…Ù„</p>
            </Link>
            <Link to="/owner/orders?status=cancelled" className="text-center p-3 bg-red-50 rounded-xl hover:bg-red-100 transition">
              <AlertCircle className="w-6 h-6 text-red-500 mx-auto mb-1" />
              <p className="text-lg font-bold text-red-700">{stats.cancelledOrders}</p>
              <p className="text-xs text-red-600">Ù…Ù„ØºÙŠ</p>
            </Link>
          </div>
        </div>
      </div>

      {/* ========== Ø£ÙƒØ«Ø± Ø§Ù„Ø£ØµÙ†Ø§Ù Ù…Ø¨ÙŠØ¹Ø§Ù‹ ========== */}
      {topItems.length > 0 && (
        <div className="px-4">
          <div className="flex items-center justify-between mb-3">
            <h2 className="text-lg font-bold text-gray-900">ğŸ† Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹</h2>
            <Link to="/owner/menu" className="text-amber-600 text-sm font-semibold">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â†</Link>
          </div>
          <div className="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100">
            {topItems.map((item, i) => (
              <div key={i} className={`flex items-center gap-3 p-4 ${i !== topItems.length - 1 ? 'border-b' : ''}`}>
                <span className="text-2xl w-8">
                  {i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : `#${i + 1}`}
                </span>
                <div className="flex-1">
                  <p className="font-semibold text-gray-900">{item.name}</p>
                </div>
                <div className="bg-amber-100 text-amber-700 px-3 py-1 rounded-full text-sm font-bold">
                  {item.count} Ù…Ø¨ÙŠØ¹Ø§Øª
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* ========== Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª ========== */}
      {recentOrders.length > 0 && (
        <div className="px-4">
          <div className="flex items-center justify-between mb-3">
            <h2 className="text-lg font-bold text-gray-900">ğŸ“¦ Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
            <Link to="/owner/orders" className="text-blue-600 text-sm font-semibold">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â†</Link>
          </div>
          <div className="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100">
            {recentOrders.map((order, i) => {
              const statusInfo = getStatusInfo(order.status)
              const StatusIcon = statusInfo.icon
              return (
                <Link
                  key={order.id}
                  to="/owner/orders"
                  className={`flex items-center gap-3 p-4 hover:bg-gray-50 transition ${i !== recentOrders.length - 1 ? 'border-b' : ''}`}
                >
                  <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${statusInfo.color}`}>
                    <StatusIcon className="w-5 h-5" />
                  </div>
                  <div className="flex-1">
                    <p className="font-semibold text-gray-900">{order.items?.length || 0} Ø£ØµÙ†Ø§Ù</p>
                    <p className="text-xs text-gray-500">
                      {order.createdAt?.toDate?.().toLocaleDateString('ar-SA') || ''}
                    </p>
                  </div>
                  <div className="text-left">
                    <p className="font-bold text-green-600">{order.subtotal?.toFixed(0)} Ø±.Ø³</p>
                    <span className={`text-xs px-2 py-0.5 rounded-full ${statusInfo.color}`}>
                      {statusInfo.label}
                    </span>
                  </div>
                </Link>
              )
            })}
          </div>
        </div>
      )}

      {/* ========== Ø£Ø¯ÙˆØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© ========== */}
      <div className="px-4">
        <h2 className="text-lg font-bold text-gray-900 mb-3">ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h2>
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
          {/* ØªÙˆØ¸ÙŠÙ Ø¹Ø§Ù…Ù„Ø§Øª */}
          <Link 
            to="/owner/edit#hiring"
            className={`flex items-center gap-3 bg-white rounded-2xl shadow p-4 border ${restaurant?.isHiring ? 'border-purple-300 bg-purple-50' : 'border-gray-100'}`}
          >
            <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${restaurant?.isHiring ? 'bg-purple-500' : 'bg-gray-200'}`}>
              <Briefcase className={`w-5 h-5 ${restaurant?.isHiring ? 'text-white' : 'text-gray-500'}`} />
            </div>
            <div className="flex-1">
              <p className="font-semibold text-gray-900">ØªÙˆØ¸ÙŠÙ Ø¹Ø§Ù…Ù„Ø§Øª</p>
              <p className="text-xs text-gray-500">
                {restaurant?.isHiring ? 'âœ“ Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ØªÙˆØ¸ÙŠÙ Ù…ÙØ¹Ù‘Ù„' : 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ø§Ù„Ø·Ø¨Ø®'}
              </p>
            </div>
          </Link>

          {/* Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ */}
          <Link 
            to="/owner/edit#bank"
            className={`flex items-center gap-3 bg-white rounded-2xl shadow p-4 border ${restaurant?.bankName ? 'border-green-300 bg-green-50' : 'border-gray-100'}`}
          >
            <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${restaurant?.bankName ? 'bg-green-500' : 'bg-gray-200'}`}>
              <Building2 className={`w-5 h-5 ${restaurant?.bankName ? 'text-white' : 'text-gray-500'}`} />
            </div>
            <div className="flex-1">
              <p className="font-semibold text-gray-900">Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</p>
              <p className="text-xs text-gray-500">
                {restaurant?.bankName ? `âœ“ ${restaurant.bankName}` : 'Ø£Ø¶Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨'}
              </p>
            </div>
          </Link>

          {/* Ø§Ù„Ø¨Ø§Ù‚Ø§Øª */}
          <Link 
            to="/owner/packages"
            className="flex items-center gap-3 bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl shadow p-4 border border-amber-200"
          >
            <div className="w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl flex items-center justify-center">
              <Crown className="w-5 h-5 text-white" />
            </div>
            <div className="flex-1">
              <p className="font-semibold text-amber-700">Ø¨Ø§Ù‚ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
              <p className="text-xs text-amber-600">ğŸ‘‘ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©</p>
            </div>
          </Link>

          {/* Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…ØªØ¬Ø± */}
          <Link 
            to={`/menu?restaurant=${user?.uid}`}
            className="flex items-center gap-3 bg-white rounded-2xl shadow p-4 border border-gray-100"
          >
            <div className="w-10 h-10 bg-sky-500 rounded-xl flex items-center justify-center">
              <Globe className="w-5 h-5 text-white" />
            </div>
            <div className="flex-1">
              <p className="font-semibold text-gray-900">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…ØªØ¬Ø±</p>
              <p className="text-xs text-gray-500">Ø´Ø§Ù‡Ø¯ Ù…ØªØ¬Ø±Ùƒ ÙƒÙ…Ø§ ÙŠØ±Ø§Ù‡ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
            </div>
          </Link>
        </div>
      </div>

      {/* ========== Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ (Ù„Ù„Ù…Ù…ÙŠØ²ÙŠÙ† ÙÙ‚Ø·) ========== */}
      {restaurant?.bankName && (
        <div className="px-4">
          <div className="bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-2xl p-4">
            <div className="flex items-center gap-2 mb-3">
              <Building2 className="w-5 h-5 text-green-600" />
              <h3 className="font-bold text-green-800">âœ… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ù…ÙØ¹Ù‘Ù„</h3>
            </div>
            <div className="bg-white rounded-xl p-3 space-y-2">
              <p className="text-sm text-gray-600">
                <span className="font-semibold">Ø§Ù„Ø¨Ù†Ùƒ:</span> {restaurant.bankName}
              </p>
              <p className="text-sm text-gray-600">
                <span className="font-semibold">Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:</span> {restaurant.bankAccountName}
              </p>
              <p className="text-sm text-gray-600">
                <span className="font-semibold">Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†:</span> {restaurant.bankAccountNumber}
              </p>
            </div>
            <p className="text-xs text-green-600 mt-2">
              ğŸ’¡ ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ
            </p>
          </div>
        </div>
      )}

    </div>
  )
}

export default OwnerDashboard

==========================================================================================
FILE: src/pages/PackagesPage.tsx
==========================================================================================
// src/pages/PackagesPage.tsx
import React, { useState, useEffect, useRef } from 'react'
import { useAuth } from '@/auth'
import { db, storage } from '@/firebase'
import { doc, getDoc, updateDoc, serverTimestamp, addDoc, collection, query, where, getDocs, onSnapshot } from 'firebase/firestore'
import { ref, uploadBytes, getDownloadURL } from 'firebase/storage'
import { useToast } from '@/components/ui/Toast'
import { useDialog } from '@/components/ui/ConfirmDialog'
import { 
  Crown, 
  Star, 
  Check, 
  Sparkles, 
  TrendingUp, 
  Eye, 
  ShoppingBag,
  FileText,
  Award,
  Megaphone,
  Calendar,
  ChevronLeft,
  Gift,
  Home,
  Upload,
  ExternalLink,
  Clock,
  CreditCard
} from 'lucide-react'

type PackageType = 'free' | 'premium'
type RequestStatus = 'pending' | 'bank_sent' | 'payment_sent' | 'approved' | 'rejected' | 'expired'

type PackageRequest = {
  id: string
  status: RequestStatus
  bankAccountImageUrl?: string
  paymentProofImageUrl?: string
  subscriptionAmount?: number
  subscriptionDuration?: number
  createdAt?: any
  expiresAt?: any
}

export const PackagesPage: React.FC = () => {
  const { user } = useAuth()
  const toast = useToast()
  const dialog = useDialog()
  const [currentPackage, setCurrentPackage] = useState<PackageType>('free')
  const [loading, setLoading] = useState(true)
  const [subscribing, setSubscribing] = useState(false)
  const [selectingFree, setSelectingFree] = useState(false)
  
  // Ø­Ø§Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
  const [activeRequest, setActiveRequest] = useState<PackageRequest | null>(null)
  const [uploadingProof, setUploadingProof] = useState(false)
  const [proofFile, setProofFile] = useState<File | null>(null)
  const proofFileRef = useRef<HTMLInputElement>(null)

  useEffect(() => {
    if (!user) return
    
    const loadData = async () => {
      try {
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù…
        const restSnap = await getDoc(doc(db, 'restaurants', user.uid))
        if (restSnap.exists()) {
          const data = restSnap.data()
          setCurrentPackage(data?.packageType || 'free')
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù†Ø´Ø·
        const requestsQuery = query(
          collection(db, 'packageRequests'),
          where('restaurantId', '==', user.uid)
        )
        const requestsSnap = await getDocs(requestsQuery)
        if (!requestsSnap.empty) {
          // Ø¬Ù„Ø¨ Ø¢Ø®Ø± Ø·Ù„Ø¨
          const requests = requestsSnap.docs.map(d => ({ id: d.id, ...d.data() } as PackageRequest))
          const activeReq = requests.find(r => !['approved', 'rejected', 'expired'].includes(r.status))
          if (activeReq) {
            setActiveRequest(activeReq)
          }
        }
      } catch (err) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', err)
      } finally {
        setLoading(false)
      }
    }
    
    loadData()
    
    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ
    const requestsQuery = query(
      collection(db, 'packageRequests'),
      where('restaurantId', '==', user.uid)
    )
    const unsub = onSnapshot(requestsQuery, (snap) => {
      if (!snap.empty) {
        const requests = snap.docs.map(d => ({ id: d.id, ...d.data() } as PackageRequest))
        const activeReq = requests.find(r => !['approved', 'rejected', 'expired'].includes(r.status))
        setActiveRequest(activeReq || null)
        
        // Ø¥Ø°Ø§ ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©ØŒ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø§Ù‚Ø©
        const approvedReq = requests.find(r => r.status === 'approved')
        if (approvedReq) {
          setCurrentPackage('premium')
        }
      }
    })
    
    return () => unsub()
  }, [user])

  // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©
  const handleSelectFree = async () => {
    if (!user) return
    if (currentPackage === 'free') {
      toast.info('Ø£Ù†Øª Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©')
      return
    }
    
    const confirmed = await dialog.confirm(
      'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©ØŸ Ø³ØªÙÙ‚Ø¯ Ù…Ù…ÙŠØ²Ø§Øª Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ².',
      {
        title: 'ğŸ“¦ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©',
        confirmText: 'Ù†Ø¹Ù…ØŒ Ø­ÙˆÙ‘Ù„ Ù„Ù„Ù…Ø¬Ø§Ù†ÙŠØ©',
        cancelText: 'Ø¥Ù„ØºØ§Ø¡',
      }
    )
    
    if (!confirmed) return

    setSelectingFree(true)
    try {
      await updateDoc(doc(db, 'restaurants', user.uid), {
        packageType: 'free',
        packageRequest: null,
        updatedAt: serverTimestamp(),
      })
      setCurrentPackage('free')
      toast.success('ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©')
    } catch (err) {
      console.error('Ø®Ø·Ø£:', err)
      toast.error('Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰')
    } finally {
      setSelectingFree(false)
    }
  }

  // Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ²
  const handleSubscribePremium = async () => {
    if (!user) return
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨ Ù†Ø´Ø·
    if (activeRequest) {
      toast.info('Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©')
      return
    }
    
    const confirmed = await dialog.confirm(
      'Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ù„Ù„Ù…Ø·ÙˆØ± ÙˆØ³ÙŠØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ². Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ',
      {
        title: 'âœ¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ²',
        confirmText: 'Ù†Ø¹Ù…ØŒ Ø£Ø±ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ',
        cancelText: 'Ù„Ø§Ø­Ù‚Ø§Ù‹',
      }
    )
    
    if (!confirmed) return

    setSubscribing(true)
    try {
      // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù…
      const restSnap = await getDoc(doc(db, 'restaurants', user.uid))
      const restData = restSnap.data()
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯
      const requestRef = await addDoc(collection(db, 'packageRequests'), {
        restaurantId: user.uid,
        restaurantName: restData?.name || 'Ø£Ø³Ø±Ø© Ù…Ù†ØªØ¬Ø©',
        ownerName: restData?.ownerName || '',
        ownerPhone: restData?.phone || '',
        status: 'pending',
        subscriptionAmount: 99, // Ø³ÙŠØ­Ø¯Ø¯Ù‡ Ø§Ù„Ù…Ø·ÙˆØ±
        subscriptionDuration: 30, // 30 ÙŠÙˆÙ…
        requestedAt: serverTimestamp(),
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
      })
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø·Ø¹Ù…
      await updateDoc(doc(db, 'restaurants', user.uid), {
        packageRequest: 'premium',
        packageRequestedAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
      })
      
      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø·ÙˆØ±
      try {
        const devQuery = query(collection(db, 'users'), where('role', '==', 'developer'))
        const devSnap = await getDocs(devQuery)
        
        if (!devSnap.empty) {
          // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„ÙƒÙ„ Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†
          for (const devDoc of devSnap.docs) {
            await addDoc(collection(db, 'notifications'), {
              recipientId: devDoc.id,
              title: 'ğŸ“¦ Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ²',
              message: `${restData?.name || 'Ø£Ø³Ø±Ø© Ù…Ù†ØªØ¬Ø©'} Ø·Ù„Ø¨Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ²`,
              type: 'package_request',
              read: false,
              data: { requestId: requestRef.id, restaurantId: user.uid },
              createdAt: serverTimestamp(),
            })
          }
        } else {
          // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø·ÙˆØ± - Ù†Ø±Ø³Ù„ Ù„Ù„Ù…Ø´Ø±ÙÙŠÙ† Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù†Ù‡
          const adminQuery = query(collection(db, 'users'), where('role', '==', 'admin'))
          const adminSnap = await getDocs(adminQuery)
          for (const adminDoc of adminSnap.docs) {
            await addDoc(collection(db, 'notifications'), {
              recipientId: adminDoc.id,
              title: 'ğŸ“¦ Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ²',
              message: `${restData?.name || 'Ø£Ø³Ø±Ø© Ù…Ù†ØªØ¬Ø©'} Ø·Ù„Ø¨Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ²`,
              type: 'package_request',
              read: false,
              data: { requestId: requestRef.id, restaurantId: user.uid },
              createdAt: serverTimestamp(),
            })
          }
        }
      } catch (notifErr) {
        // Ù„Ø§ Ù†ÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¥Ø°Ø§ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        console.warn('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:', notifErr)
      }
      
      toast.success('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ! Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ âœ¨')
    } catch (err) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨:', err)
      toast.error('Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰')
    } finally {
      setSubscribing(false)
    }
  }

  // Ø±ÙØ¹ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„
  const handleUploadPaymentProof = async () => {
    if (!user || !activeRequest || !proofFile) {
      toast.warning('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„')
      return
    }

    setUploadingProof(true)
    try {
      // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
      const path = `paymentProofs/${user.uid}_${Date.now()}_${proofFile.name}`
      const storageRef = ref(storage, path)
      await uploadBytes(storageRef, proofFile)
      const imageUrl = await getDownloadURL(storageRef)

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨
      await updateDoc(doc(db, 'packageRequests', activeRequest.id), {
        status: 'payment_sent',
        paymentProofImageUrl: imageUrl,
        paymentSentAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
      })

      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø·ÙˆØ±
      try {
        const restSnap = await getDoc(doc(db, 'restaurants', user.uid))
        const restName = restSnap.data()?.name || 'Ø£Ø³Ø±Ø© Ù…Ù†ØªØ¬Ø©'
        
        const devQuery = query(collection(db, 'users'), where('role', '==', 'developer'))
        const devSnap = await getDocs(devQuery)
        
        if (!devSnap.empty) {
          for (const devDoc of devSnap.docs) {
            await addDoc(collection(db, 'notifications'), {
              recipientId: devDoc.id,
              title: 'ğŸ’³ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø«Ø¨Ø§Øª ØªØ­ÙˆÙŠÙ„',
              message: `${restName} Ø£Ø±Ø³Ù„Øª Ø¥Ø«Ø¨Ø§Øª ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ`,
              type: 'payment_proof_sent',
              read: false,
              data: { requestId: activeRequest.id, restaurantId: user.uid },
              createdAt: serverTimestamp(),
            })
          }
        } else {
          // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø·ÙˆØ± - Ù†Ø±Ø³Ù„ Ù„Ù„Ù…Ø´Ø±ÙÙŠÙ†
          const adminQuery = query(collection(db, 'users'), where('role', '==', 'admin'))
          const adminSnap = await getDocs(adminQuery)
          for (const adminDoc of adminSnap.docs) {
            await addDoc(collection(db, 'notifications'), {
              recipientId: adminDoc.id,
              title: 'ğŸ’³ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø«Ø¨Ø§Øª ØªØ­ÙˆÙŠÙ„',
              message: `${restName} Ø£Ø±Ø³Ù„Øª Ø¥Ø«Ø¨Ø§Øª ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ`,
              type: 'payment_proof_sent',
              read: false,
              data: { requestId: activeRequest.id, restaurantId: user.uid },
              createdAt: serverTimestamp(),
            })
          }
        }
      } catch (notifErr) {
        console.warn('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:', notifErr)
      }

      toast.success('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø© âœ¨')
      setProofFile(null)
      if (proofFileRef.current) proofFileRef.current.value = ''
    } catch (err: any) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ø¥Ø«Ø¨Ø§Øª:', err)
      toast.error(`Ø­Ø¯Ø« Ø®Ø·Ø£: ${err.message}`)
    } finally {
      setUploadingProof(false)
    }
  }

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-[400px]">
        <div className="text-center">
          <div className="w-12 h-12 border-4 border-amber-200 border-t-amber-500 rounded-full animate-spin mx-auto mb-4" />
          <p className="text-gray-500">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
      </div>
    )
  }

  return (
    <div className="max-w-4xl mx-auto space-y-8">
      {/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */}
      <div className="text-center">
        <div className="inline-flex items-center gap-2 bg-gradient-to-r from-amber-100 to-yellow-100 px-5 py-2.5 rounded-full mb-4 shadow-sm">
          <span className="text-xl">ğŸ’¼</span>
          <span className="text-amber-700 font-bold text-lg">Ø¨Ø§Ù‚Ø§Øª Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª</span>
        </div>
        <h1 className="text-3xl md:text-4xl font-black text-gray-900 mb-3">
          Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø£Ø³Ø±ØªÙƒ
        </h1>
        <p className="text-gray-600 max-w-lg mx-auto">
          Ø§Ø¨Ø¯Ø£ Ù…Ø¬Ø§Ù†Ø§Ù‹ ÙˆØ§Ø³ØªÙ…ØªØ¹ Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŒ Ø£Ùˆ Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ² Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø²Ø§ÙŠØ§ Ø­ØµØ±ÙŠØ©
        </p>
      </div>

      {/* === Ù‚Ø³Ù… Ø­Ø§Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù†Ø´Ø· === */}
      {activeRequest && (
        <div className="bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border-2 border-amber-200 shadow-lg">
          <div className="flex items-center gap-3 mb-4">
            <div className="w-12 h-12 bg-amber-500 rounded-xl flex items-center justify-center">
              <CreditCard className="w-6 h-6 text-white" />
            </div>
            <div>
              <h3 className="text-xl font-bold text-amber-800">Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</h3>
              <p className="text-amber-600 text-sm">
                {activeRequest.status === 'pending' && 'â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ'}
                {activeRequest.status === 'bank_sent' && 'ğŸ¦ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ - ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙˆØ±ÙØ¹ Ø§Ù„Ø¥Ø«Ø¨Ø§Øª'}
                {activeRequest.status === 'payment_sent' && 'ğŸ’³ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ - Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯'}
              </p>
            </div>
          </div>

          {/* === Ø­Ø§Ù„Ø©: Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ø±Ø³Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ù†Ùƒ === */}
          {activeRequest.status === 'bank_sent' && (
            <div className="space-y-4">
              {/* Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ */}
              {activeRequest.bankAccountImageUrl && (
                <div className="bg-white rounded-xl p-4">
                  <p className="font-semibold text-gray-700 mb-2">ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„:</p>
                  <a
                    href={activeRequest.bankAccountImageUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="inline-flex items-center gap-2 bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg transition"
                  >
                    <ExternalLink className="w-5 h-5" />
                    Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ
                  </a>
                  <p className="text-green-600 font-bold mt-2">
                    ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: {activeRequest.subscriptionAmount || 99} Ø±ÙŠØ§Ù„
                  </p>
                </div>
              )}

              {/* Ø±ÙØ¹ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ */}
              <div className="bg-white rounded-xl p-4 space-y-3">
                <p className="font-semibold text-gray-700">ğŸ“¤ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ØŒ Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„:</p>
                <input
                  ref={proofFileRef}
                  type="file"
                  accept="image/*"
                  onChange={(e) => setProofFile(e.target.files?.[0] || null)}
                  className="w-full border-2 border-dashed border-amber-300 rounded-xl p-4 bg-amber-50"
                />
                {proofFile && (
                  <p className="text-sm text-green-600">âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: {proofFile.name}</p>
                )}
                <button
                  onClick={handleUploadPaymentProof}
                  disabled={uploadingProof || !proofFile}
                  className="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white py-3 rounded-xl font-bold disabled:opacity-50 transition flex items-center justify-center gap-2"
                >
                  {uploadingProof ? (
                    <>
                      <Clock className="w-5 h-5 animate-spin" />
                      Ø¬Ø§Ø±Ù Ø§Ù„Ø±ÙØ¹...
                    </>
                  ) : (
                    <>
                      <Upload className="w-5 h-5" />
                      Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„
                    </>
                  )}
                </button>
              </div>
            </div>
          )}

          {/* === Ø­Ø§Ù„Ø©: Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø·ÙˆØ± === */}
          {activeRequest.status === 'payment_sent' && (
            <div className="bg-purple-100 rounded-xl p-4 flex items-center gap-3">
              <Clock className="w-8 h-8 text-purple-600 animate-pulse" />
              <div>
                <p className="font-bold text-purple-800">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…</p>
                <p className="text-purple-600 text-sm">Ø¬Ø§Ø±Ù Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¥Ø«Ø¨Ø§Øª ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø©... Ø³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø±Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>
              </div>
            </div>
          )}

          {/* === Ø­Ø§Ù„Ø©: Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø·ÙˆØ± === */}
          {activeRequest.status === 'pending' && (
            <div className="bg-yellow-100 rounded-xl p-4 flex items-center gap-3">
              <Clock className="w-8 h-8 text-yellow-600 animate-pulse" />
              <div>
                <p className="font-bold text-yellow-800">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…</p>
                <p className="text-yellow-600 text-sm">Ø¬Ø§Ø±Ù Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„...</p>
              </div>
            </div>
          )}
        </div>
      )}

      {/* Ø§Ù„Ø¨Ø§Ù‚Ø§Øª */}
      <div className="grid md:grid-cols-2 gap-6">
        
        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {/* Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© */}
        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        <div className={`relative rounded-3xl overflow-hidden transition-all duration-300 ${
          currentPackage === 'free' 
            ? 'ring-4 ring-green-400 shadow-2xl' 
            : 'shadow-lg hover:shadow-xl'
        }`}>
          {currentPackage === 'free' && (
            <div className="absolute top-4 right-4 bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center gap-1 z-10">
              <Check className="w-4 h-4" />
              Ø¨Ø§Ù‚ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            </div>
          )}
          
          <div className="bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 p-6 md:p-8 h-full flex flex-col">
            {/* Ø±Ø£Ø³ Ø§Ù„Ø¨Ø§Ù‚Ø© */}
            <div className="flex items-center gap-4 mb-6">
              <div className="w-16 h-16 bg-gradient-to-br from-green-400 to-emerald-500 rounded-2xl flex items-center justify-center shadow-lg">
                <Gift className="w-8 h-8 text-white" />
              </div>
              <div>
                <h2 className="text-2xl font-black text-gray-900">Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</h2>
                <p className="text-green-600 font-semibold">Ù„Ù„Ø¬Ù…ÙŠØ¹ â€¢ Ù…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©</p>
              </div>
            </div>

            {/* Ø§Ù„Ø³Ø¹Ø± */}
            <div className="bg-white/70 backdrop-blur rounded-2xl p-4 mb-6 text-center">
              <div className="flex items-baseline justify-center gap-1">
                <span className="text-5xl font-black text-gray-900">0</span>
                <span className="text-xl text-gray-600">Ø±.Ø³</span>
              </div>
              <p className="text-green-600 font-medium mt-1">Ù…Ø¬Ø§Ù†Ø§Ù‹ Ù„Ù„Ø£Ø¨Ø¯</p>
            </div>

            {/* Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª */}
            <div className="space-y-4 flex-1">
              <h3 className="font-bold text-gray-800 flex items-center gap-2">
                <Star className="w-5 h-5 text-amber-500" />
                Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:
              </h3>
              
              <div className="space-y-3">
                <FeatureItem 
                  icon={<Eye className="w-5 h-5" />}
                  title="Ø§Ù„Ø¸Ù‡ÙˆØ± ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"
                  desc="Ø£Ø³Ø±ØªÙƒ ØªØ¸Ù‡Ø± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ù…Ù†Ø·Ù‚ØªÙƒ"
                  included
                />
                <FeatureItem 
                  icon={<ShoppingBag className="w-5 h-5" />}
                  title="Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª"
                  desc="Ø§Ø³ØªÙ‚Ø¨Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø¯ÙˆÙ† Ø­Ø¯ÙˆØ¯"
                  included
                />
                <FeatureItem 
                  icon={<FileText className="w-5 h-5" />}
                  title="ØµÙØ­Ø© Ø®Ø§ØµØ© Ù„Ø£Ø³Ø±ØªÙƒ"
                  desc="ØµÙØ­Ø© Ù…Ø®ØµØµØ© ØªØ¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…ØªÙƒ ÙˆÙ…Ù†ØªØ¬Ø§ØªÙƒ"
                  included
                />
              </div>
            </div>

            {/* Ø²Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© */}
            <div className="mt-6">
              {currentPackage === 'free' ? (
                <div className="bg-green-100 text-green-700 py-4 px-6 rounded-2xl text-center font-bold flex items-center justify-center gap-2">
                  <Check className="w-5 h-5" />
                  Ø£Ù†Øª Ù…Ø´ØªØ±Ùƒ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø§Ù‚Ø©
                </div>
              ) : (
                <button
                  onClick={handleSelectFree}
                  disabled={selectingFree}
                  className="w-full py-4 px-6 rounded-2xl bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3"
                >
                  {selectingFree ? (
                    <>
                      <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                      Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­ÙˆÙŠÙ„...
                    </>
                  ) : (
                    <>
                      <Gift className="w-6 h-6" />
                      Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©
                      <ChevronLeft className="w-5 h-5" />
                    </>
                  )}
                </button>
              )}
            </div>
          </div>
        </div>

        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        {/* Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ² */}
        {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
        <div className={`relative rounded-3xl overflow-hidden transition-all duration-300 ${
          currentPackage === 'premium' 
            ? 'ring-4 ring-amber-400 shadow-2xl' 
            : 'shadow-lg hover:shadow-xl hover:scale-[1.01]'
        }`}>
          {/* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…ÙŠØ² */}
          <div className="absolute top-0 left-0 right-0 bg-gradient-to-r from-amber-500 via-yellow-400 to-amber-500 py-2 text-center z-10">
            <div className="flex items-center justify-center gap-2 text-white font-bold">
              <Crown className="w-5 h-5" />
              <span>Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©</span>
              <Crown className="w-5 h-5" />
            </div>
          </div>

          {currentPackage === 'premium' && (
            <div className="absolute top-12 right-4 bg-amber-500 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center gap-1 z-10">
              <Crown className="w-4 h-4" />
              Ø¨Ø§Ù‚ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            </div>
          )}
          
          <div className="bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 p-6 md:p-8 pt-14 h-full flex flex-col">
            {/* Ø±Ø£Ø³ Ø§Ù„Ø¨Ø§Ù‚Ø© */}
            <div className="flex items-center gap-4 mb-6">
              <div className="w-16 h-16 bg-gradient-to-br from-amber-400 via-yellow-400 to-orange-400 rounded-2xl flex items-center justify-center shadow-lg relative">
                <Crown className="w-8 h-8 text-white" />
                <div className="absolute -top-1 -right-1 w-6 h-6 bg-white rounded-full flex items-center justify-center shadow">
                  <Sparkles className="w-4 h-4 text-amber-500" />
                </div>
              </div>
              <div>
                <h2 className="text-2xl font-black text-gray-900">Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠÙ‘Ø²</h2>
                <p className="text-amber-600 font-semibold">Ù„Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ù…ÙŠØ²Ø© âœ¨</p>
              </div>
            </div>

            {/* Ø§Ù„Ø³Ø¹Ø± */}
            <div className="bg-white/70 backdrop-blur rounded-2xl p-4 mb-6 text-center relative overflow-hidden">
              <div className="absolute inset-0 bg-gradient-to-r from-amber-400/10 via-yellow-400/10 to-orange-400/10" />
              <div className="relative">
                <div className="flex items-baseline justify-center gap-1">
                  <span className="text-5xl font-black bg-gradient-to-r from-amber-600 to-orange-500 bg-clip-text text-transparent">99</span>
                  <span className="text-xl text-gray-600">Ø±.Ø³</span>
                </div>
                <p className="text-amber-600 font-medium mt-1">Ø´Ù‡Ø±ÙŠØ§Ù‹</p>
              </div>
            </div>

            {/* Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª */}
            <div className="space-y-4 flex-1">
              <h3 className="font-bold text-gray-800 flex items-center gap-2">
                <Crown className="w-5 h-5 text-amber-500" />
                Ø¬Ù…ÙŠØ¹ Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©ØŒ Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰:
              </h3>
              
              <div className="space-y-3">
                <FeatureItem 
                  icon={<TrendingUp className="w-5 h-5" />}
                  title="Ø§Ù„Ø¸Ù‡ÙˆØ± Ø£Ø¹Ù„Ù‰ ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬"
                  desc="Ø£Ø³Ø±ØªÙƒ ØªØ¸Ù‡Ø± ÙÙŠ Ø£Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø­Ø« Ø¯Ø§Ø¦Ù…Ø§Ù‹"
                  included
                  premium
                />
                <FeatureItem 
                  icon={<Award className="w-5 h-5" />}
                  title="Ø¹Ù„Ø§Ù…Ø© Ø£Ø³Ø±Ø© Ù…Ù…ÙŠØ²Ø©"
                  desc="Ø´Ø§Ø±Ø© Ø°Ù‡Ø¨ÙŠØ© ØªÙ…ÙŠØ²Ùƒ Ø¹Ù† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†"
                  included
                  premium
                />
                <FeatureItem 
                  icon={<Home className="w-5 h-5" />}
                  title="Ø§Ù‚ØªØ±Ø§Ø­Ùƒ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"
                  desc="Ø¸Ù‡ÙˆØ± Ø£Ø³Ø±ØªÙƒ ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ù…ÙŠØ²Ø©"
                  included
                  premium
                />
                <FeatureItem 
                  icon={<Calendar className="w-5 h-5" />}
                  title="Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ©"
                  desc="Ø¯Ø®ÙˆÙ„ Ù…Ø¬Ø§Ù†ÙŠ ÙÙŠ Ø­Ù…Ù„Ø§Øª Ø±Ù…Ø¶Ø§Ù† ÙˆØ§Ù„Ø£Ø¹ÙŠØ§Ø¯"
                  included
                  premium
                />
              </div>
            </div>

            {/* Ø²Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ */}
            <div className="mt-6">
              {currentPackage === 'premium' ? (
                <div className="bg-amber-100 text-amber-700 py-4 px-6 rounded-2xl text-center font-bold flex items-center justify-center gap-2">
                  <Crown className="w-5 h-5" />
                  Ø£Ù†Øª Ù…Ø´ØªØ±Ùƒ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ²
                </div>
              ) : (
                <button
                  onClick={handleSubscribePremium}
                  disabled={subscribing}
                  className="w-full py-4 px-6 rounded-2xl bg-gradient-to-r from-amber-500 via-yellow-400 to-orange-500 text-white font-bold text-lg shadow-xl hover:shadow-2xl transition-all duration-300 hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 relative overflow-hidden group"
                >
                  <div className="absolute inset-0 bg-gradient-to-r from-white/0 via-white/30 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700" />
                  {subscribing ? (
                    <>
                      <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                      Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...
                    </>
                  ) : (
                    <>
                      <Crown className="w-6 h-6" />
                      Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠÙ‘Ø²
                      <ChevronLeft className="w-5 h-5" />
                    </>
                  )}
                </button>
              )}
            </div>
          </div>
        </div>
      </div>

      {/* Ù…Ù‚Ø§Ø±Ù†Ø© Ø³Ø±ÙŠØ¹Ø© */}
      <div className="bg-white rounded-3xl shadow-xl overflow-hidden">
        <div className="bg-gradient-to-r from-gray-800 to-gray-900 px-6 py-4">
          <h3 className="text-white font-bold text-lg flex items-center gap-2">
            <Sparkles className="w-5 h-5 text-amber-400" />
            Ù…Ù‚Ø§Ø±Ù†Ø© Ø³Ø±ÙŠØ¹Ø© Ø¨ÙŠÙ† Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
          </h3>
        </div>
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-6 py-4 text-right font-bold text-gray-700">Ø§Ù„Ù…ÙŠØ²Ø©</th>
                <th className="px-6 py-4 text-center font-bold text-green-600">
                  <div className="flex items-center justify-center gap-2">
                    <Gift className="w-5 h-5" />
                    Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©
                  </div>
                </th>
                <th className="px-6 py-4 text-center font-bold text-amber-600">
                  <div className="flex items-center justify-center gap-2">
                    <Crown className="w-5 h-5" />
                    Ø§Ù„ØªÙ…ÙŠÙ‘Ø²
                  </div>
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-100">
              <CompareRow label="Ø§Ù„Ø¸Ù‡ÙˆØ± ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" free premium />
              <CompareRow label="Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª" free premium />
              <CompareRow label="ØµÙØ­Ø© Ø®Ø§ØµØ© Ù„Ø£Ø³Ø±ØªÙƒ" free premium />
              <CompareRow label="Ø§Ù„Ø¸Ù‡ÙˆØ± Ø£Ø¹Ù„Ù‰ ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬" premium />
              <CompareRow label="Ø¹Ù„Ø§Ù…Ø© Ø£Ø³Ø±Ø© Ù…Ù…ÙŠØ²Ø©" premium />
              <CompareRow label="Ø§Ù‚ØªØ±Ø§Ø­Ùƒ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" premium />
              <CompareRow label="Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ©" premium />
            </tbody>
          </table>
        </div>
      </div>

      {/* Ù…Ù„Ø§Ø­Ø¸Ø© */}
      <div className="bg-gradient-to-r from-sky-50 to-blue-50 rounded-2xl p-6 text-center">
        <p className="text-gray-600">
          <span className="font-bold text-sky-600">ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø©:</span>
          {' '}ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø£Ùˆ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª. Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø·ÙˆÙŠÙ„Ø© Ø§Ù„Ù…Ø¯Ù‰.
        </p>
      </div>
    </div>
  )
}

// Ù…ÙƒÙˆÙ† Ø¹Ù†ØµØ± Ø§Ù„Ù…ÙŠØ²Ø©
const FeatureItem: React.FC<{
  icon: React.ReactNode
  title: string
  desc: string
  included: boolean
  premium?: boolean
}> = ({ icon, title, desc, included, premium }) => (
  <div className={`flex items-start gap-3 p-3 rounded-xl transition ${
    included 
      ? premium 
        ? 'bg-gradient-to-r from-amber-100/50 to-yellow-100/50' 
        : 'bg-white/50'
      : 'opacity-50'
  }`}>
    <div className={`w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${
      included
        ? premium
          ? 'bg-gradient-to-br from-amber-400 to-orange-400 text-white'
          : 'bg-green-100 text-green-600'
        : 'bg-gray-100 text-gray-400'
    }`}>
      {icon}
    </div>
    <div className="flex-1">
      <div className="flex items-center gap-2">
        <h4 className={`font-bold ${included ? 'text-gray-800' : 'text-gray-400'}`}>{title}</h4>
        {premium && (
          <span className="bg-gradient-to-r from-amber-400 to-orange-400 text-white text-xs px-2 py-0.5 rounded-full font-bold">
            Ø­ØµØ±ÙŠ
          </span>
        )}
      </div>
      <p className={`text-sm ${included ? 'text-gray-500' : 'text-gray-400'}`}>{desc}</p>
    </div>
    {included && (
      <Check className={`w-5 h-5 flex-shrink-0 ${premium ? 'text-amber-500' : 'text-green-500'}`} />
    )}
  </div>
)

// Ù…ÙƒÙˆÙ† ØµÙ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
const CompareRow: React.FC<{
  label: string
  free?: boolean
  premium?: boolean
}> = ({ label, free, premium }) => (
  <tr className="hover:bg-gray-50 transition">
    <td className="px-6 py-4 text-gray-700 font-medium">{label}</td>
    <td className="px-6 py-4 text-center">
      {free ? (
        <div className="inline-flex items-center justify-center w-8 h-8 bg-green-100 rounded-full">
          <Check className="w-5 h-5 text-green-600" />
        </div>
      ) : (
        <div className="inline-flex items-center justify-center w-8 h-8 bg-gray-100 rounded-full">
          <span className="text-gray-400">â€”</span>
        </div>
      )}
    </td>
    <td className="px-6 py-4 text-center">
      {premium ? (
        <div className="inline-flex items-center justify-center w-8 h-8 bg-amber-100 rounded-full">
          <Check className="w-5 h-5 text-amber-600" />
        </div>
      ) : (
        <div className="inline-flex items-center justify-center w-8 h-8 bg-gray-100 rounded-full">
          <span className="text-gray-400">â€”</span>
        </div>
      )}
    </td>
  </tr>
)

export default PackagesPage

==========================================================================================
FILE: src/pages/PrivacyPolicy.tsx
==========================================================================================
// src/pages/PrivacyPolicy.tsx
import React from "react";
import { Link } from "react-router-dom";

export default function PrivacyPolicy() {
  return (
    <div className="min-h-screen bg-gray-100 text-gray-800 px-6 py-10 leading-relaxed">
      <div className="max-w-3xl mx-auto bg-white shadow-lg rounded-2xl p-8">
        <h1 className="text-2xl font-bold text-red-600 mb-4 text-center">
          Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© - ğŸ— Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª
        </h1>

        <p className="mb-4">
          Ù†ÙÙ‚Ø¯Ù‘Ø± Ø«Ù‚ØªÙƒ Ø¨ØªØ·Ø¨ÙŠÙ‚ <strong>Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª</strong> ÙˆÙ†Ø³Ø¹Ù‰ Ù„Ø­Ù…Ø§ÙŠØ© Ø®ØµÙˆØµÙŠØªÙƒ
          ÙˆØ¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆÙÙ‚Ù‹Ø§ Ù„Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª ÙˆÙ…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£Ù…Ø§Ù†.
        </p>

        <h2 className="text-xl font-semibold mt-6 mb-2 text-gray-900">
          1. Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
        </h2>
        <p className="mb-4">
          Ù†Ù‚ÙˆÙ… Ø¨Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙŠ ØªÙ‚Ø¯Ù…Ù‡Ø§ Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø£Ùˆ Ø¹Ù†Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø¯Ù…Ø§ØªÙ†Ø§ØŒ
          Ù…Ø«Ù„ Ø§Ù„Ø§Ø³Ù…ØŒ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ØŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ ÙˆØ·Ù„Ø¨Ø§ØªÙƒ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. ÙƒÙ…Ø§ Ù‚Ø¯ Ù†Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª
          ÙÙ†ÙŠØ© Ù…Ø«Ù„ Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡.
        </p>

        <h2 className="text-xl font-semibold mt-6 mb-2 text-gray-900">
          2. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
        </h2>
        <p className="mb-4">
          ØªÙØ³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ ÙˆØ¥Ø±Ø³Ø§Ù„
          Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ ÙˆØ§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠØŒ ÙˆØªØ·ÙˆÙŠØ± Ù…Ù…ÙŠØ²Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.
        </p>

        <h2 className="text-xl font-semibold mt-6 mb-2 text-gray-900">
          3. Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </h2>
        <p className="mb-4">
          Ù†Ø³ØªØ®Ø¯Ù… Ø£Ù†Ø¸Ù…Ø© Ø­Ù…Ø§ÙŠØ© Ø­Ø¯ÙŠØ«Ø© Ù„ØªØ£Ù…ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ù‘Ø­ Ø¨Ù‡ Ø£Ùˆ
          Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø¥ÙØ´Ø§Ø¡. ÙˆÙ„Ù† Ù†Ø´Ø§Ø±Ùƒ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ù…Ø¹ Ø£ÙŠ Ø¬Ù‡Ø© Ø®Ø§Ø±Ø¬ÙŠØ© Ø¥Ù„Ø§ Ø¨Ù…ÙˆØ§ÙÙ‚ØªÙƒ
          Ø£Ùˆ ÙˆÙÙ‚Ù‹Ø§ Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø³Ø§Ø±ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©.
        </p>

        <h2 className="text-xl font-semibold mt-6 mb-2 text-gray-900">
          4. Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
        </h2>
        <p className="mb-4">
          Ù‚Ø¯ Ù†Ø´Ø§Ø±Ùƒ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø¹ Ù…Ù‚Ø¯Ù‘Ù…ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª (Ù…Ø«Ù„ Ø´Ø±ÙƒØ§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø¯ÙØ¹)
          ÙÙ‚Ø· Ø¨Ø§Ù„Ù‚Ø¯Ø± Ø§Ù„Ù„Ø§Ø²Ù… Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ ÙˆØ¨Ù…Ø§ ÙŠØ¶Ù…Ù† Ø³Ø±ÙŠØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ.
        </p>

        <h2 className="text-xl font-semibold mt-6 mb-2 text-gray-900">
          5. Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        </h2>
        <p className="mb-4">
          ÙŠÙ…ÙƒÙ†Ùƒ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø£Ùˆ Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ø®Ù„Ø§Ù„
          Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. ÙƒÙ…Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø± ÙŠØ®Øµ Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ø¹Ø¨Ø±:
          <strong> mymwalknany976@gmail.com </strong>
        </p>

        <h2 className="text-xl font-semibold mt-6 mb-2 text-gray-900">
          6. Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø³Ø©
        </h2>
        <p className="mb-4">
          Ù‚Ø¯ Ù†Ù‚ÙˆÙ… Ø¨ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ù…Ù† ÙˆÙ‚Øª Ù„Ø¢Ø®Ø±ØŒ ÙˆØ³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø£ÙŠ ØªØºÙŠÙŠØ±
          Ø¬ÙˆÙ‡Ø±ÙŠ Ø¹Ø¨Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.
        </p>

        <p className="mt-6 text-sm text-gray-600 text-center">
          ØªÙ… Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø¨ØªØ§Ø±ÙŠØ® {new Date().toLocaleDateString("ar-SA")}.
        </p>

        <div className="mt-8 text-center">
          <Link
            to="/"
            className="text-white bg-red-500 hover:bg-red-600 px-6 py-2 rounded-lg"
          >
            Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </Link>
        </div>
      </div>
    </div>
  );
}

==========================================================================================
FILE: src/pages/ProfileEdit.tsx
==========================================================================================
// src/pages/ProfileEdit.tsx
import React, { useEffect, useState } from "react"
import { db } from "@/firebase"
import { useAuth } from "@/auth"
import { doc, getDoc, updateDoc } from "firebase/firestore"
import { useDialog } from '@/components/ui/ConfirmDialog'
import { useToast } from '@/components/ui/Toast'
import { LocationPicker } from '@/components/LocationPicker'
import { User, MapPin, Phone, Building2, Home, Save, RefreshCw, Navigation, Trash2, Plus, Star, Check } from 'lucide-react'

type SavedLocation = { lat: number; lng: number; address: string; label?: string }

export const ProfileEdit: React.FC = () => {
  const { user, role } = useAuth()
  const dialog = useDialog()
  const toast = useToast()
  const [form, setForm] = useState({
    name: "",
    phone: "",
    city: "",
    address: "",
    restaurantName: ""
  })
  // Ø¯Ø¹Ù… Ø¹Ù†Ø§ÙˆÙŠÙ† Ù…ØªØ¹Ø¯Ø¯Ø©
  const [savedLocations, setSavedLocations] = useState<SavedLocation[]>([])
  const [defaultLocationIndex, setDefaultLocationIndex] = useState<number>(0)
  const [showLocationPicker, setShowLocationPicker] = useState(false)
  const [editingLocationIndex, setEditingLocationIndex] = useState<number | null>(null)
  const [newLocationLabel, setNewLocationLabel] = useState('')
  const [loading, setLoading] = useState(true)
  const [saving, setSaving] = useState(false)

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  useEffect(() => {
    if (!user) return
    const load = async () => {
      const snap = await getDoc(doc(db, "users", user.uid))
      if (snap.exists()) {
        const data = snap.data()
        setForm({
          name: data.name || "",
          phone: data.phone || user.phoneNumber || "",
          city: data.city || "",
          address: data.address || "",
          restaurantName: data.restaurantName || ""
        })
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (Ø¯Ø¹Ù… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯)
        if (data.savedLocations && Array.isArray(data.savedLocations)) {
          setSavedLocations(data.savedLocations)
          setDefaultLocationIndex(data.defaultLocationIndex || 0)
        } else if (data.savedLocation) {
          // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ø­Ø¯) Ù„Ù„Ø¬Ø¯ÙŠØ¯ (Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø§ÙˆÙŠÙ†)
          setSavedLocations([{ ...data.savedLocation, label: 'Ø§Ù„Ù…Ù†Ø²Ù„' }])
          setDefaultLocationIndex(0)
        }
      }
      setLoading(false)
    }
    load()
  }, [user])

  // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
  const save = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!user) return
    
    setSaving(true)
    try {
      // Ø­ÙØ¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ ÙƒÙ€ savedLocation Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ auth.tsx
      const defaultLoc = savedLocations[defaultLocationIndex] || null
      
      await updateDoc(doc(db, "users", user.uid), {
        name: form.name,
        phone: form.phone,
        city: form.city,
        address: form.address,
        savedLocation: defaultLoc, // Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„ØªÙˆØ§ÙÙ‚
        savedLocations: savedLocations, // Ù‚Ø§Ø¦Ù…Ø© ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
        defaultLocationIndex: defaultLocationIndex,
        ...(role === 'owner' && { restaurantName: form.restaurantName })
      })
      dialog.success('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! âœ…')
    } catch (err) {
      dialog.error('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª')
    } finally {
      setSaving(false)
    }
  }

  // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙŠØ¯
  const handleAddLocation = (loc: { lat: number; lng: number }, addr: string) => {
    const newLoc: SavedLocation = {
      lat: loc.lat,
      lng: loc.lng,
      address: addr,
      label: newLocationLabel || `Ø¹Ù†ÙˆØ§Ù† ${savedLocations.length + 1}`
    }
    setSavedLocations([...savedLocations, newLoc])
    setNewLocationLabel('')
    setShowLocationPicker(false)
    toast.success('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†! Ø§Ø¶ØºØ· Ø­ÙØ¸ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª')
  }

  // ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†ÙˆØ§Ù† Ù…ÙˆØ¬ÙˆØ¯
  const handleEditLocation = (loc: { lat: number; lng: number }, addr: string) => {
    if (editingLocationIndex === null) return
    const updated = [...savedLocations]
    updated[editingLocationIndex] = {
      ...updated[editingLocationIndex],
      lat: loc.lat,
      lng: loc.lng,
      address: addr
    }
    setSavedLocations(updated)
    setEditingLocationIndex(null)
    setShowLocationPicker(false)
    toast.success('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†! Ø§Ø¶ØºØ· Ø­ÙØ¸ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª')
  }

  // Ø­Ø°Ù Ø¹Ù†ÙˆØ§Ù†
  const handleDeleteLocation = async (index: number) => {
    const confirmed = await dialog.confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŸ')
    if (!confirmed) return
    
    const updated = savedLocations.filter((_, i) => i !== index)
    setSavedLocations(updated)
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    if (defaultLocationIndex >= updated.length) {
      setDefaultLocationIndex(Math.max(0, updated.length - 1))
    } else if (defaultLocationIndex > index) {
      setDefaultLocationIndex(defaultLocationIndex - 1)
    }
    
    toast.info('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù†ÙˆØ§Ù†')
  }

  // ØªØ¹ÙŠÙŠÙ† Ø¹Ù†ÙˆØ§Ù† ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ
  const handleSetDefault = (index: number) => {
    setDefaultLocationIndex(index)
    toast.success('ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ')
  }

  if (loading) {
    return (
      <div className="flex items-center justify-center h-96 text-lg">
        <RefreshCw className="w-6 h-6 animate-spin ml-2" />
        Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
      </div>
    )
  }

  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
  const getTitle = () => {
    if (role === 'owner') return 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù…'
    if (role === 'courier') return 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨'
    if (role === 'admin') return 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù'
    return 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ'
  }

  return (
    <div className="max-w-md mx-auto py-8 px-4">
      <div className="bg-white rounded-2xl shadow-xl p-6">
        {/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */}
        <div className="flex items-center gap-3 mb-6">
          <div className="w-12 h-12 bg-sky-100 rounded-xl flex items-center justify-center">
            <User className="w-6 h-6 text-sky-600" />
          </div>
          <div>
            <h1 className="text-xl font-bold text-gray-800">{getTitle()}</h1>
            <p className="text-sm text-gray-500">{user?.email || user?.phoneNumber}</p>
          </div>
        </div>

        <form onSubmit={save} className="space-y-4">
          {/* Ø§Ù„Ø§Ø³Ù… */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-1">
              <User className="w-4 h-4 inline ml-1" />
              Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„
            </label>
            <input
              className="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-sky-400 focus:outline-none transition"
              placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ"
              value={form.name}
              onChange={(e) => setForm({ ...form, name: e.target.value })}
            />
          </div>

          {/* Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-1">
              <Phone className="w-4 h-4 inline ml-1" />
              Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
            </label>
            <input
              className="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-sky-400 focus:outline-none transition"
              placeholder="05xxxxxxxx"
              value={form.phone}
              onChange={(e) => setForm({ ...form, phone: e.target.value })}
              dir="ltr"
            />
          </div>

          {/* Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-1">
              <Building2 className="w-4 h-4 inline ml-1" />
              Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
            </label>
            <input
              className="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-sky-400 focus:outline-none transition"
              placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±ÙŠØ§Ø¶"
              value={form.city}
              onChange={(e) => setForm({ ...form, city: e.target.value })}
            />
          </div>

          {/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† / Ø§Ù„Ù…ÙˆÙ‚Ø¹ */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-1">
              <MapPin className="w-4 h-4 inline ml-1" />
              Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
            </label>
            <textarea
              className="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-sky-400 focus:outline-none transition h-24"
              placeholder="Ø§Ù„Ø­ÙŠØŒ Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ØŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."
              value={form.address}
              onChange={(e) => setForm({ ...form, address: e.target.value })}
            />
          </div>

          {/* ğŸ“ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„ØªÙˆØµÙŠÙ„ - Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ø´Ø±ÙÙŠÙ† ÙÙ‚Ø· */}
          {(role === 'customer' || role === 'admin') && (
            <div className="border-t pt-4 mt-4">
              <div className="flex items-center justify-between mb-3">
                <label className="text-sm font-semibold text-gray-700 flex items-center gap-1">
                  <Navigation className="w-4 h-4" />
                  Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                </label>
                <span className="text-xs text-gray-400">{savedLocations.length}/5</span>
              </div>
              
              {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */}
              {savedLocations.length > 0 && (
                <div className="space-y-3 mb-4">
                  {savedLocations.map((loc, index) => (
                    <div 
                      key={index}
                      className={`rounded-xl p-3 border-2 transition ${
                        index === defaultLocationIndex 
                          ? 'bg-green-50 border-green-300' 
                          : 'bg-gray-50 border-gray-200'
                      }`}
                    >
                      <div className="flex items-start gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${
                          index === defaultLocationIndex ? 'bg-green-500' : 'bg-gray-400'
                        }`}>
                          <MapPin className="w-5 h-5 text-white" />
                        </div>
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2 mb-1">
                            <p className="font-bold text-gray-800">{loc.label || `Ø¹Ù†ÙˆØ§Ù† ${index + 1}`}</p>
                            {index === defaultLocationIndex && (
                              <span className="inline-flex items-center gap-1 px-2 py-0.5 bg-green-500 text-white text-xs font-bold rounded-full">
                                <Star className="w-3 h-3" /> Ø§ÙØªØ±Ø§Ø¶ÙŠ
                              </span>
                            )}
                          </div>
                          <p className="text-sm text-gray-600 line-clamp-2">{loc.address}</p>
                        </div>
                      </div>
                      
                      {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */}
                      <div className="flex gap-2 mt-3">
                        {index !== defaultLocationIndex && (
                          <button
                            type="button"
                            onClick={() => handleSetDefault(index)}
                            className="flex-1 py-2 px-3 rounded-lg border border-green-200 text-green-600 text-xs font-medium hover:bg-green-50 transition flex items-center justify-center gap-1"
                          >
                            <Check className="w-3 h-3" /> ØªØ¹ÙŠÙŠÙ† ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ
                          </button>
                        )}
                        <button
                          type="button"
                          onClick={() => {
                            setEditingLocationIndex(index)
                            setShowLocationPicker(true)
                          }}
                          className="flex-1 py-2 px-3 rounded-lg border border-sky-200 text-sky-600 text-xs font-medium hover:bg-sky-50 transition"
                        >
                          ØªØ¹Ø¯ÙŠÙ„
                        </button>
                        <button
                          type="button"
                          onClick={() => handleDeleteLocation(index)}
                          className="py-2 px-3 rounded-lg border border-red-200 text-red-500 hover:bg-red-50 transition"
                        >
                          <Trash2 className="w-4 h-4" />
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              )}

              {/* Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙŠØ¯ */}
              {savedLocations.length < 5 && (
                <div className="space-y-2">
                  <input
                    type="text"
                    value={newLocationLabel}
                    onChange={(e) => setNewLocationLabel(e.target.value)}
                    placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ù†Ø²Ù„ØŒ Ø§Ù„Ø¹Ù…Ù„...)"
                    className="w-full border-2 border-gray-200 rounded-xl p-3 text-sm focus:border-sky-400 focus:outline-none"
                  />
                  <button
                    type="button"
                    onClick={() => {
                      setEditingLocationIndex(null)
                      setShowLocationPicker(true)
                    }}
                    className="w-full py-4 rounded-xl bg-gradient-to-r from-sky-100 to-sky-50 border-2 border-dashed border-sky-300 text-sky-600 font-semibold hover:border-sky-400 transition flex items-center justify-center gap-3"
                  >
                    <Plus className="w-5 h-5" />
                    <span>Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙŠØ¯</span>
                  </button>
                </div>
              )}

              {savedLocations.length === 0 && (
                <p className="text-xs text-gray-500 mt-2 text-center">
                  ğŸ’¡ Ø£Ø¶Ù Ø¹Ù†Ø§ÙˆÙŠÙ†Ùƒ Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
                </p>
              )}
            </div>
          )}

          {/* Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù… - Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù… ÙÙ‚Ø· */}
          {role === 'owner' && (
            <div>
              <label className="block text-sm font-semibold text-gray-700 mb-1">
                <Home className="w-4 h-4 inline ml-1" />
                Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…
              </label>
              <input
                className="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-sky-400 focus:outline-none transition"
                placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…"
                value={form.restaurantName}
                onChange={(e) => setForm({ ...form, restaurantName: e.target.value })}
              />
            </div>
          )}

          {/* Ø²Ø± Ø§Ù„Ø­ÙØ¸ */}
          <button 
            type="submit"
            disabled={saving}
            className="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-sky-500 to-sky-600 hover:from-sky-600 hover:to-sky-700 text-white font-bold p-4 rounded-xl shadow-lg transition disabled:opacity-50"
          >
            {saving ? (
              <>
                <RefreshCw className="w-5 h-5 animate-spin" />
                Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸...
              </>
            ) : (
              <>
                <Save className="w-5 h-5" />
                Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
              </>
            )}
          </button>
        </form>

        {/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */}
        <div className="mt-6 pt-4 border-t text-center text-sm text-gray-500">
          <p>ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª</p>
          {(role === 'customer' || role === 'admin') && (
            <p className="mt-1">ğŸ“ ÙŠÙ…ÙƒÙ†Ùƒ Ø­ÙØ¸ Ø­ØªÙ‰ 5 Ø¹Ù†Ø§ÙˆÙŠÙ† Ù…Ø®ØªÙ„ÙØ©</p>
          )}
        </div>
      </div>

      {/* Location Picker Modal */}
      <LocationPicker
        isOpen={showLocationPicker}
        onClose={() => {
          setShowLocationPicker(false)
          setEditingLocationIndex(null)
        }}
        onConfirm={(loc, addr) => {
          if (editingLocationIndex !== null) {
            handleEditLocation(loc, addr)
          } else {
            handleAddLocation(loc, addr)
          }
        }}
        initialLocation={
          editingLocationIndex !== null && savedLocations[editingLocationIndex]
            ? { lat: savedLocations[editingLocationIndex].lat, lng: savedLocations[editingLocationIndex].lng }
            : null
        }
      />
    </div>
  )
}

==========================================================================================
FILE: src/pages/PromotionPage.tsx
==========================================================================================
// src/pages/PromotionPage.tsx
import React, { useEffect, useState, useRef } from 'react'
import { db, storage } from '@/firebase'
import { collection, query, where, getDocs, addDoc, updateDoc, deleteDoc, doc, serverTimestamp, Timestamp } from 'firebase/firestore'
import { ref, uploadBytesResumable, getDownloadURL } from 'firebase/storage'
import { useAuth } from '@/auth'
import { useToast } from '@/components/ui/Toast'
import { useDialog } from '@/components/ui/ConfirmDialog'
import { Promotion } from '@/types'
import { 
  Megaphone, Image, Video, FileText, Plus, Trash2, Eye, 
  Clock, CheckCircle, XCircle, Upload, Sparkles, RefreshCw,
  ArrowRight
} from 'lucide-react'
import { Link } from 'react-router-dom'

// Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø±Ù…Ø²ÙŠ (5 Ø±ÙŠØ§Ù„ Ù„Ù€ 24 Ø³Ø§Ø¹Ø©)
const PROMOTION_PRICE = 5
const PROMOTION_DURATION_HOURS = 24

export const PromotionPage: React.FC = () => {
  const { user } = useAuth()
  const toast = useToast()
  const dialog = useDialog()
  const [promotions, setPromotions] = useState<Promotion[]>([])
  const [loading, setLoading] = useState(true)
  const [showForm, setShowForm] = useState(false)
  const [uploading, setUploading] = useState(false)
  const [uploadProgress, setUploadProgress] = useState(0)
  const fileRef = useRef<HTMLInputElement>(null)

  const [form, setForm] = useState({
    type: 'text' as 'text' | 'image' | 'video',
    title: '',
    description: '',
    mediaFile: null as File | null,
    mediaPreview: '',
  })

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
  useEffect(() => {
    if (!user) return
    loadPromotions()
  }, [user])

  const loadPromotions = async () => {
    if (!user) return
    try {
      const q = query(collection(db, 'promotions'), where('ownerId', '==', user.uid))
      const snap = await getDocs(q)
      const data = snap.docs.map(d => ({
        id: d.id,
        ...d.data(),
        expiresAt: d.data().expiresAt?.toDate?.(),
        createdAt: d.data().createdAt?.toDate?.(),
      } as Promotion))
      // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø£Ø­Ø¯Ø«
      data.sort((a, b) => (b.createdAt?.getTime() || 0) - (a.createdAt?.getTime() || 0))
      setPromotions(data)
    } catch (err) {
      toast.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª')
      console.error(err)
    } finally {
      setLoading(false)
    }
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
  const isExpired = (promo: Promotion) => {
    if (!promo.expiresAt) return false
    return new Date() > new Date(promo.expiresAt)
  }

  // Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„ÙˆØ³Ø§Ø¦Ø·
  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0]
    if (!file) return

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
    const isImage = file.type.startsWith('image/')
    const isVideo = file.type.startsWith('video/')

    if (!isImage && !isVideo) {
      toast.warning('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ')
      return
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (10 Ù…ÙŠØ¬Ø§ Ù„Ù„ØµÙˆØ±ØŒ 50 Ù…ÙŠØ¬Ø§ Ù„Ù„ÙÙŠØ¯ÙŠÙˆ)
    const maxSize = isVideo ? 50 * 1024 * 1024 : 10 * 1024 * 1024
    if (file.size > maxSize) {
      toast.warning(isVideo ? 'Ø­Ø¬Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 50 Ù…ÙŠØ¬Ø§' : 'Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 10 Ù…ÙŠØ¬Ø§')
      return
    }

    setForm({
      ...form,
      type: isVideo ? 'video' : 'image',
      mediaFile: file,
      mediaPreview: URL.createObjectURL(file),
    })
  }

  // Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!user) return

    if (form.type !== 'text' && !form.mediaFile) {
      toast.warning('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ')
      return
    }

    if (!form.title.trim() && !form.description.trim() && !form.mediaFile) {
      toast.warning('ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†')
      return
    }

    try {
      setUploading(true)
      let mediaUrl = ''

      // Ø±ÙØ¹ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·
      if (form.mediaFile) {
        const safeName = form.mediaFile.name.replace(/\s+/g, '_').slice(-60)
        const path = `promotions/${user.uid}_${Date.now()}_${safeName}`
        const storageRef = ref(storage, path)

        const task = uploadBytesResumable(storageRef, form.mediaFile)

        await new Promise<void>((resolve, reject) => {
          task.on(
            'state_changed',
            (snap) => {
              const progress = Math.round((snap.bytesTransferred / snap.totalBytes) * 100)
              setUploadProgress(progress)
            },
            reject,
            async () => {
              mediaUrl = await getDownloadURL(task.snapshot.ref)
              resolve()
            }
          )
        })
      }

      // Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
      const expiresAt = new Date()
      expiresAt.setHours(expiresAt.getHours() + PROMOTION_DURATION_HOURS)

      await addDoc(collection(db, 'promotions'), {
        ownerId: user.uid,
        restaurantId: user.uid, // Ù†ÙØ³ Ø§Ù„Ù€ UID Ù„Ù„Ø£Ø³Ø±Ø©
        type: form.type,
        title: form.title.trim(),
        description: form.description.trim(),
        mediaUrl,
        isActive: true,
        isPaid: true, // Ù…Ø¤Ù‚ØªØ§Ù‹ Ù†ÙØªØ±Ø¶ Ø§Ù„Ø¯ÙØ¹ ØªÙ… (ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø¨ÙˆØ§Ø¨Ø© Ø¯ÙØ¹ Ù„Ø§Ø­Ù‚Ø§Ù‹)
        price: PROMOTION_PRICE,
        duration: PROMOTION_DURATION_HOURS,
        viewsCount: 0,
        expiresAt: Timestamp.fromDate(expiresAt),
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
      })

      toast.success(`ØªÙ… Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ! âœ¨ Ø³ÙŠØ¸Ù‡Ø± Ù„Ù…Ø¯Ø© ${PROMOTION_DURATION_HOURS} Ø³Ø§Ø¹Ø©`)
      setForm({ type: 'text', title: '', description: '', mediaFile: null, mediaPreview: '' })
      setShowForm(false)
      setUploadProgress(0)
      loadPromotions()
    } catch (err) {
      toast.error('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†')
      console.error(err)
    } finally {
      setUploading(false)
    }
  }

  // Ø­Ø°Ù Ø¥Ø¹Ù„Ø§Ù†
  const handleDelete = async (id: string) => {
    const confirmed = await dialog.confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ', { dangerous: true })
    if (!confirmed) return

    try {
      await deleteDoc(doc(db, 'promotions', id))
      toast.success('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†')
      loadPromotions()
    } catch (err) {
      toast.error('Ø­Ø¯Ø« Ø®Ø·Ø£')
    }
  }

  if (loading) {
    return (
      <div className="flex items-center justify-center h-96">
        <RefreshCw className="w-6 h-6 animate-spin ml-2" />
        Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...
      </div>
    )
  }

  return (
    <div className="max-w-2xl mx-auto py-8 px-4 space-y-6">
      {/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */}
      <div className="text-center">
        <div className="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
          <Megaphone className="w-8 h-8 text-white" />
        </div>
        <h1 className="text-2xl font-bold text-gray-800">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„Ø©</h1>
        <p className="text-gray-500 mt-2">Ø£Ù†Ø´Ø¦ Ø¥Ø¹Ù„Ø§Ù†Ùƒ ÙˆØ³ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ ØµÙØ­Ø© Ø£Ø³Ø±ØªÙƒ</p>
      </div>

      {/* Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† */}
      <div className="bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-2xl p-4 text-center">
        <div className="flex items-center justify-center gap-3">
          <Sparkles className="w-5 h-5 text-purple-500" />
          <span className="text-lg font-bold text-purple-700">
            {PROMOTION_PRICE} Ø±.Ø³ ÙÙ‚Ø· Ù„Ù…Ø¯Ø© {PROMOTION_DURATION_HOURS} Ø³Ø§Ø¹Ø©
          </span>
          <Sparkles className="w-5 h-5 text-purple-500" />
        </div>
        <p className="text-sm text-purple-600 mt-1">Ø£Ø¶Ù ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ Ø£Ùˆ Ù†Øµ ØªØ±ÙˆÙŠØ¬ÙŠ Ù„Ø£Ø³Ø±ØªÙƒ</p>
      </div>

      {/* Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† */}
      {!showForm && (
        <button
          onClick={() => setShowForm(true)}
          className="w-full py-4 rounded-2xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold shadow-lg hover:shadow-xl transition flex items-center justify-center gap-3"
        >
          <Plus className="w-6 h-6" />
          Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯
        </button>
      )}

      {/* Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† */}
      {showForm && (
        <form onSubmit={handleSubmit} className="bg-white rounded-2xl shadow-xl p-6 space-y-4">
          <h2 className="font-bold text-lg text-gray-800 mb-4">Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</h2>

          {/* Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
            <div className="grid grid-cols-3 gap-2">
              <button
                type="button"
                onClick={() => setForm({ ...form, type: 'text', mediaFile: null, mediaPreview: '' })}
                className={`p-3 rounded-xl border-2 transition flex flex-col items-center gap-1 ${
                  form.type === 'text' ? 'border-purple-500 bg-purple-50' : 'border-gray-200'
                }`}
              >
                <FileText className="w-5 h-5" />
                <span className="text-sm">Ù†Øµ</span>
              </button>
              <button
                type="button"
                onClick={() => {
                  setForm({ ...form, type: 'image' })
                  fileRef.current?.click()
                }}
                className={`p-3 rounded-xl border-2 transition flex flex-col items-center gap-1 ${
                  form.type === 'image' ? 'border-purple-500 bg-purple-50' : 'border-gray-200'
                }`}
              >
                <Image className="w-5 h-5" />
                <span className="text-sm">ØµÙˆØ±Ø©</span>
              </button>
              <button
                type="button"
                onClick={() => {
                  setForm({ ...form, type: 'video' })
                  fileRef.current?.click()
                }}
                className={`p-3 rounded-xl border-2 transition flex flex-col items-center gap-1 ${
                  form.type === 'video' ? 'border-purple-500 bg-purple-50' : 'border-gray-200'
                }`}
              >
                <Video className="w-5 h-5" />
                <span className="text-sm">ÙÙŠØ¯ÙŠÙˆ</span>
              </button>
            </div>
          </div>

          {/* Ø±ÙØ¹ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· */}
          <input
            type="file"
            ref={fileRef}
            accept="image/*,video/*"
            onChange={handleFileSelect}
            className="hidden"
          />

          {/* Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙˆØ³Ø§Ø¦Ø· */}
          {form.mediaPreview && (
            <div className="relative">
              {form.type === 'video' ? (
                <video
                  src={form.mediaPreview}
                  controls
                  className="w-full h-48 object-cover rounded-xl"
                />
              ) : (
                <img
                  src={form.mediaPreview}
                  alt="Ù…Ø¹Ø§ÙŠÙ†Ø©"
                  className="w-full h-48 object-cover rounded-xl"
                />
              )}
              <button
                type="button"
                onClick={() => setForm({ ...form, mediaFile: null, mediaPreview: '', type: 'text' })}
                className="absolute top-2 left-2 p-2 bg-red-500 text-white rounded-full"
              >
                <XCircle className="w-4 h-4" />
              </button>
            </div>
          )}

          {/* Ø²Ø± Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù */}
          {form.type !== 'text' && !form.mediaPreview && (
            <button
              type="button"
              onClick={() => fileRef.current?.click()}
              className="w-full py-4 border-2 border-dashed border-gray-300 rounded-xl text-gray-500 hover:border-purple-400 transition flex items-center justify-center gap-2"
            >
              <Upload className="w-5 h-5" />
              Ø§Ø®ØªØ± {form.type === 'video' ? 'ÙÙŠØ¯ÙŠÙˆ' : 'ØµÙˆØ±Ø©'}
            </button>
          )}

          {/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-1">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input
              type="text"
              value={form.title}
              onChange={(e) => setForm({ ...form, title: e.target.value })}
              placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø±Ø¶ Ø®Ø§Øµ Ø§Ù„ÙŠÙˆÙ…!"
              className="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-purple-400 focus:outline-none"
            />
          </div>

          {/* Ø§Ù„ÙˆØµÙ */}
          <div>
            <label className="block text-sm font-semibold text-gray-700 mb-1">Ø§Ù„Ø´Ø±Ø­ Ø£Ùˆ Ø§Ù„ÙˆØµÙ</label>
            <textarea
              value={form.description}
              onChange={(e) => setForm({ ...form, description: e.target.value })}
              placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ù‡Ù†Ø§..."
              rows={3}
              className="w-full border-2 border-gray-200 rounded-xl p-3 focus:border-purple-400 focus:outline-none"
            />
          </div>

          {/* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */}
          {uploading && uploadProgress > 0 && (
            <div className="bg-gray-200 rounded-full h-2 overflow-hidden">
              <div
                className="bg-purple-500 h-full transition-all"
                style={{ width: `${uploadProgress}%` }}
              />
            </div>
          )}

          {/* Ø£Ø²Ø±Ø§Ø± */}
          <div className="flex gap-3">
            <button
              type="submit"
              disabled={uploading}
              className="flex-1 py-3 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold disabled:opacity-50 flex items-center justify-center gap-2"
            >
              {uploading ? (
                <>
                  <RefreshCw className="w-5 h-5 animate-spin" />
                  Ø¬Ø§Ø±Ù Ø§Ù„Ù†Ø´Ø±...
                </>
              ) : (
                <>
                  <Megaphone className="w-5 h-5" />
                  Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ({PROMOTION_PRICE} Ø±.Ø³)
                </>
              )}
            </button>
            <button
              type="button"
              onClick={() => {
                setShowForm(false)
                setForm({ type: 'text', title: '', description: '', mediaFile: null, mediaPreview: '' })
              }}
              className="px-4 py-3 rounded-xl border-2 border-gray-200 text-gray-600 font-medium"
            >
              Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>
        </form>
      )}

      {/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª */}
      <div className="space-y-4">
        <h2 className="font-bold text-lg text-gray-800">Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙƒ</h2>

        {promotions.length === 0 ? (
          <div className="text-center py-10 text-gray-400">
            <Megaphone className="w-12 h-12 mx-auto mb-3 opacity-50" />
            <p>Ù„Ù… ØªÙ†Ø´Ø¦ Ø£ÙŠ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø¨Ø¹Ø¯</p>
          </div>
        ) : (
          promotions.map(promo => (
            <div
              key={promo.id}
              className={`bg-white rounded-2xl shadow-lg overflow-hidden ${
                isExpired(promo) ? 'opacity-60' : ''
              }`}
            >
              {/* Ø§Ù„ÙˆØ³Ø§Ø¦Ø· */}
              {promo.mediaUrl && (
                promo.type === 'video' ? (
                  <video
                    src={promo.mediaUrl}
                    controls
                    className="w-full h-48 object-cover"
                  />
                ) : (
                  <img
                    src={promo.mediaUrl}
                    alt={promo.title}
                    className="w-full h-48 object-cover"
                  />
                )
              )}

              <div className="p-4">
                {/* Ø§Ù„Ø­Ø§Ù„Ø© */}
                <div className="flex items-center gap-2 mb-2">
                  {isExpired(promo) ? (
                    <span className="inline-flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-500 text-xs font-medium rounded-full">
                      <XCircle className="w-3 h-3" /> Ù…Ù†ØªÙ‡ÙŠ
                    </span>
                  ) : promo.isActive ? (
                    <span className="inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-600 text-xs font-medium rounded-full">
                      <CheckCircle className="w-3 h-3" /> Ù†Ø´Ø·
                    </span>
                  ) : (
                    <span className="inline-flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-600 text-xs font-medium rounded-full">
                      <Clock className="w-3 h-3" /> ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
                    </span>
                  )}
                  <span className="inline-flex items-center gap-1 px-2 py-1 bg-purple-100 text-purple-600 text-xs font-medium rounded-full">
                    <Eye className="w-3 h-3" /> {promo.viewsCount} Ù…Ø´Ø§Ù‡Ø¯Ø©
                  </span>
                </div>

                {/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */}
                {promo.title && <h3 className="font-bold text-gray-800">{promo.title}</h3>}
                {promo.description && <p className="text-gray-600 text-sm mt-1">{promo.description}</p>}

                {/* Ø§Ù„ØªÙˆÙ‚ÙŠØª */}
                <div className="flex items-center justify-between mt-3 pt-3 border-t">
                  <span className="text-xs text-gray-400">
                    {promo.expiresAt && !isExpired(promo) && (
                      <>ÙŠÙ†ØªÙ‡ÙŠ: {new Date(promo.expiresAt).toLocaleString('ar-SA')}</>
                    )}
                    {isExpired(promo) && 'Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†'}
                  </span>
                  <button
                    onClick={() => handleDelete(promo.id)}
                    className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                </div>
              </div>
            </div>
          ))
        )}
      </div>

      {/* Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹ÙˆØ¯Ø© */}
      <Link
        to="/owner"
        className="flex items-center justify-center gap-2 text-sky-600 hover:text-sky-700 py-4"
      >
        <ArrowRight className="w-5 h-5" />
        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
      </Link>
    </div>
  )
}

==========================================================================================
FILE: src/pages/Register.tsx
==========================================================================================
// src/pages/Register.tsx
import React, { useState, useEffect } from 'react'
import { createUserWithEmailAndPassword } from 'firebase/auth'
import { auth, db } from '@/firebase'
import { doc, setDoc, addDoc, collection, serverTimestamp, updateDoc, increment, getDoc } from 'firebase/firestore'
import { useNavigate, Link, useSearchParams } from 'react-router-dom'
import { User, Mail, Lock, Store, UserPlus, Truck, ChefHat, Users, MapPin, CheckSquare, Square } from 'lucide-react'
import { SAUDI_CITIES } from '@/utils/cities'

export const Register: React.FC = () => {
  const [searchParams] = useSearchParams()
  const referralRestaurantId = searchParams.get('ref_restaurant') // Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø£Ø³Ø±Ø©
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [name, setName] = useState('')
  const [restaurantName, setRestaurantName] = useState('')
  const [city, setCity] = useState('')
  const [role, setRole] = useState<'customer'|'courier'|'owner'|''>('')
  const [acceptedTerms, setAcceptedTerms] = useState(false)
  const [loading, setLoading] = useState(false)
  const nav = useNavigate()

  // Ø¥Ø°Ø§ Ø¬Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† Ø±Ø§Ø¨Ø· Ø¥Ø­Ø§Ù„Ø©ØŒ Ù†Ø­Ø¯Ø¯ Ø¯ÙˆØ±Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒØ¹Ù…ÙŠÙ„
  useEffect(() => {
    if (referralRestaurantId) {
      setRole('customer')
    }
  }, [referralRestaurantId])

  // Ù‡Ù„ ÙŠØªØ·Ù„Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ·ØŸ
  const requiresTerms = role === 'owner' || role === 'courier'

  // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø¯ÙˆØ±ØŒ Ù†Ø¹ÙŠØ¯ ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
  const handleRoleChange = (newRole: 'customer'|'courier'|'owner') => {
    setRole(newRole)
    setAcceptedTerms(false)
  }

  const submit = async (e: React.FormEvent) => {
    e.preventDefault()
    if (!role) return alert('Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨')
    if (role === 'owner' && !restaurantName) return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…')
    if (requiresTerms && !acceptedTerms) return alert('ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…')

    setLoading(true)
    try {
      const cred = await createUserWithEmailAndPassword(auth, email, password)
      await setDoc(doc(db, 'users', cred.user.uid), {
        name,
        email,
        role,
        restaurantName: role === 'owner' ? restaurantName : null,
        referredBy: referralRestaurantId || null, // Ø­ÙØ¸ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
        createdAt: serverTimestamp()
      })

      if (role === 'owner') {
        await setDoc(doc(db, 'restaurants', cred.user.uid), {
          name: restaurantName || name || 'Ù…Ø·Ø¹Ù… Ø¬Ø¯ÙŠØ¯',
          ownerId: cred.user.uid,
          email,
          phone: '',
          city: city || '',
          location: '',
          logoUrl: '',
        }, { merge: true })
      }

      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· Ø¥Ø­Ø§Ù„Ø©ØŒ Ù†Ø³Ø¬Ù„ Ø°Ù„Ùƒ ÙˆÙ†Ø±Ø³Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø£Ø³Ø±Ø©
      if (referralRestaurantId && role === 'customer') {
        try {
          // ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø¬Ø¯ÙˆÙ„ ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
          await addDoc(collection(db, 'customerRegistrations'), {
            customerId: cred.user.uid,
            customerName: name,
            customerEmail: email,
            restaurantId: referralRestaurantId,
            registrationType: 'website',
            createdAt: serverTimestamp()
          })

          // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø·Ø¹Ù…
          const statsRef = doc(db, 'restaurantStats', referralRestaurantId)
          const statsSnap = await getDoc(statsRef)
          if (statsSnap.exists()) {
            await updateDoc(statsRef, {
              registeredCustomers: increment(1),
              updatedAt: serverTimestamp()
            })
          } else {
            await setDoc(statsRef, {
              totalProfileViews: 0,
              totalMenuViews: 0,
              totalItemViews: 0,
              totalShareClicks: 0,
              whatsappShareCount: 0,
              registeredCustomers: 1,
              appDownloads: 0,
              dailyViews: {},
              updatedAt: serverTimestamp()
            })
          }

          // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø©
          await addDoc(collection(db, 'notifications'), {
            recipientId: referralRestaurantId,
            title: 'ğŸ‰ Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ Ø³Ø¬Ù„ Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø·Ùƒ!',
            message: `Ø§Ù„Ø¹Ù…ÙŠÙ„ "${name}" Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ`,
            type: 'new_customer_registration',
            read: false,
            createdAt: serverTimestamp()
          })
        } catch (err) {
          console.warn('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©:', err)
        }
      }

      nav('/')
    } catch (e: any) {
      alert(e.message)
    } finally { setLoading(false) }
  }

  const roleOptions = [
    { value: 'customer', label: 'Ø¹Ù…ÙŠÙ„', icon: Users, color: 'sky' },
    { value: 'courier', label: 'Ù…Ù†Ø¯ÙˆØ¨', icon: Truck, color: 'emerald' },
    { value: 'owner', label: 'ØµØ§Ø­Ø¨ Ù…Ø·Ø¹Ù…', icon: ChefHat, color: 'orange' },
  ]

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-sky-50 via-white to-sky-100 px-4 py-8">
      {/* Ø®Ù„ÙÙŠØ© Ø²Ø®Ø±ÙÙŠØ© */}
      <div className="absolute top-0 left-0 w-72 h-72 bg-sky-300/20 rounded-full blur-3xl"></div>
      <div className="absolute bottom-0 right-0 w-72 h-72 bg-sky-400/20 rounded-full blur-3xl"></div>

      <div className="relative bg-white/80 backdrop-blur-xl border border-sky-100 rounded-[2rem] shadow-2xl shadow-sky-200/50 w-full max-w-md p-8">
        
        {/* Ø´Ø¹Ø§Ø± */}
        <div className="flex flex-col items-center mb-6">
          <div className="w-16 h-16 bg-gradient-to-br from-sky-500 to-sky-600 rounded-2xl flex items-center justify-center shadow-xl shadow-sky-300/50 mb-3">
            <UserPlus className="w-8 h-8 text-white" />
          </div>
          <h1 className="text-2xl font-black text-sky-600">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h1>
        </div>

        <form onSubmit={submit} className="space-y-4">
          {/* Ø§Ù„Ø§Ø³Ù… */}
          <div className="relative">
            <User className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-sky-400" />
            <input 
              className="w-full rounded-2xl p-4 pr-12 bg-sky-50 text-sky-900 border-2 border-sky-100 focus:outline-none focus:border-sky-400 focus:ring-4 focus:ring-sky-100 transition-all" 
              placeholder="Ø§Ù„Ø§Ø³Ù…" 
              value={name} 
              onChange={e=>setName(e.target.value)} 
            />
          </div>

          {/* Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ */}
          <div className="relative">
            <Mail className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-sky-400" />
            <input 
              className="w-full rounded-2xl p-4 pr-12 bg-sky-50 text-sky-900 border-2 border-sky-100 focus:outline-none focus:border-sky-400 focus:ring-4 focus:ring-sky-100 transition-all" 
              placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„" 
              type="email"
              value={email} 
              onChange={e=>setEmail(e.target.value)} 
            />
          </div>

          {/* ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */}
          <div className="relative">
            <Lock className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-sky-400" />
            <input 
              className="w-full rounded-2xl p-4 pr-12 bg-sky-50 text-sky-900 border-2 border-sky-100 focus:outline-none focus:border-sky-400 focus:ring-4 focus:ring-sky-100 transition-all" 
              placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" 
              type="password" 
              value={password} 
              onChange={e=>setPassword(e.target.value)} 
            />
          </div>

          {/* Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨ */}
          <div className="grid grid-cols-3 gap-3">
            {roleOptions.map(opt => {
              const Icon = opt.icon
              const isSelected = role === opt.value
              return (
                <label 
                  key={opt.value}
                  className={`relative flex flex-col items-center gap-2 p-4 rounded-2xl cursor-pointer transition-all duration-300 ${
                    isSelected 
                      ? 'bg-gradient-to-br from-sky-500 to-sky-600 text-white shadow-lg shadow-sky-300/50 scale-105' 
                      : 'bg-sky-50 text-sky-600 hover:bg-sky-100 border-2 border-sky-100'
                  }`}
                >
                  <input 
                    type="radio" 
                    name="role" 
                    value={opt.value} 
                    className="hidden" 
                    onChange={()=>handleRoleChange(opt.value as any)} 
                  />
                  <Icon className="w-6 h-6" />
                  <span className="text-sm font-bold">{opt.label}</span>
                </label>
              )
            })}
          </div>

          {/* Ø­Ù‚Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù… ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø© */}
          {role === 'owner' && (
            <>
              <div className="relative">
                <Store className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-orange-400" />
                <input 
                  className="w-full rounded-2xl p-4 pr-12 bg-orange-50 text-orange-900 border-2 border-orange-200 focus:outline-none focus:border-orange-400 focus:ring-4 focus:ring-orange-100 transition-all" 
                  placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…" 
                  value={restaurantName} 
                  onChange={e=>setRestaurantName(e.target.value)} 
                />
              </div>
              <div className="relative">
                <MapPin className="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-orange-400 pointer-events-none" />
                <select
                  value={city}
                  onChange={e => setCity(e.target.value)}
                  className="w-full rounded-2xl p-4 pr-12 bg-orange-50 text-orange-900 border-2 border-orange-200 focus:outline-none focus:border-orange-400 focus:ring-4 focus:ring-orange-100 transition-all appearance-none cursor-pointer"
                >
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                  {SAUDI_CITIES.map(c => (
                    <option key={c} value={c}>{c}</option>
                  ))}
                </select>
              </div>

              {/* Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… */}
              <div 
                onClick={() => setAcceptedTerms(!acceptedTerms)}
                className={`flex items-start gap-3 p-4 rounded-2xl cursor-pointer transition-all border-2 ${
                  acceptedTerms 
                    ? 'bg-green-50 border-green-400' 
                    : 'bg-orange-50 border-orange-200 hover:border-orange-300'
                }`}
              >
                {acceptedTerms ? (
                  <CheckSquare className="w-6 h-6 text-green-500 flex-shrink-0 mt-0.5" />
                ) : (
                  <Square className="w-6 h-6 text-orange-400 flex-shrink-0 mt-0.5" />
                )}
                <div className="text-sm leading-relaxed">
                  <span className={acceptedTerms ? 'text-green-700' : 'text-orange-700'}>
                    Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰{' '}
                  </span>
                  <Link 
                    to="/terms" 
                    target="_blank"
                    onClick={(e) => e.stopPropagation()}
                    className="text-sky-600 hover:text-sky-800 font-bold underline"
                  >
                    Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…
                  </Link>
                  <span className={acceptedTerms ? 'text-green-700' : 'text-orange-700'}>
                    {' '}Ùˆ{' '}
                  </span>
                  <Link 
                    to="/privacy-policy" 
                    target="_blank"
                    onClick={(e) => e.stopPropagation()}
                    className="text-sky-600 hover:text-sky-800 font-bold underline"
                  >
                    Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©
                  </Link>
                  <span className={acceptedTerms ? 'text-green-700' : 'text-orange-700'}>
                    {' '}Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…Ù†ØµØ© Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª
                  </span>
                </div>
              </div>
            </>
          )}

          {/* Ø´Ø±ÙˆØ· ÙˆØ£Ø­ÙƒØ§Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ */}
          {role === 'courier' && (
            <div 
              onClick={() => setAcceptedTerms(!acceptedTerms)}
              className={`flex items-start gap-3 p-4 rounded-2xl cursor-pointer transition-all border-2 ${
                acceptedTerms 
                  ? 'bg-green-50 border-green-400' 
                  : 'bg-emerald-50 border-emerald-200 hover:border-emerald-300'
              }`}
            >
              {acceptedTerms ? (
                <CheckSquare className="w-6 h-6 text-green-500 flex-shrink-0 mt-0.5" />
              ) : (
                <Square className="w-6 h-6 text-emerald-400 flex-shrink-0 mt-0.5" />
              )}
              <div className="text-sm leading-relaxed">
                <span className={acceptedTerms ? 'text-green-700' : 'text-emerald-700'}>
                  Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰{' '}
                </span>
                <Link 
                  to="/courier-terms" 
                  target="_blank"
                  onClick={(e) => e.stopPropagation()}
                  className="text-emerald-600 hover:text-emerald-800 font-bold underline"
                >
                  Ø´Ø±ÙˆØ· ÙˆØ£Ø­ÙƒØ§Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
                </Link>
                <span className={acceptedTerms ? 'text-green-700' : 'text-emerald-700'}>
                  {' '}ÙˆØ£ØªØ­Ù…Ù„ ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ÙƒÙ…Ù†Ø¯ÙˆØ¨ Ù…Ø³ØªÙ‚Ù„
                </span>
              </div>
            </div>
          )}

          <button 
            disabled={loading || (requiresTerms && !acceptedTerms)} 
            className={`w-full flex items-center justify-center gap-3 text-white font-bold p-4 rounded-2xl shadow-xl transition-all ${
              requiresTerms && !acceptedTerms
                ? 'bg-gray-400 cursor-not-allowed'
                : 'bg-gradient-to-r from-sky-500 to-sky-600 hover:from-sky-600 hover:to-sky-700 shadow-sky-300/50 hover:scale-[1.02]'
            }`}
          >
            {loading ? 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„...' : (
              <>
                <UserPlus className="w-5 h-5" />
                ØªØ³Ø¬ÙŠÙ„
              </>
            )}
          </button>

          {/* ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· */}
          {requiresTerms && !acceptedTerms && (
            <p className={`text-center text-sm p-3 rounded-xl ${
              role === 'courier' 
                ? 'text-emerald-600 bg-emerald-50' 
                : 'text-orange-600 bg-orange-50'
            }`}>
              âš ï¸ ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            </p>
          )}
        </form>

        {/* Ø±Ø§Ø¨Ø· ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */}
        <p className="mt-6 text-center text-sky-600">
          Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ØŸ{' '}
          <Link className="text-sky-500 hover:text-sky-700 font-bold" to="/login">
            Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„ âœ¨
          </Link>
        </p>
      </div>
    </div>
  )
}

==========================================================================================
FILE: src/pages/RestaurantOrders.tsx
==========================================================================================
// src/pages/RestaurantOrders.tsx
import React, { useEffect, useState } from 'react'
import { collection, onSnapshot, orderBy, query, where, updateDoc, doc, serverTimestamp } from 'firebase/firestore'
import { db } from '@/firebase'
import { useAuth } from '@/auth'
import { Order } from '@/types'
import { useToast } from '@/components/ui/Toast'
import { Package, MapPin, Truck, DollarSign, Check, Clock, X, AlertCircle, Store } from 'lucide-react'

// Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
const COURIER_PLATFORM_FEE = 3.75

// ØªØ±Ø¬Ù…Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ù„Ø¨
const statusLabels: Record<string, { label: string; color: string; icon: React.ReactNode }> = {
  pending: { label: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„', color: 'bg-amber-100 text-amber-700', icon: <Clock className="w-4 h-4" /> },
  accepted: { label: 'Ù…Ù‚Ø¨ÙˆÙ„', color: 'bg-blue-100 text-blue-700', icon: <Check className="w-4 h-4" /> },
  preparing: { label: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±', color: 'bg-purple-100 text-purple-700', icon: <Package className="w-4 h-4" /> },
  ready: { label: 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ³Ù„ÙŠÙ…', color: 'bg-green-100 text-green-700', icon: <Store className="w-4 h-4" /> },
  out_for_delivery: { label: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚', color: 'bg-sky-100 text-sky-700', icon: <Truck className="w-4 h-4" /> },
  delivered: { label: 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…', color: 'bg-green-500 text-white', icon: <Check className="w-4 h-4" /> },
  cancelled: { label: 'Ù…Ù„ØºÙŠ', color: 'bg-red-100 text-red-700', icon: <X className="w-4 h-4" /> },
}

export const RestaurantOrders: React.FC = () => {
  const { user } = useAuth()
  const toast = useToast()
  const [orders, setOrders] = useState<Order[]>([])
  const [loading, setLoading] = useState(true)
  const [deliveryFees, setDeliveryFees] = useState<Record<string, string>>({})
  const [savingFee, setSavingFee] = useState<string | null>(null)

  useEffect(() => {
    if (!user) return
    // âœ… Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø·Ø¹Ù… Ø­Ø³Ø¨ restaurantId
    const q = query(
      collection(db, 'orders'),
      where('restaurantId', '==', user.uid),
      orderBy('createdAt', 'desc')
    )
    const unsub = onSnapshot(q, (snap) => {
      setOrders(snap.docs.map((d) => ({ id: d.id, ...d.data() } as Order)))
      setLoading(false)
    })
    return () => unsub()
  }, [user])

  const updateStatus = async (id: string, status: string) => {
    await updateDoc(doc(db, 'orders', id), { status, updatedAt: serverTimestamp() })
    toast.success('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨')
  }

  // ØªØ­Ø¯ÙŠØ¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„
  const setDeliveryFee = async (orderId: string) => {
    const feeStr = deliveryFees[orderId]
    const fee = parseFloat(feeStr)
    
    if (isNaN(fee) || fee < 0) {
      toast.error('Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­')
      return
    }

    setSavingFee(orderId)
    
    const order = orders.find(o => o.id === orderId)
    if (!order) return

    const newTotal = order.subtotal + fee

    await updateDoc(doc(db, 'orders', orderId), {
      deliveryFee: fee,
      deliveryFeeSetBy: 'owner',
      deliveryFeeSetAt: serverTimestamp(),
      total: newTotal,
      updatedAt: serverTimestamp(),
    })

    setSavingFee(null)
    toast.success(`ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„: ${fee} Ø±.Ø³`)
  }

  if (loading) return (
    <div className="flex items-center justify-center py-20">
      <div className="text-center">
        <div className="w-16 h-16 border-4 border-sky-200 border-t-sky-500 rounded-full animate-spin mx-auto mb-4"></div>
        <p className="text-sky-600">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
      </div>
    </div>
  )

  return (
    <div className="min-h-screen bg-gradient-to-br from-sky-50 via-white to-sky-100 py-6 px-4">
      <div className="max-w-4xl mx-auto">
        <div className="flex items-center gap-3 mb-6">
          <div className="w-12 h-12 bg-gradient-to-br from-sky-500 to-sky-600 rounded-xl flex items-center justify-center">
            <Package className="w-6 h-6 text-white" />
          </div>
          <div>
            <h1 className="text-2xl font-bold text-sky-900">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø±Ø©</h1>
            <p className="text-sky-600 text-sm">{orders.length} Ø·Ù„Ø¨</p>
          </div>
        </div>

        {orders.length === 0 && (
          <div className="glass-card rounded-2xl p-10 text-center">
            <Package className="w-16 h-16 text-sky-300 mx-auto mb-4" />
            <p className="text-sky-700 font-semibold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
            <p className="text-sky-500 text-sm mt-1">Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‡Ù†Ø§</p>
          </div>
        )}

        <div className="space-y-4">
          {orders.map((o) => {
            const status = statusLabels[o.status] || statusLabels.pending
            const needsDeliveryFee = o.deliveryType === 'delivery' && !o.deliveryFeeSetBy && o.status === 'pending'
            
            return (
              <div key={o.id} className="glass-card rounded-2xl overflow-hidden">
                {/* Header */}
                <div className="bg-gradient-to-r from-sky-500 to-sky-600 px-4 py-3 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <span className="text-white font-bold">#{o.id.slice(-6)}</span>
                    <span className={`px-2 py-1 rounded-lg text-xs font-semibold flex items-center gap-1 ${status.color}`}>
                      {status.icon}
                      {status.label}
                    </span>
                  </div>
                  <div className="flex items-center gap-2 text-white">
                    {o.deliveryType === 'pickup' ? (
                      <span className="flex items-center gap-1 text-sm bg-white/20 px-2 py-1 rounded-lg">
                        <Store className="w-4 h-4" /> Ø§Ø³ØªÙ„Ø§Ù…
                      </span>
                    ) : (
                      <span className="flex items-center gap-1 text-sm bg-white/20 px-2 py-1 rounded-lg">
                        <Truck className="w-4 h-4" /> ØªÙˆØµÙŠÙ„
                      </span>
                    )}
                  </div>
                </div>

                <div className="p-4">
                  {/* Ø§Ù„Ø£ØµÙ†Ø§Ù */}
                  <div className="mb-3">
                    <p className="text-sm text-gray-500 mb-1">Ø§Ù„Ø£ØµÙ†Ø§Ù:</p>
                    <p className="font-semibold text-sky-900">
                      {o.items.map((i) => `${i.name} Ã— ${i.qty}`).join(' â€¢ ')}
                    </p>
                  </div>

                  {/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */}
                  <div className="flex items-start gap-2 mb-3 text-sm">
                    <MapPin className="w-4 h-4 text-sky-500 mt-0.5" />
                    <span className="text-gray-700">{o.address}</span>
                  </div>

                  {/* Ø§Ù„Ø£Ø³Ø¹Ø§Ø± */}
                  <div className="bg-sky-50 rounded-xl p-3 mb-4 space-y-1">
                    <div className="flex justify-between text-sm">
                      <span className="text-gray-600">Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                      <span className="font-semibold">{o.subtotal?.toFixed(2)} Ø±.Ø³</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span className="text-gray-600">Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
                      {o.deliveryFeeSetBy ? (
                        <span className="font-semibold text-green-600">{o.deliveryFee?.toFixed(2)} Ø±.Ø³</span>
                      ) : o.deliveryType === 'pickup' ? (
                        <span className="font-semibold text-green-600">Ù…Ø¬Ø§Ù†Ø§Ù‹</span>
                      ) : (
                        <span className="text-amber-600 text-xs">Ù„Ù… ØªÙØ­Ø¯Ø¯ Ø¨Ø¹Ø¯</span>
                      )}
                    </div>
                    <div className="h-px bg-sky-200 my-2"></div>
                    <div className="flex justify-between">
                      <span className="font-bold text-sky-900">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                      <span className="font-bold text-lg text-sky-600">{o.total?.toFixed(2)} Ø±.Ø³</span>
                    </div>
                  </div>

                  {/* ØªØ­Ø¯ÙŠØ¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ - ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØªÙˆØµÙŠÙ„ */}
                  {needsDeliveryFee && (
                    <div className="bg-amber-50 border-2 border-amber-200 rounded-xl p-4 mb-4">
                      <div className="flex items-center gap-2 mb-3">
                        <AlertCircle className="w-5 h-5 text-amber-600" />
                        <span className="font-bold text-amber-800">Ø­Ø¯Ø¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
                      </div>
                      <div className="flex gap-2">
                        <div className="flex-1 relative">
                          <input
                            type="number"
                            min="0"
                            step="0.5"
                            placeholder="Ù…Ø«Ø§Ù„: 10"
                            value={deliveryFees[o.id] || ''}
                            onChange={(e) => setDeliveryFees(prev => ({ ...prev, [o.id]: e.target.value }))}
                            className="w-full px-4 py-2 rounded-xl border-2 border-amber-200 focus:border-amber-400 focus:outline-none text-gray-800"
                          />
                          <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm">Ø±.Ø³</span>
                        </div>
                        <button
                          onClick={() => setDeliveryFee(o.id)}
                          disabled={savingFee === o.id}
                          className="px-4 py-2 rounded-xl bg-amber-500 text-white font-bold hover:bg-amber-600 transition disabled:opacity-50"
                        >
                          {savingFee === o.id ? '...' : 'ØªØ£ÙƒÙŠØ¯'}
                        </button>
                      </div>
                      <p className="text-xs text-amber-700 mt-2">
                        ğŸ’¡ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© {COURIER_PLATFORM_FEE} Ø±.Ø³ Ø±Ø³ÙˆÙ… Ù…Ù†ØµØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                      </p>
                    </div>
                  )}

                  {/* Ø£Ø²Ø±Ø§Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© */}
                  <div className="flex flex-wrap gap-2">
                    {o.status === 'pending' && (
                      <>
                        <button 
                          onClick={() => updateStatus(o.id, 'accepted')}
                          disabled={needsDeliveryFee}
                          className="flex-1 px-4 py-2 rounded-xl bg-green-500 text-white font-bold hover:bg-green-600 transition disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                          âœ… Ù‚Ø¨ÙˆÙ„
                        </button>
                        <button 
                          onClick={() => updateStatus(o.id, 'cancelled')}
                          className="px-4 py-2 rounded-xl bg-red-100 text-red-600 font-semibold hover:bg-red-200 transition"
                        >
                          Ø±ÙØ¶
                        </button>
                      </>
                    )}
                    {o.status === 'accepted' && (
                      <button 
                        onClick={() => updateStatus(o.id, 'preparing')}
                        className="flex-1 px-4 py-2 rounded-xl bg-purple-500 text-white font-bold hover:bg-purple-600 transition"
                      >
                        ğŸ³ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¶ÙŠØ±
                      </button>
                    )}
                    {o.status === 'preparing' && (
                      <button 
                        onClick={() => updateStatus(o.id, 'ready')}
                        className="flex-1 px-4 py-2 rounded-xl bg-green-500 text-white font-bold hover:bg-green-600 transition"
                      >
                        âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ³Ù„ÙŠÙ…
                      </button>
                    )}
                    {o.status === 'ready' && o.deliveryType === 'pickup' && (
                      <button 
                        onClick={() => updateStatus(o.id, 'delivered')}
                        className="flex-1 px-4 py-2 rounded-xl bg-green-600 text-white font-bold hover:bg-green-700 transition"
                      >
                        ğŸ“¦ ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…
                      </button>
                    )}
                  </div>
                </div>
              </div>
            )
          })}
        </div>
      </div>
    </div>
  )
}

==========================================================================================
FILE: src/pages/RestaurantsPage.tsx
==========================================================================================
// src/pages/RestaurantsPage.tsx
import React, { useEffect, useState, useMemo } from 'react'
import { db } from '@/firebase'
import { collection, getDocs, query, where, updateDoc, doc, increment, setDoc, addDoc, serverTimestamp, getDoc } from 'firebase/firestore'
import { Link, useSearchParams } from 'react-router-dom'
import { SAUDI_CITIES } from '@/utils/cities'
import { MapPin, Filter, X, Navigation, AlertCircle, CheckCircle, Crown, Medal, Award, Megaphone, ChevronLeft, ChevronRight, Play, Eye, Star, ShoppingBag, Utensils, Truck, Store, Clock } from 'lucide-react'
import { useAuth } from '@/auth'
import { calculateDistance, MAX_DELIVERY_DISTANCE } from '@/utils/distance'
import { Promotion } from '@/types'

type GeoLocation = { lat: number; lng: number }

type Restaurant = {
  id: string
  name: string
  logoUrl?: string
  city?: string
  geoLocation?: GeoLocation
  isVerified?: boolean
  licenseStatus?: 'pending' | 'approved' | 'rejected'
  sellerTier?: 'bronze' | 'silver' | 'gold'
  packageType?: 'free' | 'premium'
  allowDelivery?: boolean
  allowPickup?: boolean
  // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©
  totalOrders?: number
  averageRating?: number
  menuItemsCount?: number
}

type RestaurantWithDistance = Restaurant & {
  distance?: number
}

// Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©
const logVisit = async (restaurantId: string, userId?: string, source?: string) => {
  try {
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø© ÙÙŠ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
    await addDoc(collection(db, 'visitLogs'), {
      restaurantId,
      visitorId: userId || null,
      visitorType: userId ? 'customer' : 'anonymous',
      source: source || 'direct',
      page: 'menu',
      createdAt: serverTimestamp()
    })

    // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø·Ø¹Ù…
    const statsRef = doc(db, 'restaurantStats', restaurantId)
    const statsSnap = await getDoc(statsRef)
    
    const today = new Date().toISOString().split('T')[0]
    
    if (statsSnap.exists()) {
      const data = statsSnap.data()
      const dailyViews = data.dailyViews || {}
      dailyViews[today] = (dailyViews[today] || 0) + 1
      
      await updateDoc(statsRef, {
        totalProfileViews: increment(1),
        dailyViews,
        updatedAt: serverTimestamp()
      })
    } else {
      await setDoc(statsRef, {
        totalProfileViews: 1,
        totalMenuViews: 0,
        totalItemViews: 0,
        totalShareClicks: 0,
        whatsappShareCount: 0,
        registeredCustomers: 0,
        appDownloads: 0,
        dailyViews: { [today]: 1 },
        updatedAt: serverTimestamp()
      })
    }
  } catch (err) {
    console.warn('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©:', err)
  }
}

export const RestaurantsPage: React.FC = () => {
  const { userLocation, role, user } = useAuth()
  const [searchParams] = useSearchParams()
  const refSource = searchParams.get('ref') // Ù…ØµØ¯Ø± Ø§Ù„Ø¥Ø­Ø§Ù„Ø© (whatsapp, social, etc)
  const [restaurants, setRestaurants] = useState<RestaurantWithDistance[]>([])
  const [promotions, setPromotions] = useState<(Promotion & { restaurantName?: string })[]>([])
  const [currentPromoIndex, setCurrentPromoIndex] = useState(0)
  const [loading, setLoading] = useState(true)
  const [selectedCity, setSelectedCity] = useState<string>('')
  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid')

  useEffect(() => {
    (async () => {
      // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
      const snap = await getDocs(collection(db, 'restaurants'))
      const allRestaurants = snap.docs.map(d => ({ id: d.id, ...d.data() } as Restaurant))
      
      // Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
      try {
        const promoQuery = query(
          collection(db, 'promotions'),
          where('isActive', '==', true)
        )
        const promoSnap = await getDocs(promoQuery)
        const now = new Date()
        const activePromos = promoSnap.docs
          .map(d => ({
            id: d.id,
            ...d.data(),
            expiresAt: d.data().expiresAt?.toDate?.(),
          } as Promotion))
          .filter(p => !p.expiresAt || new Date(p.expiresAt) > now)
          .map(p => {
            // Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…
            const restaurant = allRestaurants.find(r => r.id === p.ownerId)
            return { ...p, restaurantName: restaurant?.name }
          })
        setPromotions(activePromos)
      } catch (err) {
        console.warn('Error loading promotions:', err)
      }
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© ÙˆÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
      let processedRestaurants: RestaurantWithDistance[] = []
      
      if (userLocation) {
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ù„ÙƒÙ„ Ù…Ø·Ø¹Ù…
        processedRestaurants = allRestaurants.map(r => {
          if (r.geoLocation) {
            const distance = calculateDistance(userLocation, r.geoLocation)
            return { ...r, distance }
          }
          return { ...r, distance: undefined }
        })
        
        // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø¶Ù…Ù† 15 ÙƒÙ… ÙÙ‚Ø· (Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨)
        if (role === 'customer' || role === 'courier') {
          processedRestaurants = processedRestaurants.filter(r => {
            // Ø¥Ø°Ø§ Ø§Ù„Ù…Ø·Ø¹Ù… Ù…Ø§ Ø¹Ù†Ø¯Ù‡ Ù…ÙˆÙ‚Ø¹ØŒ Ù†Ø®ÙÙŠÙ‡
            if (!r.geoLocation || r.distance === undefined) return false
            return r.distance <= MAX_DELIVERY_DISTANCE
          })
        }
        
        // ØªØ±ØªÙŠØ¨ Ø°ÙƒÙŠ: Premium + Gold Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø«Ù… Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ©
        processedRestaurants.sort((a, b) => {
          // Premium ÙŠØ¸Ù‡Ø± Ø£ÙˆÙ„Ø§Ù‹
          const aPremium = a.packageType === 'premium' ? 1 : 0
          const bPremium = b.packageType === 'premium' ? 1 : 0
          if (bPremium !== aPremium) return bPremium - aPremium
          
          // Gold Ø«Ù… Silver Ø«Ù… Bronze
          const tierOrder = { gold: 3, silver: 2, bronze: 1 }
          const aTier = tierOrder[a.sellerTier || 'bronze'] || 0
          const bTier = tierOrder[b.sellerTier || 'bronze'] || 0
          if (bTier !== aTier) return bTier - aTier
          
          // Ø§Ù„Ù…ÙˆØ«Ù‚Ø© ØªØ¸Ù‡Ø± Ù‚Ø¨Ù„ ØºÙŠØ± Ø§Ù„Ù…ÙˆØ«Ù‚Ø©
          const aVerified = a.isVerified ? 1 : 0
          const bVerified = b.isVerified ? 1 : 0
          if (bVerified !== aVerified) return bVerified - aVerified
          
          // Ø«Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ©
          return (a.distance || 999) - (b.distance || 999)
        })
      } else {
        // Ø¥Ø°Ø§ Ù…Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆÙ‚Ø¹ØŒ Ù†Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ù…Ø±ØªØ¨Ø©
        processedRestaurants = allRestaurants.sort((a, b) => {
          const tierOrder = { gold: 3, silver: 2, bronze: 1 }
          const aTier = tierOrder[a.sellerTier || 'bronze'] || 0
          const bTier = tierOrder[b.sellerTier || 'bronze'] || 0
          if (bTier !== aTier) return bTier - aTier
          const aVerified = a.isVerified ? 1 : 0
          const bVerified = b.isVerified ? 1 : 0
          return bVerified - aVerified
        })
      }
      
      setRestaurants(processedRestaurants)
      setLoading(false)
    })()
  }, [userLocation, role])

  // Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ØªØ§Ø­Ø© (ÙÙ‚Ø· Ø§Ù„ØªÙŠ Ù„Ø¯ÙŠÙ‡Ø§ Ù…Ø·Ø§Ø¹Ù…)
  const availableCities = useMemo(() => {
    const cities = new Set(restaurants.map(r => r.city).filter(Boolean))
    return SAUDI_CITIES.filter(c => cities.has(c))
  }, [restaurants])

  // Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ù…ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
  const filteredRestaurants = useMemo(() => {
    if (!selectedCity) return restaurants
    return restaurants.filter(r => r.city === selectedCity)
  }, [restaurants, selectedCity])

  if (loading) {
    return (
      <div className="flex items-center justify-center h-96 text-lg text-gray-300">
        â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…...
      </div>
    )
  }

  return (
    <div className="py-10">
      <h1 className="text-3xl font-extrabold text-center mb-8 text-sky-600">
        ğŸ´ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
      </h1>

      {/* ğŸ“¢ Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙˆÙ„Ø© */}
      {promotions.length > 0 && (
        <div className="mb-8">
          <div className="flex items-center justify-center gap-2 mb-3">
            <Megaphone className="w-5 h-5 text-purple-500" />
            <span className="font-bold text-purple-600">Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ù…ÙŠØ²Ø©</span>
          </div>
          
          <div className="relative">
            {/* Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ */}
            <Link
              to={`/menu?restaurant=${promotions[currentPromoIndex]?.ownerId}`}
              onClick={async () => {
                // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª
                try {
                  await updateDoc(doc(db, 'promotions', promotions[currentPromoIndex].id), {
                    viewsCount: increment(1)
                  })
                } catch {}
              }}
              className="block bg-gradient-to-r from-purple-900 via-purple-800 to-pink-900 rounded-2xl shadow-xl overflow-hidden"
            >
              {/* Ø´Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† */}
              <div className="absolute top-3 right-3 z-10 inline-flex items-center gap-1 px-3 py-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xs font-bold rounded-full shadow">
                <Megaphone className="w-3 h-3" />
                Ø¥Ø¹Ù„Ø§Ù†
              </div>

              {/* Ø§Ù„ÙˆØ³Ø§Ø¦Ø· */}
              {promotions[currentPromoIndex]?.mediaUrl && (
                <div className="relative h-48">
                  {promotions[currentPromoIndex].type === 'video' ? (
                    <>
                      <video
                        src={promotions[currentPromoIndex].mediaUrl}
                        className="w-full h-full object-cover"
                        muted
                        loop
                        autoPlay
                        playsInline
                      />
                      <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <div className="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                          <Play className="w-6 h-6 text-white fill-white" />
                        </div>
                      </div>
                    </>
                  ) : (
                    <img
                      src={promotions[currentPromoIndex].mediaUrl}
                      alt={promotions[currentPromoIndex].title}
                      className="w-full h-full object-cover"
                    />
                  )}
                </div>
              )}

              {/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */}
              <div className="p-4">
                <div className="flex items-center gap-2 mb-2">
                  {promotions[currentPromoIndex]?.restaurantName && (
                    <span className="text-xs bg-white/20 text-white px-2 py-1 rounded-full">
                      {promotions[currentPromoIndex].restaurantName}
                    </span>
                  )}
                </div>
                {promotions[currentPromoIndex]?.title && (
                  <h3 className="text-lg font-bold text-white">{promotions[currentPromoIndex].title}</h3>
                )}
                {promotions[currentPromoIndex]?.description && (
                  <p className="text-purple-100 text-sm mt-1 line-clamp-2">{promotions[currentPromoIndex].description}</p>
                )}
              </div>
            </Link>

            {/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ */}
            {promotions.length > 1 && (
              <>
                <button
                  onClick={(e) => {
                    e.preventDefault()
                    setCurrentPromoIndex((prev) => (prev === 0 ? promotions.length - 1 : prev - 1))
                  }}
                  className="absolute left-2 top-1/2 -translate-y-1/2 p-2 bg-white/80 hover:bg-white rounded-full shadow-lg transition z-10"
                >
                  <ChevronLeft className="w-5 h-5 text-gray-800" />
                </button>
                <button
                  onClick={(e) => {
                    e.preventDefault()
                    setCurrentPromoIndex((prev) => (prev === promotions.length - 1 ? 0 : prev + 1))
                  }}
                  className="absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-white/80 hover:bg-white rounded-full shadow-lg transition z-10"
                >
                  <ChevronRight className="w-5 h-5 text-gray-800" />
                </button>
              </>
            )}

            {/* Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ØµÙØ­Ø§Øª */}
            {promotions.length > 1 && (
              <div className="flex justify-center gap-2 mt-3">
                {promotions.map((_, idx) => (
                  <button
                    key={idx}
                    onClick={() => setCurrentPromoIndex(idx)}
                    className={`w-2 h-2 rounded-full transition ${
                      idx === currentPromoIndex ? 'bg-purple-500 w-4' : 'bg-gray-300'
                    }`}
                  />
                ))}
              </div>
            )}
          </div>
        </div>
      )}

      {/* ÙÙ„ØªØ± Ø§Ù„Ù…Ø¯Ù† */}
      {availableCities.length > 0 && (
        <div className="mb-6 flex flex-wrap items-center justify-center gap-2">
          <div className="flex items-center gap-2 text-sky-600">
            <Filter className="w-5 h-5" />
            <span className="font-semibold">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</span>
          </div>
          <button
            onClick={() => setSelectedCity('')}
            className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${
              !selectedCity
                ? 'bg-sky-500 text-white shadow-lg'
                : 'bg-sky-100 text-sky-700 hover:bg-sky-200'
            }`}
          >
            Ø§Ù„ÙƒÙ„
          </button>
          {availableCities.map(city => (
            <button
              key={city}
              onClick={() => setSelectedCity(city)}
              className={`px-4 py-2 rounded-full text-sm font-medium transition-all flex items-center gap-1 ${
                selectedCity === city
                  ? 'bg-sky-500 text-white shadow-lg'
                  : 'bg-sky-100 text-sky-700 hover:bg-sky-200'
              }`}
            >
              <MapPin className="w-4 h-4" />
              {city}
            </button>
          ))}
          {selectedCity && (
            <button
              onClick={() => setSelectedCity('')}
              className="p-2 text-gray-400 hover:text-red-500 transition-colors"
              title="Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙÙ„ØªØ±"
            >
              <X className="w-5 h-5" />
            </button>
          )}
        </div>
      )}

      {filteredRestaurants.length === 0 && (
        <div className="text-center py-10">
          <div className="w-20 h-20 bg-sky-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <AlertCircle className="w-10 h-10 text-sky-500" />
          </div>
          {userLocation ? (
            <>
              <p className="text-gray-600 text-lg font-semibold">ğŸ˜” Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø·Ø§Ø¹Ù… Ù‚Ø±ÙŠØ¨Ø© Ù…Ù†Ùƒ</p>
              <p className="text-gray-400 text-sm mt-2">Ù†Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø¶Ù…Ù† {MAX_DELIVERY_DISTANCE} ÙƒÙ… ÙÙ‚Ø·</p>
            </>
          ) : (
            <>
              <p className="text-gray-600 text-lg font-semibold">
                {selectedCity ? `ğŸ˜” Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø·Ø§Ø¹Ù… ÙÙŠ ${selectedCity}` : 'ğŸ˜” Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø·Ø§Ø¹Ù… Ø­Ø§Ù„ÙŠØ§Ù‹'}
              </p>
            </>
          )}
        </div>
      )}

      {/* Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© Ù„Ù„Ù…Ø³Ø§ÙØ© */}
      {userLocation && filteredRestaurants.length > 0 && (role === 'customer' || role === 'courier') && (
        <div className="mb-6 bg-sky-50 border border-sky-200 rounded-xl p-4 flex items-center gap-3">
          <Navigation className="w-6 h-6 text-sky-500 flex-shrink-0" />
          <div>
            <p className="text-sky-700 font-semibold">Ù†Ø¹Ø±Ø¶ Ù„Ùƒ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© ÙÙ‚Ø·</p>
            <p className="text-sky-600 text-sm">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù‚ØµÙˆÙ‰ Ù„Ù„ØªÙˆØµÙŠÙ„: {MAX_DELIVERY_DISTANCE} ÙƒÙ…</p>
          </div>
        </div>
      )}

      {/* === Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ù…ÙŠØ²Ø© (Premium) - Ø¹Ø±Ø¶ Ù…Ù…ÙŠØ² Ø¨Ù…Ø±Ø¨Ø¹Ø§Øª === */}
      {filteredRestaurants.filter(r => r.packageType === 'premium').length > 0 && (
        <div className="mb-8">
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-2">
              <Crown className="w-6 h-6 text-amber-500" />
              <h2 className="text-xl font-bold text-amber-400">â­ Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h2>
            </div>
            <span className="text-sm text-gray-400">{filteredRestaurants.filter(r => r.packageType === 'premium').length} Ø£Ø³Ø±Ø©</span>
          </div>
          
          <div className="grid grid-cols-2 xs:grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4">
            {filteredRestaurants.filter(r => r.packageType === 'premium').map(r => (
              <Link
                key={r.id}
                to={`/menu?restaurant=${r.id}${refSource ? `&ref=${refSource}` : ''}`}
                onClick={() => logVisit(r.id, user?.uid, refSource || 'direct')}
                className="group bg-[#1E293B] border border-amber-500/30 rounded-[16px] shadow-lg shadow-amber-500/10 hover:shadow-xl hover:shadow-amber-500/20 hover:-translate-y-2 transform transition-all duration-300 p-3 sm:p-4 flex flex-col items-center text-center relative overflow-hidden active:scale-[0.98]"
              >
                {/* Ø®Ù„ÙÙŠØ© Ù…ØªÙˆÙ‡Ø¬Ø© */}
                <div className="absolute inset-0 bg-gradient-to-br from-amber-500/5 to-purple-500/5 opacity-0 group-hover:opacity-100 transition-opacity" />
                
                {/* Ø´Ø§Ø±Ø© Ù…Ù…ÙŠØ²Ø© */}
                <div className="absolute top-2 right-2">
                  <div className="bg-gradient-to-r from-amber-500 to-orange-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow flex items-center gap-1">
                    <Crown className="w-3 h-3" />
                    Ù…Ù…ÙŠØ²Ø©
                  </div>
                </div>

                {/* Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© */}
                {r.distance !== undefined && (
                  <div className="absolute top-2 left-2 bg-sky-500/90 backdrop-blur text-white text-[10px] font-bold px-2 py-0.5 rounded-full flex items-center gap-0.5">
                    <Navigation className="w-2.5 h-2.5" />
                    {r.distance < 1 ? `${Math.round(r.distance * 1000)}Ù…` : `${r.distance.toFixed(1)}ÙƒÙ…`}
                  </div>
                )}
                
                {/* Ø§Ù„Ø´Ø¹Ø§Ø± ÙÙŠ Ø¯Ø§Ø¦Ø±Ø© */}
                <div className="relative mt-6 mb-3">
                  {r.logoUrl ? (
                    <img
                      src={r.logoUrl}
                      alt={r.name}
                      className="w-20 h-20 object-cover rounded-full border-4 border-amber-400 shadow-lg group-hover:scale-110 transition-transform duration-300"
                    />
                  ) : (
                    <div className="w-20 h-20 flex items-center justify-center rounded-full bg-slate-700 border-4 border-amber-400 shadow-lg group-hover:scale-110 transition-transform duration-300">
                      <Utensils className="w-8 h-8 text-amber-400" />
                    </div>
                  )}
                </div>
                
                {/* Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø±Ø© */}
                <h3 className="font-bold text-sm text-white line-clamp-1">{r.name}</h3>
                
                {/* Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© */}
                {r.city && (
                  <p className="text-xs text-gray-400 flex items-center gap-0.5 mt-1 mb-2">
                    <MapPin className="w-3 h-3" />
                    {r.city}
                  </p>
                )}

                {/* Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ - ÙƒØ¨Ø³ÙˆÙ„Ø© ØªØ­Øª Ø§Ù„Ø§Ø³Ù… */}
                {(r.isVerified || r.licenseStatus === 'approved') ? (
                  <div className="bg-emerald-500/20 border border-emerald-500/50 text-emerald-400 text-[11px] font-bold px-3 py-1 rounded-full flex items-center gap-1 mb-2">
                    <CheckCircle className="w-3 h-3" />
                    âœ” Ø£Ø³Ø±Ø© Ù…ÙˆØ«Ù‚Ø©
                  </div>
                ) : (
                  <div className="bg-amber-500/20 border border-amber-500/50 text-amber-400 text-[11px] font-bold px-3 py-1 rounded-full flex items-center gap-1 mb-2">
                    <Clock className="w-3 h-3" />
                    â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙˆØ«ÙŠÙ‚
                  </div>
                )}

                {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© */}
                <div className="flex items-center justify-center gap-3 text-[10px] text-gray-400">
                  {r.averageRating !== undefined && r.averageRating > 0 && (
                    <span className="flex items-center gap-0.5">
                      <Star className="w-3 h-3 text-amber-400 fill-amber-400" />
                      {r.averageRating.toFixed(1)}
                    </span>
                  )}
                  {r.totalOrders !== undefined && r.totalOrders > 0 && (
                    <span className="flex items-center gap-0.5">
                      <ShoppingBag className="w-3 h-3" />
                      {r.totalOrders}
                    </span>
                  )}
                </div>

                {/* Ø´Ø§Ø±Ø§Øª Ø§Ù„ØªØµÙ†ÙŠÙ */}
                <div className="flex gap-1 mt-2">
                  {r.sellerTier === 'gold' && (
                    <span className="bg-gradient-to-r from-amber-400 to-yellow-400 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-full">ğŸ‘‘ Gold</span>
                  )}
                  {r.sellerTier === 'silver' && (
                    <span className="bg-gradient-to-r from-gray-400 to-gray-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-full">ğŸ¥ˆ Silver</span>
                  )}
                </div>

                {/* Ø´Ø§Ø±Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù… */}
                <div className="flex flex-wrap gap-1 mt-1.5 justify-center">
                  {(r.allowDelivery !== false) && (
                    <span className="inline-flex items-center gap-0.5 bg-sky-500/20 text-sky-400 text-[9px] font-medium px-1.5 py-0.5 rounded-full">
                      <Truck className="w-2.5 h-2.5" />
                      ØªÙˆØµÙŠÙ„
                    </span>
                  )}
                  {r.allowPickup && (
                    <span className="inline-flex items-center gap-0.5 bg-green-500/20 text-green-400 text-[9px] font-medium px-1.5 py-0.5 rounded-full">
                      <Store className="w-2.5 h-2.5" />
                      Ø§Ø³ØªÙ„Ø§Ù…
                    </span>
                  )}
                </div>
              </Link>
            ))}
          </div>
        </div>
      )}

      {/* === Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø³Ø± (Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©) - Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø§Ø¯ÙŠ === */}
      {filteredRestaurants.filter(r => r.packageType !== 'premium').length > 0 && (
        <div>
          {filteredRestaurants.filter(r => r.packageType === 'premium').length > 0 && (
            <div className="flex items-center gap-2 mb-4">
              <Utensils className="w-5 h-5 text-gray-400" />
              <h2 className="text-lg font-bold text-gray-300">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø±</h2>
            </div>
          )}
          
          <div className="grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4 sm:gap-6">
            {filteredRestaurants.filter(r => r.packageType !== 'premium').map(r => (
              <Link
                key={r.id}
                to={`/menu?restaurant=${r.id}${refSource ? `&ref=${refSource}` : ''}`}
                onClick={() => logVisit(r.id, user?.uid, refSource || 'direct')}
                className="group bg-[#1E293B] rounded-[16px] shadow-lg shadow-black/20 hover:shadow-xl hover:shadow-black/30 hover:-translate-y-1 transform transition-all duration-300 p-4 sm:p-6 flex flex-col items-center text-center relative overflow-hidden active:scale-[0.98]"
              >
                {/* Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© */}
                {r.distance !== undefined && (
                  <div className="absolute top-3 left-3 bg-sky-500/90 backdrop-blur-sm text-white text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1">
                    <Navigation className="w-3 h-3" />
                    {r.distance < 1 ? `${Math.round(r.distance * 1000)} Ù…` : `${r.distance.toFixed(1)} ÙƒÙ…`}
                  </div>
                )}

                {/* Ø´Ø§Ø±Ø§Øª Ø§Ù„ØªØµÙ†ÙŠÙ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ */}
                <div className="absolute top-3 right-3 flex flex-col gap-1.5">
                  {r.sellerTier === 'gold' && (
                    <div className="bg-gradient-to-r from-amber-400 to-yellow-500 text-white text-xs font-bold px-2.5 py-1 rounded-full flex items-center gap-1 shadow-lg">
                      <Crown className="w-3 h-3" />
                      Gold
                    </div>
                  )}
                  {r.sellerTier === 'silver' && (
                    <div className="bg-gradient-to-r from-gray-300 to-gray-400 text-gray-800 text-xs font-bold px-2.5 py-1 rounded-full flex items-center gap-1 shadow-lg">
                      <Medal className="w-3 h-3" />
                      Silver
                    </div>
                  )}
                </div>
                
                {/* Ø§Ù„Ø´Ø¹Ø§Ø± ÙÙŠ Ø¯Ø§Ø¦Ø±Ø© */}
                <div className="mt-2 mb-4">
                  {r.logoUrl ? (
                    <img
                      src={r.logoUrl}
                      alt={r.name}
                      className={`w-24 h-24 object-cover rounded-full border-4 shadow-lg group-hover:scale-105 transition-transform duration-300 ${
                        r.sellerTier === 'gold' 
                          ? 'border-amber-400 ring-4 ring-amber-400/30' 
                          : r.sellerTier === 'silver'
                          ? 'border-gray-300 ring-4 ring-gray-300/30'
                          : 'border-slate-500'
                      }`}
                    />
                  ) : (
                    <div className={`w-24 h-24 flex items-center justify-center rounded-full text-4xl border-4 shadow-lg group-hover:scale-105 transition-transform duration-300 ${
                      r.sellerTier === 'gold' 
                        ? 'bg-amber-900/50 border-amber-400' 
                        : r.sellerTier === 'silver'
                        ? 'bg-gray-700 border-gray-300'
                        : 'bg-slate-700 border-slate-500'
                    }`}>
                      ğŸ´
                    </div>
                  )}
                </div>
                
                {/* Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø±Ø© */}
                <h3 className="font-bold text-xl text-white mb-1">{r.name}</h3>
                
                {/* Ø§Ù„Ù…ÙˆÙ‚Ø¹ */}
                {r.city && (
                  <p className="text-sm text-gray-400 flex items-center justify-center gap-1 mb-3">
                    <MapPin className="w-4 h-4" />
                    {r.city}
                  </p>
                )}

                {/* Ø´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ - ÙƒØ¨Ø³ÙˆÙ„Ø© ØªØ­Øª Ø§Ù„Ø§Ø³Ù… */}
                {(r.isVerified || r.licenseStatus === 'approved') ? (
                  <div className="bg-emerald-500/20 border border-emerald-500/50 text-emerald-400 text-sm font-bold px-4 py-1.5 rounded-full flex items-center gap-2 mb-3">
                    <CheckCircle className="w-4 h-4" />
                    âœ” Ø£Ø³Ø±Ø© Ù…ÙˆØ«Ù‚Ø©
                  </div>
                ) : (
                  <div className="bg-amber-500/20 border border-amber-500/50 text-amber-400 text-sm font-bold px-4 py-1.5 rounded-full flex items-center gap-2 mb-3">
                    <Clock className="w-4 h-4" />
                    â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙˆØ«ÙŠÙ‚
                  </div>
                )}
                
                {/* Ø´Ø§Ø±Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù… */}
                <div className="flex items-center justify-center gap-2">
                  {(r.allowDelivery === undefined || r.allowDelivery === true) && (
                    <span className="inline-flex items-center gap-1 px-3 py-1 bg-sky-500/20 text-sky-400 text-xs font-semibold rounded-full">
                      <Truck className="w-3 h-3" />
                      ØªÙˆØµÙŠÙ„
                    </span>
                  )}
                  {r.allowPickup && (
                    <span className="inline-flex items-center gap-1 px-3 py-1 bg-green-500/20 text-green-400 text-xs font-semibold rounded-full">
                      <Store className="w-3 h-3" />
                      Ø§Ø³ØªÙ„Ø§Ù…
                    </span>
                  )}
                </div>
              </Link>
            ))}
          </div>
        </div>
      )}
    </div>
  )
}

==========================================================================================
FILE: src/pages/SetupDeveloper.tsx
==========================================================================================
// src/pages/SetupDeveloper.tsx
// ØµÙØ­Ø© Ù…Ø®ÙÙŠØ© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
import React, { useState } from 'react'
import { createUserWithEmailAndPassword } from 'firebase/auth'
import { doc, setDoc, serverTimestamp } from 'firebase/firestore'
import { auth, db } from '@/firebase'
import { useNavigate } from 'react-router-dom'
import { Shield, Sparkles, Lock, Mail, Key, CheckCircle } from 'lucide-react'

// Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ ÙÙ‚Ø·
const ALLOWED_EMAIL = 'afrtalbyt2026@gmail.com'

export const SetupDeveloper: React.FC = () => {
  const nav = useNavigate()
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState('')
  const [success, setSuccess] = useState(false)

  const handleSetup = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­
    if (email.trim().toLowerCase() !== ALLOWED_EMAIL) {
      setError('âŒ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ù„Ù‡ Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø·ÙˆØ±')
      return
    }
    
    if (password.length < 6) {
      setError('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„')
      return
    }
    
    setLoading(true)
    
    try {
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ Firebase Auth
      const userCred = await createUserWithEmailAndPassword(auth, email.trim(), password)
      const uid = userCred.user.uid
      
      // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ± ÙÙŠ Firestore
      await setDoc(doc(db, 'users', uid), {
        email: email.trim(),
        name: 'Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ',
        role: 'developer',
        createdAt: serverTimestamp(),
      })
      
      setSuccess(true)
      
      // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ± Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©
      setTimeout(() => {
        nav('/developer')
      }, 2000)
      
    } catch (err: any) {
      console.error('Setup error:', err)
      if (err.code === 'auth/email-already-in-use') {
        setError('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ø¬Ø±Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„')
      } else if (err.code === 'auth/invalid-email') {
        setError('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­')
      } else if (err.code === 'auth/weak-password') {
        setError('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹')
      } else {
        setError('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + (err.message || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'))
      }
    } finally {
      setLoading(false)
    }
  }

  if (success) {
    return (
      <div className="min-h-[70vh] flex items-center justify-center">
        <div className="text-center bg-gradient-to-br from-green-500 to-emerald-600 text-white p-10 rounded-3xl shadow-2xl">
          <CheckCircle className="w-20 h-20 mx-auto mb-4" />
          <h1 className="text-2xl font-bold mb-2">ğŸ‰ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!</h1>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ±...</p>
        </div>
      </div>
    )
  }

  return (
    <div className="min-h-[70vh] flex items-center justify-center">
      <div className="w-full max-w-md">
        <div className="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 rounded-3xl shadow-2xl overflow-hidden">
          {/* Ø§Ù„Ø±Ø£Ø³ */}
          <div className="bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 p-6 text-center">
            <div className="w-20 h-20 bg-white/20 backdrop-blur rounded-full flex items-center justify-center mx-auto mb-4">
              <Shield className="w-10 h-10 text-white" />
            </div>
            <h1 className="text-2xl font-bold text-white flex items-center justify-center gap-2">
              <Sparkles className="w-6 h-6" />
              Ø¥Ø¹Ø¯Ø§Ø¯ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø·ÙˆØ±
              <Sparkles className="w-6 h-6" />
            </h1>
            <p className="text-white/80 text-sm mt-2">ğŸ” Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­Ø¯ÙˆØ¯ ÙÙ‚Ø·</p>
          </div>
          
          {/* Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */}
          <form onSubmit={handleSetup} className="p-6 space-y-5">
            {error && (
              <div className="bg-red-500/20 border border-red-500/50 text-red-400 rounded-xl p-3 text-sm text-center">
                {error}
              </div>
            )}
            
            <div>
              <label className="block text-gray-400 text-sm mb-2 flex items-center gap-2">
                <Mail className="w-4 h-4" />
                Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
              </label>
              <input
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø®ØµØµ"
                className="w-full px-4 py-3 bg-gray-700/50 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"
                required
              />
            </div>
            
            <div>
              <label className="block text-gray-400 text-sm mb-2 flex items-center gap-2">
                <Key className="w-4 h-4" />
                ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
              </label>
              <input
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                className="w-full px-4 py-3 bg-gray-700/50 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"
                required
              />
            </div>
            
            <button
              type="submit"
              disabled={loading}
              className="w-full py-4 bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 text-white font-bold rounded-xl hover:opacity-90 transition-all disabled:opacity-50 flex items-center justify-center gap-2"
            >
              {loading ? (
                <>
                  <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />
                  Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...
                </>
              ) : (
                <>
                  <Lock className="w-5 h-5" />
                  Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø·ÙˆØ±
                </>
              )}
            </button>
            
            <p className="text-gray-500 text-xs text-center">
              âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø­Ø¯ÙˆØ¯Ø© Ù„Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙ‚Ø·
            </p>
          </form>
        </div>
      </div>
    </div>
  )
}

==========================================================================================
FILE: src/pages/TermsPage.tsx
==========================================================================================
// src/pages/TermsPage.tsx
import React from "react";
import { Link } from "react-router-dom";

export default function TermsPage() {
  return (
    <div className="min-h-screen bg-gray-100 text-gray-800 px-4 py-10 leading-relaxed">
      <div className="max-w-3xl mx-auto bg-white shadow-lg rounded-2xl p-6 sm:p-8">
        <h1 className="text-2xl font-bold text-sky-600 mb-6 text-center">
          Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… - ğŸ  Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª
        </h1>

        {/* 1. Ø§Ù„ØªØ¹Ø±ÙŠÙ */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-sky-500 pr-3">
            1. Ø§Ù„ØªØ¹Ø±ÙŠÙ
          </h2>
          <p>
            Ù…Ù†ØµØ© Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª Ù‡ÙŠ Ù…Ù†ØµØ© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ØªÙ‡Ø¯Ù Ø¥Ù„Ù‰ Ø¹Ø±Ø¶ ÙˆØªØ³ÙˆÙŠÙ‚ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ø±
            Ø§Ù„Ù…Ù†ØªØ¬Ø© ÙˆØ±Ø¨Ø·Ù‡Ø§ Ø¨Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ø¨Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.
          </p>
        </section>

        {/* 2. Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-sky-500 pr-3">
            2. Ø§Ù„ØªØ³Ø¬ÙŠÙ„
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ù…Ù†ØµØ© Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª Ù…Ø¬Ø§Ù†ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.</li>
            <li>Ù„Ø§ ÙŠØªÙ… ÙØ±Ø¶ Ø£ÙŠ Ø±Ø³ÙˆÙ… ØªØ³Ø¬ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø©.</li>
          </ul>
        </section>

        {/* 3. ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ±Ø³ÙˆÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ© */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-sky-500 pr-3">
            3. ØªØ³Ø¹ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ±Ø³ÙˆÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ©
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>ØªÙ‚ÙˆÙ… Ø§Ù„Ø£Ø³Ø±Ø© Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ù…Ù†ØªØ¬.</li>
            <li>
              ØªÙˆØ§ÙÙ‚ Ø§Ù„Ø£Ø³Ø±Ø© Ø¹Ù„Ù‰ Ù‚ÙŠØ§Ù… Ø§Ù„Ù…Ù†ØµØ© Ø¨Ø¥Ø¶Ø§ÙØ© Ø±Ø³ÙˆÙ… ØªØ´ØºÙŠÙ„ Ù‚Ø¯Ø±Ù‡Ø§{" "}
              <strong className="text-sky-600">1.75 Ø±ÙŠØ§Ù„</strong> Ø¹Ù„Ù‰ ÙƒÙ„ Ù…Ù†ØªØ¬.
            </li>
            <li>
              Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙŠ ÙŠÙƒÙˆÙ† Ø³Ø¹Ø±Ù‡Ø§ 1 Ø±ÙŠØ§Ù„ Ø£Ùˆ 2 Ø±ÙŠØ§Ù„ØŒ ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ©{" "}
              <strong className="text-sky-600">0.25 Ø±ÙŠØ§Ù„</strong> ÙÙ‚Ø·.
            </li>
            <li>
              ÙŠØ¸Ù‡Ø± Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø£Ù†Ù‡ Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬.
            </li>
            <li>
              Ù„Ø§ ÙŠØªÙ… Ø®ØµÙ… Ø£ÙŠ Ù…Ø¨Ø§Ù„Øº Ù…Ù† Ø¯Ø®Ù„ Ø§Ù„Ø£Ø³Ø±Ø©ØŒ ÙˆØ¬Ù…ÙŠØ¹ Ø±Ø³ÙˆÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ© ØªÙØ­Ù…Ù‘Ù„
              Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„.
            </li>
          </ul>
        </section>

        {/* 4. Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„Ø¯ÙØ¹ */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-sky-500 pr-3">
            4. Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„Ø¯ÙØ¹
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>
              ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ù…Ù†ØªØ¬ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø±Ø³ÙˆÙ… ØªØ´ØºÙŠÙ„
              Ø§Ù„Ù…Ù†ØµØ©.
            </li>
            <li>
              Ù‚Ø¯ ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø±Ø³ÙˆÙ… Ø£Ø®Ø±Ù‰ Ù…Ø«Ù„:
              <ul className="list-disc list-inside mr-6 mt-2 space-y-1">
                <li>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</li>
                <li>Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø­Ø³Ø¨ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø¹Ù…ÙˆÙ„ Ø¨Ù‡Ø§</li>
              </ul>
            </li>
            <li>
              ØªØ­ØªÙØ¸ Ø§Ù„Ù…Ù†ØµØ© Ø¨Ø­Ù‚ ØªØ­Ø¯ÙŠØ« Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø§Øª Ø£Ùˆ Ø±Ø³ÙˆÙ… Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©ØŒ
              Ù…Ø¹ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø°Ù„Ùƒ.
            </li>
          </ul>
        </section>

        {/* 5. Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø© */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-sky-500 pr-3">
            5. Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø©
          </h2>
          <p className="mb-3">ØªØªØ­Ù…Ù„ Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø© ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø¹Ù†:</p>
          <ul className="list-disc list-inside space-y-2 text-gray-700 mr-4">
            <li>Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</li>
            <li>Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</li>
            <li>Ù†Ø¸Ø§ÙØ© ÙˆØªØ­Ø¶ÙŠØ± Ø§Ù„Ø·Ø¹Ø§Ù…</li>
            <li>Ø§Ù„ØªØºÙ„ÙŠÙ ÙˆØ§Ù„ØªØ¹Ø¨Ø¦Ø©</li>
            <li>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§Ø·Ø§Øª Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ù…Ø¹Ù…ÙˆÙ„ Ø¨Ù‡Ø§</li>
          </ul>
          <p className="mt-3">
            ØªÙ„ØªØ²Ù… Ø§Ù„Ø£Ø³Ø±Ø© Ø¨ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆØ§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§ Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„.
          </p>
        </section>

        {/* 6. Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-sky-500 pr-3">
            6. Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>ØªØ¹Ù…Ù„ Ù…Ù†ØµØ© Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª ÙƒÙˆØ³ÙŠØ· ØªÙ‚Ù†ÙŠ Ù„Ø±Ø¨Ø· Ø§Ù„Ø£Ø·Ø±Ø§Ù.</li>
            <li>
              Ù„Ø§ ØªØªØ­Ù…Ù„ Ø§Ù„Ù…Ù†ØµØ© Ø£ÙŠ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø¹Ù†:
              <ul className="list-disc list-inside mr-6 mt-2 space-y-1">
                <li>ØªØµØ±ÙØ§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</li>
                <li>ØªØ£Ø®ÙŠØ± Ø§Ù„ØªÙˆØµÙŠÙ„</li>
                <li>Ø³ÙˆØ¡ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ù„ÙŠÙ…</li>
                <li>ØªÙ„Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯ Ø®Ø±ÙˆØ¬Ù‡ Ù…Ù† Ø§Ù„Ø£Ø³Ø±Ø©</li>
              </ul>
            </li>
            <li>
              Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„ØªÙˆØµÙŠÙ„ ÙŠØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡Ø§ Ø­Ø³Ø¨ Ø³ÙŠØ§Ø³Ø© Ù…Ø²ÙˆØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„
              Ø§Ù„Ù…Ø¹ØªÙ…Ø¯.
            </li>
          </ul>
        </section>

        {/* 7. Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-sky-500 pr-3">
            7. Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>
              ØªØªÙŠØ­ Ø§Ù„Ù…Ù†ØµØ© Ø®Ø¯Ù…Ø§Øª Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© Ø£Ùˆ ØªØ±ÙˆÙŠØ¬ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù‚Ø§Ø¨Ù„ Ø±Ø³ÙˆÙ….
            </li>
            <li>
              Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆÙ„Ø§ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ø±Ø©
              ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.
            </li>
            <li>
              Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØªÙ‡Ø¯Ù Ø¥Ù„Ù‰ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¸Ù‡ÙˆØ± ÙˆÙ„Ø§ ØªØ¶Ù…Ù† Ø¹Ø¯Ø¯Ù‹Ø§ Ù…Ø¹ÙŠÙ†Ù‹Ø§ Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø£Ùˆ
              Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª.
            </li>
          </ul>
        </section>

        {/* 8. Ø­Ø¯ÙˆØ¯ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ù…Ù†ØµØ© */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-sky-500 pr-3">
            8. Ø­Ø¯ÙˆØ¯ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ù…Ù†ØµØ©
          </h2>
          <p className="mb-3">Ù…Ù†ØµØ© Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª ØºÙŠØ± Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù†:</p>
          <ul className="list-disc list-inside space-y-2 text-gray-700 mr-4">
            <li>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø£Ùˆ ØµÙˆØ±Ù‡Ø§</li>
            <li>Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ù„Ù„Ø¹Ù…ÙŠÙ„</li>
            <li>Ø£ÙŠ Ø£Ø¶Ø±Ø§Ø± Ù†Ø§ØªØ¬Ø© Ø¹Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¬</li>
          </ul>
          <p className="mt-3">ÙŠÙ‚ØªØµØ± Ø¯ÙˆØ± Ø§Ù„Ù…Ù†ØµØ© Ø¹Ù„Ù‰:</p>
          <ul className="list-disc list-inside space-y-2 text-gray-700 mr-4 mt-2">
            <li>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</li>
            <li>ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</li>
            <li>Ø±Ø¨Ø· Ø§Ù„Ø£Ø·Ø±Ø§Ù Ø¹Ø¨Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ù†ÙŠ</li>
          </ul>
        </section>

        {/* 9. Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-sky-500 pr-3">
            9. Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
          </h2>
          <ul className="list-disc list-inside space-y-2 text-gray-700">
            <li>
              ÙŠØ­Ù‚ Ù„Ù„Ù…Ù†ØµØ© ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ· Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© Ø¨Ù…Ø§ ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©.
            </li>
            <li>ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø£ÙŠ ØªØ­Ø¯ÙŠØ«Ø§Øª.</li>
          </ul>
        </section>

        {/* 10. Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© */}
        <section className="mb-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-3 border-r-4 border-sky-500 pr-3">
            10. Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
          </h2>
          <p className="bg-sky-50 border border-sky-200 rounded-lg p-4 text-gray-800">
            Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ØŒ ÙØ¥Ù†Ùƒ ØªÙ‚Ø± Ø¨Ù‚Ø±Ø§Ø¡Ø© ÙˆÙÙ‡Ù… ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ·
            ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… Ø£Ø¹Ù„Ø§Ù‡.
          </p>
        </section>

        {/* Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© */}
        <div className="border-t-2 border-gray-200 pt-6 mt-8">
          <h1 className="text-2xl font-bold text-sky-600 mb-6 text-center">
            Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©
          </h1>

          <ul className="list-disc list-inside space-y-3 text-gray-700">
            <li>ØªØ­ØªØ±Ù… Ù…Ù†ØµØ© Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª Ø®ØµÙˆØµÙŠØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.</li>
            <li>
              ÙŠØªÙ… Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø· Ù„ØºØ±Ø¶:
              <ul className="list-disc list-inside mr-6 mt-2 space-y-1">
                <li>ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</li>
                <li>ØªÙ†ÙÙŠØ° Ø§Ù„Ø·Ù„Ø¨Ø§Øª</li>
                <li>Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</li>
                <li>ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø©</li>
              </ul>
            </li>
            <li>
              Ù„Ø§ ÙŠØªÙ… Ù…Ø´Ø§Ø±ÙƒØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø¹ Ø£ÙŠ Ø·Ø±Ù Ø«Ø§Ù„Ø« Ø¥Ù„Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø±ÙˆØ±Ø©
              Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø© Ø£Ùˆ ÙˆÙÙ‚ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø¹Ù…ÙˆÙ„ Ø¨Ù‡Ø§.
            </li>
            <li>
              ØªØ­ØªÙØ¸ Ø§Ù„Ù…Ù†ØµØ© Ø¨Ø­Ù‚ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª ÙˆØ§Ù„ØªÙØ§Ø¹Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
              Ù„Ø£ØºØ±Ø§Ø¶ ØªØ´ØºÙŠÙ„ÙŠØ© ÙˆØªØ­Ù„ÙŠÙ„ÙŠØ© ÙˆØªØ­Ø³ÙŠÙ†ÙŠØ©.
            </li>
          </ul>
        </div>

        {/* Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© */}
        <div className="bg-green-50 border border-green-300 rounded-lg p-4 mt-8 text-center">
          <p className="text-green-800 font-medium">
            â˜‘ï¸ Ø¨Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©ØŒ Ø£Ù†Øª ØªÙ‚Ø± Ø¨Ù‚Ø±Ø§Ø¡Ø© ÙˆÙÙ‡Ù… Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… ÙˆØ³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©
          </p>
        </div>

        <p className="mt-6 text-sm text-gray-500 text-center">
          ØªÙ… Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ· Ø¨ØªØ§Ø±ÙŠØ® {new Date().toLocaleDateString("ar-SA")}
        </p>

        <div className="mt-8 flex flex-col sm:flex-row gap-3 justify-center">
          <Link
            to="/register"
            className="text-white bg-sky-500 hover:bg-sky-600 px-6 py-3 rounded-lg inline-block transition-colors text-center font-bold"
          >
            âœ… Ù…ÙˆØ§ÙÙ‚ - Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ³Ø¬ÙŠÙ„
          </Link>
          <Link
            to="/"
            className="text-sky-600 bg-sky-100 hover:bg-sky-200 px-6 py-3 rounded-lg inline-block transition-colors text-center"
          >
            Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </Link>
        </div>
      </div>
    </div>
  );
}

==========================================================================================
FILE: src/pages/TrackOrders.tsx
==========================================================================================
// src/pages/TrackOrders.tsx
import React, { useEffect, useState } from 'react'
import { collection, getDocs, onSnapshot, orderBy, query, where, limit, doc, getDoc } from 'firebase/firestore'
import { db } from '@/firebase'
import { useAuth } from '@/auth'
import { Order } from '@/types'
import { useNavigate } from 'react-router-dom'
import { MessageCircle, Package, MapPin, Truck, CheckCircle, Clock, ChefHat, XCircle, Store, CreditCard, Building2, Copy, X } from 'lucide-react'
import { useToast } from '@/components/ui/Toast'

export const TrackOrders: React.FC = () => {
  const { user } = useAuth()
  const nav = useNavigate()
  const toast = useToast()
  const [err, setErr] = useState<string | null>(null)
  const [orders, setOrders] = useState<Order[]>([])
  const [diag, setDiag] = useState<{ uid: string; fallbackCount: number; sample: any[] } | null>(null)
  
  // Ø­Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ
  const [showPaymentModal, setShowPaymentModal] = useState<string | null>(null) // orderId
  const [bankInfo, setBankInfo] = useState<{ bankName?: string; bankAccountName?: string; bankAccountNumber?: string } | null>(null)
  const [loadingBank, setLoadingBank] = useState(false)

  // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ Ù„Ù„Ù…Ø·Ø¹Ù… Ù…Ù† subcollection Ø§Ù„Ù…Ø­Ù…ÙŠ
  const fetchBankInfo = async (restaurantId: string, orderId: string) => {
    setLoadingBank(true)
    setShowPaymentModal(orderId)
    try {
      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ù…Ù† subcollection Ø§Ù„Ù…Ø­Ù…ÙŠ Ø£ÙˆÙ„Ø§Ù‹
      const bankSnap = await getDoc(doc(db, 'restaurants', restaurantId, 'private', 'bankInfo'))
      if (bankSnap.exists()) {
        const data = bankSnap.data() as any
        setBankInfo({
          bankName: data.bankName || '',
          bankAccountName: data.bankAccountName || '',
          bankAccountNumber: data.bankAccountNumber || '',
        })
      } else {
        // fallback Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙÙŠ document Ø§Ù„Ù…Ø·Ø¹Ù… (Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©)
        const rSnap = await getDoc(doc(db, 'restaurants', restaurantId))
        if (rSnap.exists()) {
          const data = rSnap.data() as any
          setBankInfo({
            bankName: data.bankName || '',
            bankAccountName: data.bankAccountName || '',
            bankAccountNumber: data.bankAccountNumber || '',
          })
        } else {
          setBankInfo(null)
        }
      }
    } catch (e) {
      toast.error('ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹')
      setBankInfo(null)
    } finally {
      setLoadingBank(false)
    }
  }

  // Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨
  const copyToClipboard = (text: string) => {
    navigator.clipboard.writeText(text)
    toast.success('ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨! ğŸ“‹')
  }

  useEffect(() => {
    if (!user) return
    setErr(null)
    setDiag(null)

    // Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: customerId + orderBy(createdAt)
    const q1 = query(
      collection(db, 'orders'),
      where('customerId', '==', user.uid),
      orderBy('createdAt', 'desc')
    )

    // Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.. Ù„Ùˆ ØµØ§Ø± Ø®Ø·Ø£ ÙÙ‡Ø±Ø³ØŒ Ù†Ø·ÙŠØ­ Ø¹Ù„Ù‰ ÙÙˆÙ„Ø¨Ù‘Ø§Ùƒ
    const unsub = onSnapshot(
      q1,
      snap => {
        setOrders(snap.docs.map(d => ({ id: d.id, ...d.data() } as Order)))
        setErr(null)
      },
      async (e) => {
        console.error('TrackOrders onSnapshot error:', e)
        setErr('âš ï¸ Ø§Ø­ØªÙ…Ø§Ù„ ØªØ­ØªØ§Ø¬ Composite Index Ù„Ù€ customerId + createdAt. Ø¨Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¯ÙˆÙ† ØªØ±ØªÙŠØ¨ Ù…Ø¤Ù‚ØªÙ‹Ø§.')

        // ÙÙˆÙ„Ø¨Ù‘Ø§Ùƒ Ø¨Ø¯ÙˆÙ† orderBy (Ù…Ø§ ÙŠØ­ØªØ§Ø¬ ÙÙ‡Ø±Ø³ Ù…Ø±ÙƒØ¨)
        const q2 = query(
          collection(db, 'orders'),
          where('customerId', '==', user.uid)
        )
        const s2 = await getDocs(q2)
        const list = s2.docs.map(d => ({ id: d.id, ...d.data() } as Order))

        // ØªØ´Ø®ÙŠØµ Ø³Ø±ÙŠØ¹: Ù†Ø¹Ø±Ø¶ Ø¹ÙŠÙ†Ø© Ù…Ù† Ø£Ø­Ø¯Ø« 5 Ø·Ù„Ø¨Ø§Øª Ø¹Ø§Ù…Ø©
        const q3 = query(collection(db, 'orders'), orderBy('createdAt', 'desc'), limit(5))
        let sample: any[] = []
        try {
          const s3 = await getDocs(q3)
          sample = s3.docs.map(d => {
            const data = d.data() as any
            return {
              id: d.id,
              customerId: data.customerId,
              restaurantId: data.restaurantId,
              createdAt: data.createdAt?.toDate?.()?.toISOString?.() ?? null,
            }
          })
        } catch {}

        setDiag({
          uid: user.uid,
          fallbackCount: list.length,
          sample,
        })
        setOrders(list)
      }
    )

    return () => unsub()
  }, [user])

  const badge = (s: string) => {
    const map: Record<string, { text: string; emoji: string; color: string; icon: any }> = {
      pending: { text: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', emoji: 'â³', color: 'bg-yellow-500', icon: Clock },
      accepted: { text: 'ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„', emoji: 'âœ…', color: 'bg-blue-500', icon: CheckCircle },
      preparing: { text: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±', emoji: 'ğŸ‘¨â€ğŸ³', color: 'bg-orange-500', icon: ChefHat },
      ready: { text: 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ³Ù„ÙŠÙ…', emoji: 'ğŸ“¦', color: 'bg-purple-500', icon: Package },
      out_for_delivery: { text: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚', emoji: 'ğŸš—', color: 'bg-sky-500', icon: Truck },
      delivered: { text: 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…', emoji: 'ğŸ‰', color: 'bg-green-500', icon: CheckCircle },
      cancelled: { text: 'Ù…Ù„ØºÙŠ', emoji: 'âŒ', color: 'bg-red-500', icon: XCircle },
    }
    return map[s] || { text: s, emoji: 'ğŸ“¦', color: 'bg-gray-500', icon: Package }
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ù„Ø¨ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
  // 1. Ù…Ø¹ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ ÙˆÙŠÙˆØ¬Ø¯ Ù…Ù†Ø¯ÙˆØ¨
  // 2. Ù…Ø¹ Ø§Ù„Ù…Ø·Ø¹Ù…: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø£Ùˆ Ø¬Ø§Ù‡Ø² ÙˆÙ„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø¯ÙˆØ¨
  const canChatWithCourier = (order: Order) => {
    return order.courierId && order.status === 'out_for_delivery'
  }
  
  const canChatWithRestaurant = (order: Order) => {
    const activeStatuses = ['pending', 'accepted', 'preparing', 'ready']
    return !order.courierId && order.restaurantId && activeStatuses.includes(order.status)
  }
  
  const canChat = (order: Order) => {
    return canChatWithCourier(order) || canChatWithRestaurant(order)
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ù„Ø¨ ÙŠØ­ØªØ§Ø¬ Ø¯ÙØ¹ (pending Ø£Ùˆ accepted)
  const needsPayment = (order: Order) => {
    return ['pending', 'accepted'].includes(order.status)
  }

  return (
    <div className="space-y-3">
      <h1 className="text-xl font-bold">Ø·Ù„Ø¨Ø§ØªÙŠ</h1>

      {/* Ù†Ø§ÙØ°Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹ */}
      {showPaymentModal && (
        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onClick={() => setShowPaymentModal(null)}>
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden" onClick={e => e.stopPropagation()}>
            {/* Ø±Ø£Ø³ Ø§Ù„Ù†Ø§ÙØ°Ø© */}
            <div className="bg-gradient-to-r from-green-500 to-green-600 p-4 text-white">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <CreditCard className="w-6 h-6" />
                  <h2 className="text-lg font-bold">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹</h2>
                </div>
                <button onClick={() => setShowPaymentModal(null)} className="p-1 hover:bg-white/20 rounded-lg">
                  <X className="w-5 h-5" />
                </button>
              </div>
            </div>

            <div className="p-5">
              {loadingBank ? (
                <div className="text-center py-8">
                  <div className="w-10 h-10 border-3 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-3" />
                  <p className="text-gray-500">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                </div>
              ) : bankInfo && bankInfo.bankName && bankInfo.bankAccountNumber ? (
                <div className="space-y-4">
                  <p className="text-sm text-gray-600 bg-amber-50 p-3 rounded-xl">
                    ğŸ’° Ø­ÙˆÙ‘Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø§Ù„ØªØ§Ù„ÙŠ Ø«Ù… Ø£Ø¨Ù„Øº ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ø·Ø¹Ù…
                  </p>

                  {/* Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ */}
                  <div className="bg-gray-50 rounded-xl p-4 space-y-3">
                    <div className="flex items-center gap-3">
                      <Building2 className="w-5 h-5 text-green-600" />
                      <div>
                        <p className="text-xs text-gray-500">Ø§Ù„Ø¨Ù†Ùƒ</p>
                        <p className="font-bold text-gray-800">{bankInfo.bankName}</p>
                      </div>
                    </div>

                    <div className="border-t pt-3">
                      <p className="text-xs text-gray-500">Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨</p>
                      <p className="font-bold text-gray-800">{bankInfo.bankAccountName}</p>
                    </div>

                    <div className="border-t pt-3">
                      <p className="text-xs text-gray-500">Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù† / Ø§Ù„Ø­Ø³Ø§Ø¨</p>
                      <div className="flex items-center gap-2">
                        <p className="font-mono font-bold text-gray-800 flex-1 text-left" dir="ltr">
                          {bankInfo.bankAccountNumber}
                        </p>
                        <button
                          onClick={() => copyToClipboard(bankInfo.bankAccountNumber || '')}
                          className="p-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition"
                        >
                          <Copy className="w-4 h-4" />
                        </button>
                      </div>
                    </div>
                  </div>

                  {/* Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ */}
                  {orders.find(o => o.id === showPaymentModal) && (
                    <div className="bg-green-50 border-2 border-green-200 rounded-xl p-4 text-center">
                      <p className="text-sm text-green-600 mb-1">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØªØ­ÙˆÙŠÙ„Ù‡</p>
                      <p className="text-3xl font-black text-green-700">
                        {orders.find(o => o.id === showPaymentModal)?.total?.toFixed(2)} Ø±.Ø³
                      </p>
                    </div>
                  )}

                  <p className="text-xs text-gray-500 text-center">
                    âš ï¸ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø·Ø¹Ù… Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹
                  </p>
                </div>
              ) : (
                <div className="text-center py-8">
                  <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <Building2 className="w-8 h-8 text-gray-400" />
                  </div>
                  <p className="text-gray-600 font-semibold mb-2">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</p>
                  <p className="text-sm text-gray-500">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø·Ø¹Ù… Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù…Ø¹Ø±ÙØ© Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</p>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {err && (
        <div className="text-xs bg-yellow-50 text-yellow-800 border border-yellow-200 rounded-xl p-3">
          {err}
          {diag && (
            <div className="mt-1">
              <div>UID: <b>{diag.uid}</b></div>
              <div>Ø¹Ø¯Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙÙˆÙ„Ø¨Ù‘Ø§Ùƒ: <b>{diag.fallbackCount}</b></div>
              {Array.isArray(diag.sample) && diag.sample.length > 0 && (
                <div className="mt-1">
                  <div className="font-semibold">Ø¹ÙŠÙ†Ø© (Ø£Ø­Ø¯Ø« 5):</div>
                  {diag.sample.map((x) => (
                    <div key={x.id} className="truncate">
                      #{x.id} â€¢ customerId: {String(x.customerId)} â€¢ restaurantId: {String(x.restaurantId)} â€¢ createdAt: {x.createdAt || 'â€”'}
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
        </div>
      )}

      {orders.map((o) => (
        <div key={o.id} className="bg-white rounded-2xl shadow-card overflow-hidden hover:shadow-lg transition-shadow">
          {/* Ø±Ø£Ø³ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© */}
          <div className={`${badge(o.status).color} px-4 py-3 flex items-center justify-between`}>
            <div className="flex items-center gap-2 text-white">
              <span className="text-xl">{badge(o.status).emoji}</span>
              <span className="font-bold">{badge(o.status).text}</span>
            </div>
            <div className="text-white/80 text-sm font-medium">
              #{o.id.slice(-6)}
            </div>
          </div>

          <div className="p-4">
            {o.restaurantName && (
              <div className="flex items-center gap-2 text-primary font-semibold mb-2">
                <span>ğŸ½ï¸</span>
                <span>{String(o.restaurantName)}</span>
              </div>
            )}

            <div className="text-sm text-gray-700 bg-gray-50 rounded-xl p-3 mb-3">
              {o.items?.map((i) => `${i.name}Ã—${i.qty}`).join(' â€¢ ')}
            </div>

            {/* ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙˆØµÙŠÙ„ */}
            <div className="text-sm text-gray-600 space-y-2">
              {o.deliveryType === 'pickup' ? (
                <div className="flex items-center gap-2 text-green-600 font-medium bg-green-50 rounded-xl p-3">
                  <MapPin className="w-4 h-4" />
                  <span>Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…</span>
                </div>
              ) : (
                <div className="space-y-1 bg-gray-50 rounded-xl p-3">
                  <div className="flex justify-between">
                    <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</span>
                    <span>{o.subtotal?.toFixed?.(2) || 'â€”'} Ø±.Ø³</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
                    {o.deliveryFee !== undefined && o.deliveryFee > 0 ? (
                      <span className="font-medium">{o.deliveryFee?.toFixed?.(2)} Ø±.Ø³</span>
                    ) : (
                      <span className="text-amber-600">Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø·Ø¹Ù…</span>
                    )}
                  </div>
                </div>
              )}
            </div>

            <div className="mt-3 pt-3 border-t space-y-3">
              <div className="flex items-center justify-between">
                <div className="font-bold text-lg text-primary">
                  Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: {o.total?.toFixed?.(2)} Ø±.Ø³
                </div>
              </div>

              {/* Ø²Ø± Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ - ÙŠØ¸Ù‡Ø± Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */}
              {needsPayment(o) && o.restaurantId && (
                <button
                  onClick={() => fetchBankInfo(o.restaurantId!, o.id)}
                  className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-green-500 to-green-600 
                             text-white rounded-xl font-bold shadow-lg hover:shadow-xl 
                             hover:scale-[1.02] transition-all duration-200"
                >
                  <CreditCard className="w-5 h-5" />
                  <span>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ ğŸ’³</span>
                </button>
              )}

              <div className="flex gap-2">
                {/* Ø²Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ */}
                {canChatWithCourier(o) && (
                  <button
                    onClick={() => nav(`/chat?orderId=${o.id}`)}
                    className="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-primary to-accent 
                               text-white rounded-full font-medium shadow-lg hover:shadow-xl 
                               hover:scale-105 transition-all duration-200 animate-pulse"
                  >
                    <MessageCircle className="w-5 h-5" />
                    <span>ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ğŸš—</span>
                  </button>
                )}
                
                {/* Ø²Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ù…Ø·Ø¹Ù… (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ù†Ø¯ÙˆØ¨) */}
                {canChatWithRestaurant(o) && (
                  <button
                    onClick={() => nav(`/chat?orderId=${o.id}`)}
                    className="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-500 to-amber-500 
                               text-white rounded-full font-medium shadow-lg hover:shadow-xl 
                               hover:scale-105 transition-all duration-200"
                  >
                    <Store className="w-5 h-5" />
                    <span>ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø·Ø¹Ù… ğŸ½ï¸</span>
                  </button>
                )}
              </div>
            </div>
          </div>
        </div>
      ))}

      {orders.length === 0 && !err && (
        <div className="text-gray-600">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>
      )}
    </div>
  )
}

==========================================================================================
FILE: src/routes/ProtectedRoute.tsx
==========================================================================================
import React from 'react'
import { Navigate } from 'react-router-dom'
import { useAuth } from '@/auth'

export const ProtectedRoute: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const { user, loading } = useAuth()
  if (loading) return <div className="p-8 text-center">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  if (!user) return <Navigate to="/login" replace />
  return <>{children}</>
}

==========================================================================================
FILE: src/routes/RoleGate.tsx
==========================================================================================
// src/routes/RoleGate.tsx
import React from 'react'
import { Navigate } from 'react-router-dom'
import { useAuth } from '@/auth'

// ÙˆØ­Ù‘Ø¯ Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙˆØ± Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
export type Role = 'owner' | 'courier' | 'customer' | 'admin' | 'developer'

type Props = {
  allow: Role[]
  children: React.ReactNode
}

export const RoleGate: React.FC<Props> = ({ allow, children }) => {
  const { role, loading } = useAuth()

  if (loading) {
    return <div className="p-8 text-center">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  }

  if (!role || !allow.includes(role)) {
    return <Navigate to="/" replace />
  }

  return <>{children}</>
}

export default RoleGate

==========================================================================================
FILE: src/types/index.ts
==========================================================================================
/**
 * Type definitions for the Broast Al-Qaryah application
 * Centralized types to avoid redundant definitions and ensure consistency
 */

/**
 * Menu Item - Product sold by a restaurant
 */
export interface MenuItem {
  id: string;
  name: string;
  desc?: string;
  price: number;
  imageUrl?: string;
  available: boolean;
  categoryId?: string;
  ownerId: string; // Links to restaurants/{ownerId}
  // Ù†Ø¸Ø§Ù… Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª
  discountPercent?: number; // Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… (Ù…Ø«Ø§Ù„: 20 ØªØ¹Ù†ÙŠ 20%)
  discountExpiresAt?: Date | any; // ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø®ØµÙ…
  createdAt?: Date;
  updatedAt?: Date;
}

/**
 * Restaurant - Owner's restaurant profile
 */
export interface Restaurant {
  id: string; // doc ID = ownerId
  name: string;
  ownerId: string;
  email?: string;
  phone?: string;
  city?: string;
  location?: string; // Address or description
  logoUrl?: string;
  // Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªØ¬Ø±
  isOpen?: boolean; // Ù‡Ù„ Ø§Ù„Ù…ØªØ¬Ø± Ù…ÙØªÙˆØ­ Ù„Ù„Ø·Ù„Ø¨Ø§ØªØŸ (true = Ù…ØªØ§Ø­ØŒ false = Ù…ØºÙ„Ù‚)
  // Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù…
  allowDelivery?: boolean; // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡
  allowPickup?: boolean; // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø·Ø¹Ù…
  // Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ
  commercialLicenseUrl?: string; // ØµÙˆØ±Ø© Ø§Ù„Ø±Ø®ØµØ© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© / Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ
  licenseStatus?: 'pending' | 'approved' | 'rejected'; // Ø­Ø§Ù„Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ
  licenseNotes?: string; // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
  referredBy?: string; // UID Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø°ÙŠ Ø£Ø¶Ø§Ù Ø§Ù„Ù…Ø·Ø¹Ù… (admin) - Ø¥Ø°Ø§ ÙƒØ§Ù† ÙØ§Ø±Øº = Ù…Ø³Ø¬Ù„ Ù…Ù† Ø§Ù„Ù…Ø·ÙˆØ±
  referrerType?: 'admin' | 'developer'; // Ù†ÙˆØ¹ Ù…Ù† Ø£Ø¶Ø§Ù Ø§Ù„Ù…Ø·Ø¹Ù…
  // Ø¨Ø§Ù‚Ø§Øª Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª
  packageType?: 'free' | 'premium'; // Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  packageRequest?: 'premium'; // Ø·Ù„Ø¨ ØªØ±Ù‚ÙŠØ© Ù„Ù„Ø¨Ø§Ù‚Ø©
  packageRequestedAt?: Date; // ØªØ§Ø±ÙŠØ® Ø·Ù„Ø¨ Ø§Ù„ØªØ±Ù‚ÙŠØ©
  packageSubscribedAt?: Date; // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
  packageExpiresAt?: Date; // ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
  // Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ÙˆØ§Ù„ØªØµÙ†ÙŠÙ
  isVerified?: boolean; // Ù‡Ù„ Ø§Ù„Ø£Ø³Ø±Ø© Ù…ÙˆØ«Ù‚Ø©ØŸ
  verifiedAt?: Date; // ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙˆØ«ÙŠÙ‚
  sellerTier?: 'bronze' | 'silver' | 'gold'; // ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨Ø§Ø¦Ø¹
  tierUpdatedAt?: Date; // ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù„ØªØµÙ†ÙŠÙ
  // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„Ù„ØªØµÙ†ÙŠÙ
  totalOrders?: number; // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  averageRating?: number; // Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
  onTimeDeliveryRate?: number; // Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ÙˆÙ‚Øª
  complaintsCount?: number; // Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰
  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„
  bankName?: string; // Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ
  bankAccountName?: string; // Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨
  bankAccountNumber?: string; // Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù† Ø£Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨
  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØ¸ÙŠÙ
  isHiring?: boolean; // Ù‡Ù„ Ø§Ù„Ø£Ø³Ø±Ø© ØªØ¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸ÙØ§ØªØŸ
  hiringDescription?: string; // ÙˆØµÙ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
  hiringContact?: string; // Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù„Ù„ØªÙˆØ¸ÙŠÙ
  createdAt?: Date;
  updatedAt?: Date;
}

/**
 * Seller Tier Levels
 * Bronze: Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)
 * Silver: Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ (ØªÙ‚ÙŠÙŠÙ… 4+ØŒ Ø§Ù„ØªØ²Ø§Ù… 85%+ØŒ Ø´ÙƒØ§ÙˆÙ‰ Ø£Ù‚Ù„ Ù…Ù† 5)
 * Gold: Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø² (ØªÙ‚ÙŠÙŠÙ… 4.5+ØŒ Ø§Ù„ØªØ²Ø§Ù… 95%+ØŒ Ø´ÙƒØ§ÙˆÙ‰ Ø£Ù‚Ù„ Ù…Ù† 2)
 */
export type SellerTier = 'bronze' | 'silver' | 'gold';

/**
 * Order - Customer purchase record
 */
export interface Order {
  id: string;
  customerId: string; // Links to users/{customerId}
  items: OrderItem[];
  subtotal: number;
  deliveryFee: number; // Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ (ÙŠØ­Ø¯Ø¯Ù‡Ø§ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£Ùˆ Ø§Ù„Ø£Ø³Ø±Ø©)
  deliveryFeeSetBy?: 'owner' | 'courier'; // Ù…Ù† Ø­Ø¯Ø¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„
  deliveryFeeSetAt?: Date; // Ù…ØªÙ‰ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„
  total: number;
  status: OrderStatus;
  address: string;
  deliveryType?: 'delivery' | 'pickup'; // Ù†ÙˆØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ…: ØªÙˆØµÙŠÙ„ Ø£Ùˆ Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…
  courierId?: string; // Links to users/{courierId} if assigned
  notes?: string;
  restaurantName?: string; // Denormalized for display convenience
  restaurantId?: string; // Links to restaurants/{id}
  // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª ÙˆØ§Ù„Ø±Ø³ÙˆÙ…
  platformFee?: number; // Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø«Ø§Ø¨ØªØ© (3.75 Ø±ÙŠØ§Ù„ Ù„ÙƒÙ„ Ø·Ù„Ø¨) - Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
  adminCommission?: number; // Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø´Ø±Ù (0.5 Ø±ÙŠØ§Ù„ Ø¥Ø°Ø§ Ø§Ù„Ù…Ø·Ø¹Ù… Ù…Ø³Ø¬Ù„ Ø¹Ù† Ø·Ø±ÙŠÙ‚Ù‡)
  courierPlatformFee?: number; // Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…Ø®ØµÙˆÙ…Ø© Ù…Ù† Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ (3.75 Ø±ÙŠØ§Ù„)
  referredBy?: string; // UID Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø°ÙŠ Ø£Ø¶Ø§Ù Ø§Ù„Ù…Ø·Ø¹Ù…
  createdAt?: Date;
  updatedAt?: Date;
}

/**
 * Order Item - Line item in an order
 */
export interface OrderItem {
  id: string; // menuItems/{id}
  name: string;
  price: number;
  qty: number;
  ownerId?: string; // Restaurant ID for multi-restaurant support
}

/**
 * Order Status - Lifecycle states of an order
 */
export type OrderStatus = 
  | 'pending'           // Just created, awaiting owner acceptance
  | 'accepted'          // Owner accepted the order
  | 'preparing'         // Kitchen is preparing
  | 'ready'             // Ready for pickup/delivery
  | 'out_for_delivery'  // Courier is delivering
  | 'delivered'         // Successfully delivered
  | 'cancelled';        // Order cancelled

/**
 * User - Application user record
 */
export interface User {
  uid: string;
  email: string;
  name?: string;
  phone?: string;
  city?: string;
  address?: string;
  role: UserRole;
  // Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ù„Ù„ØªÙˆØµÙŠÙ„
  savedLocation?: {
    lat: number;
    lng: number;
    address: string;
  };
  createdAt?: Date;
  updatedAt?: Date;
}

/**
 * User Role - Authorization levels in the app
 */
export type UserRole = 'customer' | 'courier' | 'owner' | 'admin' | 'developer';

/**
 * Admin Role (Ø§Ù„Ù…Ø´Ø±Ù):
 * - Ø¥Ø¶Ø§ÙØ©/Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
 * - Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ù…Ø¶Ø§ÙØ© (Ø¨Ø¯ÙˆÙ† ØªØ¹Ø¯ÙŠÙ„)
 * - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙˆØ§Ù„Ù…ÙƒØ§ÙØ¢Øª
 * - ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ø·Ù„Ø¨ ÙƒØ¹Ù…ÙŠÙ„
 */

/**
 * Developer Role (Ø§Ù„Ù…Ø·ÙˆØ±):
 * - Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©
 * - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ø¥Ø¶Ø§ÙØ©/Ø­Ø°Ù)
 * - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù… (Ø¥Ø¶Ø§ÙØ©/Ø­Ø°Ù/ØªØ¹Ø¯ÙŠÙ„)
 * - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
 * - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
 */

/**
 * Settings - Global app configuration
 */
export interface AppSettings {
  deliveryFee?: number;
  minOrderAmount?: number;
  operatingHours?: {
    open: string;
    close: string;
  };
  platformFee?: number; // Ø±Ø³ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«Ø§Ø¨ØªØ© (1.5 Ø±ÙŠØ§Ù„)
  adminCommissionRate?: number; // Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø´Ø±Ù (0.5 Ø±ÙŠØ§Ù„)
  [key: string]: any;
}

/**
 * Wallet - Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø´Ø±Ù Ø£Ùˆ Ø§Ù„Ù…Ø·ÙˆØ±
 */
export interface Wallet {
  id: string; // = user UID
  balance: number; // Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
  totalEarnings: number; // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
  totalWithdrawn: number; // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø­ÙˆØ¨
  transactions: WalletTransaction[];
  updatedAt?: Date;
}

/**
 * WalletTransaction - Ù…Ø¹Ø§Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ù…Ø­ÙØ¸Ø©
 */
export interface WalletTransaction {
  id: string;
  type: 'credit' | 'debit'; // Ø¥ÙŠØ¯Ø§Ø¹ Ø£Ùˆ Ø³Ø­Ø¨
  amount: number;
  description: string;
  orderId?: string; // Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø±ØªØ¨Ø·
  restaurantId?: string;
  createdAt: Date;
}

/**
 * Promotion - Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù…Ù…ÙˆÙ„ Ù„Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø© (Ø­Ø§Ù„Ø©/Ø³ØªÙˆØ±ÙŠ)
 */
export interface Promotion {
  id: string;
  ownerId: string; // ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø³Ø±Ø©
  restaurantId: string; // Ø§Ù„Ù…Ø·Ø¹Ù…/Ø§Ù„Ø£Ø³Ø±Ø©
  type: 'text' | 'image' | 'video'; // Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
  title?: string; // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
  description?: string; // Ø§Ù„ÙˆØµÙ Ø£Ùˆ Ø§Ù„Ø´Ø±Ø­
  mediaUrl?: string; // Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø£Ùˆ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
  isActive: boolean; // Ù‡Ù„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù†Ø´Ø·ØŸ
  isPaid: boolean; // Ù‡Ù„ ØªÙ… Ø§Ù„Ø¯ÙØ¹ØŸ
  price: number; // Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
  duration: number; // Ù…Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª (24 Ø³Ø§Ø¹Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠ)
  viewsCount: number; // Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª
  expiresAt?: Date; // ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
  createdAt?: Date;
  updatedAt?: Date;
}

/**
 * PackageSubscriptionRequest - Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø¨Ø§Ù‚Ø© Ø§Ù„ØªÙ…ÙŠØ²
 */
export interface PackageSubscriptionRequest {
  id: string;
  restaurantId: string; // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø·Ø¹Ù…/Ø§Ù„Ø£Ø³Ø±Ø©
  restaurantName: string; // Ø§Ø³Ù… Ø§Ù„Ø£Ø³Ø±Ø©
  ownerName?: string; // Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø³Ø±Ø©
  ownerPhone?: string; // Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
  status: PackageRequestStatus;
  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹
  bankAccountImageUrl?: string; // ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ù…Ù† Ø§Ù„Ù…Ø·ÙˆØ±
  paymentProofImageUrl?: string; // ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù† Ø§Ù„Ø£Ø³Ø±Ø©
  subscriptionAmount: number; // Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
  subscriptionDuration: number; // Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø§Ù„Ø£ÙŠØ§Ù… (30 ÙŠÙˆÙ… Ù…Ø«Ù„Ø§Ù‹)
  // Ù…Ù„Ø§Ø­Ø¸Ø§Øª
  developerNotes?: string; // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ±
  ownerNotes?: string; // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø£Ø³Ø±Ø©
  // ØªÙˆØ§Ø±ÙŠØ®
  requestedAt?: Date;
  bankSentAt?: Date; // ØªØ§Ø±ÙŠØ® Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ù†Ùƒ
  paymentSentAt?: Date; // ØªØ§Ø±ÙŠØ® Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„
  approvedAt?: Date;
  rejectedAt?: Date;
  expiresAt?: Date; // ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
  createdAt?: Date;
  updatedAt?: Date;
}

/**
 * Ø­Ø§Ù„Ø§Øª Ø·Ù„Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø§Ù‚Ø©
 */
export type PackageRequestStatus = 
  | 'pending'           // Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø·ÙˆØ±
  | 'bank_sent'         // Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ø±Ø³Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ
  | 'payment_sent'      // Ø§Ù„Ø£Ø³Ø±Ø© Ø£Ø±Ø³Ù„Øª Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„
  | 'approved'          // ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø©
  | 'rejected'          // Ù…Ø±ÙÙˆØ¶
  | 'expired';          // Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©

/**
 * RestaurantStats - Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø·Ø¹Ù…/Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø©
 */
export interface RestaurantStats {
  id: string; // = restaurant ID
  // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
  totalProfileViews: number; // Ø¹Ø¯Ø¯ Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ
  totalMenuViews: number; // Ø¹Ø¯Ø¯ Ù…Ø´Ø§Ù‡Ø¯Ø§Øª ØµÙØ­Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
  totalItemViews: number; // Ø¹Ø¯Ø¯ Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„Ø£ØµÙ†Ø§Ù
  // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
  totalShareClicks: number; // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
  whatsappShareCount: number; // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
  // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„
  registeredCustomers: number; // Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø³Ø±Ø©
  appDownloads: number; // Ø¹Ø¯Ø¯ ØªØ­Ù…ÙŠÙ„Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø³Ø±Ø©
  followersCount: number; // Ø¹Ø¯Ø¯ Ù…ØªØ§Ø¨Ø¹ÙŠ Ø§Ù„Ù…ØªØ¬Ø±
  // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
  dailyViews: Record<string, number>; // Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© { "2024-01-22": 50 }
  // Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
  updatedAt?: Date;
}

/**
 * VisitLog - Ø³Ø¬Ù„ Ø²ÙŠØ§Ø±Ø© Ù„ØªØªØ¨Ø¹ Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
 */
export interface VisitLog {
  id: string;
  restaurantId: string; // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø·Ø¹Ù…
  visitorId?: string; // Ù…Ø¹Ø±Ù Ø§Ù„Ø²Ø§Ø¦Ø± (Ø¥Ø°Ø§ Ù…Ø³Ø¬Ù„)
  visitorType: 'anonymous' | 'customer' | 'registered_via_link';
  source: 'direct' | 'whatsapp_share' | 'social_share' | 'referral';
  page: 'menu' | 'profile' | 'item';
  itemId?: string; // Ù…Ø¹Ø±Ù Ø§Ù„ØµÙ†Ù (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø²ÙŠØ§Ø±Ø© ØµÙ†Ù)
  referralCode?: string; // ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
  createdAt?: Date;
}

/**
 * CustomerRegistration - ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…ÙŠÙ„ Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø³Ø±Ø©
 */
export interface CustomerRegistration {
  id: string;
  customerId: string; // Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù…ÙŠÙ„
  restaurantId: string; // Ù…Ø¹Ø±Ù Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„ØªÙŠ Ø³Ø¬Ù„ Ø¹Ø¨Ø±Ù‡Ø§
  registrationType: 'website' | 'app';
  referralCode?: string;
  createdAt?: Date;
}

/**
 * StoreFollower - Ù…ØªØ§Ø¨Ø¹ Ù„Ù„Ù…ØªØ¬Ø±
 */
export interface StoreFollower {
  id: string;
  followerId: string; // Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹
  followerName?: string; // Ø§Ø³Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹
  restaurantId: string; // Ù…Ø¹Ø±Ù Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ØªØ§Ø¨ÙØ¹
  createdAt?: Date;
}

==========================================================================================
FILE: src/utils/cities.ts
==========================================================================================
// src/utils/cities.ts
// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

export const SAUDI_CITIES = [
  'Ø§Ù„Ø±ÙŠØ§Ø¶',
  'Ø¬Ø¯Ø©',
  'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©',
  'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©',
  'Ø§Ù„Ø¯Ù…Ø§Ù…',
  'Ø§Ù„Ø®Ø¨Ø±',
  'Ø§Ù„Ø¸Ù‡Ø±Ø§Ù†',
  'Ø§Ù„Ø£Ø­Ø³Ø§Ø¡',
  'Ø§Ù„Ù‚Ø·ÙŠÙ',
  'Ø§Ù„Ø·Ø§Ø¦Ù',
  'ØªØ¨ÙˆÙƒ',
  'Ø¨Ø±ÙŠØ¯Ø©',
  'Ø¹Ù†ÙŠØ²Ø©',
  'Ø­Ø§Ø¦Ù„',
  'Ø®Ù…ÙŠØ³ Ù…Ø´ÙŠØ·',
  'Ø£Ø¨Ù‡Ø§',
  'Ù†Ø¬Ø±Ø§Ù†',
  'Ø¬Ø§Ø²Ø§Ù†',
  'ÙŠÙ†Ø¨Ø¹',
  'Ø§Ù„Ø¬Ø¨ÙŠÙ„',
  'Ø­ÙØ± Ø§Ù„Ø¨Ø§Ø·Ù†',
  'Ø§Ù„Ø®Ø±Ø¬',
  'Ø£Ù…Ù„Ø¬',
  'Ø§Ù„Ø¹Ù„Ø§',
  'Ø±Ø§Ø¨Øº',
  'Ø§Ù„Ù‚Ù†ÙØ°Ø©',
  'Ø¨ÙŠØ´Ø©',
  'ØµØ¨ÙŠØ§',
  'Ø§Ù„Ø¨Ø§Ø­Ø©',
  'Ø¹Ø±Ø¹Ø±',
  'Ø³ÙƒØ§ÙƒØ§',
  'Ø§Ù„Ø¯ÙˆØ§Ø¯Ù…ÙŠ',
  'Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©',
  'Ø§Ù„Ø²Ù„ÙÙŠ',
  'Ø´Ù‚Ø±Ø§Ø¡',
  'ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¯ÙˆØ§Ø³Ø±',
  'Ø±ÙØ­Ø§Ø¡',
  'Ø·Ø±ÙŠÙ',
  'Ø§Ù„Ù‚Ø±ÙŠØ§Øª',
  'Ø£Ø®Ø±Ù‰',
] as const

export type SaudiCity = typeof SAUDI_CITIES[number]

==========================================================================================
FILE: src/utils/config.ts
==========================================================================================
/**
 * App Configuration & Utilities
 * Centralized place for app-level settings and configuration
 */

import { db } from '@/firebase'
import { doc, getDoc } from 'firebase/firestore'
import { AppSettings } from '@/types'

const DEFAULT_DELIVERY_FEE = 7
const SETTINGS_DOC_ID = 'general'

/**
 * Get delivery fee from app settings, with fallback to default
 * Should be cached or called once during app initialization
 */
export async function getDeliveryFee(): Promise<number> {
  try {
    const snap = await getDoc(doc(db, 'settings', SETTINGS_DOC_ID))
    if (snap.exists()) {
      const data = snap.data() as AppSettings
      return data.deliveryFee ?? DEFAULT_DELIVERY_FEE
    }
  } catch (err) {
    console.warn('Failed to fetch delivery fee from settings:', err)
  }
  return DEFAULT_DELIVERY_FEE
}

/**
 * Get all app settings with fallbacks
 */
export async function getAppSettings(): Promise<AppSettings> {
  try {
    const snap = await getDoc(doc(db, 'settings', SETTINGS_DOC_ID))
    if (snap.exists()) {
      return snap.data() as AppSettings
    }
  } catch (err) {
    console.warn('Failed to fetch app settings:', err)
  }
  return {
    deliveryFee: DEFAULT_DELIVERY_FEE,
  }
}

==========================================================================================
FILE: src/utils/distance.ts
==========================================================================================
// src/utils/distance.ts
// Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ù†Ù‚Ø·ØªÙŠÙ† Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙŠØºØ© Haversine

export type GeoLocation = {
  lat: number
  lng: number
}

/**
 * Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ù†Ù‚Ø·ØªÙŠÙ† Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±
 * @param point1 Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
 * @param point2 Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
 * @returns Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±
 */
export function calculateDistance(point1: GeoLocation, point2: GeoLocation): number {
  const R = 6371 // Ù†ØµÙ Ù‚Ø·Ø± Ø§Ù„Ø£Ø±Ø¶ Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±
  
  const dLat = toRad(point2.lat - point1.lat)
  const dLng = toRad(point2.lng - point1.lng)
  
  const a = 
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(toRad(point1.lat)) * Math.cos(toRad(point2.lat)) *
    Math.sin(dLng / 2) * Math.sin(dLng / 2)
  
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))
  
  return R * c
}

function toRad(deg: number): number {
  return deg * (Math.PI / 180)
}

/**
 * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¶Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø­Ø¯Ø¯
 * @param point1 Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
 * @param point2 Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
 * @param maxDistance Ø£Ù‚ØµÙ‰ Ù…Ø³Ø§ÙØ© Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±
 * @returns true Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¶Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚
 */
export function isWithinDistance(point1: GeoLocation, point2: GeoLocation, maxDistance: number): boolean {
  return calculateDistance(point1, point2) <= maxDistance
}

// Ø£Ù‚ØµÙ‰ Ù…Ø³Ø§ÙØ© Ù„Ù„ØªÙˆØµÙŠÙ„ (15 ÙƒÙŠÙ„Ùˆ)
export const MAX_DELIVERY_DISTANCE = 15

==========================================================================================
FILE: storage.rules
==========================================================================================
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹ (Ø§Ù„ØµÙˆØ± Ø¹Ø§Ù…Ø©)
    match /{allPaths=**} {
      allow read: if true;
    }
    
    // ØµÙˆØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© - ÙŠÙ…ÙƒÙ† Ù„Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø±ÙØ¹Ù‡Ø§
    match /menuImages/{allImages} {
      allow write: if request.auth != null
                   && request.resource.size < 5 * 1024 * 1024  // 5MB max
                   && request.resource.contentType.matches('image/.*');
    }
    
    // ØµÙˆØ± Ø§Ù„Ù…Ø·Ø§Ø¹Ù… (Ø§Ù„Ø´Ø¹Ø§Ø±Ø§Øª) - ÙŠÙ…ÙƒÙ† Ù„Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø±ÙØ¹Ù‡Ø§
    match /restaurants/{ownerId}/{allImages} {
      allow write: if request.auth != null
                   && request.resource.size < 5 * 1024 * 1024  // 5MB max
                   && request.resource.contentType.matches('image/.*');
    }
    
    // ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… (ØµÙˆØ± Ø£Ùˆ PDF) - Ù…Ø³Ø§Ø± ÙØ±Ø¹ÙŠ licenses
    match /restaurants/{ownerId}/licenses/{fileName} {
      allow write: if request.auth != null
                   && request.resource.size < 5 * 1024 * 1024  // 5MB max
                   && (request.resource.contentType.matches('image/.*') 
                       || request.resource.contentType == 'application/pdf');
    }
    
    // Ù…Ø¬Ù„Ø¯ Ø¹Ø§Ù… Ù„Ù„ØµÙˆØ± (Ù„Ù„Ø£Ø¯Ù…Ù† ÙˆØ§Ù„Ù…Ø·ÙˆØ±)
    match /uploads/{allImages} {
      allow write: if request.auth != null
                   && request.resource.size < 5 * 1024 * 1024
                   && request.resource.contentType.matches('image/.*');
    }
    
    // Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø© (ØµÙˆØ± ÙˆÙÙŠØ¯ÙŠÙˆ)
    match /promotions/{fileName} {
      allow write: if request.auth != null
                   && request.resource.size < 50 * 1024 * 1024  // 50MB max Ù„Ù„ÙÙŠØ¯ÙŠÙˆ
                   && (request.resource.contentType.matches('image/.*') 
                       || request.resource.contentType.matches('video/.*'));
    }
    
    // ØµÙˆØ± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ© (Ù„Ù„Ù…Ø·ÙˆØ± ÙÙ‚Ø·)
    match /bankAccounts/{fileName} {
      allow write: if request.auth != null
                   && request.resource.size < 5 * 1024 * 1024  // 5MB max
                   && request.resource.contentType.matches('image/.*');
    }
    
    // Ø¥Ø«Ø¨Ø§ØªØ§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ (Ù„Ù„Ù…Ø·Ø§Ø¹Ù…)
    match /paymentProofs/{fileName} {
      allow write: if request.auth != null
                   && request.resource.size < 5 * 1024 * 1024  // 5MB max
                   && request.resource.contentType.matches('image/.*');
    }
  }
}

==========================================================================================
FILE: vite.config.ts
==========================================================================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
})
