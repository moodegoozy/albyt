import{u as P,b as S,j as e,d as n}from"./index-FuU3jBZc.js";import{b as T,r as x}from"./vendor-react-C_wfuX_s.js";import{q as _,F as D,w as $,m as E,n as R,u as b,k as m,p as B}from"./vendor-firebase-Co4MdP0H.js";import{ac as M,A as q,B as h,a9 as N,h as L,i as U,y as z,j as F,T as I,f as G,P as H}from"./vendor-icons-Dyg7S3Xx.js";const j={order_ready:{icon:e.jsx(H,{className:"w-5 h-5"}),bgColor:"bg-green-100",textColor:"text-green-600"},order_delivered:{icon:e.jsx(G,{className:"w-5 h-5"}),bgColor:"bg-emerald-100",textColor:"text-emerald-600"},order_accepted:{icon:e.jsx(N,{className:"w-5 h-5"}),bgColor:"bg-blue-100",textColor:"text-blue-600"},courier_assigned:{icon:e.jsx(I,{className:"w-5 h-5"}),bgColor:"bg-sky-100",textColor:"text-sky-600"},nearby_offer:{icon:e.jsx(F,{className:"w-5 h-5"}),bgColor:"bg-purple-100",textColor:"text-purple-600"},discount:{icon:e.jsx(z,{className:"w-5 h-5"}),bgColor:"bg-rose-100",textColor:"text-rose-600"},new_menu_item:{icon:e.jsx(U,{className:"w-5 h-5"}),bgColor:"bg-amber-100",textColor:"text-amber-600"},default:{icon:e.jsx(h,{className:"w-5 h-5"}),bgColor:"bg-gray-100",textColor:"text-gray-600"}},V=()=>{const{user:l}=P(),c=S(),g=T(),[i,w]=x.useState([]),[C,u]=x.useState(!0);x.useEffect(()=>{if(!l)return;const s=_(E(n,"notifications"),$("recipientId","==",l.uid),D("createdAt","desc")),t=R(s,a=>{const o=a.docs.map(r=>({id:r.id,...r.data()}));w(o),u(!1)},a=>{console.error("Error fetching notifications:",a),u(!1)});return()=>t()},[l]);const p=async s=>{try{await b(m(n,"notifications",s),{read:!0})}catch(t){console.error("Error marking as read:",t)}},k=async()=>{const s=i.filter(t=>!t.read);try{await Promise.all(s.map(t=>b(m(n,"notifications",t.id),{read:!0}))),c.success("تم تحديد الكل كمقروء")}catch{c.error("فشل تحديث الإشعارات")}},v=async s=>{try{await B(m(n,"notifications",s)),c.success("تم حذف الإشعار")}catch{c.error("فشل حذف الإشعار")}},A=s=>{if(!s)return"";const t=s.toDate(),o=new Date().getTime()-t.getTime(),r=Math.floor(o/6e4),f=Math.floor(o/36e5),y=Math.floor(o/864e5);return r<1?"الآن":r<60?`منذ ${r} دقيقة`:f<24?`منذ ${f} ساعة`:y<7?`منذ ${y} يوم`:t.toLocaleDateString("ar-SA")},d=i.filter(s=>!s.read).length;return C?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-sky-500"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white",children:[e.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>g(-1),className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[e.jsx(q,{className:"w-5 h-5"}),"رجوع"]}),e.jsxs("h1",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(h,{className:"w-6 h-6 text-sky-500"}),"الإشعارات",d>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:d})]}),d>0&&e.jsx("button",{onClick:k,className:"text-sm text-sky-600 hover:text-sky-800",children:"قراءة الكل"})]})})}),e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-6",children:i.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(h,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"لا توجد إشعارات"})]}):e.jsx("div",{className:"space-y-3",children:i.map(s=>{const t=j[s.type]||j.default;return e.jsx("div",{className:`bg-white rounded-2xl p-4 shadow-sm border transition hover:shadow-md cursor-pointer ${s.read?"border-gray-100":"border-sky-200 bg-sky-50/50"}`,onClick:()=>{s.read||p(s.id),s.actionUrl&&g(s.actionUrl)},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-xl ${t.bgColor} ${t.textColor}`,children:t.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:s.message}),!s.read&&e.jsx("span",{className:"text-xs bg-sky-100 text-sky-700 px-2 py-0.5 rounded-full",children:"جديد"})]}),e.jsx("span",{className:"text-xs text-gray-400",children:A(s.createdAt)})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[!s.read&&e.jsx("button",{onClick:a=>{a.stopPropagation(),p(s.id)},className:"p-1.5 text-gray-400 hover:text-green-500 transition",title:"تحديد كمقروء",children:e.jsx(N,{className:"w-4 h-4"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),v(s.id)},className:"p-1.5 text-gray-400 hover:text-red-500 transition",title:"حذف",children:e.jsx(L,{className:"w-4 h-4"})})]})]})},s.id)})})})]})};export{V as NotificationsPage,V as default};
