import{j as s}from"./index-FuU3jBZc.js";import{r as f}from"./vendor-react-C_wfuX_s.js";import{O as x}from"./index-D6ulfRl4.js";import{f as v,d as j,K as N}from"./vendor-icons-Dyg7S3Xx.js";const I=(e,t)=>{var o;if(!e)return{elapsed:0,remaining:t,percentage:0};const i=(o=e==null?void 0:e.toDate)!=null&&o.call(e)?e.toDate():e instanceof Date?e:new Date(e);if(isNaN(i.getTime()))return{elapsed:0,remaining:t,percentage:0};const a=new Date().getTime()-i.getTime(),l=Math.floor(a/6e4),r=t-l,p=Math.min(l/t*100,100);return{elapsed:l,remaining:r,percentage:p}},$=e=>e>=100?"exceeded":e>=x.WARNING_THRESHOLD*100?"warning":"normal",d=e=>{const t=Math.abs(e);if(t<60)return`${t} دقيقة`;const i=Math.floor(t/60),c=t%60;return`${i}س ${c}د`},w=e=>{switch(e){case"preparation":return"التجهيز";case"pickup":return"الاستلام";case"delivery":return"التوصيل"}},k=e=>{switch(e){case"preparation":return x.PREPARATION_TIME;case"pickup":return x.COURIER_PICKUP_TIME;case"delivery":return x.DELIVERY_TIME}},E=(e,t)=>{if(e.timestamps)switch(t){case"preparation":return e.timestamps.acceptedAt;case"pickup":return e.timestamps.readyAt;case"delivery":return e.timestamps.pickedUpAt}},_=(e,t)=>{switch(t){case"preparation":return e.status==="ready"||e.status==="out_for_delivery"||e.status==="delivered";case"pickup":return e.status==="out_for_delivery"||e.status==="delivered";case"delivery":return e.status==="delivered"}},M=(e,t)=>{switch(t){case"preparation":return e.status==="accepted"||e.status==="preparing";case"pickup":return e.status==="ready";case"delivery":return e.status==="out_for_delivery"}},O=({order:e,type:t,showLabel:i=!0,compact:c=!1})=>{const[a,l]=f.useState({elapsed:0,remaining:0,percentage:0}),[r,p]=f.useState("normal"),o=k(t),m=E(e,t),u=_(e,t),g=M(e,t);if(f.useEffect(()=>{if(!g||u||!m)return;const h=()=>{const b=I(m,o);l(b),p($(b.percentage))};h();const y=setInterval(h,1e4);return()=>clearInterval(y)},[m,o,g,u]),!m&&!u)return null;if(u)return c?s.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[s.jsx(v,{className:"w-4 h-4"}),s.jsx("span",{className:"text-xs",children:"✓"})]}):s.jsxs("div",{className:"flex items-center gap-2 text-green-600 bg-green-50 px-3 py-1.5 rounded-lg",children:[s.jsx(v,{className:"w-4 h-4"}),s.jsxs("span",{className:"text-sm font-medium",children:[w(t)," ✓"]})]});if(!g)return null;const n={normal:{bg:"bg-sky-50",border:"border-sky-200",text:"text-sky-700",bar:"bg-sky-500",icon:"text-sky-500"},warning:{bg:"bg-amber-50",border:"border-amber-300",text:"text-amber-700",bar:"bg-amber-500",icon:"text-amber-500"},exceeded:{bg:"bg-red-50",border:"border-red-300",text:"text-red-700",bar:"bg-red-500",icon:"text-red-500"}}[r];return c?s.jsxs("div",{className:`flex items-center gap-1 ${n.text}`,children:[r==="exceeded"?s.jsx(j,{className:"w-4 h-4 animate-pulse"}):s.jsx(N,{className:`w-4 h-4 ${n.icon}`}),s.jsx("span",{className:"text-xs font-bold",children:a.remaining>0?d(a.remaining):`+${d(Math.abs(a.remaining))}`})]}):s.jsxs("div",{className:`${n.bg} ${n.border} border rounded-xl p-3 space-y-2`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[r==="exceeded"?s.jsx(j,{className:`w-5 h-5 ${n.icon} animate-pulse`}):s.jsx(N,{className:`w-5 h-5 ${n.icon}`}),i&&s.jsx("span",{className:`text-sm font-bold ${n.text}`,children:w(t)})]}),s.jsx("div",{className:`text-lg font-bold ${n.text}`,children:a.remaining>0?s.jsx("span",{children:d(a.remaining)}):s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsxs("span",{children:["+",d(Math.abs(a.remaining))]}),s.jsx("span",{className:"text-xs",children:"⚠️"})]})})]}),s.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:s.jsx("div",{className:`h-full ${n.bar} transition-all duration-500`,style:{width:`${Math.min(a.percentage,100)}%`}})}),r==="exceeded"&&s.jsx("div",{className:"text-xs text-red-600 font-medium animate-pulse",children:"⚠️ تجاوز الوقت المحدد! يرجى الإسراع."}),r==="warning"&&s.jsxs("div",{className:"text-xs text-amber-600 font-medium",children:["⏰ الوقت ينفد! باقي ",d(a.remaining)," فقط."]})]})};export{O};
