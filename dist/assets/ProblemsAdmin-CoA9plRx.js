import{d as R,j as e}from"./index-FuU3jBZc.js";import{r as c}from"./vendor-react-C_wfuX_s.js";import{t as C,m as S}from"./vendor-firebase-Co4MdP0H.js";import{L as P,ar as q,ac as z,S as k,T as F,U as T,d as f,b3 as D}from"./vendor-icons-Dyg7S3Xx.js";const V=()=>{const[$,w]=c.useState(!0),[h,E]=c.useState([]),[g,I]=c.useState([]),[b,A]=c.useState([]),[d,j]=c.useState("restaurants"),[m,O]=c.useState("month");c.useEffect(()=>{v()},[m]);const v=async()=>{w(!0);try{const n=(await C(S(R,"orders"))).docs.map(a=>({id:a.id,...a.data()})),M=new Date,N=n.filter(a=>{var l,i;if(m==="all")return!0;const t=((i=(l=a.createdAt)==null?void 0:l.toDate)==null?void 0:i.call(l))||new Date(0),r=(M.getTime()-t.getTime())/(1e3*60*60*24);return m==="week"?r<=7:m==="month"?r<=30:!0}),p=new Map;N.forEach(a=>{var i,x;const t=a.restaurantId;if(!t)return;p.has(t)||p.set(t,{id:t,name:a.restaurantName||"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",totalOrders:0,complaintsCount:0,avgRating:0,lowRatings:0});const r=p.get(t);r.totalOrders++;const l=(x=(i=a.ratings)==null?void 0:i.customerToRestaurant)==null?void 0:x.stars;l&&l<=2&&r.lowRatings++});const y=(await C(S(R,"supportChats"))).docs.map(a=>a.data());y.forEach(a=>{});const L=Array.from(p.values()).sort((a,t)=>t.lowRatings-a.lowRatings);E(L);const u=new Map;N.forEach(a=>{var i,x;const t=a.courierId;if(!t)return;u.has(t)||u.set(t,{id:t,name:a.courierName||"Ù…Ù†Ø¯ÙˆØ¨",totalDeliveries:0,complaintsCount:0,avgRating:0,lowRatings:0});const r=u.get(t);r.totalDeliveries++;const l=(x=(i=a.ratings)==null?void 0:i.customerToCourier)==null?void 0:x.stars;l&&l<=2&&r.lowRatings++});const U=Array.from(u.values()).sort((a,t)=>t.lowRatings-a.lowRatings);I(U);const o=new Map;N.forEach(a=>{const t=a.customerId;if(!t)return;o.has(t)||o.set(t,{id:t,name:a.customerName||"Ø¹Ù…ÙŠÙ„",totalOrders:0,complaintsFiledCount:0,avgRatingGiven:0});const r=o.get(t);r.totalOrders++}),y.forEach(a=>{const t=a.userId;o.has(t)&&o.get(t).complaintsFiledCount++});const G=Array.from(o.values()).sort((a,t)=>t.complaintsFiledCount-a.complaintsFiledCount);A(G)}catch(s){console.error("Error loading stats:",s)}finally{w(!1)}};return $?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(P,{className:"w-8 h-8 animate-spin text-sky-500"})}):e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[e.jsx(q,{className:"w-8 h-8 text-red-500"}),"Ù…Ø±ÙƒØ² Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø´Ø§ÙƒÙ„"]}),e.jsx("button",{onClick:v,className:"p-2 bg-gray-100 rounded-xl hover:bg-gray-200 transition",children:e.jsx(z,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-red-500 to-orange-500 rounded-2xl p-5 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(k,{className:"w-6 h-6"}),e.jsx("span",{className:"font-bold",children:"Ø£Ø³Ø± Ø¨Ù…Ø´Ø§ÙƒÙ„"})]}),e.jsx("p",{className:"text-3xl font-bold",children:h.filter(s=>s.lowRatings>0).length}),e.jsxs("p",{className:"text-white/70 text-sm",children:["Ù…Ù† Ø£ØµÙ„ ",h.length," Ø£Ø³Ø±Ø©"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500 to-yellow-500 rounded-2xl p-5 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(F,{className:"w-6 h-6"}),e.jsx("span",{className:"font-bold",children:"Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† Ø¨Ù…Ø´Ø§ÙƒÙ„"})]}),e.jsx("p",{className:"text-3xl font-bold",children:g.filter(s=>s.lowRatings>0).length}),e.jsxs("p",{className:"text-white/70 text-sm",children:["Ù…Ù† Ø£ØµÙ„ ",g.length," Ù…Ù†Ø¯ÙˆØ¨"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl p-5 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(T,{className:"w-6 h-6"}),e.jsx("span",{className:"font-bold",children:"Ø¹Ù…Ù„Ø§Ø¡ ÙƒØ«ÙŠØ±ÙŠ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰"})]}),e.jsx("p",{className:"text-3xl font-bold",children:b.filter(s=>s.complaintsFiledCount>2).length}),e.jsx("p",{className:"text-white/70 text-sm",children:"Ø£ÙƒØ«Ø± Ù…Ù† Ø´ÙƒÙˆÙŠØªÙŠÙ†"})]})]}),e.jsx("div",{className:"flex gap-2 mb-6",children:["week","month","all"].map(s=>e.jsx("button",{onClick:()=>O(s),className:`px-4 py-2 rounded-xl font-medium transition ${m===s?"bg-sky-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:s==="week"?"Ø¢Ø®Ø± Ø£Ø³Ø¨ÙˆØ¹":s==="month"?"Ø¢Ø®Ø± Ø´Ù‡Ø±":"Ø§Ù„ÙƒÙ„"},s))}),e.jsxs("div",{className:"flex gap-2 mb-6 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>j("restaurants"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition ${d==="restaurants"?"bg-red-500 text-white":"bg-gray-100 text-gray-600"}`,children:[e.jsx(k,{className:"w-4 h-4"}),"Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø©"]}),e.jsxs("button",{onClick:()=>j("couriers"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition ${d==="couriers"?"bg-amber-500 text-white":"bg-gray-100 text-gray-600"}`,children:[e.jsx(F,{className:"w-4 h-4"}),"Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†"]}),e.jsxs("button",{onClick:()=>j("customers"),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition ${d==="customers"?"bg-purple-500 text-white":"bg-gray-100 text-gray-600"}`,children:[e.jsx(T,{className:"w-4 h-4"}),"Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡"]})]}),d==="restaurants"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-red-50 border-b border-red-100",children:e.jsxs("h2",{className:"font-bold text-red-800 flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Ø§Ù„Ø£Ø³Ø± Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø´Ø§ÙƒÙ„ (ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù…Ù†Ø®ÙØ¶Ø©)"]})}),h.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª"}):e.jsx("div",{className:"divide-y divide-gray-100",children:h.slice(0,20).map((s,n)=>e.jsxs("div",{className:`p-4 flex items-center justify-between ${s.lowRatings>0?"bg-red-50":""}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${s.lowRatings>2?"bg-red-500 text-white":s.lowRatings>0?"bg-amber-500 text-white":"bg-gray-200 text-gray-600"}`,children:n+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-800",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.totalOrders," Ø·Ù„Ø¨"]})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:s.lowRatings>0&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{className:"font-bold",children:s.lowRatings}),e.jsx("span",{className:"text-xs",children:"ØªÙ‚ÙŠÙŠÙ… Ø³ÙŠØ¡"})]})})]},s.id))})]}),d==="couriers"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-amber-50 border-b border-amber-100",children:e.jsxs("h2",{className:"font-bold text-amber-800 flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø´Ø§ÙƒÙ„"]})}),g.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª"}):e.jsx("div",{className:"divide-y divide-gray-100",children:g.slice(0,20).map((s,n)=>e.jsxs("div",{className:`p-4 flex items-center justify-between ${s.lowRatings>0?"bg-amber-50":""}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${s.lowRatings>2?"bg-red-500 text-white":s.lowRatings>0?"bg-amber-500 text-white":"bg-gray-200 text-gray-600"}`,children:n+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-800",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.totalDeliveries," ØªÙˆØµÙŠÙ„"]})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:s.lowRatings>0&&e.jsxs("div",{className:"flex items-center gap-1 text-amber-600",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{className:"font-bold",children:s.lowRatings}),e.jsx("span",{className:"text-xs",children:"ØªÙ‚ÙŠÙŠÙ… Ø³ÙŠØ¡"})]})})]},s.id))})]}),d==="customers"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-purple-50 border-b border-purple-100",children:e.jsxs("h2",{className:"font-bold text-purple-800 flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙƒØ«ÙŠØ±ÙŠ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰"]})}),b.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª"}):e.jsx("div",{className:"divide-y divide-gray-100",children:b.filter(s=>s.complaintsFiledCount>0).slice(0,20).map((s,n)=>e.jsxs("div",{className:`p-4 flex items-center justify-between ${s.complaintsFiledCount>2?"bg-purple-50":""}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${s.complaintsFiledCount>3?"bg-red-500 text-white":s.complaintsFiledCount>1?"bg-amber-500 text-white":"bg-gray-200 text-gray-600"}`,children:n+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-800",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.totalOrders," Ø·Ù„Ø¨"]})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-1 text-purple-600",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{className:"font-bold",children:s.complaintsFiledCount}),e.jsx("span",{className:"text-xs",children:"Ø´ÙƒÙˆÙ‰"})]})})]},s.id))})]}),e.jsx("div",{className:"mt-6 bg-amber-50 border border-amber-200 rounded-xl p-4 text-center",children:e.jsxs("p",{className:"text-amber-800",children:["ğŸ’¡ ",e.jsx("strong",{children:"Ù†ØµÙŠØ­Ø©:"})," Ø±Ø§Ù‚Ø¨ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ù…Ø¨ÙƒØ±Ø§Ù‹"]})})]})};export{V as ProblemsAdmin,V as default};
