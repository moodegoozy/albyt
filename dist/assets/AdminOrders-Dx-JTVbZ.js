import{u as F,b as I,d as m,j as e,R as j}from"./index-FuU3jBZc.js";import{r as n}from"./vendor-react-C_wfuX_s.js";import{q as p,m as h,F as f,w as b,t as v}from"./vendor-firebase-Co4MdP0H.js";import"./vendor-icons-Dyg7S3Xx.js";const u={pending:"â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",accepted:"âœ… Ù…Ù‚Ø¨ÙˆÙ„",preparing:"ðŸ‘¨â€ðŸ³ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±",ready:"ðŸ“¦ Ø¬Ø§Ù‡Ø²",out_for_delivery:"ðŸš— ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚",delivered:"âœ”ï¸ ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…",cancelled:"âŒ Ù…Ù„ØºÙŠ"},L=()=>{const{user:d,role:i}=F(),N=I(),[c,w]=n.useState([]),[O,A]=n.useState([]),[R,S]=n.useState(!0),[r,g]=n.useState("all"),[o,y]=n.useState([]);n.useEffect(()=>{if(!d)return;(async()=>{if(i==="developer")y([]);else{const l=p(h(m,"restaurants"),b("referredBy","==",d.uid)),a=(await v(l)).docs.map(x=>x.id);y(a)}})()},[d,i]),n.useEffect(()=>{d&&q()},[r,d,i,o]);const q=async()=>{try{let s;r==="all"?s=p(h(m,"orders"),f("createdAt","desc")):s=p(h(m,"orders"),b("status","==",r),f("createdAt","desc"));let t=(await v(s)).docs.map(a=>({id:a.id,...a.data()}));i!=="developer"&&o.length>0?t=t.filter(a=>o.includes(a.restaurantId||"")):i!=="developer"&&o.length===0&&(t=[]),A(t),w(t)}catch(s){N.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª"),console.error(s)}finally{S(!1)}};return R?e.jsx(j,{allow:["admin","developer"],children:e.jsx("div",{className:"flex items-center justify-center h-96",children:"Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„..."})}):e.jsx(j,{allow:["admin","developer"],children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary",children:"Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª"}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsxs("button",{onClick:()=>g("all"),className:`px-4 py-2 rounded-xl font-semibold transition whitespace-nowrap ${r==="all"?"bg-primary text-white":"bg-gray-200 text-gray-800 hover:bg-gray-300"}`,children:["Ø§Ù„ÙƒÙ„ (",c.length,")"]}),["pending","accepted","preparing","ready","out_for_delivery","delivered"].map(s=>{const l=c.filter(t=>t.status===s).length;return e.jsxs("button",{onClick:()=>g(s),className:`px-4 py-2 rounded-xl font-semibold transition whitespace-nowrap ${r===s?"bg-primary text-white":"bg-gray-200 text-gray-800 hover:bg-gray-300"}`,children:[u[s]," (",l,")"]},s)})]}),e.jsx("div",{className:"space-y-4",children:c.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-12",children:["Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ",r!=="all"&&`Ø¨Ø­Ø§Ù„Ø© "${u[r]}"`]}):c.map(s=>{var l,t;return e.jsxs("div",{className:"bg-white rounded-2xl shadow p-6 hover:shadow-lg transition",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold",children:["Ø·Ù„Ø¨ #",s.id.slice(-8)]}),e.jsx("p",{className:"text-gray-600 text-sm",children:s.createdAt?new Date(s.createdAt).toLocaleDateString("ar-SA"):"â€”"})]}),e.jsx("span",{className:`px-4 py-2 rounded-xl font-semibold text-white whitespace-nowrap ${s.status==="pending"?"bg-yellow-500":s.status==="delivered"?"bg-green-600":s.status==="cancelled"?"bg-red-600":"bg-blue-600"}`,children:u[s.status]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Ø§Ù„Ø¹Ù…ÙŠÙ„ ID"}),e.jsxs("p",{className:"font-mono text-sm text-gray-800",children:[s.customerId.slice(0,12),"..."]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Ø§Ù„Ù…Ø·Ø¹Ù…"}),e.jsx("p",{className:"font-semibold text-gray-800",children:s.restaurantName||"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"}),e.jsx("p",{className:"text-sm text-gray-800",children:s.address})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹"}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:[((l=s.total)==null?void 0:l.toFixed(2))||0," Ø±.Ø³"]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 text-sm",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Ø§Ù„Ø£ØµÙ†Ø§Ù:"}),e.jsx("div",{className:"space-y-1",children:(t=s.items)==null?void 0:t.map((a,x)=>e.jsxs("div",{className:"flex justify-between text-gray-700",children:[e.jsxs("span",{children:[a.name," Ã— ",a.qty]}),e.jsxs("span",{children:[(a.price*a.qty).toFixed(2)," Ø±.Ø³"]})]},x))})]})]},s.id)})})]})})};export{L as AdminOrders,L as default};
