import{u as re,c as le,f as ce,j as e,d as I}from"./index-FuU3jBZc.js";import{r as x}from"./vendor-react-C_wfuX_s.js";import{e as ie,q as de,w as oe,m as z,t as ue,H,K as J,J as K,y as me,u as V,k as T,p as xe}from"./vendor-firebase-Co4MdP0H.js";import"./vendor-icons-Dyg7S3Xx.js";const pe=({kind:o,message:w,onClose:f})=>{const i=o==="success"?"bg-green-600":o==="error"?"bg-rose-600":o==="warning"?"bg-amber-500":"bg-slate-800";return x.useEffect(()=>{const y=setTimeout(f,2500);return()=>clearTimeout(y)},[f]),e.jsx("div",{className:`fixed bottom-4 right-4 z-50 rounded-xl px-4 py-3 text-white shadow-lg ${i}`,children:w})},D=()=>({name:"",desc:"",price:0,available:!0,file:null,discountPercent:0,discountExpiresAt:""});async function G(o,w=900,f=.8){try{const i=await createImageBitmap(o),y=Math.min(1,w/i.width),N=Math.round(i.width*y),a=Math.round(i.height*y),u=document.createElement("canvas");u.width=N,u.height=a,u.getContext("2d").drawImage(i,0,0,N,a);const P=o.type.includes("png")?"image/png":"image/jpeg";return await new Promise(_=>u.toBlob(t=>_(t),P,f))}catch{return o}}const ve=()=>{const{user:o}=re(),w=le(),[f,i]=x.useState([]),[y,N]=x.useState(!0),[a,u]=x.useState(D()),[k,P]=x.useState(!1),[j,_]=x.useState(null),[t,b]=x.useState(D()),[C,L]=x.useState(!1),S=x.useRef(null),[F,M]=x.useState(null),m=(s,n)=>M({kind:s,message:n}),O=ie(ce),U=x.useRef(null),Q=async()=>{if(!o)return;N(!0);const s=de(z(I,"menuItems"),oe("ownerId","==",o.uid)),n=await ue(s);i(n.docs.map(l=>({id:l.id,...l.data()}))),N(!1)};x.useEffect(()=>{Q()},[o]);const W=async s=>{if(s.preventDefault(),!o){m("warning","âš ï¸ Ù„Ø§Ø²Ù… ØªØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„");return}const n=Number(a.price||0);if(!a.name.trim()){m("warning","âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù");return}if(!Number.isFinite(n)||n<=0){m("warning","âš ï¸ Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± ØµØ§Ù„Ø­");return}P(!0);const l="temp_"+Date.now(),r=a.file?URL.createObjectURL(a.file):void 0,c={_tempId:l,_optimistic:!0,_progress:a.file?1:100,name:a.name,desc:a.desc||"",price:n,imageUrl:r,available:a.available??!0,ownerId:o.uid};i(d=>[c,...d]);try{let d;if(a.file){const p=await G(a.file),g=a.file.name.replace(/\s+/g,"_").slice(-60),$=`menuImages/${o.uid}_${Date.now()}_${g}`,A=H(O,$),q=J(A,p,{contentType:a.file.type||"image/jpeg"});await new Promise((se,te)=>{q.on("state_changed",E=>{const ae=Math.round(E.bytesTransferred/E.totalBytes*100);i(ne=>ne.map(R=>R._tempId===l?{...R,_progress:ae}:R))},te,async()=>{const E=await K(q.snapshot.ref);d=`${E}${E.includes("?")?"&":"?"}v=${Date.now()}`,se()})})}const h={name:c.name,desc:c.desc,price:n,imageUrl:d||"",available:c.available,ownerId:o.uid,...c.categoryId?{categoryId:c.categoryId}:{},...a.discountPercent&&a.discountPercent>0?{discountPercent:a.discountPercent}:{},...a.discountExpiresAt?{discountExpiresAt:new Date(a.discountExpiresAt)}:{}},v=await me(z(I,"menuItems"),h);i(p=>p.map(g=>g._tempId===l?{...g,id:v.id,imageUrl:d||g.imageUrl,_optimistic:!1,_progress:100}:g)),m("success","âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­")}catch(d){i(h=>h.filter(v=>v._tempId!==l)),m("error",`âŒ ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù: ${(d==null?void 0:d.message)||d}`)}finally{P(!1),u(D()),U.current&&(U.current.value=""),r&&URL.revokeObjectURL(r)}},X=async(s,n)=>{if(s){i(l=>l.map(r=>r.id===s?{...r,available:!n}:r));try{await V(T(I,"menuItems",s),{available:!n}),m("success","ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©")}catch{i(l=>l.map(r=>r.id===s?{...r,available:!!n}:r)),m("error","Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØºÙŠÙŠØ±. Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.")}}},Y=async s=>{if(!s||!await w.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†Ù Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ",{dangerous:!0,title:"Ø­Ø°Ù Ø§Ù„ØµÙ†Ù"}))return;const l=f;i(r=>r.filter(c=>c.id!==s));try{await xe(T(I,"menuItems",s)),m("success","ØªÙ… Ø§Ù„Ø­Ø°Ù")}catch{i(l),m("error","Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù. Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.")}},Z=s=>{_(s.id||null),b({...s,file:null})},B=()=>{_(null),b(D()),S.current&&(S.current.value="")},ee=async s=>{if(s.preventDefault(),!o||!j)return;const n=Number(t.price||0);if(!t.name.trim()){m("warning","âš ï¸ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù");return}if(!Number.isFinite(n)||n<=0){m("warning","âš ï¸ Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± ØµØ§Ù„Ø­");return}L(!0);const l=f;i(r=>r.map(c=>c.id===j?{...c,name:t.name,desc:t.desc,price:n,available:t.available}:c));try{let r=t.imageUrl;if(t.file){const c=await G(t.file),d=t.file.name.replace(/\s+/g,"_").slice(-60),h=`menuImages/${o.uid}_${Date.now()}_${d}`,v=H(O,h),p=J(v,c,{contentType:t.file.type||"image/jpeg"});await new Promise((g,$)=>{p.on("state_changed",null,$,async()=>{const A=await K(p.snapshot.ref);r=`${A}${A.includes("?")?"&":"?"}v=${Date.now()}`,g()})})}await V(T(I,"menuItems",j),{name:t.name,desc:t.desc||"",price:n,available:t.available,...r?{imageUrl:r}:{},discountPercent:t.discountPercent||0,...t.discountExpiresAt?{discountExpiresAt:new Date(t.discountExpiresAt)}:{discountExpiresAt:null}}),r&&i(c=>c.map(d=>d.id===j?{...d,imageUrl:r}:d)),m("success","âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­"),B()}catch(r){i(l),m("error",`âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${(r==null?void 0:r.message)||r}`)}finally{L(!1)}};return y?e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow p-6 space-y-3",children:[e.jsx("div",{className:"h-6 w-40 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-10 w-full bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-24 w-full bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-10 w-full bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-10 w-32 bg-gray-200 rounded animate-pulse"})]}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsxs("div",{className:"bg-white rounded-2xl shadow p-4 flex items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-xl animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 w-48 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-3 w-64 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-24 bg-gray-200 rounded animate-pulse"})]})]},s))})]}):e.jsxs(e.Fragment,{children:[F&&e.jsx(pe,{kind:F.kind,message:F.message,onClose:()=>M(null)}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("form",{onSubmit:W,className:"bg-white rounded-2xl shadow p-6 space-y-3",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù"}),e.jsx("input",{className:"w-full border rounded-xl p-3",placeholder:"Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù",value:a.name,onChange:s=>u({...a,name:s.target.value})}),e.jsx("textarea",{className:"w-full border rounded-xl p-3",placeholder:"Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",value:a.desc,onChange:s=>u({...a,desc:s.target.value})}),e.jsx("input",{className:"w-full border rounded-xl p-3",placeholder:"Ø§Ù„Ø³Ø¹Ø±",type:"number",min:0,step:.5,inputMode:"decimal",value:Number.isFinite(a.price)?a.price:0,onChange:s=>u({...a,price:Number(s.target.value)})}),e.jsxs("div",{className:"border border-dashed border-amber-300 rounded-xl p-4 bg-amber-50/50 space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-amber-700 flex items-center gap-2",children:"ğŸ·ï¸ Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… %"}),e.jsx("input",{className:"w-full border rounded-xl p-3",placeholder:"Ù…Ø«Ø§Ù„: 20",type:"number",min:0,max:100,value:a.discountPercent||"",onChange:s=>u({...a,discountPercent:Number(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ"}),e.jsx("input",{className:"w-full border rounded-xl p-3",type:"date",value:a.discountExpiresAt?typeof a.discountExpiresAt=="string"?a.discountExpiresAt:new Date(a.discountExpiresAt).toISOString().split("T")[0]:"",onChange:s=>u({...a,discountExpiresAt:s.target.value})})]})]}),a.discountPercent&&a.discountPercent>0&&e.jsxs("div",{className:"text-sm bg-green-100 text-green-700 p-2 rounded-lg",children:["Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: ",e.jsxs("strong",{children:[(a.price-a.price*(a.discountPercent/100)).toFixed(2)," Ø±.Ø³"]}),e.jsxs("span",{className:"line-through text-gray-400 mr-2",children:[a.price.toFixed(2)," Ø±.Ø³"]})]})]}),e.jsx("input",{ref:U,className:"w-full border rounded-xl p-3",type:"file",accept:"image/*",onChange:s=>{var n;return u({...a,file:((n=s.target.files)==null?void 0:n[0])||null})}}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:a.available,onChange:s=>u({...a,available:s.target.checked})}),"Ù…ØªØ§Ø­"]}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-gray-900 text-white disabled:opacity-60",disabled:k,children:k?"Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸â€¦":"Ø­ÙØ¸"})]}),e.jsxs("div",{className:"space-y-3",children:[f.map(s=>e.jsx("div",{className:"bg-white rounded-2xl shadow p-4",children:j===s.id?e.jsxs("form",{onSubmit:ee,className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("img",{src:t.file?URL.createObjectURL(t.file):t.imageUrl||"",className:"w-20 h-20 object-cover rounded-xl bg-gray-100",onError:n=>{n.currentTarget.style.display="none"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600 block mb-1",children:"ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©"}),e.jsx("input",{ref:S,type:"file",accept:"image/*",className:"w-full text-sm border rounded-lg p-2",onChange:n=>{var l;return b({...t,file:((l=n.target.files)==null?void 0:l[0])||null})}})]})]}),e.jsx("input",{className:"w-full border rounded-xl p-3",placeholder:"Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù",value:t.name,onChange:n=>b({...t,name:n.target.value})}),e.jsx("textarea",{className:"w-full border rounded-xl p-3",placeholder:"Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",value:t.desc||"",onChange:n=>b({...t,desc:n.target.value})}),e.jsx("input",{className:"w-full border rounded-xl p-3",placeholder:"Ø§Ù„Ø³Ø¹Ø±",type:"number",min:0,step:.5,inputMode:"decimal",value:Number.isFinite(t.price)?t.price:0,onChange:n=>b({...t,price:Number(n.target.value)})}),e.jsxs("div",{className:"border border-dashed border-amber-300 rounded-xl p-4 bg-amber-50/50 space-y-3",children:[e.jsx("h3",{className:"text-sm font-bold text-amber-700 flex items-center gap-2",children:"ğŸ·ï¸ Ø§Ù„Ø®ØµÙ…"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… %"}),e.jsx("input",{className:"w-full border rounded-xl p-3",placeholder:"Ù…Ø«Ø§Ù„: 20",type:"number",min:0,max:100,value:t.discountPercent||"",onChange:n=>b({...t,discountPercent:Number(n.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ"}),e.jsx("input",{className:"w-full border rounded-xl p-3",type:"date",value:t.discountExpiresAt?typeof t.discountExpiresAt=="string"?t.discountExpiresAt:new Date(t.discountExpiresAt).toISOString().split("T")[0]:"",onChange:n=>b({...t,discountExpiresAt:n.target.value})})]})]}),t.discountPercent&&t.discountPercent>0&&e.jsxs("div",{className:"text-sm bg-green-100 text-green-700 p-2 rounded-lg",children:["Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: ",e.jsxs("strong",{children:[(t.price-t.price*(t.discountPercent/100)).toFixed(2)," Ø±.Ø³"]}),e.jsxs("span",{className:"line-through text-gray-400 mr-2",children:[t.price.toFixed(2)," Ø±.Ø³"]})]}),t.discountPercent&&t.discountPercent>0&&e.jsx("button",{type:"button",onClick:()=>b({...t,discountPercent:0,discountExpiresAt:""}),className:"text-xs text-red-500 hover:text-red-700",children:"âŒ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®ØµÙ…"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:t.available,onChange:n=>b({...t,available:n.target.checked})}),"Ù…ØªØ§Ø­"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",disabled:C,className:"flex-1 px-4 py-2 rounded-xl bg-green-600 text-white disabled:opacity-60",children:C?"Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸â€¦":"ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª"}),e.jsx("button",{type:"button",onClick:B,disabled:C,className:"px-4 py-2 rounded-xl bg-gray-400 text-white disabled:opacity-60",children:"Ø¥Ù„ØºØ§Ø¡"})]})]}):e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.imageUrl||"",className:"w-20 h-20 object-cover rounded-xl bg-gray-100",onError:n=>{n.currentTarget.style.display="none"}}),s._optimistic&&e.jsx("div",{className:"absolute -bottom-2 left-0 right-0",children:e.jsx("div",{className:"h-1 w-20 rounded bg-gray-200 overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-500 transition-[width]",style:{width:`${s._progress||1}%`}})})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold",children:s.name}),s.desc&&e.jsx("div",{className:"text-sm text-gray-600",children:s.desc}),(()=>{var c,d,h,v,p,g;const n=s.discountPercent&&s.discountPercent>0,l=((d=(c=s.discountExpiresAt)==null?void 0:c.toDate)==null?void 0:d.call(c))||(s.discountExpiresAt?new Date(s.discountExpiresAt):null),r=!l||l>new Date;return n&&r?e.jsxs("div",{className:"mt-1 flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"font-bold text-green-600",children:[(s.price-s.price*((s.discountPercent||0)/100)).toFixed(2)," Ø±.Ø³"]}),e.jsxs("span",{className:"text-sm text-gray-400 line-through",children:[(v=(h=s.price)==null?void 0:h.toFixed)==null?void 0:v.call(h,2)," Ø±.Ø³"]}),e.jsxs("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:["Ø®ØµÙ… ",s.discountPercent,"%"]})]}):e.jsxs("div",{className:"font-semibold mt-1",children:[(g=(p=s.price)==null?void 0:p.toFixed)==null?void 0:g.call(p,2)," Ø±.Ø³"]})})(),s._optimistic&&e.jsx("div",{className:"text-xs text-yellow-600 mt-1",children:"ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸â€¦"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:()=>Z(s),disabled:!!s._optimistic,className:"px-3 py-2 rounded-xl text-sm bg-amber-500 text-white disabled:opacity-50",children:"âœï¸ ØªØ¹Ø¯ÙŠÙ„"}),e.jsx("button",{onClick:()=>X(s.id,s.available),disabled:!!s._optimistic,className:"px-3 py-2 rounded-xl text-sm bg-blue-600 text-white disabled:opacity-50",children:s.available?"ØªØ¹Ø·ÙŠÙ„":"ØªÙØ¹ÙŠÙ„"}),e.jsx("button",{onClick:()=>Y(s.id),disabled:!!s._optimistic,className:"px-3 py-2 rounded-xl text-sm bg-red-600 text-white disabled:opacity-50",children:"Ø­Ø°Ù"})]})]})},s.id||s._tempId)),f.length===0&&e.jsx("div",{className:"text-gray-600",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù Ø¨Ø¹Ø¯."})]})]})]})};export{ve as ManageMenu,ve as default};
