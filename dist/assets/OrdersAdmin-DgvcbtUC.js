const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/refundService-Ck6lnjyu.js","assets/index-FuU3jBZc.js","assets/vendor-react-C_wfuX_s.js","assets/vendor-firebase-Co4MdP0H.js","assets/vendor-icons-Dyg7S3Xx.js","assets/index-KBblhOUv.css","assets/notificationService-CH0h_Jqx.js"])))=>i.map(i=>d[i]);
import{u as X,b as Y,j as e,d as f,_ as O,s as Z}from"./index-FuU3jBZc.js";import{b as ee,r as g}from"./vendor-react-C_wfuX_s.js";import{n as te,m as se,u as k,z as b,k as F,H as ae,I as re,J as ne}from"./vendor-firebase-Co4MdP0H.js";import{R as le}from"./RatingModal-D3FyVkKF.js";import{ah as S,f as ie,L as ce,av as de,ag as oe,m as P,U as me}from"./vendor-icons-Dyg7S3Xx.js";const D=p=>({pending:"â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",accepted:"âœ… ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„",preparing:"ðŸ‘¨â€ðŸ³ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±",ready:"ðŸ“¦ Ø¬Ø§Ù‡Ø²",out_for_delivery:"ðŸšš ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚",delivered:"ðŸŽ‰ ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…",cancelled:"âŒ Ù…Ù„ØºÙŠ"})[p]||p,ue=p=>{switch(p){case"pending":return"bg-gray-200 text-gray-800";case"accepted":return"bg-blue-200 text-blue-800";case"preparing":return"bg-yellow-200 text-yellow-800";case"ready":return"bg-purple-200 text-purple-800";case"out_for_delivery":return"bg-indigo-200 text-indigo-800";case"delivered":return"bg-green-200 text-green-800";case"cancelled":return"bg-red-200 text-red-800";default:return"bg-gray-100 text-gray-700"}},fe=()=>{const{user:p}=X(),E=ee(),y=Y(),[A,U]=g.useState([]),[w,_]=g.useState(null),[j,M]=g.useState({}),[h,I]=g.useState(null),[T,$]=g.useState(null);g.useRef(null);const x=g.useMemo(()=>(p==null?void 0:p.uid)??null,[p]);g.useEffect(()=>{if(!x)return;_(null);const t=te(se(f,"orders"),r=>{const l=r.docs.map(n=>({id:n.id,...n.data()})).filter(n=>{var o,a;const d=n.restaurantId===x,i=((a=(o=n==null?void 0:n.items)==null?void 0:o[0])==null?void 0:a.ownerId)===x;return d||i});l.sort((n,d)=>{var a,c,m,u;const i=((c=(a=n.createdAt)==null?void 0:a.toMillis)==null?void 0:c.call(a))??0;return(((u=(m=d.createdAt)==null?void 0:m.toMillis)==null?void 0:u.call(m))??0)-i}),U(l),_(null)},r=>{console.error("Firestore error:",r),_("Ø­Ø¯Ø«Øª Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª.")});return()=>t()},[x]);const L=async(t,r,s)=>{const l={status:r,updatedAt:b()};if(r==="accepted"&&(s==null?void 0:s.deliveryType)==="delivery"){const n=j[t]||0;l.deliveryFee=n,l.total=(s.subtotal||0)+n}if(r==="cancelled"&&(l.cancelledAt=b(),l.cancelledBy="owner"),await k(F(f,"orders",t),l),r==="cancelled"&&s){try{const{processOrderRefund:n,notifyRefundParties:d}=await O(async()=>{const{processOrderRefund:o,notifyRefundParties:a}=await import("./refundService-Ck6lnjyu.js");return{processOrderRefund:o,notifyRefundParties:a}},__vite__mapDeps([0,1,2,3,4,5])),i=await n({id:s.id||t,customerId:s.customerId,restaurantId:s.restaurantId||x||"",subtotal:s.subtotal,total:s.total,restaurantEarnings:s.restaurantEarnings,platformFee:s.platformFee,adminCommission:s.adminCommission,appEarnings:s.appEarnings,referredBy:s.referredBy,paymentMethod:s.paymentMethod});await d({id:s.id||t,customerId:s.customerId,restaurantId:s.restaurantId||x||"",subtotal:s.subtotal,total:s.total},i,"owner"),i.success&&y.success("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨Ø§Ù„Øº ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ âœ…")}catch(n){console.warn("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:",n),y.warning("ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ù„ÙƒÙ† ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ")}return}try{const{notifyOrderAccepted:n,notifyOrderPreparing:d,notifyOrderReady:i,notifyCourierOrderReady:o}=await O(async()=>{const{notifyOrderAccepted:m,notifyOrderPreparing:u,notifyOrderReady:v,notifyCourierOrderReady:R}=await import("./notificationService-CH0h_Jqx.js");return{notifyOrderAccepted:m,notifyOrderPreparing:u,notifyOrderReady:v,notifyCourierOrderReady:R}},__vite__mapDeps([6,3,1,2,4,5])),a=s==null?void 0:s.customerId,c=(s==null?void 0:s.restaurantName)||"Ø§Ù„Ù…Ø·Ø¹Ù…";if(a){if(r==="accepted")await n(a,t,c);else if(r==="preparing")await d(a,t,c);else if(r==="ready"&&(await i(a,t,c,(s==null?void 0:s.deliveryType)||"delivery"),(s==null?void 0:s.deliveryType)==="delivery"&&x)){const{collection:m,query:u,where:v,getDocs:R}=await O(async()=>{const{collection:C,query:N,where:G,getDocs:K}=await import("./vendor-firebase-Co4MdP0H.js").then(W=>W.M);return{collection:C,query:N,where:G,getDocs:K}},[]),H=u(m(f,"hiringRequests"),v("restaurantId","==",x),v("status","==","accepted")),J=await R(H),Q=(s==null?void 0:s.address)||"Ø§Ù„Ø¹Ù…ÙŠÙ„";for(const C of J.docs){const N=C.data().courierId;N&&await o(N,t,c,Q)}}}}catch(n){console.warn("âš ï¸ ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:",n)}},q=async(t,r)=>{const s={stars:r.stars,comment:r.comment||void 0,createdAt:new Date};await k(F(f,"orders",t),{"ratings.restaurantToCustomer":s,updatedAt:b()}),y.success("ØªÙ… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! â­")},B=t=>{var r,s;return t.status==="delivered"&&!((s=(r=t.ratings)==null?void 0:r.restaurantToCustomer)!=null&&s.stars)},z=async(t,r)=>{if(r){$(t);try{const s=ae(Z,`orders/${t}/ready_${Date.now()}.jpg`);await re(s,r);const l=await ne(s);await k(F(f,"orders",t),{readyPhotoUrl:l,readyPhotoAt:b(),updatedAt:b()}),y.success("ØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ðŸ“¸")}catch(s){console.error("Error uploading photo:",s),y.error("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©")}finally{$(null)}}},V=(t,r)=>{var l;const s=(l=r.target.files)==null?void 0:l[0];s&&z(t,s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-extrabold text-yellow-500",children:"ðŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª"}),h&&e.jsx(le,{isOpen:h.isOpen,onClose:()=>I(null),onSubmit:async t=>{await q(h.orderId,t),I(null)},type:"customer",targetName:h.customerName,orderId:h.orderId}),w&&e.jsx("div",{className:"text-red-500 text-sm mb-2",children:w}),A.map(t=>{var r,s,l,n,d,i,o;return e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-5 text-gray-900 space-y-4 transition hover:shadow-2xl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsxs("div",{className:"font-bold text-lg",children:["Ø·Ù„Ø¨ #",t.id.slice(-6),e.jsx("span",{className:"text-gray-500 text-sm ml-2",children:(r=t.items)==null?void 0:r.map(a=>`${a.name}Ã—${a.qty}`).join(" â€¢ ")})]}),e.jsxs("div",{className:"font-extrabold text-xl text-green-600",children:[(l=(s=t.total)==null?void 0:s.toFixed)==null?void 0:l.call(s,2)," Ø±.Ø³"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Ø§Ù„Ø­Ø§Ù„Ø©:"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${ue(t.status)}`,children:D(t.status||"pending")})]}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:"})," ",t.address]}),t.location&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-800 mb-2",children:"ðŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„:"}),e.jsx("iframe",{title:`map-${t.id}`,width:"100%",height:"250",style:{borderRadius:"12px"},loading:"lazy",allowFullScreen:!0,src:`https://www.google.com/maps?q=${t.location.lat},${t.location.lng}&hl=ar&z=15&output=embed`})]}),t.status==="pending"&&t.deliveryType==="delivery"&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:[e.jsx("label",{className:"block text-sm font-bold text-amber-800 mb-2",children:"ðŸ’µ Ø­Ø¯Ø¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ù‚Ø¨ÙˆÙ„:"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"number",min:"0",step:"0.5",placeholder:"Ù…Ø«Ø§Ù„: 10",value:j[t.id]||"",onChange:a=>M(c=>({...c,[t.id]:parseFloat(a.target.value)||0})),className:"flex-1 px-4 py-3 border-2 border-amber-300 rounded-xl focus:border-amber-500 focus:ring-2 focus:ring-amber-200 text-lg font-bold text-center"}),e.jsx("span",{className:"text-amber-700 font-bold",children:"Ø±.Ø³"})]}),e.jsx("p",{className:"text-xs text-amber-600 mt-2",children:"Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ù†Ø¯ Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨"})]}),t.deliveryFee!==void 0&&t.deliveryFee>0&&e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„:"})," ",(d=(n=t.deliveryFee)==null?void 0:n.toFixed)==null?void 0:d.call(n,2)," Ø±.Ø³"]}),["preparing","ready"].includes(t.status)&&e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-200 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(S,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"font-bold text-purple-800",children:"ðŸ“¸ ØµÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø§Ù‡Ø²"})]}),t.readyPhotoUrl?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.readyPhotoUrl,alt:"ØµÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨",className:"w-full h-48 object-cover rounded-xl border-2 border-purple-300"}),e.jsxs("div",{className:"absolute top-2 left-2 bg-green-500 text-white px-2 py-1 rounded-full text-xs font-bold flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),"ØªÙ… Ø§Ù„Ø±ÙØ¹"]})]}),e.jsx("p",{className:"text-xs text-purple-600 text-center",children:"âœ… ØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨ - ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø§Ø³ØªÙ„Ø§Ù…Ù‡ Ø§Ù„Ø¢Ù†"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-purple-700",children:"âš ï¸ ÙŠÙØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨ Ù‚Ø¨Ù„ ØªØ³Ù„ÙŠÙ…Ù‡ Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨"}),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:a=>V(t.id,a),className:"hidden",id:`photo-${t.id}`}),e.jsx("label",{htmlFor:`photo-${t.id}`,className:`flex items-center justify-center gap-3 w-full py-4 rounded-xl cursor-pointer transition-all ${T===t.id?"bg-purple-200 cursor-wait":"bg-purple-500 hover:bg-purple-600 text-white"}`,children:T===t.id?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold",children:"ðŸ“¸ Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨"})]})})]})]}),t.readyPhotoUrl&&!["preparing","ready"].includes(t.status)&&e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(de,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"ØµÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨:"})]}),e.jsx("img",{src:t.readyPhotoUrl,alt:"ØµÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨",className:"w-full h-32 object-cover rounded-lg"})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 sm:flex sm:flex-wrap gap-2",children:[!t.courierId&&["pending","accepted","preparing","ready"].includes(t.status)&&e.jsxs("button",{onClick:()=>E(`/chat?orderId=${t.id}`),className:"px-4 py-2 rounded-xl text-sm font-semibold bg-gradient-to-r from-orange-500 to-amber-500 text-white hover:shadow-lg transition flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ ðŸ’¬"]}),["accepted","preparing","ready","out_for_delivery","delivered","cancelled"].map(a=>{const c=a==="accepted"&&t.status==="pending"&&t.deliveryType==="delivery",m=j[t.id]!==void 0&&j[t.id]>=0,u=c&&!m;return e.jsx("button",{onClick:()=>L(t.id,a,t),disabled:u,className:`px-4 py-2 rounded-xl text-sm font-semibold transition ${u?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gray-100 hover:bg-gray-200"}`,title:u?"Ø­Ø¯Ø¯ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹":"",children:D(a)},a)})]}),B(t)&&e.jsxs("div",{className:"mt-4 bg-gradient-to-r from-sky-50 to-blue-50 border-2 border-sky-200 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(P,{className:"w-5 h-5 text-sky-500 fill-sky-500"}),e.jsx("span",{className:"font-bold text-sky-800",children:"Ù‚ÙŠÙ‘Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ â­"})]}),e.jsxs("button",{onClick:()=>I({isOpen:!0,orderId:t.id,customerName:"Ø§Ù„Ø¹Ù…ÙŠÙ„"}),className:`w-full flex items-center justify-between px-4 py-3 bg-white border-2 border-sky-300 
                           rounded-xl hover:bg-sky-50 transition-all group`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-5 h-5 text-sky-600"}),e.jsx("span",{className:"font-medium text-gray-800",children:"Ù‚ÙŠÙ‘Ù… ØªØ¹Ø§Ù…Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„"})]}),e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(a=>e.jsx(P,{className:"w-4 h-4 text-gray-300 group-hover:text-sky-400 transition"},a))})]})]}),((o=(i=t.ratings)==null?void 0:i.restaurantToCustomer)==null?void 0:o.stars)&&e.jsx("div",{className:"mt-4 bg-green-50 border border-green-200 rounded-xl p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-green-700 font-medium",children:"ØªÙ‚ÙŠÙŠÙ…Ùƒ Ù„Ù„Ø¹Ù…ÙŠÙ„:"}),e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(a=>e.jsx(P,{className:`w-4 h-4 ${a<=t.ratings.restaurantToCustomer.stars?"text-sky-400 fill-sky-400":"text-gray-300"}`},a))})]})})]},t.id)}),A.length===0&&!w&&e.jsx("div",{className:"text-gray-400 text-center text-lg",children:"ðŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹."})]})};export{fe as OrdersAdmin};
