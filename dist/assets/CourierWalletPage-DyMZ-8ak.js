import{u as je,b as be,j as e,d as u}from"./index-FuU3jBZc.js";import{r as c}from"./vendor-react-C_wfuX_s.js";import{j as H,k as J,q as K,m as V,w as Ne,F as X,G as ee,t as se}from"./vendor-firebase-Co4MdP0H.js";import{ae as fe,s as ye,t as we,ac as te,b7 as ve,E as ke,T as ae,Z as De,aC as re,aL as Ee,j as Fe,ad as Se,a$ as Ae,b0 as Ce}from"./vendor-icons-Dyg7S3Xx.js";const le=3.75,Te=()=>{const{user:a,role:d}=je(),b=be(),[x,N]=c.useState(new Date().getFullYear()),[o,ne]=c.useState(new Date().getMonth()+1),[F,S]=c.useState(!0),[f,A]=c.useState(null),[r,ie]=c.useState({todayDeliveries:0,todayEarnings:0,todayFees:0,weekDeliveries:0,weekEarnings:0,weekFees:0,monthDeliveries:0,monthEarnings:0,monthFees:0,totalDeliveries:0,totalEarnings:0,totalFees:0,netEarnings:0,availableBalance:0}),[C,ce]=c.useState([]),[$,L]=c.useState([]),[oe,de]=c.useState("");if(c.useEffect(()=>{a!=null&&a.uid&&(d==="courier"||d==="developer")&&M()},[a==null?void 0:a.uid,x,o,d]),d!=="courier"&&d!=="developer")return e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-red-500",children:"Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©"})});const M=async()=>{if(a!=null&&a.uid){S(!0);try{const s=await H(J(u,"couriers",a.uid));s.exists()&&de(s.data().name||"Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨");const t=await H(J(u,"wallets",a.uid));if(t.exists()){const n=t.data();A(n)}else A({id:a.uid,ownerType:"courier",balance:0,totalEarnings:0,totalPlatformFees:0,netEarnings:0,totalWithdrawn:0});const l=K(V(u,"orders"),Ne("courierId","==",a.uid),X("createdAt","desc"),ee(200)),pe=(await se(l)).docs.map(n=>({id:n.id,...n.data()})),w=new Date,P=new Date(w.getFullYear(),w.getMonth(),w.getDate()),v=new Date(P);v.setDate(v.getDate()-7);const ge=new Date(x,o-1,1),ue=new Date(x,o,0,23,59,59);let Y=0,B=0,W=0,_=0,I=0,U=0,q=0,O=0,Q=0,G=0,k=0,D=0;const E=[];pe.forEach(n=>{var g,z;const p=((z=(g=n.createdAt)==null?void 0:g.toDate)==null?void 0:z.call(g))||new Date(n.createdAt),m=n.deliveryFee||0,h=n.courierPlatformFee||le;E.length<20&&E.push({id:n.id,deliveryFee:m,platformFee:h,status:n.status,createdAt:n.createdAt,restaurantName:n.restaurantName}),n.status==="delivered"&&(G++,k+=m,D+=h,p>=P&&(Y++,B+=m,W+=h),p>=v&&(_++,I+=m,U+=h),p>=ge&&p<=ue&&(q++,O+=m,Q+=h))});const Z=k-D;ie({todayDeliveries:Y,todayEarnings:B,todayFees:W,weekDeliveries:_,weekEarnings:I,weekFees:U,monthDeliveries:q,monthEarnings:O,monthFees:Q,totalDeliveries:G,totalEarnings:k,totalFees:D,netEarnings:Z,availableBalance:(f==null?void 0:f.balance)||Z}),ce(E),await xe()}catch(s){console.error("Error loading wallet data:",s),b.error("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")}finally{S(!1)}}},xe=async()=>{if(a!=null&&a.uid)try{const s=K(V(u,"wallets",a.uid,"transactions"),X("createdAt","desc"),ee(50)),t=await se(s);L(t.docs.map(l=>({id:l.id,...l.data()})))}catch{L([])}},R=s=>{let t=o+s,l=x;t>12?(t=1,l++):t<1&&(t=12,l--),ne(t),N(l)},T=s=>["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"][s-1],i=s=>`${s.toFixed(2)} Ø±.Ø³`,me=s=>({ready:{text:"Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…",color:"text-sky-600 bg-sky-50"},out_for_delivery:{text:"ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚",color:"text-orange-600 bg-orange-50"},delivered:{text:"ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…",color:"text-emerald-600 bg-emerald-50"},cancelled:{text:"Ù…Ù„ØºÙŠ",color:"text-red-600 bg-red-50"}})[s]||{text:s,color:"text-gray-600 bg-gray-50"},he=s=>{var l;return s?(((l=s==null?void 0:s.toDate)==null?void 0:l.call(s))||new Date(s)).toLocaleDateString("ar-SA",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"-"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-sky-900 flex items-center gap-2",children:[e.jsx(fe,{className:"w-7 h-7"}),"Ù…Ø­ÙØ¸ØªÙŠ"]}),e.jsx("p",{className:"text-sky-600 mt-1",children:oe})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-xl p-2 shadow-sm border border-sky-100",children:[e.jsx("button",{onClick:()=>R(-1),className:"p-2 hover:bg-sky-50 rounded-lg transition",children:e.jsx(ye,{className:"w-5 h-5 text-sky-600"})}),e.jsxs("div",{className:"px-4 py-2 font-semibold text-sky-900 min-w-[140px] text-center",children:[T(o)," ",x]}),e.jsx("button",{onClick:()=>R(1),className:"p-2 hover:bg-sky-50 rounded-lg transition",children:e.jsx(we,{className:"w-5 h-5 text-sky-600"})}),e.jsx("button",{onClick:M,className:"p-2 hover:bg-sky-50 rounded-lg transition mr-2",title:"ØªØ­Ø¯ÙŠØ«",children:e.jsx(te,{className:`w-5 h-5 text-sky-600 ${F?"animate-spin":""}`})})]})]}),F?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"w-8 h-8 animate-spin text-sky-500 mx-auto mb-3"}),e.jsx("p",{className:"text-sky-600",children:"Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl p-6 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("span",{className:"text-orange-100 flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5"}),"ØµØ§ÙÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­"]}),e.jsx("span",{className:"bg-white/20 px-3 py-1 rounded-full text-sm",children:"Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨"})]}),e.jsx("p",{className:"text-4xl font-bold mb-2",children:i(r.netEarnings)}),e.jsxs("div",{className:"flex gap-6 mt-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-orange-200",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­"}),e.jsx("p",{className:"font-semibold",children:i(r.totalEarnings)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-orange-200",children:"Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ©"}),e.jsxs("p",{className:"font-semibold text-orange-200",children:["-",i(r.totalFees)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-orange-200",children:"Ø§Ù„ØªÙˆØµÙŠÙ„Ø§Øª"}),e.jsx("p",{className:"font-semibold",children:r.totalDeliveries})]})]})]}),e.jsxs("div",{className:"bg-amber-50 rounded-xl p-4 border border-amber-200 flex items-start gap-3",children:[e.jsx(ke,{className:"w-5 h-5 text-amber-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ù†ØµØ©"}),e.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:["ÙŠØªÙ… Ø®ØµÙ… ",i(le)," Ù…Ù† ÙƒÙ„ Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„ ÙƒØ±Ø³ÙˆÙ… Ù„Ù„Ù…Ù†ØµØ©"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(j,{title:"Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…",value:i(r.todayEarnings-r.todayFees),subtitle:`${r.todayDeliveries} ØªÙˆØµÙŠÙ„Ø©`,icon:e.jsx(ae,{className:"w-5 h-5"}),color:"emerald"}),e.jsx(j,{title:"Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",value:i(r.weekEarnings-r.weekFees),subtitle:`${r.weekDeliveries} ØªÙˆØµÙŠÙ„Ø©`,icon:e.jsx(De,{className:"w-5 h-5"}),color:"sky"}),e.jsx(j,{title:"Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø´Ù‡Ø±",value:i(r.monthEarnings-r.monthFees),subtitle:`${r.monthDeliveries} ØªÙˆØµÙŠÙ„Ø©`,icon:e.jsx(re,{className:"w-5 h-5"}),color:"purple"}),e.jsx(j,{title:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­",value:i(r.totalEarnings),subtitle:`${r.totalDeliveries} ØªÙˆØµÙŠÙ„Ø©`,icon:e.jsx(Ee,{className:"w-5 h-5"}),color:"amber"})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sky-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-sky-900 mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"ØªÙØ§ØµÙŠÙ„ ",T(o)]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-sky-50 rounded-xl",children:[e.jsx("p",{className:"text-2xl font-bold text-sky-900",children:r.monthDeliveries}),e.jsx("p",{className:"text-sm text-sky-600",children:"ØªÙˆØµÙŠÙ„Ø©"})]}),e.jsxs("div",{className:"text-center p-4 bg-emerald-50 rounded-xl",children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:i(r.monthEarnings)}),e.jsx("p",{className:"text-sm text-emerald-600",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-xl",children:[e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:["-",i(r.monthFees)]}),e.jsx("p",{className:"text-sm text-red-600",children:"Ø±Ø³ÙˆÙ…"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sky-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-sky-900 mb-4 flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Ø¢Ø®Ø± Ø§Ù„ØªÙˆØµÙŠÙ„Ø§Øª"]}),C.length>0?e.jsx("div",{className:"space-y-3",children:C.slice(0,10).map(s=>{const t=me(s.status);return s.deliveryFee-(s.status==="delivered"?s.platformFee:0),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-sky-50/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(Fe,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sky-900 text-sm",children:s.restaurantName||`Ø·Ù„Ø¨ #${s.id.slice(-6)}`}),e.jsx("p",{className:"text-xs text-sky-500",children:he(s.createdAt)})]})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:"font-bold text-sky-900",children:[i(s.deliveryFee),s.status==="delivered"&&e.jsxs("span",{className:"text-xs text-red-500 mr-1",children:["(-",i(s.platformFee),")"]})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t.color}`,children:t.text})]})]},s.id)})}):e.jsx("p",{className:"text-center text-sky-500 py-8",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØµÙŠÙ„Ø§Øª Ø¨Ø¹Ø¯"})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sky-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-sky-900 mb-4 flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5"}),"Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª"]}),$.length>0?e.jsx("div",{className:"space-y-3",children:$.map(s=>{var t,l,y;return e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-sky-50 last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${s.type==="credit"?"bg-emerald-100":"bg-red-100"}`,children:s.type==="credit"?e.jsx(Ae,{className:"w-5 h-5 text-emerald-600"}):e.jsx(Ce,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sky-900 text-sm",children:s.description}),e.jsx("p",{className:"text-xs text-sky-500",children:((y=(l=(t=s.createdAt)==null?void 0:t.toDate)==null?void 0:l.call(t))==null?void 0:y.toLocaleDateString("ar-SA"))||(s.createdAt instanceof Date?s.createdAt.toLocaleDateString("ar-SA"):"-")})]})]}),e.jsxs("span",{className:`font-bold ${s.type==="credit"?"text-emerald-600":"text-red-600"}`,children:[s.type==="credit"?"+":"-",i(s.amount)]})]},s.id)})}):e.jsx("p",{className:"text-center text-sky-500 py-8",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø¹Ø¯"})]}),e.jsx("div",{className:"bg-sky-50 rounded-xl p-4 border border-sky-100",children:e.jsx("p",{className:"text-sm text-sky-700 text-center",children:"ðŸ’¡ ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø© Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø®Ù„Ø§Ù„ 3-5 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„"})})]})]})},j=({title:a,value:d,subtitle:b,icon:x,color:N})=>{const o={sky:"bg-sky-50 text-sky-600",emerald:"bg-emerald-50 text-emerald-600",purple:"bg-purple-50 text-purple-600",amber:"bg-amber-50 text-amber-600"};return e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-sky-100",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${o[N]} flex items-center justify-center mb-3`,children:x}),e.jsx("p",{className:"text-sm text-sky-600 mb-1",children:a}),e.jsx("p",{className:"text-xl font-bold text-sky-900",children:d}),e.jsx("p",{className:"text-xs text-sky-500 mt-1",children:b})]})};export{Te as CourierWalletPage,Te as default};
