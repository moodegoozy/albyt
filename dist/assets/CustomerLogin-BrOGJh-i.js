import{c as F,e as k,j as e,d as w}from"./index-FuU3jBZc.js";import{r as n,b as z,L as I}from"./vendor-react-C_wfuX_s.js";import{R as P,E as V,j as W,k as j,s as q,z as M,u as _}from"./vendor-firebase-Co4MdP0H.js";import{ab as H,ac as S,A as J,a1 as K,a0 as U}from"./vendor-icons-Dyg7S3Xx.js";const E=c=>{let l=c.replace(/\D/g,"");return l.startsWith("0")&&(l=l.substring(1)),l.startsWith("966")||(l="966"+l),"+"+l},Z=()=>{const[c,l]=n.useState(""),[u,y]=n.useState(""),[b,x]=n.useState("phone"),[g,p]=n.useState(!1),[N,C]=n.useState(null),[i,L]=n.useState(0),h=n.useRef(null),r=n.useRef(null),m=z(),s=F();n.useEffect(()=>(h.current&&!r.current&&(r.current=new P(k,h.current,{size:"invisible",callback:()=>{},"expired-callback":()=>{r.current=null}})),()=>{r.current&&(r.current.clear(),r.current=null)}),[]),n.useEffect(()=>{if(i>0){const t=setTimeout(()=>L(i-1),1e3);return()=>clearTimeout(t)}},[i]);const T=async()=>{if(!c||c.length<9){s.warning("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ ØµØ­ÙŠØ­");return}const t=E(c);p(!0);try{!r.current&&h.current&&(r.current=new P(k,h.current,{size:"invisible"}));const a=await V(k,t,r.current);C(a),x("otp"),L(60),s.success("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ Ø¬ÙˆØ§Ù„Ùƒ")}catch(a){console.error("OTP Error:",a),r.current&&(r.current.clear(),r.current=null),a.code==="auth/invalid-phone-number"?s.error("Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ØºÙŠØ± ØµØ­ÙŠØ­"):a.code==="auth/too-many-requests"?s.error("Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹"):a.code==="auth/quota-exceeded"?s.error("ØªÙ… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØŒ Ø­Ø§ÙˆÙ„ ØºØ¯Ø§Ù‹"):s.error(a.message||"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²")}finally{p(!1)}},O=async()=>{if(!u||u.length!==6){s.warning("Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…");return}if(!N){s.error("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø£Ø¹Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²"),x("phone");return}p(!0);try{const t=await N.confirm(u),a=t.user.uid,D=t.user.phoneNumber,v=await W(j(w,"users",a));let R=!1;v.exists()?s.success("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ! ğŸ‘‹"):(R=!0,await q(j(w,"users",a),{phone:D,role:"customer",name:"",createdAt:M()}),s.success("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰"));const o=v.exists()?v.data():{role:"customer"};if(!((o==null?void 0:o.savedLocation)||(o==null?void 0:o.location))&&(o.role==="customer"||R))try{navigator.geolocation&&navigator.geolocation.getCurrentPosition(async d=>{const f={lat:d.coords.latitude,lng:d.coords.longitude,address:"Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ"};await _(j(w,"users",a),{savedLocation:f,location:{lat:f.lat,lng:f.lng}}),sessionStorage.setItem("broast_session_location",JSON.stringify({lat:f.lat,lng:f.lng}))},d=>{console.warn("ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:",d)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}catch(d){console.warn("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹:",d)}o.role==="owner"?m("/owner"):o.role==="admin"?m("/admin"):o.role==="developer"?m("/developer"):o.role==="courier"?m("/courier"):m("/")}catch(t){console.error("Verify Error:",t),t.code==="auth/invalid-verification-code"?s.error("Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­"):t.code==="auth/code-expired"?(s.error("Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø±Ù…Ø²ØŒ Ø£Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„"),x("phone")):s.error(t.message||"ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚")}finally{p(!1)}},A=()=>{i>0||(x("phone"),y(""),C(null))};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-sky-50 via-white to-sky-100 px-4",children:[e.jsx("div",{className:"absolute top-0 left-0 w-72 h-72 bg-sky-300/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-72 h-72 bg-sky-400/20 rounded-full blur-3xl"}),e.jsx("div",{ref:h,id:"recaptcha-container"}),e.jsxs("div",{className:"relative bg-white/80 backdrop-blur-xl border border-sky-100 rounded-[2rem] shadow-2xl shadow-sky-200/50 w-full max-w-md p-8",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-sky-500 to-sky-600 rounded-2xl flex items-center justify-center shadow-xl shadow-sky-300/50 mb-4",children:e.jsx("span",{className:"text-4xl",children:"ğŸ"})}),e.jsx("h1",{className:"text-3xl font-black text-sky-600",children:"Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª"}),e.jsx("p",{className:"text-sky-500 mt-1",children:b==="phone"?"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„":"Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚"})]}),b==="phone"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-sky-400"}),e.jsx("input",{type:"tel",placeholder:"05xxxxxxxx",dir:"ltr",className:`w-full rounded-2xl p-4 pr-12 bg-sky-50 text-sky-900 border-2 border-sky-100 
                           focus:outline-none focus:border-sky-400 focus:ring-4 focus:ring-sky-100 transition-all text-center text-lg tracking-wider`,value:c,onChange:t=>l(t.target.value.replace(/\D/g,"")),maxLength:10})]}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Ø³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ù…Ø² ØªØ­Ù‚Ù‚ Ø¹Ø¨Ø± SMS"}),e.jsx("button",{onClick:T,disabled:g||c.length<9,className:`w-full flex items-center justify-center gap-3 bg-gradient-to-r from-sky-500 to-sky-600 hover:from-sky-600 hover:to-sky-700 text-white font-bold p-4 rounded-2xl 
                         shadow-xl shadow-sky-300/50 transition-all hover:scale-[1.02] hover:shadow-sky-400/50 disabled:opacity-50 disabled:hover:scale-100`,children:g?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-5 h-5 animate-spin"}),"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-5 h-5"}),"Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚"]})})]}),b==="otp"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"text-gray-600",children:"Ø£Ø±Ø³Ù„Ù†Ø§ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰"}),e.jsx("p",{className:"font-bold text-sky-600 text-lg",dir:"ltr",children:E(c)})]}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-sky-400"}),e.jsx("input",{type:"text",inputMode:"numeric",placeholder:"000000",dir:"ltr",className:`w-full rounded-2xl p-4 pr-12 bg-sky-50 text-sky-900 border-2 border-sky-100 
                           focus:outline-none focus:border-sky-400 focus:ring-4 focus:ring-sky-100 transition-all text-center text-2xl tracking-[0.5em] font-bold`,value:u,onChange:t=>y(t.target.value.replace(/\D/g,"")),maxLength:6,autoFocus:!0})]}),e.jsx("button",{onClick:O,disabled:g||u.length!==6,className:`w-full flex items-center justify-center gap-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold p-4 rounded-2xl 
                         shadow-xl shadow-green-300/50 transition-all hover:scale-[1.02] hover:shadow-green-400/50 disabled:opacity-50 disabled:hover:scale-100`,children:g?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-5 h-5 animate-spin"}),"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-5 h-5"}),"ØªØ£ÙƒÙŠØ¯ ÙˆØ¯Ø®ÙˆÙ„"]})}),e.jsx("div",{className:"text-center",children:i>0?e.jsxs("p",{className:"text-gray-500 text-sm",children:["Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¯ ",e.jsx("span",{className:"font-bold text-sky-600",children:i})," Ø«Ø§Ù†ÙŠØ©"]}):e.jsx("button",{onClick:A,className:"text-sky-600 hover:text-sky-700 font-semibold text-sm",children:"Ù„Ù… ÙŠØµÙ„Ùƒ Ø§Ù„Ø±Ù…Ø²ØŸ Ø£Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„"})}),e.jsx("button",{onClick:()=>{x("phone"),y("")},className:"w-full text-gray-500 hover:text-gray-700 text-sm",children:"â† ØªØºÙŠÙŠØ± Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„"})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-sky-100",children:[e.jsx("p",{className:"text-center text-sm text-gray-500 mb-3",children:"ØµØ§Ø­Ø¨ Ù…Ø·Ø¹Ù… Ø£Ùˆ Ù…Ù†Ø¯ÙˆØ¨ØŸ"}),e.jsx(I,{to:"/login",className:"block text-center text-sky-600 hover:text-sky-700 font-semibold",children:"ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ â†’"})]})]})]})};export{Z as CustomerLogin};
