import{u as le,b as re,j as e,d as B}from"./index-FuU3jBZc.js";import{r as b}from"./vendor-react-C_wfuX_s.js";import{q as U,m as T,w as _,F as G,t as O,G as oe}from"./vendor-firebase-Co4MdP0H.js";import{ar as ne,s as ie,t as ce,ac as K,ae as de,b6 as me,a4 as X,P as xe,b7 as pe,aL as ue,R as he,T as be,aC as ge,Z as je,aX as ye}from"./vendor-icons-Dyg7S3Xx.js";const Z=3.75,Se=()=>{const{role:c}=le(),p=re(),[r,x]=b.useState(new Date().getFullYear()),[i,g]=b.useState(new Date().getMonth()+1),[N,v]=b.useState(!0),[s,z]=b.useState({totalOrders:0,totalOrdersValue:0,totalDeliveries:0,totalDeliveryFees:0,platformFees:0,adminCommissions:0,subscriptions:0,promotions:0,grossRevenue:0,netRevenue:0}),[$,H]=b.useState([]),[d,J]=b.useState({restaurants:{count:0,totalBalance:0,totalSales:0},couriers:{count:0,totalBalance:0,totalEarnings:0,totalFees:0},admins:{count:0,totalBalance:0,totalCommissions:0},app:{balance:0,totalEarnings:0}}),[ve,M]=b.useState([]);if(b.useEffect(()=>{c==="developer"&&A()},[r,i,c]),c!=="developer")return e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-red-500",children:"ليس لديك صلاحية الوصول لهذه الصفحة"})});const A=async()=>{v(!0);try{const t=`${r}-${String(i).padStart(2,"0")}`,l=new Date(r,i-1,1),o=new Date(r,i,0,23,59,59),j=U(T(B,"orders"),_("createdAt",">=",l),_("createdAt","<=",o),G("createdAt","desc")),f=(await O(j)).docs.map(a=>({id:a.id,...a.data()}));let n=0,D=0,V=0,L=0,R=0,E=0;const u={};f.forEach(a=>{var k,Q;n++,D+=a.total||0,a.status==="delivered"&&(V++,L+=a.deliveryFee||0,R+=a.courierPlatformFee||Z,a.adminCommission&&(E+=a.adminCommission));const h=(((Q=(k=a.createdAt)==null?void 0:k.toDate)==null?void 0:Q.call(k))||new Date(a.createdAt)).toISOString().split("T")[0];u[h]||(u[h]={date:h,orders:0,ordersValue:0,deliveries:0,deliveryFees:0,platformFees:0,adminCommissions:0}),u[h].orders++,u[h].ordersValue+=a.total||0,a.status==="delivered"&&(u[h].deliveries++,u[h].deliveryFees+=a.deliveryFee||0,u[h].platformFees+=a.courierPlatformFee||Z,u[h].adminCommissions+=a.adminCommission||0)});const W=0,Y=0,I=R+E+W+Y;z({totalOrders:n,totalOrdersValue:D,totalDeliveries:V,totalDeliveryFees:L,platformFees:R,adminCommissions:E,subscriptions:W,promotions:Y,grossRevenue:I,netRevenue:I});const ae=Object.values(u).sort((a,q)=>new Date(q.date).getTime()-new Date(a.date).getTime());H(ae),await ee(),await se()}catch(t){console.error("Error loading accounting data:",t),p.error("حدث خطأ في تحميل البيانات")}finally{v(!1)}},ee=async()=>{try{const t=await O(T(B,"wallets"));let l={count:0,totalBalance:0,totalSales:0},o={count:0,totalBalance:0,totalEarnings:0,totalFees:0},j={count:0,totalBalance:0,totalCommissions:0},F={balance:0,totalEarnings:0};t.docs.forEach(f=>{const n=f.data();f.id==="app_earnings"?F={balance:n.balance||0,totalEarnings:n.totalEarnings||0}:n.ownerType==="restaurant"?(l.count++,l.totalBalance+=n.balance||0,l.totalSales+=n.totalSales||0):n.ownerType==="courier"?(o.count++,o.totalBalance+=n.balance||0,o.totalEarnings+=n.totalEarnings||0,o.totalFees+=n.totalPlatformFees||0):(j.count++,j.totalBalance+=n.balance||0,j.totalCommissions+=n.totalEarnings||0)}),J({restaurants:l,couriers:o,admins:j,app:F})}catch(t){console.error("Error loading wallet summary:",t)}},se=async()=>{try{const t=U(T(B,"transactions"),G("createdAt","desc"),oe(20)),l=await O(t);M(l.docs.map(o=>({id:o.id,...o.data()})))}catch{M([])}},P=t=>{let l=i+t,o=r;l>12?(l=1,o++):l<1&&(l=12,o--),g(l),x(o)},te=t=>["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"][t-1],m=t=>`${t.toFixed(2)} ر.س`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-sky-900 flex items-center gap-2",children:[e.jsx(ne,{className:"w-7 h-7"}),"لوحة المحاسبة"]}),e.jsx("p",{className:"text-sky-600 mt-1",children:"إدارة ومراقبة إيرادات التطبيق"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-xl p-2 shadow-sm border border-sky-100",children:[e.jsx("button",{onClick:()=>P(-1),className:"p-2 hover:bg-sky-50 rounded-lg transition",children:e.jsx(ie,{className:"w-5 h-5 text-sky-600"})}),e.jsxs("div",{className:"px-4 py-2 font-semibold text-sky-900 min-w-[140px] text-center",children:[te(i)," ",r]}),e.jsx("button",{onClick:()=>P(1),className:"p-2 hover:bg-sky-50 rounded-lg transition",children:e.jsx(ce,{className:"w-5 h-5 text-sky-600"})}),e.jsx("button",{onClick:A,className:"p-2 hover:bg-sky-50 rounded-lg transition mr-2",title:"تحديث",children:e.jsx(K,{className:`w-5 h-5 text-sky-600 ${N?"animate-spin":""}`})})]})]}),N?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(K,{className:"w-8 h-8 animate-spin text-sky-500 mx-auto mb-3"}),e.jsx("p",{className:"text-sky-600",children:"جارِ تحميل البيانات..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(w,{title:"صافي الإيرادات",value:m(s.netRevenue),icon:e.jsx(de,{className:"w-6 h-6"}),color:"emerald",subtitle:"هذا الشهر"}),e.jsx(w,{title:"رسوم المنصة",value:m(s.platformFees),icon:e.jsx(me,{className:"w-6 h-6"}),color:"sky",subtitle:`من ${s.totalDeliveries} توصيلة`}),e.jsx(w,{title:"عمولات المشرفين",value:m(s.adminCommissions),icon:e.jsx(X,{className:"w-6 h-6"}),color:"purple",subtitle:"إجمالي العمولات"}),e.jsx(w,{title:"إجمالي الطلبات",value:s.totalOrders.toString(),icon:e.jsx(xe,{className:"w-6 h-6"}),color:"amber",subtitle:m(s.totalOrdersValue)})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sky-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-sky-900 mb-4 flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),"ملخص المحافظ"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(C,{title:"محفظة التطبيق",balance:d.app.balance,total:d.app.totalEarnings,icon:e.jsx(ue,{className:"w-5 h-5"}),color:"emerald"}),e.jsx(C,{title:"الأسر المنتجة",balance:d.restaurants.totalBalance,total:d.restaurants.totalSales,count:d.restaurants.count,icon:e.jsx(he,{className:"w-5 h-5"}),color:"sky"}),e.jsx(C,{title:"المناديب",balance:d.couriers.totalBalance,total:d.couriers.totalEarnings,count:d.couriers.count,icon:e.jsx(be,{className:"w-5 h-5"}),color:"orange"}),e.jsx(C,{title:"المشرفون",balance:d.admins.totalBalance,total:d.admins.totalCommissions,count:d.admins.count,icon:e.jsx(X,{className:"w-5 h-5"}),color:"purple"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sky-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-sky-900 mb-4 flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5"}),"الإحصائيات اليومية"]}),$.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-sky-100",children:[e.jsx("th",{className:"text-right py-3 px-2 font-semibold text-sky-700",children:"التاريخ"}),e.jsx("th",{className:"text-right py-3 px-2 font-semibold text-sky-700",children:"الطلبات"}),e.jsx("th",{className:"text-right py-3 px-2 font-semibold text-sky-700",children:"قيمة الطلبات"}),e.jsx("th",{className:"text-right py-3 px-2 font-semibold text-sky-700",children:"التوصيلات"}),e.jsx("th",{className:"text-right py-3 px-2 font-semibold text-sky-700",children:"رسوم المنصة"}),e.jsx("th",{className:"text-right py-3 px-2 font-semibold text-sky-700",children:"عمولات المشرفين"})]})}),e.jsx("tbody",{children:$.map(t=>e.jsxs("tr",{className:"border-b border-sky-50 hover:bg-sky-25",children:[e.jsx("td",{className:"py-3 px-2 font-medium",children:t.date}),e.jsx("td",{className:"py-3 px-2",children:t.orders}),e.jsx("td",{className:"py-3 px-2",children:m(t.ordersValue)}),e.jsx("td",{className:"py-3 px-2",children:t.deliveries}),e.jsx("td",{className:"py-3 px-2 text-emerald-600",children:m(t.platformFees)}),e.jsx("td",{className:"py-3 px-2 text-purple-600",children:m(t.adminCommissions)})]},t.date))})]})}):e.jsx("p",{className:"text-center text-sky-500 py-8",children:"لا توجد بيانات لهذا الشهر"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sky-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-sky-900 mb-4 flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5"}),"مصادر الإيرادات"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{label:"رسوم المنصة (من المناديب)",value:s.platformFees,percentage:s.platformFees/(s.grossRevenue||1)*100,color:"sky"}),e.jsx(S,{label:"عمولات المشرفين",value:s.adminCommissions,percentage:s.adminCommissions/(s.grossRevenue||1)*100,color:"purple"}),e.jsx(S,{label:"اشتراكات الباقات",value:s.subscriptions,percentage:s.subscriptions/(s.grossRevenue||1)*100,color:"amber"}),e.jsx(S,{label:"الإعلانات الممولة",value:s.promotions,percentage:s.promotions/(s.grossRevenue||1)*100,color:"emerald"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sky-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-sky-900 mb-4 flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"ملخص الشهر"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{label:"إجمالي الطلبات",value:s.totalOrders.toString()}),e.jsx(y,{label:"قيمة الطلبات",value:m(s.totalOrdersValue)}),e.jsx(y,{label:"الطلبات المكتملة",value:s.totalDeliveries.toString()}),e.jsx(y,{label:"إجمالي رسوم التوصيل",value:m(s.totalDeliveryFees)}),e.jsxs("div",{className:"border-t border-sky-100 pt-4 mt-4",children:[e.jsx(y,{label:"إجمالي الإيرادات",value:m(s.grossRevenue),highlight:!0}),e.jsx(y,{label:"صافي الإيرادات",value:m(s.netRevenue),highlight:!0,color:"emerald"})]})]})]})]})]})]})},w=({title:c,value:p,icon:r,color:x,subtitle:i})=>{const g={sky:"bg-sky-50 text-sky-600",emerald:"bg-emerald-50 text-emerald-600",purple:"bg-purple-50 text-purple-600",amber:"bg-amber-50 text-amber-600",orange:"bg-orange-50 text-orange-600"};return e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-sky-100",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${g[x]} flex items-center justify-center mb-3`,children:r}),e.jsx("p",{className:"text-sm text-sky-600 mb-1",children:c}),e.jsx("p",{className:"text-xl font-bold text-sky-900",children:p}),i&&e.jsx("p",{className:"text-xs text-sky-500 mt-1",children:i})]})},C=({title:c,balance:p,total:r,count:x,icon:i,color:g})=>{const N={sky:"border-sky-200 bg-sky-50",emerald:"border-emerald-200 bg-emerald-50",purple:"border-purple-200 bg-purple-50",orange:"border-orange-200 bg-orange-50"},v={sky:"text-sky-600",emerald:"text-emerald-600",purple:"text-purple-600",orange:"text-orange-600"};return e.jsxs("div",{className:`rounded-xl p-4 border ${N[g]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:v[g],children:i}),e.jsx("span",{className:"font-semibold text-sky-900 text-sm",children:c}),x!==void 0&&e.jsx("span",{className:"text-xs bg-white px-2 py-0.5 rounded-full text-sky-600",children:x})]}),e.jsxs("p",{className:`text-lg font-bold ${v[g]}`,children:[p.toFixed(2)," ر.س"]}),e.jsxs("p",{className:"text-xs text-sky-500 mt-1",children:["إجمالي: ",r.toFixed(2)," ر.س"]})]})},S=({label:c,value:p,percentage:r,color:x})=>{const i={sky:"bg-sky-500",emerald:"bg-emerald-500",purple:"bg-purple-500",amber:"bg-amber-500"};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-sky-700",children:c}),e.jsxs("span",{className:"font-semibold text-sky-900",children:[p.toFixed(2)," ر.س"]})]}),e.jsx("div",{className:"h-2 bg-sky-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${i[x]} rounded-full transition-all duration-500`,style:{width:`${Math.min(r,100)}%`}})})]})},y=({label:c,value:p,highlight:r,color:x="sky"})=>e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:r?"font-semibold text-sky-900":"text-sky-600",children:c}),e.jsx("span",{className:`font-bold ${x==="emerald"?"text-emerald-600":"text-sky-900"}`,children:p})]});export{Se as AccountingDashboard,Se as default};
