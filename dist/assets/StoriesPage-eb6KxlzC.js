import{u as Q,b as X,d as j,j as e,s as G}from"./index-FuU3jBZc.js";import{r as c}from"./vendor-react-C_wfuX_s.js";import{j as Z,k as F,q as P,m as N,w as T,t as $,H as ee,K as te,J as se,z as ae,T as le,y as re,p as ie}from"./vendor-firebase-Co4MdP0H.js";import{L as R,Y as ne,i as oe,X as U,av as ce,aD as de,aH as me,aA as xe,k as pe,ah as E,K as ue,as as fe,h as ge,a5 as he}from"./vendor-icons-Dyg7S3Xx.js";const be=24,Ne=()=>{const{user:n}=Q(),d=X(),[k,v]=c.useState([]),[C,L]=c.useState([]),[z,H]=c.useState(!0),[B,y]=c.useState(!1),[I,S]=c.useState(!1),[O,D]=c.useState(0),[g,q]=c.useState(null),h=c.useRef(null),[s,m]=c.useState({type:"image",mediaFile:null,mediaPreview:"",caption:"",backgroundColor:"#0ea5e9",textColor:"#ffffff",menuItemId:""});c.useEffect(()=>{n&&M()},[n]);const M=async()=>{if(n)try{const t=await Z(F(j,"restaurants",n.uid));t.exists()&&q(t.data());const a=P(N(j,"stories"),T("ownerId","==",n.uid)),r=await $(a),i=new Date,u=r.docs.map(l=>{var x,f,p,b;return{id:l.id,...l.data(),expiresAt:(f=(x=l.data().expiresAt)==null?void 0:x.toDate)==null?void 0:f.call(x),createdAt:(b=(p=l.data().createdAt)==null?void 0:p.toDate)==null?void 0:b.call(p)}}).filter(l=>l.expiresAt&&new Date(l.expiresAt)>i).sort((l,x)=>{var f,p;return(((f=x.createdAt)==null?void 0:f.getTime())||0)-(((p=l.createdAt)==null?void 0:p.getTime())||0)});v(u);const o=P(N(j,"menuItems"),T("ownerId","==",n.uid)),w=await $(o);L(w.docs.map(l=>({id:l.id,...l.data()})))}catch(t){console.error("Error loading data:",t),d.error("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")}finally{H(!1)}},_=t=>{var o;const a=(o=t.target.files)==null?void 0:o[0];if(!a)return;const r=a.type.startsWith("image/"),i=a.type.startsWith("video/");if(!r&&!i){d.warning("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ");return}const u=i?30*1024*1024:10*1024*1024;if(a.size>u){d.warning(i?"Ø­Ø¬Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 30 Ù…ÙŠØ¬Ø§":"Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 10 Ù…ÙŠØ¬Ø§");return}m({...s,type:i?"video":"image",mediaFile:a,mediaPreview:URL.createObjectURL(a)})},K=async()=>{if(n){if(s.type!=="text"&&!s.mediaFile){d.warning("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ");return}if(s.type==="text"&&!s.caption.trim()){d.warning("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø§Ù„Ø³ØªÙˆØ±ÙŠ");return}S(!0);try{let t="";if(s.mediaFile){const o=s.mediaFile.name.split(".").pop(),w=`stories/${n.uid}/${Date.now()}.${o}`,l=ee(G,w),x=te(l,s.mediaFile);await new Promise((f,p)=>{x.on("state_changed",b=>{const J=b.bytesTransferred/b.totalBytes*100;D(J)},p,async()=>{t=await se(x.snapshot.ref),f()})})}const a=new Date;a.setHours(a.getHours()+be);const r=C.find(o=>o.id===s.menuItemId),i={ownerId:n.uid,restaurantId:n.uid,restaurantName:g==null?void 0:g.name,restaurantLogo:g==null?void 0:g.logoUrl,type:s.type,mediaUrl:t||void 0,caption:s.caption.trim()||void 0,backgroundColor:s.type==="text"?s.backgroundColor:void 0,textColor:s.type==="text"?s.textColor:void 0,menuItemId:s.menuItemId||void 0,menuItemName:r==null?void 0:r.name,viewsCount:0,viewedBy:[],expiresAt:le.fromDate(a),createdAt:ae()},u=await re(N(j,"stories"),i);console.log("âœ… Story created successfully:",u.id),v(o=>[{id:u.id,...i,expiresAt:a,createdAt:new Date},...o]),d.success("ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø³ØªÙˆØ±ÙŠ! ðŸŽ‰"),y(!1),A()}catch(t){console.error("âŒ Error uploading story:",t),console.error("Error code:",t==null?void 0:t.code),console.error("Error message:",t==null?void 0:t.message),d.error(`Ø­Ø¯Ø« Ø®Ø·Ø£: ${(t==null?void 0:t.message)||"ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}`)}finally{S(!1),D(0)}}},V=async t=>{if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³ØªÙˆØ±ÙŠØŸ"))try{await ie(F(j,"stories",t)),v(a=>a.filter(r=>r.id!==t)),d.success("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³ØªÙˆØ±ÙŠ")}catch{d.error("Ø­Ø¯Ø« Ø®Ø·Ø£")}},A=()=>{m({type:"image",mediaFile:null,mediaPreview:"",caption:"",backgroundColor:"#0ea5e9",textColor:"#ffffff",menuItemId:""}),h.current&&(h.current.value="")},W=t=>{const a=new Date,r=new Date(t).getTime()-a.getTime(),i=Math.floor(r/(1e3*60*60)),u=Math.floor(r%(1e3*60*60)/(1e3*60));return i>0?`${i} Ø³Ø§Ø¹Ø©`:`${u} Ø¯Ù‚ÙŠÙ‚Ø©`},Y=["#0ea5e9","#8b5cf6","#ec4899","#f97316","#22c55e","#1f2937","#dc2626","#0891b2"];return z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(R,{className:"w-8 h-8 text-sky-500 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-sky-700",children:"ðŸ“¸ Ø³ØªÙˆØ±ÙŠ Ø§Ù„Ø£Ø³Ø±Ø©"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Ø´Ø§Ø±Ùƒ Ø·Ø¨Ø® Ø§Ù„ÙŠÙˆÙ… ÙˆØ¹Ø±ÙˆØ¶Ùƒ Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡"})]}),e.jsxs("button",{onClick:()=>{y(!0),A()},className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-xl font-bold shadow-lg hover:scale-105 transition",children:[e.jsx(ne,{className:"w-5 h-5"}),"Ø³ØªÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯"]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-pink-50 to-purple-50 rounded-2xl p-4 border border-pink-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-pink-700",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold",children:"Ø³ØªÙˆØ±ÙŠ Ù…Ø¬Ø§Ù†ÙŠ!"})]}),e.jsx("p",{className:"text-sm text-pink-600 mt-1",children:"Ø´Ø§Ø±Ùƒ ØµÙˆØ± Ø§Ù„Ø·Ø¨Ø® ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ Ù…Ø¹ Ø¹Ù…Ù„Ø§Ø¦Ùƒ. Ø§Ù„Ø³ØªÙˆØ±ÙŠ ÙŠØ¸Ù‡Ø± Ù„Ù€ 24 Ø³Ø§Ø¹Ø© Ø«Ù… ÙŠØ®ØªÙÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹."})]}),B&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-pink-500 to-purple-500 p-4 text-white sticky top-0 z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold",children:"ðŸ“¸ Ø³ØªÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯"}),e.jsx("button",{onClick:()=>y(!1),className:"p-1 hover:bg-white/20 rounded-lg",children:e.jsx(U,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Ù†ÙˆØ¹ Ø§Ù„Ø³ØªÙˆØ±ÙŠ"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("button",{onClick:()=>m({...s,type:"image",mediaFile:null,mediaPreview:""}),className:`p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition ${s.type==="image"?"border-pink-500 bg-pink-50":"border-gray-200"}`,children:[e.jsx(ce,{className:`w-6 h-6 ${s.type==="image"?"text-pink-600":"text-gray-400"}`}),e.jsx("span",{className:"text-xs font-medium",children:"ØµÙˆØ±Ø©"})]}),e.jsxs("button",{onClick:()=>m({...s,type:"video",mediaFile:null,mediaPreview:""}),className:`p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition ${s.type==="video"?"border-purple-500 bg-purple-50":"border-gray-200"}`,children:[e.jsx(de,{className:`w-6 h-6 ${s.type==="video"?"text-purple-600":"text-gray-400"}`}),e.jsx("span",{className:"text-xs font-medium",children:"ÙÙŠØ¯ÙŠÙˆ"})]}),e.jsxs("button",{onClick:()=>m({...s,type:"text",mediaFile:null,mediaPreview:""}),className:`p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition ${s.type==="text"?"border-sky-500 bg-sky-50":"border-gray-200"}`,children:[e.jsx(me,{className:`w-6 h-6 ${s.type==="text"?"text-sky-600":"text-gray-400"}`}),e.jsx("span",{className:"text-xs font-medium",children:"Ù†Øµ"})]})]})]}),(s.type==="image"||s.type==="video")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:s.type==="image"?"ðŸ“· Ø§Ø®ØªØ± ØµÙˆØ±Ø©":"ðŸŽ¬ Ø§Ø®ØªØ± ÙÙŠØ¯ÙŠÙˆ"}),e.jsx("input",{ref:h,type:"file",accept:s.type==="video"?"video/*":"image/*",onChange:_,className:"hidden"}),s.mediaPreview?e.jsxs("div",{className:"relative rounded-xl overflow-hidden bg-black aspect-[9/16] max-h-[300px]",children:[s.type==="video"?e.jsx("video",{src:s.mediaPreview,className:"w-full h-full object-contain",controls:!0}):e.jsx("img",{src:s.mediaPreview,alt:"Preview",className:"w-full h-full object-contain"}),e.jsx("button",{onClick:()=>{m({...s,mediaFile:null,mediaPreview:""}),h.current&&(h.current.value="")},className:"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full",children:e.jsx(U,{className:"w-4 h-4"})})]}):e.jsxs("button",{onClick:()=>{var t;return(t=h.current)==null?void 0:t.click()},className:"w-full aspect-[9/16] max-h-[200px] border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center gap-2 hover:border-pink-400 hover:bg-pink-50 transition",children:[e.jsx(xe,{className:"w-10 h-10 text-gray-400"}),e.jsx("span",{className:"text-gray-500 font-medium",children:"Ø§Ø¶ØºØ· Ù„Ù„Ø±ÙØ¹"}),e.jsx("span",{className:"text-xs text-gray-400",children:s.type==="video"?"Ø­Ø¯ 30 Ù…ÙŠØ¬Ø§":"Ø­Ø¯ 10 Ù…ÙŠØ¬Ø§"})]})]}),s.type==="text"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-[9/16] max-h-[250px] rounded-xl flex items-center justify-center p-6",style:{backgroundColor:s.backgroundColor},children:e.jsx("p",{className:"text-center text-xl font-bold leading-relaxed",style:{color:s.textColor},children:s.caption||"Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø³ØªÙˆØ±ÙŠ..."})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Y.map(t=>e.jsx("button",{onClick:()=>m({...s,backgroundColor:t}),className:`w-10 h-10 rounded-full transition-transform ${s.backgroundColor===t?"ring-4 ring-pink-300 scale-110":""}`,style:{backgroundColor:t}},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:s.type==="text"?"Ù†Øµ Ø§Ù„Ø³ØªÙˆØ±ÙŠ *":"Ù†Øµ Ù…ØµØ§Ø­Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"}),e.jsx("textarea",{value:s.caption,onChange:t=>m({...s,caption:t.target.value}),placeholder:s.type==="text"?"Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø³ØªÙˆØ±ÙŠ...":"Ù…Ø«Ø§Ù„: Ø·Ø¨Ø® Ø§Ù„ÙŠÙˆÙ… ðŸš",rows:3,className:"w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-pink-500 focus:outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:[e.jsx(pe,{className:"w-4 h-4 inline ml-1"}),"Ø±Ø¨Ø· Ø¨ØµÙ†Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"]}),e.jsxs("select",{value:s.menuItemId,onChange:t=>m({...s,menuItemId:t.target.value}),className:"w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-pink-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"Ø¨Ø¯ÙˆÙ† Ø±Ø¨Ø·"}),C.filter(t=>t.available!==!1).map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.price," Ø±.Ø³"]},t.id))]})]}),I&&e.jsxs("div",{className:"bg-pink-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"w-5 h-5 text-pink-500 animate-spin"}),e.jsx("span",{className:"text-pink-700 font-medium",children:"Ø¬Ø§Ø±Ù Ø§Ù„Ø±ÙØ¹..."})]}),e.jsx("div",{className:"h-2 bg-pink-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-pink-500 to-purple-500 transition-all duration-300",style:{width:`${O}%`}})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs("button",{onClick:K,disabled:I,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-xl font-bold shadow-lg hover:scale-[1.02] transition disabled:opacity-50",children:[e.jsx(E,{className:"w-5 h-5"}),"Ù†Ø´Ø± Ø§Ù„Ø³ØªÙˆØ±ÙŠ"]}),e.jsx("button",{onClick:()=>y(!1),className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-bold hover:bg-gray-200 transition",children:"Ø¥Ù„ØºØ§Ø¡"})]})]})]})}),k.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-2xl",children:[e.jsx("div",{className:"w-20 h-20 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(E,{className:"w-10 h-10 text-pink-500"})}),e.jsx("p",{className:"text-gray-600 font-semibold mb-2",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ØªÙˆØ±ÙŠØ§Øª"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Ø´Ø§Ø±Ùƒ Ø·Ø¨Ø® Ø§Ù„ÙŠÙˆÙ… Ù…Ø¹ Ø¹Ù…Ù„Ø§Ø¦Ùƒ!"})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:k.map(t=>e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"aspect-[9/16] rounded-2xl overflow-hidden shadow-lg",children:[t.type==="text"?e.jsx("div",{className:"w-full h-full flex items-center justify-center p-4",style:{backgroundColor:t.backgroundColor},children:e.jsx("p",{className:"text-center text-sm font-bold leading-relaxed line-clamp-6",style:{color:t.textColor},children:t.caption})}):t.type==="video"?e.jsx("video",{src:t.mediaUrl,className:"w-full h-full object-cover"}):e.jsx("img",{src:t.mediaUrl,alt:"",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"}),e.jsxs("div",{className:"absolute top-2 right-2 flex items-center gap-1 bg-black/50 text-white text-xs font-medium px-2 py-1 rounded-full",children:[e.jsx(ue,{className:"w-3 h-3"}),W(t.expiresAt)]}),e.jsxs("div",{className:"absolute bottom-2 right-2 flex items-center gap-1 bg-black/50 text-white text-xs font-medium px-2 py-1 rounded-full",children:[e.jsx(fe,{className:"w-3 h-3"}),t.viewsCount]}),e.jsx("button",{onClick:()=>V(t.id),className:"absolute top-2 left-2 p-2 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition",children:e.jsx(ge,{className:"w-4 h-4"})}),t.menuItemName&&e.jsxs("div",{className:"absolute bottom-2 left-2 flex items-center gap-1 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:[e.jsx(he,{className:"w-3 h-3"}),t.menuItemName]})]}),t.caption&&t.type!=="text"&&e.jsx("p",{className:"mt-2 text-sm text-gray-600 line-clamp-2",children:t.caption})]},t.id))})]})};export{Ne as StoriesPage,Ne as default};
