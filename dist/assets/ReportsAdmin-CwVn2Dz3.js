import{u as F,b as P,j as e,d as v}from"./index-FuU3jBZc.js";import{r as n}from"./vendor-react-C_wfuX_s.js";import{q as O,F as U,m as _,n as q,u as z,k as K,z as M}from"./vendor-firebase-Co4MdP0H.js";import{L as Y,d as y,D as G,v as H,b4 as J,U as Q,ad as V,T as W,P as X,f as k,as as S,K as Z,b5 as ee,aC as se,aS as ae,aT as le}from"./vendor-icons-Dyg7S3Xx.js";const w={orders:{label:"طلبات",icon:X,color:"blue",bgClass:"bg-blue-100",textClass:"text-blue-600"},delivery:{label:"توصيل",icon:W,color:"orange",bgClass:"bg-orange-100",textClass:"text-orange-600"},payment:{label:"دفع",icon:V,color:"green",bgClass:"bg-green-100",textClass:"text-green-600"},account:{label:"حساب",icon:Q,color:"purple",bgClass:"bg-purple-100",textClass:"text-purple-600"},suggestion:{label:"اقتراح",icon:J,color:"amber",bgClass:"bg-amber-100",textClass:"text-amber-600"}},C={customer:{label:"عميل",color:"blue",bgClass:"bg-blue-50",textClass:"text-blue-700"},owner:{label:"أسرة منتجة",color:"green",bgClass:"bg-green-50",textClass:"text-green-700"},courier:{label:"مندوب",color:"orange",bgClass:"bg-orange-50",textClass:"text-orange-700"}},b={pending:{label:"جديد",color:"yellow",icon:Z,bgClass:"bg-yellow-100",textClass:"text-yellow-700"},reviewed:{label:"تمت المراجعة",color:"blue",icon:S,bgClass:"bg-blue-100",textClass:"text-blue-700"},resolved:{label:"تم الحل",color:"green",icon:k,bgClass:"bg-green-100",textClass:"text-green-700"}},ie=()=>{const{user:d}=F(),x=P(),[c,E]=n.useState([]),[T,p]=n.useState(!0),[L,A]=n.useState(null),[m,R]=n.useState("all"),[u,I]=n.useState("all"),[g,D]=n.useState("all"),[h,$]=n.useState("");n.useEffect(()=>{const s=O(_(v,"problemReports"),U("createdAt","desc")),a=q(s,l=>{const t=l.docs.map(i=>{var r,N;return{id:i.id,...i.data(),createdAt:((N=(r=i.data().createdAt)==null?void 0:r.toDate)==null?void 0:N.call(r))||new Date}});E(t),p(!1)},l=>{console.error("Error fetching reports:",l),x.error("خطأ في جلب البلاغات"),p(!1)});return()=>a()},[]);const j=async(s,a)=>{try{await z(K(v,"problemReports",s),{status:a,adminId:d==null?void 0:d.uid,reviewedAt:M()}),x.success(`تم تغيير الحالة إلى: ${b[a].label}`)}catch(l){console.error("Error updating status:",l),x.error("خطأ في تحديث الحالة")}},f=c.filter(s=>{var a,l;if(m!=="all"&&s.problemType!==m||u!=="all"&&s.status!==u||g!=="all"&&s.userRole!==g)return!1;if(h){const t=h.toLowerCase();return s.description.toLowerCase().includes(t)||((a=s.userName)==null?void 0:a.toLowerCase().includes(t))||((l=s.userEmail)==null?void 0:l.toLowerCase().includes(t))}return!0}),o={total:c.length,pending:c.filter(s=>s.status==="pending").length,reviewed:c.filter(s=>s.status==="reviewed").length,resolved:c.filter(s=>s.status==="resolved").length},B=s=>new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(s);return T?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(Y,{className:"w-8 h-8 text-sky-600 animate-spin"})}):e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-sky-900 flex items-center gap-3",children:[e.jsx(y,{className:"w-8 h-8 text-sky-600"}),"إدارة البلاغات"]}),e.jsx("p",{className:"text-sky-600 mt-1",children:"مراجعة ومتابعة بلاغات المستخدمين"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"text-3xl font-bold text-sky-900",children:o.total}),e.jsx("div",{className:"text-sm text-gray-500",children:"إجمالي البلاغات"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-xl p-4 shadow-sm border border-yellow-100",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-700",children:o.pending}),e.jsx("div",{className:"text-sm text-yellow-600",children:"جديد"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 shadow-sm border border-blue-100",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-700",children:o.reviewed}),e.jsx("div",{className:"text-sm text-blue-600",children:"تمت المراجعة"})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-4 shadow-sm border border-green-100",children:[e.jsx("div",{className:"text-3xl font-bold text-green-700",children:o.resolved}),e.jsx("div",{className:"text-sm text-green-600",children:"تم الحل"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-sky-700",children:[e.jsx(G,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"تصفية البلاغات"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"بحث...",value:h,onChange:s=>$(s.target.value),className:"w-full pr-10 pl-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"})]}),e.jsxs("select",{value:m,onChange:s=>R(s.target.value),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500",children:[e.jsx("option",{value:"all",children:"جميع الأنواع"}),Object.entries(w).map(([s,{label:a}])=>e.jsx("option",{value:s,children:a},s))]}),e.jsxs("select",{value:u,onChange:s=>I(s.target.value),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500",children:[e.jsx("option",{value:"all",children:"جميع الحالات"}),Object.entries(b).map(([s,{label:a}])=>e.jsx("option",{value:s,children:a},s))]}),e.jsxs("select",{value:g,onChange:s=>D(s.target.value),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500",children:[e.jsx("option",{value:"all",children:"جميع المستخدمين"}),Object.entries(C).map(([s,{label:a}])=>e.jsx("option",{value:s,children:a},s))]})]})]}),f.length===0?e.jsxs("div",{className:"bg-white rounded-xl p-12 text-center shadow-sm",children:[e.jsx(y,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"لا توجد بلاغات"})]}):e.jsx("div",{className:"space-y-4",children:f.map(s=>{const a=w[s.problemType],l=C[s.userRole],t=b[s.status],i=a.icon;t.icon;const r=L===s.id;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>A(r?null:s.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${a.bgClass}`,children:e.jsx(i,{className:`w-5 h-5 ${a.textClass}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sky-900",children:a.label}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${t.bgClass} ${t.textClass}`,children:t.label})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[e.jsx("span",{className:`px-2 py-0.5 rounded ${l.bgClass} ${l.textClass}`,children:l.label}),s.userName&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),s.userName]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),B(s.createdAt)]})]})]})]}),e.jsx("div",{className:"text-gray-400",children:r?e.jsx(ae,{className:"w-5 h-5"}):e.jsx(le,{className:"w-5 h-5"})})]})}),r&&e.jsxs("div",{className:"border-t border-gray-100 p-4 bg-gray-50",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4",children:[e.jsx("h4",{className:"font-medium text-sky-900 mb-2",children:"وصف المشكلة:"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm",children:[s.userEmail&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"البريد:"}),e.jsx("span",{className:"mr-2 text-sky-700",children:s.userEmail})]}),s.userPhone&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"الهاتف:"}),e.jsx("span",{className:"mr-2 text-sky-700",children:s.userPhone})]})]}),s.status!=="resolved"&&e.jsxs("div",{className:"flex gap-2",children:[s.status==="pending"&&e.jsxs("button",{onClick:()=>j(s.id,"reviewed"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),"تمت المراجعة"]}),e.jsxs("button",{onClick:()=>j(s.id,"resolved"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"تم الحل"]})]})]})]},s.id)})})]})};export{ie as ReportsAdmin,ie as default};
