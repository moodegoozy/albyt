import{u as ie,b as xe,j as e,d as u}from"./index-FuU3jBZc.js";import{r as d}from"./vendor-react-C_wfuX_s.js";import{j as Q,k as U,q as _,m as G,w as me,F as Z,G as z,t as H}from"./vendor-firebase-Co4MdP0H.js";import{ae as he,s as pe,t as ue,ac as J,b7 as be,k as je,Z as ye,aC as ge,aL as fe,P as K,ad as we,a$ as Ne,b8 as ke}from"./vendor-icons-Dyg7S3Xx.js";const Oe=()=>{const{user:a,role:o}=ie(),j=xe(),[i,y]=d.useState(new Date().getFullYear()),[x,V]=d.useState(new Date().getMonth()+1),[v,S]=d.useState(!0),[g,D]=d.useState(null),[n,X]=d.useState({todaySales:0,todayOrders:0,weekSales:0,weekOrders:0,monthSales:0,monthOrders:0,totalSales:0,totalOrders:0,pendingAmount:0,availableBalance:0}),[A,ee]=d.useState([]),[O,C]=d.useState([]),[te,se]=d.useState("");if(d.useEffect(()=>{a!=null&&a.uid&&(o==="owner"||o==="developer")&&$()},[a==null?void 0:a.uid,i,x,o]),o!=="owner"&&o!=="developer")return e.jsx("div",{className:"p-8 text-center",children:e.jsx("p",{className:"text-red-500",children:"Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©"})});const $=async()=>{if(a!=null&&a.uid){S(!0);try{const t=await Q(U(u,"restaurants",a.uid));t.exists()&&se(t.data().name||"Ø£Ø³Ø±ØªÙŠ");const s=await Q(U(u,"wallets",a.uid));if(s.exists()){const l=s.data();D(l)}else D({id:a.uid,ownerType:"restaurant",balance:0,totalSales:0,totalWithdrawn:0,pendingBalance:0});const r=_(G(u,"orders"),me("restaurantId","==",a.uid),Z("createdAt","desc"),z(200)),ce=(await H(r)).docs.map(l=>({id:l.id,...l.data()})),w=new Date,B=new Date(w.getFullYear(),w.getMonth(),w.getDate()),N=new Date(B);N.setDate(N.getDate()-7);const de=new Date(i,x-1,1),oe=new Date(i,x,0,23,59,59);let M=0,E=0,R=0,T=0,F=0,Y=0,W=0,P=0,q=0;const k=[];ce.forEach(l=>{var p,I;const h=((I=(p=l.createdAt)==null?void 0:p.toDate)==null?void 0:I.call(p))||new Date(l.createdAt),m=l.subtotal||0;k.length<20&&k.push({id:l.id,total:l.total,subtotal:l.subtotal,status:l.status,createdAt:l.createdAt}),["delivered","cancelled"].includes(l.status)||(q+=m),l.status==="delivered"&&(P++,W+=m,h>=B&&(E++,M+=m),h>=N&&(T++,R+=m),h>=de&&h<=oe&&(Y++,F+=m))}),X({todaySales:M,todayOrders:E,weekSales:R,weekOrders:T,monthSales:F,monthOrders:Y,totalSales:W,totalOrders:P,pendingAmount:q,availableBalance:(g==null?void 0:g.balance)||0}),ee(k),await ae()}catch(t){console.error("Error loading wallet data:",t),j.error("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")}finally{S(!1)}}},ae=async()=>{if(a!=null&&a.uid)try{const t=_(G(u,"wallets",a.uid,"transactions"),Z("createdAt","desc"),z(50)),s=await H(t);C(s.docs.map(r=>({id:r.id,...r.data()})))}catch{C([])}},L=t=>{let s=x+t,r=i;s>12?(s=1,r++):s<1&&(s=12,r--),V(s),y(r)},le=t=>["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"][t-1],c=t=>`${t.toFixed(2)} Ø±.Ø³`,re=t=>({pending:{text:"Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„",color:"text-amber-600 bg-amber-50"},accepted:{text:"Ù…Ù‚Ø¨ÙˆÙ„",color:"text-blue-600 bg-blue-50"},preparing:{text:"Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±",color:"text-purple-600 bg-purple-50"},ready:{text:"Ø¬Ø§Ù‡Ø²",color:"text-sky-600 bg-sky-50"},out_for_delivery:{text:"ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚",color:"text-orange-600 bg-orange-50"},delivered:{text:"ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…",color:"text-emerald-600 bg-emerald-50"},cancelled:{text:"Ù…Ù„ØºÙŠ",color:"text-red-600 bg-red-50"}})[t]||{text:t,color:"text-gray-600 bg-gray-50"},ne=t=>{var r;return t?(((r=t==null?void 0:t.toDate)==null?void 0:r.call(t))||new Date(t)).toLocaleDateString("ar-SA",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"-"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-sky-900 flex items-center gap-2",children:[e.jsx(he,{className:"w-7 h-7"}),"Ù…Ø­ÙØ¸ØªÙŠ"]}),e.jsx("p",{className:"text-sky-600 mt-1",children:te})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-xl p-2 shadow-sm border border-sky-100",children:[e.jsx("button",{onClick:()=>L(-1),className:"p-2 hover:bg-sky-50 rounded-lg transition",children:e.jsx(pe,{className:"w-5 h-5 text-sky-600"})}),e.jsxs("div",{className:"px-4 py-2 font-semibold text-sky-900 min-w-[140px] text-center",children:[le(x)," ",i]}),e.jsx("button",{onClick:()=>L(1),className:"p-2 hover:bg-sky-50 rounded-lg transition",children:e.jsx(ue,{className:"w-5 h-5 text-sky-600"})}),e.jsx("button",{onClick:$,className:"p-2 hover:bg-sky-50 rounded-lg transition mr-2",title:"ØªØ­Ø¯ÙŠØ«",children:e.jsx(J,{className:`w-5 h-5 text-sky-600 ${v?"animate-spin":""}`})})]})]}),v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"w-8 h-8 animate-spin text-sky-500 mx-auto mb-3"}),e.jsx("p",{className:"text-sky-600",children:"Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-br from-sky-500 to-sky-600 rounded-2xl p-6 text-white shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("span",{className:"text-sky-100 flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),"Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­"]}),e.jsx("span",{className:"bg-white/20 px-3 py-1 rounded-full text-sm",children:"Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø£Ø³Ø±Ø©"})]}),e.jsx("p",{className:"text-4xl font-bold mb-2",children:c(n.availableBalance)}),e.jsxs("div",{className:"flex gap-6 mt-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sky-200",children:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª"}),e.jsx("p",{className:"font-semibold",children:c(n.totalSales)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sky-200",children:"Ù…Ø¹Ù„Ù‚"}),e.jsx("p",{className:"font-semibold",children:c(n.pendingAmount)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sky-200",children:"Ø§Ù„Ø·Ù„Ø¨Ø§Øª"}),e.jsx("p",{className:"font-semibold",children:n.totalOrders})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(b,{title:"Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…",value:c(n.todaySales),subtitle:`${n.todayOrders} Ø·Ù„Ø¨`,icon:e.jsx(je,{className:"w-5 h-5"}),color:"emerald"}),e.jsx(b,{title:"Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",value:c(n.weekSales),subtitle:`${n.weekOrders} Ø·Ù„Ø¨`,icon:e.jsx(ye,{className:"w-5 h-5"}),color:"sky"}),e.jsx(b,{title:"Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±",value:c(n.monthSales),subtitle:`${n.monthOrders} Ø·Ù„Ø¨`,icon:e.jsx(ge,{className:"w-5 h-5"}),color:"purple"}),e.jsx(b,{title:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª",value:c(n.totalSales),subtitle:`${n.totalOrders} Ø·Ù„Ø¨`,icon:e.jsx(fe,{className:"w-5 h-5"}),color:"amber"})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sky-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-sky-900 mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª"]}),A.length>0?e.jsx("div",{className:"space-y-3",children:A.slice(0,10).map(t=>{const s=re(t.status);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-sky-50/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-sky-100 rounded-full flex items-center justify-center",children:e.jsx(K,{className:"w-5 h-5 text-sky-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-sky-900 text-sm",children:["Ø·Ù„Ø¨ #",t.id.slice(-6)]}),e.jsx("p",{className:"text-xs text-sky-500",children:ne(t.createdAt)})]})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold text-sky-900",children:c(t.subtotal)}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${s.color}`,children:s.text})]})]},t.id)})}):e.jsx("p",{className:"text-center text-sky-500 py-8",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯"})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-sky-100",children:[e.jsxs("h2",{className:"text-lg font-bold text-sky-900 mb-4 flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5"}),"Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª"]}),O.length>0?e.jsx("div",{className:"space-y-3",children:O.map(t=>{var s,r,f;return e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-sky-50 last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${t.type==="credit"?"bg-emerald-100":"bg-red-100"}`,children:t.type==="credit"?e.jsx(Ne,{className:"w-5 h-5 text-emerald-600"}):e.jsx(ke,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sky-900 text-sm",children:t.description}),e.jsx("p",{className:"text-xs text-sky-500",children:((f=(r=(s=t.createdAt)==null?void 0:s.toDate)==null?void 0:r.call(s))==null?void 0:f.toLocaleDateString("ar-SA"))||(t.createdAt instanceof Date?t.createdAt.toLocaleDateString("ar-SA"):"-")})]})]}),e.jsxs("span",{className:`font-bold ${t.type==="credit"?"text-emerald-600":"text-red-600"}`,children:[t.type==="credit"?"+":"-",c(t.amount)]})]},t.id)})}):e.jsx("p",{className:"text-center text-sky-500 py-8",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø¹Ø¯"})]}),e.jsx("div",{className:"bg-sky-50 rounded-xl p-4 border border-sky-100",children:e.jsx("p",{className:"text-sm text-sky-700 text-center",children:"ðŸ’¡ ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø© Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø®Ù„Ø§Ù„ 3-5 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„ Ø¨Ø¹Ø¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨"})})]})]})},b=({title:a,value:o,subtitle:j,icon:i,color:y})=>{const x={sky:"bg-sky-50 text-sky-600",emerald:"bg-emerald-50 text-emerald-600",purple:"bg-purple-50 text-purple-600",amber:"bg-amber-50 text-amber-600"};return e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-sky-100",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${x[y]} flex items-center justify-center mb-3`,children:i}),e.jsx("p",{className:"text-sm text-sky-600 mb-1",children:a}),e.jsx("p",{className:"text-xl font-bold text-sky-900",children:o}),e.jsx("p",{className:"text-xs text-sky-500 mt-1",children:j})]})};export{Oe as OwnerWalletPage,Oe as default};
