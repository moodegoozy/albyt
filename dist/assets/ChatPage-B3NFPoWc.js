import{u as B,b as F,j as e,d as u}from"./index-FuU3jBZc.js";import{e as H,b as J,r as n}from"./vendor-react-C_wfuX_s.js";import{n as E,k as y,j as k,q as L,F as V,m as C,y as W,z as X}from"./vendor-firebase-Co4MdP0H.js";import{ag as Y,A as Z,S as A,i as ee,P as te,j as se,K as re,aP as M,aQ as ae,aN as ie,g as ne}from"./vendor-icons-Dyg7S3Xx.js";const ce=[{text:"Ø£ÙŠÙ† ÙˆØµÙ„ØªØŸ ğŸ“",emoji:"ğŸ“"},{text:"Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! ğŸ’™",emoji:"ğŸ’™"},{text:"Ø®Ø° Ø±Ø§Ø­ØªÙƒ ğŸ˜Š",emoji:"ğŸ˜Š"},{text:"Ø£Ù†Ø§ Ø¨Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± â³",emoji:"â³"},{text:"ØªÙ…Ø§Ù… ğŸ‘",emoji:"ğŸ‘"},{text:"Ù…Ù…ØªØ§Ø²! â­",emoji:"â­"}],le=[{text:"ÙƒÙ… Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©ØŸ â±ï¸",emoji:"â±ï¸"},{text:"Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ…! ğŸ’™",emoji:"ğŸ’™"},{text:"Ù‡Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¬Ø§Ù‡Ø²ØŸ ğŸ“¦",emoji:"ğŸ“¦"},{text:"Ø£Ø­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ ğŸ“",emoji:"ğŸ“"},{text:"Ù…Ù…ØªØ§Ø²! â­",emoji:"â­"},{text:"ØªÙ…Ø§Ù… ğŸ‘",emoji:"ğŸ‘"}],oe=[{text:"ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø¥Ù„ÙŠÙƒ! ğŸš—",emoji:"ğŸš—"},{text:"ÙˆØµÙ„Øª! ğŸ“",emoji:"ğŸ“"},{text:"Ø¯Ù‚Ø§Ø¦Ù‚ ÙˆØ£ÙˆØµÙ„ â±ï¸",emoji:"â±ï¸"},{text:"Ø£Ø­ØªØ§Ø¬ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ğŸ“Œ",emoji:"ğŸ“Œ"},{text:"Ø§ØªØµÙ„ Ø¨ÙŠ ğŸ“",emoji:"ğŸ“"},{text:"Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ! ğŸ™",emoji:"ğŸ™"}],de=[{text:"Ø·Ù„Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ± ğŸ‘¨â€ğŸ³",emoji:"ğŸ‘¨â€ğŸ³"},{text:"Ø§Ù„Ø·Ù„Ø¨ Ø¬Ø§Ù‡Ø²! ğŸ“¦",emoji:"ğŸ“¦"},{text:"Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ ğŸš—",emoji:"ğŸš—"},{text:"Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ! ğŸ™",emoji:"ğŸ™"},{text:"Ù†Ø¹ØªØ°Ø± Ø¹Ù† Ø§Ù„ØªØ£Ø®ÙŠØ± â³",emoji:"â³"},{text:"ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ âœ…",emoji:"âœ…"}],me=["ğŸ˜Š","ğŸ‘","â¤ï¸","ğŸ”¥","â­","ğŸ™","ğŸ’ª","ğŸ‰","â˜•","ğŸ•","ğŸš—","ğŸ“"],pe=()=>{const[R]=H(),c=R.get("orderId"),_=J(),{user:i,role:h}=B(),T=F(),[r,P]=n.useState(null),[f,U]=n.useState([]),[x,g]=n.useState(""),[K,v]=n.useState(!1),[p,w]=n.useState(!1),[O,j]=n.useState(""),S=n.useRef(null),d=h==="courier",m=h==="owner",N=h==="customer"||h==="admin",o=r&&!r.courierId&&r.restaurantId,Q=d?oe:m?de:N&&o?le:ce;n.useEffect(()=>{if(!c)return;const t=E(y(u,"orders",c),s=>{if(s.exists()){const a=s.data();P({id:s.id,status:a.status,address:a.address,total:a.total,customerId:a.customerId,courierId:a.courierId,restaurantId:a.restaurantId,restaurantName:a.restaurantName})}});return()=>t()},[c]),n.useEffect(()=>{if(!r)return;let t,s="customer";if(d||m?(t=r.customerId,s="customer"):N&&(r.courierId?(t=r.courierId,s="courier"):r.restaurantId&&(t=r.restaurantId,s="restaurant")),!t){j(o?r.restaurantName||"Ø§Ù„Ù…Ø·Ø¹Ù…":"ØºÙŠØ± Ù…Ø­Ø¯Ø¯");return}s==="restaurant"?k(y(u,"restaurants",t)).then(a=>{var l;a.exists()?j(((l=a.data())==null?void 0:l.name)||"Ø§Ù„Ù…Ø·Ø¹Ù…"):j(r.restaurantName||"Ø§Ù„Ù…Ø·Ø¹Ù…")}):k(y(u,"users",t)).then(a=>{var l;if(a.exists()){const z=s==="courier"?"Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨":"Ø§Ù„Ø¹Ù…ÙŠÙ„";j(((l=a.data())==null?void 0:l.name)||z)}})},[r,d,m,N,o]),n.useEffect(()=>{if(!c)return;const t=L(C(u,"orders",c,"messages"),V("createdAt","asc")),s=E(t,a=>{U(a.docs.map(l=>({id:l.id,...l.data()})))});return()=>s()},[c]),n.useEffect(()=>{var t;(t=S.current)==null||t.scrollIntoView({behavior:"smooth"})},[f]);const b=async t=>{if(!(!t.trim()||!i||!c)){v(!0);try{let s="customer";d?s="courier":m&&(s="owner"),await W(C(u,"orders",c,"messages"),{text:t.trim(),senderId:i.uid,senderRole:s,createdAt:X()}),g(""),w(!1)}catch{T.error("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©")}v(!1)}},$=t=>{g(s=>s+t)},G=t=>t?t.toDate().toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"",q=t=>({pending:{text:"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",color:"bg-yellow-500",emoji:"â³"},accepted:{text:"ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„",color:"bg-blue-500",emoji:"âœ…"},preparing:{text:"Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±",color:"bg-orange-500",emoji:"ğŸ‘¨â€ğŸ³"},ready:{text:"Ø¬Ø§Ù‡Ø²",color:"bg-purple-500",emoji:"ğŸ“¦"},out_for_delivery:{text:"ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚",color:"bg-sky-500",emoji:"ğŸš—"},delivered:{text:"ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…",color:"bg-green-500",emoji:"âœ…"}})[t]||{text:t,color:"bg-gray-500",emoji:"ğŸ“¦"},D=()=>d||m?"ğŸ‘¤":o?"ğŸ½ï¸":"ğŸš—";if(!c)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨"})]})});if(!r)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„..."})]})});if(!((i==null?void 0:i.uid)===r.customerId||(i==null?void 0:i.uid)===r.courierId||(i==null?void 0:i.uid)===r.restaurantId))return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ”’"}),e.jsx("p",{className:"text-gray-500",children:"Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©"})]})});const I=q(r.status);return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-200px)] max-w-2xl mx-auto",children:[e.jsxs("div",{className:`bg-gradient-to-r ${o?"from-orange-500 via-amber-500 to-yellow-500":"from-primary via-sky-500 to-accent"} rounded-t-3xl p-4 shadow-luxury`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>_(-1),className:"w-10 h-10 rounded-full bg-white/20 backdrop-blur flex items-center justify-center hover:bg-white/30 transition-all",children:e.jsx(Z,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 backdrop-blur flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:D()})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-white text-lg",children:O||(o?"Ø§Ù„Ù…Ø·Ø¹Ù…":d||m?"Ø§Ù„Ø¹Ù…ÙŠÙ„":"Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨")}),e.jsxs("div",{className:"flex items-center gap-1 text-white/80 text-sm",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${r.status==="delivered"?"bg-green-400":"bg-yellow-400 animate-pulse"}`}),e.jsxs("span",{children:[I.emoji," ",I.text]})]})]})]})}),o?e.jsx(A,{className:"w-6 h-6 text-white animate-pulse"}):e.jsx(ee,{className:"w-6 h-6 text-yellow-300 animate-pulse"})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-4 text-white/90 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsxs("span",{children:["#",r.id.slice(-6)]})]}),r.restaurantName&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:r.restaurantName})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate max-w-[150px]",children:r.address})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-gradient-to-b from-sky-50 to-white p-4 space-y-3",children:[f.length===0&&e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ’¬"}),e.jsx("p",{className:"text-gray-500",children:"Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¢Ù†!"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„ØªÙˆØ§ØµÙ„"})]}),f.map((t,s)=>{const a=t.senderId===(i==null?void 0:i.uid);return e.jsx("div",{className:`flex ${a?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`
                  max-w-[80%] rounded-2xl px-4 py-3 shadow-md
                  ${a?"bg-gradient-to-br from-primary to-sky-600 text-white rounded-bl-sm":"bg-white text-gray-800 rounded-br-sm border border-gray-100"}
                  transform transition-all duration-300 hover:scale-[1.02]
                `,children:[e.jsx("p",{className:"text-base leading-relaxed",children:t.text}),e.jsxs("div",{className:`flex items-center gap-1 mt-1 text-xs ${a?"text-white/70":"text-gray-400"}`,children:[e.jsx(re,{className:"w-3 h-3"}),e.jsx("span",{children:G(t.createdAt)}),a&&e.jsx(M,{className:"w-3 h-3 mr-1"})]})]})},t.id)}),e.jsx("div",{ref:S})]}),e.jsx("div",{className:"bg-white border-t border-gray-100 px-3 py-2",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:Q.map((t,s)=>e.jsx("button",{onClick:()=>b(t.text),className:`flex-shrink-0 px-4 py-2 bg-gradient-to-r from-sky-50 to-blue-50 
                         rounded-full text-sm text-primary font-medium border border-sky-100
                         hover:from-sky-100 hover:to-blue-100 hover:shadow-md 
                         transition-all duration-200 active:scale-95`,children:t.text},s))})}),p&&e.jsx("div",{className:"bg-white border-t border-gray-100 px-4 py-3",children:e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:me.map((t,s)=>e.jsx("button",{onClick:()=>$(t),className:`w-10 h-10 text-2xl hover:bg-gray-100 rounded-full 
                           transition-all duration-200 hover:scale-125 active:scale-95`,children:t},s))})}),e.jsx("div",{className:"bg-white border-t border-gray-200 p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>w(!p),className:`w-10 h-10 rounded-full flex items-center justify-center transition-all
                       ${p?"bg-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:e.jsx(ae,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{type:"text",value:x,onChange:t=>g(t.target.value),onKeyPress:t=>t.key==="Enter"&&b(x),placeholder:"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...",className:`w-full px-5 py-3 bg-gray-100 rounded-full text-gray-800 
                         placeholder-gray-400 focus:outline-none focus:ring-2 
                         focus:ring-primary/50 focus:bg-white transition-all`})}),e.jsx("button",{onClick:()=>b(x),disabled:!x.trim()||K,className:`w-12 h-12 rounded-full flex items-center justify-center transition-all
                       ${x.trim()?"bg-gradient-to-r from-primary to-accent text-white shadow-lg hover:shadow-xl hover:scale-105":"bg-gray-200 text-gray-400"}
                       disabled:opacity-50 active:scale-95`,children:e.jsx(ie,{className:"w-5 h-5"})})]})}),r.status==="delivered"&&e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-white",children:[e.jsx(M,{className:"w-6 h-6"}),e.jsx("span",{className:"font-bold",children:"ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰"}),e.jsx(ne,{className:"w-5 h-5 text-red-300 animate-pulse"})]}),e.jsx("p",{className:"text-white/80 text-sm mt-1",children:"Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ ØªØ·Ø¨ÙŠÙ‚Ù†Ø§ â­"})]})]})};export{pe as ChatPage};
