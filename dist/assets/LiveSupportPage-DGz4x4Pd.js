import{u as Q,b as U,d as o,j as e}from"./index-FuU3jBZc.js";import{b as H,r as l}from"./vendor-react-C_wfuX_s.js";import{q as I,F as _,m as u,n as z,G,w as T,t as K,u as b,k as j,z as c,y as x,x as O}from"./vendor-firebase-Co4MdP0H.js";import{L as q,H as D,X as V,i as X,ag as J,aR as $,aN as W}from"./vendor-icons-Dyg7S3Xx.js";const Y=[{keywords:["Ù…Ø±Ø­Ø¨Ø§","Ø§Ù„Ø³Ù„Ø§Ù…","Ù‡Ù„Ø§","Ø§Ù‡Ù„Ø§"],reply:"Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! ðŸ‘‹ ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ"},{keywords:["Ø·Ù„Ø¨","Ù…ØªØ£Ø®Ø±","ØªØ£Ø®Ø±","ÙˆÙŠÙ† Ø§Ù„Ø·Ù„Ø¨"],reply:"Ù†Ø¹ØªØ°Ø± Ø¹Ù† Ø§Ù„ØªØ£Ø®ÙŠØ±! Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø®Ø¨Ø§Ø±ÙŠ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ù„Ù…ØªØ§Ø¨Ø¹ØªÙ‡ØŸ"},{keywords:["Ø§Ù„ØºØ§Ø¡","Ø§Ù„ØºÙŠ","Ø£Ù„ØºÙŠ","Ø±Ø¬Ø¹ ÙÙ„ÙˆØ³ÙŠ"],reply:"Ø³Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨. Ù…Ø§ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ØŸ ÙˆÙ…Ø§ Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ØŸ"},{keywords:["Ø´ÙƒØ±Ø§","Ù…Ø´ÙƒÙˆØ±","ØªØ³Ù„Ù…"],reply:"Ø§Ù„Ø¹ÙÙˆ! Ø³Ø¹ÙŠØ¯ÙŠÙ† Ø¨Ø®Ø¯Ù…ØªÙƒ ðŸŒŸ Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ø£ÙŠ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø£Ø®Ø±Ù‰ØŸ"}],Z=[{q:"ÙƒÙŠÙ Ø£Ù„ØºÙŠ Ø·Ù„Ø¨ÙŠØŸ",icon:"âŒ"},{q:"Ø£ÙŠÙ† Ø·Ù„Ø¨ÙŠ Ø§Ù„Ø¢Ù†ØŸ",icon:"ðŸ“"},{q:"Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¯ÙØ¹",icon:"ðŸ’³"},{q:"Ø´ÙƒÙˆÙ‰ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø±Ø©",icon:"ðŸ "},{q:"Ø´ÙƒÙˆÙ‰ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨",icon:"ðŸš—"},{q:"Ø£Ø®Ø±Ù‰",icon:"ðŸ’¬"}],re=()=>{H();const{user:r,role:F}=Q(),p=U(),w=l.useRef(null),N=l.useRef(null),[t,h]=l.useState(null),[v,k]=l.useState([]),[L,B]=l.useState(!0),[m,C]=l.useState(!1),[f,R]=l.useState(""),[M,g]=l.useState(!0),[S,A]=l.useState(!1);l.useEffect(()=>{if(!(r!=null&&r.uid))return;(async()=>{const a=I(u(o,"supportChats"),T("userId","==",r.uid),T("status","in",["active","waiting"]),G(1)),n=await K(a);if(!n.empty){const d={id:n.docs[0].id,...n.docs[0].data()};h(d),g(!1)}B(!1)})()},[r==null?void 0:r.uid]),l.useEffect(()=>{if(!(t!=null&&t.id))return;const s=I(u(o,"supportChats",t.id,"messages"),_("createdAt","asc")),a=z(s,n=>{const d=n.docs.map(i=>({id:i.id,...i.data()}));k(d),d.some(i=>!i.read&&i.senderRole==="support")&&b(j(o,"supportChats",t.id),{unreadByUser:0})});return()=>a()},[t==null?void 0:t.id]),l.useEffect(()=>{var s;(s=w.current)==null||s.scrollIntoView({behavior:"smooth"})},[v,S]);const E=async s=>{if(r!=null&&r.uid)try{const a={userId:r.uid,userName:r.displayName||"Ù…Ø³ØªØ®Ø¯Ù…",userRole:F||"customer",status:"waiting",subject:s||"Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ø§Ù…",priority:"medium",createdAt:c(),updatedAt:c(),unreadByUser:0,unreadBySupport:1},n=await x(u(o,"supportChats"),a),d={id:n.id,...a};h(d),g(!1),await x(u(o,"supportChats",n.id,"messages"),{chatId:n.id,senderId:"bot",senderName:"Ù…Ø³Ø§Ø¹Ø¯ Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª",senderRole:"bot",message:`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${r.displayName||"Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø¹Ù…ÙŠÙ„"}! ðŸ‘‹

Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø¢Ù„ÙŠ. Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¨Ù…Ø´ÙƒÙ„ØªÙƒ ÙˆØ³Ø£Ø­Ø§ÙˆÙ„ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŒ Ø£Ùˆ Ø³ÙŠØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚.

${s?`Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±: ${s}`:""}`,type:"bot",createdAt:c(),read:!1}),setTimeout(()=>{var i;return(i=N.current)==null?void 0:i.focus()},100)}catch(a){console.error("Error starting chat:",a),p.error("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰")}},y=async s=>{const a=s||f.trim();if(!(!a||!(t!=null&&t.id)||m)){C(!0),R("");try{await x(u(o,"supportChats",t.id,"messages"),{chatId:t.id,senderId:r==null?void 0:r.uid,senderName:(r==null?void 0:r.displayName)||"Ù…Ø³ØªØ®Ø¯Ù…",senderRole:"user",message:a,type:"user",createdAt:c(),read:!1}),await b(j(o,"supportChats",t.id),{lastMessage:a,lastMessageAt:c(),updatedAt:c(),unreadBySupport:O(1)}),setTimeout(async()=>{A(!0);const n=Y.find(d=>d.keywords.some(i=>a.toLowerCase().includes(i)));await new Promise(d=>setTimeout(d,1500)),n&&await x(u(o,"supportChats",t.id,"messages"),{chatId:t.id,senderId:"bot",senderName:"Ù…Ø³Ø§Ø¹Ø¯ Ø³ÙØ±Ø© Ø§Ù„Ø¨ÙŠØª",senderRole:"bot",message:n.reply,type:"bot",createdAt:c(),read:!1}),A(!1)},500)}catch(n){console.error("Error sending message:",n),p.error("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©")}finally{C(!1)}}},P=async()=>{t!=null&&t.id&&(await b(j(o,"supportChats",t.id),{status:"closed",updatedAt:c()}),h(null),k([]),g(!0),p.success("ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©"))};return L?e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-10 h-10 animate-spin text-sky-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..."})]})}):e.jsxs("div",{className:"max-w-2xl mx-auto h-[calc(100vh-120px)] flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-sky-600 via-sky-500 to-blue-500 rounded-t-2xl p-4 text-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(D,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:"Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ"}),e.jsx("p",{className:"text-sky-100 text-sm flex items-center gap-1",children:(t==null?void 0:t.status)==="active"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†"]}):(t==null?void 0:t.status)==="waiting"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 bg-amber-400 rounded-full animate-pulse"}),"Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¯Ø¹Ù…"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full"}),"Ù…ØªØ§Ø­ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©"]})})]})]}),t&&e.jsx("button",{onClick:P,className:"p-2 hover:bg-white/20 rounded-full transition",title:"Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©",children:e.jsx(V,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"flex-1 bg-gradient-to-b from-gray-50 to-white overflow-y-auto p-4 space-y-4",children:[M&&!t&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-sky-400 to-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center shadow-lg",children:e.jsx(X,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Ø§Ø®ØªØ± Ù…ÙˆØ¶ÙˆØ¹Ø§Ù‹ Ø£Ùˆ Ø§Ø¨Ø¯Ø£ Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¨Ø§Ø´Ø±Ø©"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Z.map((s,a)=>e.jsxs("button",{onClick:()=>E(s.q),className:`flex items-center gap-3 p-4 bg-white rounded-xl border-2 border-gray-100 
                             hover:border-sky-300 hover:shadow-md transition-all text-right`,children:[e.jsx("span",{className:"text-2xl",children:s.icon}),e.jsx("span",{className:"font-medium text-gray-700 text-sm",children:s.q})]},a))}),e.jsxs("button",{onClick:()=>E(),className:`w-full flex items-center justify-center gap-3 py-4 px-6 
                         bg-gradient-to-r from-sky-500 to-blue-600 hover:from-sky-600 hover:to-blue-700
                         text-white rounded-2xl font-bold shadow-lg transition-all`,children:[e.jsx(J,{className:"w-6 h-6"}),e.jsx("span",{children:"Ø§Ø¨Ø¯Ø£ Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…"})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-amber-800 text-sm",children:"â° ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… Ù…ØªØ§Ø­ Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¹Ø©"}),e.jsx("p",{className:"text-amber-600 text-xs mt-1",children:"Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø±Ø¯: Ø£Ù‚Ù„ Ù…Ù† 5 Ø¯Ù‚Ø§Ø¦Ù‚"})]})]}),v.map(s=>{var a,n;return e.jsx("div",{className:`flex ${s.senderRole==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] ${s.senderRole==="user"?"order-1":"order-2"}`,children:[s.senderRole!=="user"&&e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${s.senderRole==="bot"?"bg-purple-100":"bg-sky-100"}`,children:s.senderRole==="bot"?e.jsx($,{className:"w-4 h-4 text-purple-600"}):e.jsx(D,{className:"w-4 h-4 text-sky-600"})}),e.jsx("span",{className:"text-xs text-gray-500",children:s.senderName})]}),e.jsx("div",{className:`rounded-2xl px-4 py-3 ${s.senderRole==="user"?"bg-gradient-to-r from-sky-500 to-blue-500 text-white rounded-br-md":s.senderRole==="bot"?"bg-purple-50 text-gray-800 border border-purple-100 rounded-bl-md":"bg-white text-gray-800 border border-gray-200 shadow-sm rounded-bl-md"}`,children:e.jsx("p",{className:"whitespace-pre-wrap text-sm leading-relaxed",children:s.message})}),e.jsx("p",{className:`text-xs text-gray-400 mt-1 ${s.senderRole==="user"?"text-left":"text-right"}`,children:((n=(a=s.createdAt)==null?void 0:a.toDate)==null?void 0:n.call(a).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}))||""})]})},s.id)}),S&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx($,{className:"w-4 h-4 text-purple-600"})}),e.jsx("div",{className:"bg-gray-100 rounded-2xl px-4 py-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),e.jsx("div",{ref:w})]}),t&&e.jsxs("div",{className:"bg-white border-t border-gray-200 p-4 rounded-b-2xl flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{ref:N,type:"text",value:f,onChange:s=>R(s.target.value),onKeyPress:s=>s.key==="Enter"&&y(),placeholder:"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...",className:`flex-1 px-4 py-3 bg-gray-100 rounded-xl border-2 border-transparent 
                       focus:border-sky-300 focus:bg-white focus:outline-none transition`,disabled:m}),e.jsx("button",{onClick:()=>y(),disabled:!f.trim()||m,className:`w-12 h-12 bg-gradient-to-r from-sky-500 to-blue-500 hover:from-sky-600 hover:to-blue-700
                       text-white rounded-xl flex items-center justify-center transition-all
                       disabled:opacity-50 disabled:cursor-not-allowed`,children:m?e.jsx(q,{className:"w-5 h-5 animate-spin"}):e.jsx(W,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex gap-2 mt-3 overflow-x-auto pb-1",children:["Ø£ÙŠÙ† Ø·Ù„Ø¨ÙŠØŸ","Ø£Ø±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨","ØªØ­Ø¯Ø« Ù…Ø¹ Ù…ÙˆØ¸Ù"].map((s,a)=>e.jsx("button",{onClick:()=>y(s),disabled:m,className:`flex-shrink-0 px-3 py-1.5 bg-gray-100 hover:bg-sky-100 
                         text-gray-600 hover:text-sky-700 rounded-full text-sm transition`,children:s},a))})]})]})};export{re as LiveSupportPage,re as default};
